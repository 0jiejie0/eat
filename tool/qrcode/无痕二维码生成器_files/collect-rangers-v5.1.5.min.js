(()=>{var l=function(){return(l=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(((e,t)=>{var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=r.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return a})(arguments[t]));return e}function B(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)}function N(e){return window.btoa?window.btoa(encodeURIComponent(e)):encodeURIComponent(e)}function U(e){if("string"==typeof e){for(var t=[],i=String.fromCharCode(122),n=e.split(i),o=0;o<n.length;o++){var r=64^+parseInt(n[o],25),r=String.fromCharCode(r);t.push(r)}return t.join("")}}function V(e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)}function L(){var t=0;return["hidden","msHidden","webkitHidden"].forEach(function(e){void 0!==document[e]&&(t=1)}),t}function z(e){var t=document.createElement("a");return t.href=e,t}function c(e){var o={};try{z(e).search.slice(1).split("&").forEach(function(e){var t,i,n=e.split("=");n.length&&(t=n[0],i=n[1]);try{o[t]=decodeURIComponent(void 0===i?"":i)}catch(e){o[t]=i}})}catch(e){}return o}function j(e){for(var t=0,i=0,n=(e+="").length,o=0;o<n;o++)(0x7fffffffffff<(t=31*t+e.charCodeAt(i++))||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t}e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(i,n){var o=this;i&&n&&"function"==typeof n&&this.on(i,function e(t){n(t),o.off(i,e)})},e.prototype.off=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&(t?-1!==(t=this._hooks[e].indexOf(t))&&this._hooks[e].splice(t,1):this._hooks[e]=[])},e.prototype.emit=function(e,t,i){i?e&&(-1!==this._cache.indexOf(i)?this._emit(e,t):(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(e)||(this._hooksCache[i][e]=[]),this._hooksCache[i][e].push(t))):this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&s(this._hooks[e]).forEach(function(e){try{e(t)}catch(e){}})},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)};var K,q=e,J=function(e){return Array.isArray(e)},H=(K=+Date.now()+Number((""+Math.random()).slice(2,8)),function(e,t,i){var n=document.createElement("script");n.src=e,n.onerror=function(){i(e)},n.onload=function(){t()},document.getElementsByTagName("head")[0].appendChild(n)}),W="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(){this._hooks={},this._cache=[],this._hooksCache={}}var h=(r={exports:{}}).exports=function(){function s(){for(var e=0,t={};e<arguments.length;e++){var i,n=arguments[e];for(i in n)t[i]=n[i]}return t}function l(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(c){function a(){}function i(e,t,i){if("undefined"!=typeof document){"number"==typeof(i=s({path:"/"},a.defaults,i)).expires&&(i.expires=new Date(+new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var n=JSON.stringify(t);/^[\{\[]/.test(n)&&(t=n)}catch(e){}t=c.write?c.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o,r="";for(o in i)i[o]&&(r+="; "+o,!0!==i[o])&&(r+="="+i[o].split(";")[0]);return document.cookie=e+"="+t+r}}function t(e,t){if("undefined"!=typeof document){for(var i={},n=document.cookie?document.cookie.split("; "):[],o=0;o<n.length;o++){var r=n[o].split("="),a=r.slice(1).join("=");t||'"'!==a.charAt(0)||(a=a.slice(1,-1));try{var s=l(r[0]),a=(c.read||c)(a,s)||l(a);if(t)try{a=JSON.parse(a)}catch(e){}if(i[s]=a,e===s)break}catch(e){}}return e?i[e]:i}}return a.set=i,a.get=function(e){return t(e,!1)},a.getJSON=function(e){return t(e,!0)},a.remove=function(e,t){i(e,"",s(t,{expires:-1}))},a.defaults={},a.withConverter=e,a}(function(){})}(),$=(t.prototype.setItem=function(e,t){this.cache[e]=t},t.prototype.getItem=function(e){return this.cache[e]},t.prototype.removeItem=function(e){this.cache[e]=void 0},t.prototype.getCookie=function(e){this.getItem(e)},t.prototype.setCookie=function(e,t){this.setItem(e,t)},t);function t(){this.cache={}}var F={getItem:function(e){try{var t=localStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){try{return h.get(e,{domain:t||document.domain})}catch(e){return""}},setCookie:function(e,t,i,n){try{var o=n||document.domain,r=+new Date+i;h.set(e,t,{expires:new Date(r),path:"/",domain:o})}catch(e){}},isSupportLS:(()=>{try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}})()},X={getItem:function(e){try{var t=sessionStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e){this.getItem(e)},setCookie:function(e,t){this.setItem(e,t)},isSupportSession:(()=>{try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}})()},f=(n.prototype.getItem=function(e){return this._storage.getItem(e)},n.prototype.setItem=function(e,t){this._storage.setItem(e,t)},n.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},n.prototype.setCookie=function(e,t,i,n){this._storage.setCookie(e,t,i,n)},n.prototype.removeItem=function(e){this._storage.removeItem(e)},n),Q=(i.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,i=document.referrer,n=i?z(i).hostname:"",o=c(window.location.href),r=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web",o=(this.utm=((e,t,i,n)=>{var o=new f(!1),r=new f(!1,"session"),a=e?"_tea_utm_cache_"+e:"_tea_utm_cache",s=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],h={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var u,p,d=!1;for(u in h)h[u]&&(-1!==l.indexOf(u)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[u]=h[u]):c[u]=h[u],d=!0);d?(r.setItem(s,"1"),o.setCookie(a,JSON.stringify(c),n,i)):(p=o.getCookie(a,i))&&(c=JSON.parse(p)),r.getItem(s)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return h}return c})(this.appid,o,this.domain,this.cookie_expire),this.browser()),a=this.os();return{browser:o.browser,browser_version:o.browser_version,platform:r,os_name:a.os_name,os_version:a.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(a.os_name),language:t,referrer:i,referrer_host:n,utm:this.utm,latest_data:this.last(i,n)}},i.prototype.last=function(e,t){var i="",n="",o="",r=location.hostname,a=!1;return e&&t&&r!==t&&(n=t,a=!0,(r=c(i=e)).keyword)&&(o=r.keyword),{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:o,isLast:a}},i.prototype.browser=function(){var e,t="",i=""+parseFloat(this.appVersion),n=this.userAgent;return-1!==n.indexOf("Edge")||-1!==n.indexOf("Edg")?(t="Microsoft Edge",i=-1!==n.indexOf("Edge")?(e=n.indexOf("Edge"),n.substring(e+5)):(e=n.indexOf("Edg"),n.substring(e+4))):-1!==(e=n.indexOf("MSIE"))?(t="Microsoft Internet Explorer",i=n.substring(e+5)):-1!==(e=n.indexOf("Lark"))?(t="Lark",i=n.substring(e+5,e+11)):-1!==(e=n.indexOf("MetaSr"))?(t="sougoubrowser",i=n.substring(e+7,e+10)):-1!==n.indexOf("MQQBrowser")||-1!==n.indexOf("QQBrowser")?(t="qqbrowser",-1!==n.indexOf("MQQBrowser")?(e=n.indexOf("MQQBrowser"),i=n.substring(e+11,e+15)):-1!==n.indexOf("QQBrowser")&&(e=n.indexOf("QQBrowser"),i=n.substring(e+10,e+17))):-1!==n.indexOf("Chrome")?-1!==(e=n.indexOf("MicroMessenger"))?(t="weixin",i=n.substring(e+15,e+20)):-1!==(e=n.indexOf("360"))?(t="360browser",i=n.substring(n.indexOf("Chrome")+7)):-1!==n.indexOf("baidubrowser")||-1!==n.indexOf("BIDUBrowser")?(-1!==n.indexOf("baidubrowser")?(e=n.indexOf("baidubrowser"),i=n.substring(e+13,e+16)):-1!==n.indexOf("BIDUBrowser")&&(e=n.indexOf("BIDUBrowser"),i=n.substring(e+12,e+15)),t="baidubrowser"):-1!==(e=n.indexOf("xiaomi"))?i=-1!==n.indexOf("openlanguagexiaomi")?(t="openlanguage xiaomi",n.substring(e+7,e+13)):(t="xiaomi",n.substring(e-7,e-1)):-1!==(e=n.indexOf("TTWebView"))?(t="TTWebView",i=n.substring(e+10,e+23)):-1===(e=n.indexOf("Chrome"))&&-1===(e=n.indexOf("Chrome"))||(t="Chrome",i=n.substring(e+7)):-1!==n.indexOf("Safari")?-1!==(e=n.indexOf("QQ"))?(t="qqbrowser",i=n.substring(e+10,e+16)):-1!==(e=n.indexOf("Safari"))&&(t="Safari",i=n.substring(e+7),-1!==(e=n.indexOf("Version")))&&(i=n.substring(e+8)):-1!==(e=n.indexOf("Firefox"))?(t="Firefox",i=n.substring(e+8)):-1!==(e=n.indexOf("MicroMessenger"))?(t="weixin",i=n.substring(e+15,e+20)):-1!==(e=n.indexOf("QQ"))?(t="qqbrowser",i=n.substring(e+3,e+8)):-1!==(e=n.indexOf("Opera"))&&(t="Opera",i=n.substring(e+6),-1!==(e=n.indexOf("Version")))&&(i=n.substring(e+8)),{browser:t,browser_version:i=-1!==(n=(i=-1!==(n=(i=-1!==(n=i.indexOf(";"))?i.substring(0,n):i).indexOf(" "))?i.substring(0,n):i).indexOf(")"))?i.substring(0,n):i}},i.prototype.os=function(){for(var e="",t="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<i.length;n++){var o=i[n];if(o.r.test(this.userAgent)){"Mac OS X"===(e=o.s)&&this.isNewIpad()&&(e="iOS");break}}function r(e,t){return(e=e.exec(t))&&e[1]?e[1]:""}function a(e,t){return(e=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t))?e.slice(1)[0]:""}var s;switch(/Windows/.test(e)&&(t=r(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=a("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":t=r(/Android ([\.\_\d]+)/,s=this.userAgent)||r(/Android\/([\.\_\d]+)/,s),e="android";break;case"iOS":t=this.isNewIpad()?a("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios"}return{os_name:e,os_version:t}},i.prototype.getDeviceModel=function(e){var t,i,n="";try{"android"===e?navigator.userAgent.split(";").forEach(function(e){-1<e.indexOf("Build/")&&(n=e.slice(0,e.indexOf("Build/")))}):"ios"!==e&&"mac"!==e&&"windows"!==e||(n=this.isNewIpad()?"iPad":(i=(t=navigator.userAgent.replace("Mozilla/5.0 (","")).indexOf(";"),t.slice(0,i)))}catch(e){}return n.trim()},i.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&1<navigator.maxTouchPoints},i),Z={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az24z1mz1jz1az1cz18z1nz1nz1jz1mz1ez4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},u="5.1.5_tob";function i(e,t,i){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}function n(e,t){this._storage=t&&"session"===t?X:!e&&F.isSupportLS?F:new $}var p,Y={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},ee=(te.prototype.checkVerify=function(e){var t,i,n,o=this;return!!(e&&e.length&&(e=e[0])&&(t=e.events,i=e.header,t)&&t.length)&&(n=!0,t.forEach(function(e){e?(o.checkEventName(e.event)||(n=!1,e.checkEvent="事件名不能以 $ or __开头"),o.checkEventParams(e.params)||(n=!1,e.checkParams="属性名不能以 $ or __开头")):(n=!1,e.checkEvent="事件异常")}),n=!!this.checkEventParams(i)&&n)},te.prototype.checkEventName=function(e){return!!e&&this.calculate(e,"event")},te.prototype.checkEventParams=function(e){var t=e,i=("string"==typeof e&&(t=JSON.parse(t)),!0);if(Object.keys(t).length)for(var n in t){if(!this.calculate(n,"params")){i=!1;break}if("string"==typeof t[n]&&1024<t[n].length){console.warn("params: "+n+" can not over 1024 byte, please check;"),i=!1;break}}return i},te.prototype.calculate=function(e,t){return-1!==("event"===t?this.eventNameWhiteList:"params"===t?this.paramsNameWhiteList:[]).indexOf(e)||!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||(console.warn(t+" name: "+e+" can not start with $ or __, pleace check;"),!1)},te);function te(e,t){this.collector=e,this.config=t,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","_be_active"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","$user_unique_id_type","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}(r=A=A||{}).Init="init",r.Config="config",r.Start="start",r.Ready="ready",r.TokenComplete="token-complete",r.TokenStorage="token-storage",r.TokenFetch="token-fetch",r.TokenError="token-error",r.ConfigUuid="config-uuid",r.ConfigWebId="config-webid",r.ConfigDomain="config-domain",r.CustomWebId="custom-webid",r.AnonymousId="anonymous-id",r.TokenChange="token-change",r.TokenReset="token-reset",r.ConfigTransform="config-transform",r.EnvTransform="env-transform",r.SessionReset="session-reset",r.SessionResetTime="session-reset-time",r.Event="event",r.Events="events",r.EventNow="event-now",r.CleanEvents="clean-events",r.BeconEvent="becon-event",r.SubmitBefore="submit-before",r.SubmitScuess="submit-scuess",r.SubmitAfter="submit-after",r.SubmitError="submit-error",r.SubmitVerifyH="submit-verify-h5",r.Stay="stay",r.ResetStay="reset-stay",r.StayReady="stay-ready",r.SetStay="set-stay",r.RouteChange="route-change",r.RouteReady="route-ready",r.Ab="ab",r.AbVar="ab-var",r.AbAllVars="ab-all-vars",r.AbConfig="ab-config",r.AbExternalVersion="ab-external-version",r.AbVersionChangeOn="ab-version-change-on",r.AbVersionChangeOff="ab-version-change-off",r.AbOpenLayer="ab-open-layer",r.AbCloseLayer="ab-close-layer",r.AbReady="ab-ready",r.AbComplete="ab-complete",r.AbTimeout="ab-timeout",r.Profile="profile",r.ProfileSet="profile-set",r.ProfileSetOnce="profile-set-once",r.ProfileUnset="profile-unset",r.ProfileIncrement="profile-increment",r.ProfileAppend="profile-append",r.ProfileClear="profile-clear",r.TrackDuration="track-duration",r.TrackDurationStart="track-duration-start",r.TrackDurationEnd="track-duration-end",r.TrackDurationPause="track-duration-pause",r.TrackDurationResume="tracl-duration-resume",r.Autotrack="autotrack",r.AutotrackReady="autotrack-ready",r.CepReady="cep-ready",r.TracerReady="tracer-ready",(r=p=p||{}).DEBUGGER_MESSAGE="debugger-message",r.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",r.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",r.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",r.DEBUGGER_MESSAGE_EVENT="debugger-message-event",r.DEVTOOL_WEB_READY="devtool-web-ready";var d=A,o=void 0,r=(new Date).getTimezoneOffset(),ie=parseInt(""+-r/60,10),ne=60*r,oe=(a.prototype.initDomain=function(){var e=this.initConfig.channel_domain;e?this.domain=e:(e=this.initConfig.channel,this.domain=U(Z[e]))},a.prototype.setDomain=function(e){this.domain=e},a.prototype.getDomain=function(){return this.domain},a.prototype.initABData=function(){var e,t="__tea_sdk_ab_version_"+this.initConfig.app_id,i=null;i=this.initConfig.ab_cross?(e=this.localStorage.getCookie(t,this.initConfig.ab_cookie_domain))?JSON.parse(e):null:this.localStorage.getItem(t),this.setAbCache(i)},a.prototype.setAbCache=function(e){this.ab_cache=e},a.prototype.getAbCache=function(){return this.ab_cache},a.prototype.clearAbCache=function(){this.ab_cache={},this.ab_version=""},a.prototype.setAbVersion=function(e){this.ab_version=e},a.prototype.getAbVersion=function(){return this.ab_version},a.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||"/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid"}var i="";return this.initConfig.caller&&(i="?sdk_version="+u+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),this.initConfig.enable_encryption&&"event"===e&&(i=this.initConfig.caller?i+"&encryption=1":i+"?encryption=1"),""+this.getDomain()+t+i},a.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},a.prototype.set=function(o){var r=this;Object.keys(o).forEach(function(e){null==o[e]&&r.delete(e);try{r.eventCheck.calculate(e,"config")}catch(e){}var t,i,n;"traffic_type"===e&&r.isLast&&(r.envInfo.header.custom.$latest_traffic_source_type=o[e]),"evtParams"===e?r.evtParams=l({},r.evtParams||{},o.evtParams||{}):"_staging_flag"===e?r.evtParams=l({},r.evtParams||{},{_staging_flag:o._staging_flag}):"reportErrorCallback"===e&&"function"==typeof o[e]?r.reportErrorCallback=o[e]:(n=i="",-1<e.indexOf(".")&&(i=(t=e.split("."))[0],n=t[1]),i?"user"===i||"header"===i?r.envInfo[i][n]=o[e]:r.envInfo.header.custom[n]=o[e]:Object.hasOwnProperty.call(r.envInfo.user,e)?-1<["user_type","ip_addr_id"].indexOf(e)?r.envInfo.user[e]=o[e]&&Number(o[e]):-1<["user_id","web_id","user_unique_id","user_unique_id_type","anonymous_id"].indexOf(e)?r.envInfo.user[e]=o[e]&&String(o[e]):-1<["user_is_auth","user_is_login"].indexOf(e)?r.envInfo.user[e]=Boolean(o[e]):"device_id"===e&&(r.envInfo.user[e]=o[e]):Object.hasOwnProperty.call(r.envInfo.header,e)?r.envInfo.header[e]=o[e]:r.envInfo.header.custom[e]=o[e])})},a.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},a.prototype.setStore=function(e){try{var t,i;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.keys(e).length&&(i=Object.assign(e,t),this.storage.setItem(this.configKey,i))}catch(e){console.log("setStore error"),this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},a.prototype.getStore=function(){try{var e;return this.configPersist?(e=this.storage.getItem(this.configKey)||{})&&Object.keys(e).length?e:null:null}catch(e){return this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),null}},a.prototype.delete=function(e){try{var t;this.configPersist&&(t=this.storage.getItem(this.configKey)||{})&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("delete error")}},a),re=(le.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: "+this.name+"] "+e)},le.prototype.warn=function(e){this.isLog&&console.warn("%c %s","color: yellow; background-color: black;","[instance: "+this.name+"] "+e)},le.prototype.error=function(e){this.isLog&&console.error("[instance: "+this.name+"] "+e)},le.prototype.throw=function(e){throw this.error(this.name),new Error(e)},le),ae=((A=ce.prototype).bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},A.bridgeReady=function(){var e=this;return new Promise(function(t,i){try{e.bridgeInject()?AppLogBridge.hasStarted(function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):i(!1)}):i(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),i(!1)}})},A.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(e){console.error("setNativeAppId error")}},A.setConfig=function(t){var i=this;try{Object.keys(t).forEach(function(e){"user_unique_id"===e?i.setUserUniqueId(t[e]):t[e]?i.addHeaderInfo(e,t[e]):i.removeHeaderInfo(e)})}catch(t){console.error("setConfig error")}},A.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},A.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},A.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},A.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},A.reportPv=function(e){this.onEventV3("predefine_pageview",e)},A.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t)}catch(e){console.error("onEventV3 error")}},A.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},A.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},A.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},A.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},A.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},A.setExternalAbVersion=function(e){try{AppLogBridge.setExternalAbVersion(e)}catch(e){console.error("setExternalAbVersion error")}},A.getVar=function(e,t,i){try{"android"===this.os?i(AppLogBridge.getABTestConfigValueForKey(e,t)):AppLogBridge.getABTestConfigValueForKey(e,t,function(e){i(e)})}catch(e){console.error("getVar error"),i(t)}},A.getAllVars=function(t){try{"android"===this.os?t(AppLogBridge.getAllAbTestConfigs()):AppLogBridge.getAllAbTestConfigs(function(e){t(e)})}catch(e){console.error("getAllVars error"),t(null)}},A.getAbSdkVersion=function(t){try{"android"===this.os?t(AppLogBridge.getAbSdkVersion()):AppLogBridge.getAbSdkVersion(function(e){t(e)})}catch(e){console.error("getAbSdkVersion error"),t("")}},ce),se={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function ce(e,t){this.native=e.enable_native||e["evitaN".split("").reverse().join("")],this.os=t.get("os_name")}function le(e,t){this.isLog=t||!1,this.name=e||""}function a(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var i=new Q(t.app_id,t.cookie_domain||"",t.cookie_expire||7776e6).init(),e=(this.eventCheck=new ee(e,t),"__tea_cache_first_"+t.app_id),t=(this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new f(!1,"session"),this.localStorage=new f(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage),this.localStorage.getItem(e));t&&1==t?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(e,"1")),this.envInfo={user:{user_unique_id:o,user_type:o,user_id:o,user_is_auth:o,user_is_login:o,device_id:o,web_id:o,ip_addr_id:o,user_unique_id_type:o,anonymous_id:o},header:{app_id:o,app_name:o,app_install_id:o,install_id:o,app_package:o,app_channel:o,app_version:o,ab_version:o,os_name:i.os_name,os_version:i.os_version,device_model:i.device_model,ab_client:o,traffic_type:o,client_ip:o,device_brand:o,os_api:o,access:o,language:i.language,region:o,app_language:o,app_region:o,creative_id:i.utm.creative_id,ad_id:i.utm.ad_id,campaign_id:i.utm.campaign_id,log_type:o,rnd:o,platform:i.platform,sdk_version:u,sdk_lib:"js",province:o,city:o,timezone:ie,tz_offset:ne,tz_name:o,sim_region:o,carrier:o,resolution:i.screen_width+"x"+i.screen_height,browser:i.browser,browser_version:i.browser_version,referrer:i.referrer,referrer_host:i.referrer_host,width:i.screen_width,height:i.screen_height,screen_width:i.screen_width,screen_height:i.screen_height,utm_term:i.utm.utm_term,utm_content:i.utm.utm_content,utm_source:i.utm.utm_source,utm_medium:i.utm.utm_medium,utm_campaign:i.utm.utm_campaign,tracer_data:JSON.stringify(i.utm.tracer_data),custom:{},wechat_unionid:o,wechat_openid:o}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(i),this.initDomain(),this.initABData()}function he(e,i,t,n,o,r,a,s,c){try{var l=new XMLHttpRequest,h=s||"POST";l.open(h,""+e,!0),l.setRequestHeader("Content-Type","application/json; charset=utf-8"),a&&l.setRequestHeader("X-MCS-AppKey",""+a),n&&(l.withCredentials=!0),t&&(l.timeout=t,l.ontimeout=function(){r&&r(i,se.TIMEOUT)}),l.onload=function(){if(o){var t=null;if(l.responseText){try{t=JSON.parse(l.responseText)}catch(e){t={}}o(t,i)}}},l.onerror=function(){l.abort(),r&&r(i,se.XHR_ON)},c?l.send(i):l.send(JSON.stringify(i))}catch(e){}}function ue(i,n,o,r){try{var e=i.match(/\/v\d\//),t=e?e[0]:-1!==i.indexOf("/v1/")?"/v1/":"/v2/",a=i.split(t)[0];a?n.forEach(function(e){var e=(e=>{var t,i="";for(t in e)e.hasOwnProperty(t)&&void 0!==e[t]&&(i+="&"+t+"="+encodeURIComponent(JSON.stringify(e[t])));return"&"===i[0]?i.slice(1):i})(e),t=new Image(1,1);t.onload=function(){t=null,o&&o()},t.onerror=function(){t=null,r&&r(i,n,me)},t.src=a+"/gif?"+e}):r(i,n,ge)}catch(o){r&&r(i,n,_e,o.message)}}function pe(e,t,i,n,o,r,a,s){var c=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===c.indexOf("MSIE 8.0")&&-1===c.indexOf("MSIE 9.0")){if(a)return window.navigator&&window.navigator.sendBeacon?window.navigator.sendBeacon(e,JSON.stringify(t))?o():r(e,t,4003):ue(e,t,o,r)}else ue(e,t,o,r);he(e,t,i,n,o,r,"","",s)}function de(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)}function fe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var ge=4001,me=4e3,_e=4002,ve=(v.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new f(!0),this.localStorage=new f(!1),this.eventCheck=new ee(e,t),this.maxReport=t.max_report||20,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.collect.on(d.Ready,function(){i.reportAll(!1)}),this.collect.on(d.ConfigDomain,function(){i.reportUrl=i.configManager.getUrl("event")}),this.collect.on(d.Event,function(e){i.event(e)}),this.collect.on(d.BeconEvent,function(e){i.beconEvent(e)}),this.collect.on(d.CleanEvents,function(){i.reportAll(!1)}),this.linster()},v.prototype.linster=function(){var e=this;window.addEventListener("unload",function(){e.reportAll(!0)},!1),V(function(){e.reportAll(!0)}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.reportAll(!0)},!1)},v.prototype.reportAll=function(e){this.report(e),this.reportBecon()},v.prototype.event=function(e){var t=this;try{var i,n=s(e,this.cacheStorgae.getItem(this.eventKey)||[]);this.cacheStorgae.setItem(this.eventKey,n),this.reportTimeout&&clearTimeout(this.reportTimeout),n.length>=this.maxReport?this.report(!1):(i=this.reportTime,this.reportTimeout=setTimeout(function(){t.report(!1),t.reportTimeout=null},i))}catch(e){this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},v.prototype.beconEvent=function(e){e=s(e,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,e),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},v.prototype.reportBecon=function(){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},v.prototype.report=function(e){var t;!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(t=this.cacheStorgae.getItem(this.eventKey)||[]).length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))},v.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var i=0;i<e.length;i+=this.eventLimit){var n=e.slice(i,i+this.eventLimit),o=this.split(this.merge(n));this.send(o,t)}else o=this.split(this.merge(e)),this.send(o,t)},v.prototype.merge=function(e,o){var r=this,t=this.configManager.get(),i=t.header,a=t.user,s=(i.custom=JSON.stringify(i.custom),this.configManager.get("evtParams")),c=this.configManager.get("user_unique_id_type"),t=e.map(function(t){try{Object.keys(s).length&&!o&&(t.params=l({},t.params,s)),r.collect.dynamicParamsFilter&&(e=r.collect.dynamicParamsFilter(),Object.keys(e).length)&&(t.params=l({},t.params,e)),c&&(t.params.$user_unique_id_type=c);var e,i=r.configManager.getAbCache(),n=r.configManager.getAbVersion();return n&&i&&(r.config.disable_ab_reset||i.uuid===a.user_unique_id)&&(t.ab_sdk_version=n),t.session_id=r.collect.sessionManager.getSessionId(),t.params=JSON.stringify(t.params),t}catch(e){return r.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),t}}),e=[];return Object.keys(a).length?(this.config.enable_anonymousid&&delete a.web_id,(t=JSON.parse(JSON.stringify({events:t,user:a,header:i}))).local_time=Math.floor(Date.now()/1e3),t.verbose=1,t.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,e.push(t)):console.warn("user info error，cant report"),e},v.prototype.split=function(e){return e.map(function(e){var t=[];return t.push(e),t})},v.prototype.send=function(e,r){var a=this;e.length&&e.forEach(function(e){try{var t,i=JSON.parse(JSON.stringify(e)),n=(a.config.filter&&!(i=a.config.filter(i))&&console.warn("filter must return data !!"),a.collect.eventFilter&&i&&((i=a.collect.eventFilter(i))||console.warn("filterEvent api must return data !!")),i||e),o=JSON.parse(JSON.stringify(n));a.eventCheck.checkVerify(o),n.length&&(a.collect.emit(d.SubmitBefore,n),t=a.config.enable_encryption?"data="+N(JSON.stringify(n)):n,pe(a.reportUrl,t,a.timeout,!1,function(e,t){e&&0!==e.e?(a.collect.emit(d.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),a.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_EVENT,info:"埋点上报失败",time:Date.now(),data:o,code:e.e,failType:"数据异常",status:"fail"})):(a.collect.emit(d.SubmitScuess,{eventData:t,res:e}),a.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:o,code:200,status:"success"}))},function(e,t){a.configManager.get("reportErrorCallback")(e,t),a.collect.emit(d.SubmitError,{type:"f_net",eventData:e,errorCode:t}),a.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_EVENT,info:"埋点上报网络异常",time:Date.now(),data:o,code:t,failType:"网络异常",status:"fail"})},r,a.config.enable_encryption||!1),a.eventCheck.checkVerify(n),a.collect.emit(d.SubmitVerifyH,n),a.collect.emit(d.SubmitAfter,n))}catch(e){console.warn("something error, "+JSON.stringify(e.stack)),a.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}})},v),ye=(_.prototype.apply=function(e,t){var i=this;this.collect=e,this.storage=new f(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(d.SessionReset,function(){i.resetSessionId()}),this.collect.on(d.SessionResetTime,function(){i.updateSessionIdTime()}))},_.prototype.updateSessionIdTime=function(){var e,t=this.storage.getItem(this.sessionKey);t&&t.sessionId&&(e=t.timestamp,Date.now()-e>this.expireTime?t={sessionId:fe(),timestamp:Date.now()}:t.timestamp=Date.now(),this.storage.setItem(this.sessionKey,t),this.resetExpTime())},_.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:fe(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime)},_.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return!this.disableSession&&e&&e.sessionId?e.sessionId:""},_.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},_.prototype.resetSessionId=function(){var e={sessionId:fe(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},_.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:fe(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},_),be=(m.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new f(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enableAnonymousid=t.enable_anonymousid,this.enableTTwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(d.AnonymousId,function(e){i.setAnonymousId(e)}),this.collect.on(d.ConfigUuid,function(e){i.setUuid(e)}),this.collect.on(d.ConfigWebId,function(e){i.setWebId(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},m.prototype.checkStorage=function(){var e,t=this;this.enableCookie?(e=this.storage.getCookie(this.tokenKey,this.cookieDomain),this.cacheToken=e&&"string"==typeof e?JSON.parse(e):{}):this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid||this.enableAnonymousid?this.enableAnonymousid?this.completeAnonymous(this.cacheToken):this.enableCustomWebid?this.collect.on(d.CustomWebId,function(){t.tokenReady=!0,t.collect.emit(d.TokenComplete)}):this.checkEnv()||(this.enableTTwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},m.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:de(),user_unique_id:this.configManager.get("user_unique_id")||de()}):this.remoteWebid()},m.prototype.checkEnv=function(){var e=window.navigator.userAgent;return(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram"))&&!(!(e=c(window.location.href))||!e.Web_ID||(this.complete({web_id:""+e.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+e.Web_ID}),0))},m.prototype.remoteWebid=function(){var i=this,e=this.configManager.getUrl("webid"),t={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""},n=(this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 发起WEBID请求",logType:"fetch",level:"info",time:Date.now(),data:t}),de());he(e,t,3e5,!1,function(e){var t;e&&0===e.e?(t=e.web_id,i.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"WEBID请求成功",logType:"fetch",level:"info",time:Date.now(),data:e})):(i.collect.configManager.set({localWebId:t=n}),i.collect.emit(d.TokenError),i.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"WEBID请求返回值异常",logType:"fetch",level:"warn",time:Date.now(),data:e}),i.collect.logger.warn("appid: "+i.config.app_id+" get webid error, use local webid~")),i.complete({web_id:i.configManager.get("web_id")||t,user_unique_id:i.configManager.get("user_unique_id")||t})},function(){i.complete({web_id:i.configManager.get("web_id")||n,user_unique_id:i.configManager.get("user_unique_id")||n}),i.collect.configManager.set({localWebId:n}),i.collect.emit(d.TokenError),i.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"WEBID请求网络异常",logType:"fetch",level:"error",time:Date.now(),data:null}),i.collect.logger.warn("appid: "+i.config.app_id+", get webid error, use local webid~")})},m.prototype.complete=function(e){var t=e.web_id,i=e.user_unique_id;t||i?(e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:i}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(d.TokenComplete)):(this.collect.emit(d.TokenError),console.warn("token error"))},m.prototype.completeAnonymous=function(e){var t=e.anonymous_id||fe(),i=e.user_unique_id||this.configManager.get("user_unique_id");this.collect.configManager.set({anonymous_id:t,user_unique_id:i||t}),e.anonymous_id=t,e.user_unique_id=i||t,this.setStorage(e),this.tokenReady=!0,this.collect.emit(d.TokenComplete)},m.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",i=this.configManager.get("user_unique_id");this.configManager.set({user_unique_id:i||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(d.TokenComplete)},m.prototype.setUuid=function(e){var t,i;e&&-1===["null","undefined","Null","None"].indexOf(e)?(e=String(e),t=this.configManager.get("user_unique_id"),i=this.cacheToken&&this.cacheToken.user_unique_id,e===t&&e===i||(this.configManager.set({user_unique_id:e}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(d.TokenChange,"uuid"),this.collect.emit(d.SessionReset))):this.clearUuid()},m.prototype.clearUuid=function(){var e;this.config.enable_ttwebid||(e=this.enableAnonymousid?this.configManager.get("anonymous_id"):this.configManager.get("web_id"),this.configManager.get("user_unique_id")!==e&&(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(d.TokenReset)))},m.prototype.setAnonymousId=function(e){var t,i;e&&this.enableAnonymousid&&(t=this.configManager.get("anonymous_id"),i=this.configManager.get("user_unique_id"),t!==e)&&(t!==i&&i||(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.collect.emit(d.TokenChange,"uuid")),this.configManager.set({anonymous_id:e}),this.cacheToken.anonymous_id=e,this.collect.emit(d.TokenChange,"anonymous_id"),this.setStorage(this.cacheToken))},m.prototype.setWebId=function(e){var t,i;!e||this.config.enable_ttwebid||this.enableAnonymousid||(t=this.configManager.get("web_id"),(i=this.configManager.get("user_unique_id"))&&i!==t||(this.configManager.set({user_unique_id:e}),this.cacheToken.user_unique_id=e,this.collect.emit(d.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.cacheToken.web_id=e,this.collect.emit(d.TokenChange,"webid")),this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken))},m.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enableTTwebid?this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},m.prototype.getReady=function(){return this.tokenReady},m.prototype.getTobId=function(){var e=this,i=this.configManager.getUrl("tobid");return new Promise(function(t){he(i,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},3e4,e.enableTTwebid,function(e){e&&0===e.e?t(e.tobid):t("")},function(){t("")})})},m),Ee=(g.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){console.log("devTool load fail, "+e.message)}},g.prototype.load=function(){try{this.loadBaseInfo(),this.loadHook();var e=c(window.location.href);e.open_devtool_web&&parseInt(e.app_id)===this.app_id&&(this.addLintener(),this.loadDebuggerModule(),this.loadDevTool())}catch(e){console.log("debug fail, "+e.message)}},g.prototype.loadDevTool=function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.js")},g.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"基本信息",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"上报域名":this.collect.configManager.getDomain(),"SDK版本":u,"SDK引入方式":"script"}},{title:"用户信息",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"点击获取SSID"}},{title:"公共参数信息",type:2,infoName:{"浏览器":this.collect.configManager.get("browser"),"浏览器版本":this.collect.configManager.get("browser_version"),"平台":this.collect.configManager.get("platform"),"设备型号":this.collect.configManager.get("device_model"),"操作系统":this.collect.configManager.get("os_name"),"操作系统版本":this.collect.configManager.get("os_version"),"屏幕分辨率":this.collect.configManager.get("resolution"),"来源":this.collect.configManager.get("referrer"),"自定义信息":""}},{title:"配置信息",type:3,infoName:{"全埋点":!!this.config.autotrack,"停留时长":!!this.config.enable_stay_duration}},{title:"A/B配置信息",type:4,infoName:{"A/B实验":!!this.config.enable_ab_test}},{title:"客户端信息",type:3,infoName:{"打通开关":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(d.Ready,function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["自定义信息"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B域名"]=e.config.ab_channel_domain||U(Y[e.config.channel]),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["是否打通"]=!!e.collect.bridgeReport)})},g.prototype.loadHook=function(){var n=this;this.collect.on(p.DEBUGGER_MESSAGE,function(t){switch(t.type){case p.DEBUGGER_MESSAGE_SDK:var e={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(e.desc={content:JSON.stringify(t.data)}),n.updateLog(e),t.secType&&"AB"===t.secType?(n.info[4].infoName["已曝光VID"]=n.collect.configManager.getAbVersion(),n.info[4].infoName["全部配置"]=n.collect.configManager.getAbData()):"USER"===t.secType&&(n.info[1].infoName.uuid=n.collect.configManager.get("user").user_unique_id,n.info[1].infoName.web_id=n.collect.configManager.get("user").web_id),void n.updateInfo();case p.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var e=t.data[0],i=e.events;if(!i.length)return;i.forEach(function(e){e.checkShow=!0,e.searchShow=!0,e.success=t.status,e.type=-1!==n.filterEvent.indexOf(e.event)?"sdk":"cus",e.type=n.collect.bridgeReport?"bridge":e.type,e.info="","fail"===t.status&&(e.info={message:"code: "+t.code+"， msg: "+t.failType})}),n.updateEvent(e)}return}})},g.prototype.addLintener=function(){var t=this;window.addEventListener("message",function(e){if(e&&e.data&&"devtool:web:ready"===e.data.type){if(t.devToolOrigin=e.origin,t.devToolReady=!0,t.sendAlready)return;console.log("inittttt"),t.sendData("devtool:web:init",{info:t.info,log:t.log,event:t.event}),t.sendAlready=!0}e&&e.data&&"devtool:web:ssid"===e.data.type&&t.collect.getToken(function(e){t.info[1].infoName.ssid=e.tobid,t.updateInfo()})})},g.prototype.sendData=function(e,t){try{var i={type:e,payload:t};(window.opener||window.parent).postMessage(i,this.devToolOrigin)}catch(e){}},g.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},g.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},g.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},g.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),e=(t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: fixed;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),e.appendChild(t),document.createElement("div")),t=(e.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLog调试</div>',document.createElement("div"));t.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(e),document.getElementsByTagName("body")[0].appendChild(t),document.getElementById("debugger-applog-web").addEventListener("click",function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)})},g),we={autotrack:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/route.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},tracer:{src:{cn:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://lf16-data.bytepluscdn.com/obj/data-static-sg/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"}};function g(e,t){this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.collect=e,this.config=t,this.app_id=t.app_id,this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],t.enable_debug&&this.load()}function m(){this.cacheToken={},this.enableCookie=!1,this.enableTTwebid=!1,this.enableCustomWebid=!1,this.enableAnonymousid=!1}function _(){}function v(){this.eventLimit=50,this.eventCache=[],this.beconEventCache=[]}function Se(){return"undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null}b.usePlugin=function(e,t,i){if(t){for(var n=!1,o=0,r=b.plugins.length;o<r;o++)if(b.plugins[o].name===t){b.plugins[o].plugin=e,b.plugins[o].options=i||{},n=!0;break}n||b.plugins.push({name:t,plugin:e,options:i})}else b.plugins.push({plugin:e})},b.prototype.usePlugin=function(e,t,i){e&&(we.hasOwnProperty(e)?console.info("your sdk version has "+e+" already ~"):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:i}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},b.prototype.init=function(t){var e,n=this;this.inited?console.log("init can be call only one time"):t&&B(t)?t.app_id&&"number"==typeof(e=t.app_id)&&!isNaN(e)?t.app_key&&"string"!=typeof t.app_key?console.warn("app_key param is error, must be string, please check!"):(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),t.channel="cn"),this.logger=new re(this.name,t.log),this.configManager=new oe(this,t),this.appBridge=new ae(t,this.configManager),this.bridgeReport=this.appBridge.bridgeInject(),this.debugger=new Ee(this,t),this.initConfig=t,this.env=t.channel_domain?"self":"public",this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行INIT",data:t,level:"info",time:Date.now()}),t.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:t.app_id}),this.eventManager=new ve,this.tokenManager=new be,this.sessionManager=new ye,Promise.all([new Promise(function(e){n.once(d.TokenComplete,function(){e(!0)})}),new Promise(function(e){n.once(d.Start,function(){e(!0)})})]).then(function(){try{b.plugins.reduce(function(e,t){var i=t.plugin,t=Object.assign(n.initConfig,t.options),i=new i;return i.apply(n,t),e.push(i),e},n.pluginInstances)}catch(e){console.log("load plugin error, "+e.message),n.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}n.sdkReady=!0,n.emit(d.Ready),n.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 初始化完成",time:Date.now(),level:"info",data:n.configManager.get("user")}),n.logger.info("appid: "+t.app_id+", userInfo:"+JSON.stringify(n.configManager.get("user"))),n.logger.info("appid: "+t.app_id+", sdk is ready, version is "+u+", you can report now !!!");try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){n.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}n.pageView(),n.on(d.TokenChange,function(e){"webid"!==e&&"anonymous_id"!==e||n.pageView(),n.logger.info("appid: "+t.app_id+" token change, new userInfo:"+JSON.stringify(n.configManager.get("user"))),n.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 设置了用户信息",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})}),n.on(d.TokenReset,function(){n.logger.info("appid: "+t.app_id+" token reset, new userInfo:"+JSON.stringify(n.configManager.get("user"))),n.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 重置了用户信息",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})}),n.on(d.RouteChange,function(e){e.init||t.disable_route_report||n.pageView()})}),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t),this.inited=!0,this.emit(d.Init))):console.warn("app_id param is error, must be number, please check!"):console.warn("init params error,please check")},b.prototype.config=function(e){var t,i;this.inited?e&&B(e)?this.bridgeReport?this.appBridge.setConfig(e):(e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv),t=l({},e),this.initConfig&&this.initConfig.configPersist&&((i=this.configManager.getStore())&&(t=Object.assign(i,e)),this.configManager.setStore(e)),t.web_id,t.user_unique_id,i=((e,t)=>{var i={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&(i[o[n]]=e[o[n]]);return i})(t,["web_id","user_unique_id"]),t.hasOwnProperty("web_id")&&this.emit(d.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(d.ConfigUuid,t.user_unique_id),this.configManager.set(i),this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行CONFIG",level:"info",time:Date.now(),data:t})):this.logger.warn("config params is error, please check"):this.logger.warn("config must be use after function init")},b.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(d.ConfigDomain)},b.prototype.getConfig=function(e){return this.configManager.get(e)},b.prototype.send=function(){this.start()},b.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(d.Start),this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行START",level:"info",time:Date.now()}),this.bridgeReport)&&(this.pageView(),this.emit(d.Ready))},b.prototype.event=function(e,t){var i=this;try{if(!this.initConfig||!this.initConfig.disable_track_event){var n=[];if(Array.isArray(e))e.forEach(function(e){e=i.processEvent(e[0],e[1]||{});e&&n.push(e)});else{var o=this.processEvent(e,t);if(!o)return;n.push(o)}this.bridgeReport?n.forEach(function(e){var t=e.event;i.appBridge.onEventV3(t,JSON.stringify(e.params))}):n.length&&(this.emit(d.Event,n),this.emit(d.SessionResetTime))}}catch(e){this.logger.warn("something error, please check"),this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},b.prototype.beconEvent=function(e,t){var i;this.initConfig&&this.initConfig.disable_track_event||(Array.isArray(e)?console.warn("beconEvent not support batch report, please check"):(i=[],(e=this.processEvent(e,t||{}))&&(i.push(e),i.length)&&(this.emit(d.BeconEvent,i),this.emit(d.SessionResetTime))))},b.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var i,n,o;return e?(/^event\./.test(i=e)&&(i=e.slice(6)),o=void((n="object"!=typeof(n=t)?{}:n).profile?delete n.profile:n.event_index=K+=1),n.local_ms?(o=n.local_ms,delete n.local_ms):o=+new Date,{event:i,params:n,local_time_ms:o,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}):(this.logger.warn("eventName is null， please check"),null)}catch(i){return this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message}),{event:e,params:t}}},b.prototype.dynamicParams=function(e){this.dynamicParamsFilter=e},b.prototype.filterEvent=function(e){this.eventFilter=e},b.prototype.on=function(e,t){this.hook.on(e,t)},b.prototype.once=function(e,t){this.hook.once(e,t)},b.prototype.off=function(e,t){this.hook.off(e,t)},b.prototype.emit=function(e,t,i){this.hook.emit(e,t,i)},b.prototype.set=function(e){this.hook.set(e)},b.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},b.prototype.predefinePageView=function(e){var t;void 0===e&&(e={}),this.inited?(t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+(this.configManager&&this.configManager.is_first_time||!1)},t=l({},t,e),this.event("predefine_pageview",t)):console.warn("predefinePageView should call after init")},b.prototype.clearEventCache=function(){this.emit(d.CleanEvents)},b.prototype.setWebIDviaUnionID=function(e){var t;e&&(t=j(e),this.config({web_id:""+t,wechat_unionid:e}),this.emit(d.CustomWebId))},b.prototype.setWebIDviaOpenID=function(e){var t;e&&(t=j(e),this.config({web_id:""+t,wechat_openid:e}),this.emit(d.CustomWebId))},b.prototype.setAnonymousId=function(e){this.emit(d.AnonymousId,e)},b.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},b.prototype.resetStayDuration=function(e,t,i){this.emit(d.ResetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:i=void 0===i?"":i},d.Stay)},b.prototype.resetStayParams=function(e,t,i){this.emit(d.SetStay,{url_path:e=void 0===e?"":e,title:t=void 0===t?"":t,url:i=void 0===i?"":i},d.Stay)},b.prototype.getToken=function(i,e){var n,t,o,r=this;this.inited?(n=!1,t=function(e){var t;if(!n)return n=!0,t=r.configManager.get().user,e&&(t.tobid=e,t["diss".split("").reverse().join("")]=e),i(l({},t))},o=function(){r.tokenManager.getTobId().then(function(e){t(e)})},this.sdkReady?o():(e&&setTimeout(function(){t()},e),this.on(d.Ready,function(){o()}))):this.logger.warn("getToken must be use after function init")},b.prototype.startTrackEvent=function(e){e&&this.emit(d.TrackDurationStart,e,d.TrackDuration)},b.prototype.endTrackEvent=function(e,t){void 0===t&&(t={}),e&&this.emit(d.TrackDurationEnd,{eventName:e,params:t},d.TrackDuration)},b.prototype.pauseTrackEvent=function(e){e&&this.emit(d.TrackDurationPause,e,d.TrackDuration)},b.prototype.resumeTrackEvent=function(e){e&&this.emit(d.TrackDurationResume,e,d.TrackDuration)},b.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(d.ProfileSet,e,d.Profile),this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSet",level:"info",time:Date.now(),data:e})},b.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(d.ProfileSetOnce,e,d.Profile),this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSetOnce",level:"info",time:Date.now(),data:e})},b.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(d.ProfileIncrement,e,d.Profile),this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileIncrement",level:"info",time:Date.now(),data:e})},b.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(d.ProfileUnset,e,d.Profile),this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileUnset",level:"info",time:Date.now(),data:e})},b.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(d.ProfileAppend,e,d.Profile),this.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileAppend",level:"info",time:Date.now(),data:e})},b.prototype.setExternalAbVersion=function(e){this.bridgeReport?this.appBridge.setExternalAbVersion(e):this.emit(d.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,d.Ab)},b.prototype.getVar=function(e,t,i){this.bridgeReport?this.appBridge.getVar(e,t,i):this.emit(d.AbVar,{name:e,defaultValue:t,callback:i},d.Ab)},b.prototype.getAllVars=function(e){this.bridgeReport?this.appBridge.getAllVars(e):this.emit(d.AbAllVars,e,d.Ab)},b.prototype.getABconfig=function(e,t){this.emit(d.AbConfig,{params:e,callback:t},d.Ab)},b.prototype.getAbSdkVersion=function(e){if(!this.bridgeReport||!e)return this.configManager.getAbVersion()||"";this.appBridge.getAbSdkVersion(e)},b.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(d.AbVersionChangeOn,e,d.Ab),function(){t.emit(d.AbVersionChangeOff,e,d.Ab)}},b.prototype.offAbSdkVersionChange=function(e){this.emit(d.AbVersionChangeOff,e,d.Ab)},b.prototype.openOverlayer=function(){this.emit(d.AbOpenLayer,"",d.Ab)},b.prototype.closeOverlayer=function(){this.emit(d.AbCloseLayer,"",d.Ab)},b.prototype.autoInitializationRangers=function(e){var t,i=e.app_id,n=e.onTokenReady,e=Z[e.channel]+"/webid",o=new f(!1),r="__tea_cache_tokens_"+i;(t=o.getItem(r))&&t.web_id?n(t.web_id):pe(e,{app_key:"",app_id:i,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,function(e){e&&0===e.e?(n(e.web_id),e={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()},o.setItem(r,e)):n("")},function(){n("")},!0)},b.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(d.TokenComplete))},b.plugins=[];var ke,Te,Ae,De,y,r=b,Oe="__rangers_ab_style__";function b(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.adapters={},this.sdkReady=!1,this.name=e,this.hook=new q,this.logger=new re(e),this.remotePlugin=new Map,this.Types=d,this.adapters.fetch=he,this.adapters.storage=f}Ae=W,De=(()=>{try{return!!Symbol.iterator}catch(e){return!1}})(),(()=>{try{var e=Ae.URLSearchParams;return"a=1"===new e("?a=1").toString()&&"function"==typeof e.prototype.set&&"function"==typeof e.prototype.entries}catch(e){}})()||((y=Re.prototype).append=function(e,t){e in this._entries?this._entries[e].push(String(t)):this._entries[e]=[String(t)]},y.delete=function(e){delete this._entries[e]},y.get=function(e){return e in this._entries?this._entries[e][0]:null},y.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]},y.has=function(e){return e in this._entries},y.set=function(e,t){this._entries[e]=[String(t)]},y.forEach=function(e,t){for(var i in this._entries)if(this._entries.hasOwnProperty(i))for(var n=this._entries[i],o=0;o<n.length;o++)e.call(t,n[o],i,this)},y.keys=function(){var i=[];return this.forEach(function(e,t){i.push(t)}),Ge(i)},y.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),Ge(t)},y.entries=function(){var i=[];return this.forEach(function(e,t){i.push([t,e])}),Ge(i)},De&&(y[Symbol.iterator]=y.entries),y.toString=function(){var i=[];return this.forEach(function(e,t){i.push(Me(t)+"="+Me(e))}),i.join("&")},Ae.URLSearchParams=Re),"function"!=typeof(y=Ae.URLSearchParams.prototype).sort&&(y.sort=function(){var i=this,n=[];this.forEach(function(e,t){n.push([t,e]),i._entries||i.delete(t)}),n.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),i._entries&&(i._entries={});for(var e=0;e<n.length;e++)this.append(n[e][0],n[e][1])}),"function"!=typeof y._fromString&&Object.defineProperty(y,"_fromString",{enumerable:!1,configurable:!1,writable:!1,value:function(e){if(this._entries)this._entries={};else{var i=[];this.forEach(function(e,t){i.push(t)});for(var t=0;t<i.length;t++)this.delete(i[t])}for(var n,o=(e=e.replace(/^\?/,"")).split("&"),t=0;t<o.length;t++)n=o[t].split("="),this.append(Ie(n[0]),1<n.length?Ie(n[1]):"")}});var E=W;if((()=>{try{var e=new E.URL("b","http://a");return e.pathname="c d","http://a/c%20d"===e.href&&e.searchParams}catch(e){}})()||(ke=E.URL,Te=xe.prototype,["hash","host","hostname","port","protocol"].forEach(function(e){var t;t=e,Object.defineProperty(Te,t,{get:function(){return this._anchorElement[t]},set:function(e){this._anchorElement[t]=e},enumerable:!0})}),Object.defineProperty(Te,"search",{get:function(){return this._anchorElement.search},set:function(e){this._anchorElement.search=e,this._updateSearchParams()},enumerable:!0}),Object.defineProperties(Te,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e,this._updateSearchParams()},enumerable:!0},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:!0},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol],e=this._anchorElement.port!=e&&""!==this._anchorElement.port;return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(e?":"+this._anchorElement.port:"")},enumerable:!0},password:{get:function(){return""},set:function(e){},enumerable:!0},username:{get:function(){return""},set:function(e){},enumerable:!0}}),xe.createObjectURL=function(e){return ke.createObjectURL.apply(ke,arguments)},xe.revokeObjectURL=function(e){return ke.revokeObjectURL.apply(ke,arguments)},E.URL=xe),void 0!==E.location&&!("origin"in E.location)){var Ce=function(){return E.location.protocol+"//"+E.location.hostname+(E.location.port?":"+E.location.port:"")};try{Object.defineProperty(E.location,"origin",{get:Ce,enumerable:!0})}catch(e){setInterval(function(){E.location.origin=Ce()},100)}}function xe(e,t){"string"!=typeof e&&(e=String(e)),t&&"string"!=typeof t&&(t=String(t));var i=document;if(t&&(void 0===E.location||t!==E.location.href)){t=t.toLowerCase(),(o=(i=document.implementation.createHTMLDocument("")).createElement("base")).href=t,i.head.appendChild(o);try{if(0!==o.href.indexOf(t))throw new Error(o.href)}catch(e){throw new Error("URL unable to set base "+t+" due to "+e)}}var n=i.createElement("a"),o=(n.href=e,o&&(i.body.appendChild(n),n.href=n.href),i.createElement("input"));if(o.type="url",o.value=e,":"===n.protocol||!/:/.test(n.href)||!o.checkValidity()&&!t)throw new TypeError("Invalid URL");Object.defineProperty(this,"_anchorElement",{value:n});var r=new E.URLSearchParams(this.search),a=!0,s=!0,c=this,l=(["append","delete","set"].forEach(function(e){var t=r[e];r[e]=function(){t.apply(r,arguments),a&&(s=!1,c.search=r.toString(),s=!0)}}),Object.defineProperty(this,"searchParams",{value:r,enumerable:!0}),void 0);Object.defineProperty(this,"_updateSearchParams",{enumerable:!1,configurable:!1,writable:!1,value:function(){this.search!==l&&(l=this.search,s)&&(a=!1,this.searchParams._fromString(this.search),a=!0)}})}function Ge(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return De&&(e[Symbol.iterator]=function(){return e}),e}function Me(e){return encodeURIComponent(e).replace(/%20/g,"+")}function Ie(e){return decodeURIComponent(String(e).replace(/\+/g," "))}function Re(e){Object.defineProperty(this,"_entries",{writable:!0,value:{}});var t=typeof e;if("undefined"!=t)if("string"==t)""!==e&&this._fromString(e);else if(e instanceof Re){var i=this;e.forEach(function(e,t){i.append(t,e)})}else{if(null===e||"object"!=t)throw new TypeError("Unsupported input's type for URLSearchParams");if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;n<e.length;n++){var o=e[n];if("[object Array]"!==Object.prototype.toString.call(o)&&2===o.length)throw new TypeError("Expected [string, any] as entry at index "+n+" of URLSearchParams's input");this.append(o[0],o[1])}else for(var r in e)e.hasOwnProperty(r)&&this.append(r,e[r])}}function Pe(e){e.length&&e.forEach(function(e){Ne.push(e)})}var Be={},Ne=[];function Ue(e,t,i,n){var o=e&&e.source||window.opener||window.parent,e=e&&e.origin||n||"*";o.postMessage(JSON.stringify({type:t,payload:i}),e)}function Ve(e,t){Be[e]=Be[e]||[],Be[e].push(t)}function Le(t){if(Ne.some(function(e){return"*"===e})||Ne.some(function(e){return-1<t.origin.indexOf(e)})){var e,i,n=t.data;if("string"==typeof t.data)try{n=JSON.parse(t.data)}catch(t){n=void 0}n&&(e=n.type,i=n.payload,Be[e])&&Be[e].forEach(function(e){"function"==typeof e&&e(t,i)})}}function ze(e,t){e=l({},e);e.filter&&delete e.filter,"object"==typeof e.autotrack&&e.autotrack.collect_url&&delete e.autotrack.collect_url,(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:e,version:t},"*"),window.addEventListener("message",Le,!1)}var je,Ke,qe=!1;function Je(e){var t=e.event;qe||(qe=!0,H(e.editorUrl,function(){Ue(t,"abEditorScriptloadSuccess")},function(){t&&Ue(t,"abEditorScriptloadError"),qe=!1}))}(A=Ke=Ke||{})[A.Var=0]="Var",A[A.All=1]="All",w.prototype.apply=function(e,t){var i,n,o,r,a,s,c,l,h=this;this.collect=e,this.config=t,this.config.enable_ab_test&&(i=t.enable_multilink,n=t.enable_ab_visual,o=t.ab_cross,r=t.ab_cookie_domain,a=t.disable_ab_reset,s=t.ab_channel_domain||U(Y[t.channel||"cn"]),l=(c=e.adapters).storage,c=c.fetch,this.cacheStorgae=new l(!1),this.fetch=c,this.enable_multilink=i,this.enable_ab_visual=n,this.abKey="__tea_sdk_ab_version_"+t.app_id,this.ab_cross=o,this.ab_cookie_domain=r||"",this.fetchUrl=s+"/service/2/abtest_config/",this.reportUrl=""+e.configManager.getUrl("event"),this.exposureLimit=t.exposure_limit||20,this.ab_batch_time=t.ab_batch_time||500,l=this.collect.Types,this.types=l,this.collect.on(l.TokenChange,function(e){a||"uuid"===e&&h.readyStatus&&(h.clearCache(),h.fetchAB())}),this.collect.on(l.TokenReset,function(){a||h.readyStatus&&(h.clearCache(),h.fetchAB())}),this.collect.on(l.AbVar,function(e){var t=e.name;h.getVar(t,e.defaultValue,e.callback)}),this.collect.on(l.AbAllVars,function(e){h.getAllVars(e)}),this.collect.on(l.AbConfig,function(e){var t=e.params;h.getABconfig(t,e.callback)}),this.collect.on(l.AbExternalVersion,function(e){h.setExternalAbVersion(e)}),this.collect.on(l.AbOpenLayer,function(){h.openOverlayer()}),this.collect.on(l.AbCloseLayer,function(){h.closeOverlayer()}),this.collect.on(l.AbVersionChangeOn,function(e){h.changeListener.set(e,e)}),this.collect.on(l.AbVersionChangeOff,function(e){h.changeListener.get(e)&&h.changeListener.delete(e)}),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(l.AbReady))},w.prototype.ready=function(e){var i=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var n=this.collect.hook._hooksCache[e];if(Object.keys(n).length)for(var t in n)(t=>{n[t].length&&n[t].forEach(function(e){i.collect.hook.emit(t,e)})})(t)}},w.prototype.loadMode=function(){var o,e,t=(()=>{try{return JSON.parse(atob(window.name))||void 0}catch(e){}})(),i="";t&&(e=t.scenario,t=t.href,e?(this.editMode=!0,i=e):!t||-1===t.indexOf("datatester")&&-1===t.indexOf("visual-editor")||(this.editMode=!0,i="visual-editor")),this.enable_ab_visual&&(((n,o)=>{window.TEAVisualEditor=window.TEAVisualEditor||{},Pe(["*"]);var e,r="",t=(ze(o,u),"");try{var i=window.performance.getEntriesByType("resource");if(i&&i.length&&(i.forEach(function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(t=e.name)}),t||document.currentScript&&(t=document.currentScript.src),t)&&(e=t.split("/"))&&e.length){for(var r="https:/",a=2;a<e.length&&a!==e.length-1;a++)r=r+"/"+e[a];r+="/visual-ab-core"}}catch(n){}Ve("tea:openVisualABEditor",function(e){var t,i=e.data;if("string"==typeof e.data)try{i=JSON.parse(e.data)}catch(e){i=void 0}i&&(t=i.lang,i.appId!==o.app_id?(Ue(e,"appIdError"),console.error("abtest appid is not belong the page appid please check")):(i=i.version,je=i&&r?r+(i?"."+i:".1.0.1")+".js?query="+Date.now():"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-core.js?query="+Date.now(),window.TEAVisualEditor.lang=t,window.TEAVisualEditor.__ab_domin=o.channel_domain||"",Je({event:e,editorUrl:je,collectInstance:n})))})})(this.collect,this.config),"visual-editor"===i)?this.collect.destoryInstace():this.enable_multilink&&(o=this.collect,e=this.config,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=e.app_id,Ve("tea:openTesterEventInspector",function(e){var t,i,n=e.data;if("string"==typeof e.data)try{n=JSON.parse(e.data)}catch(e){n=void 0}n&&(t=n.referrer,i=n.lang,n=n.appId,window.TEAVisualEditor.__editor_ajax_domain=t||"",window.TEAVisualEditor.__ab_appId=n||"",window.TEAVisualEditor.lang=i||"",Je({event:e,editorUrl:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector.js?query="+Date.now(),collectInstance:o}))}))},w.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,i=e.ab_ext_version,n=e.ab_version_multilink,e=e.data,o=this.checkFromUrl(),o=(o?this.mulilinkVersions.push(o):this.mulilinkVersions=n||[],this.extVersions=i||[],this.versions=t||[],this.data=e,this.versions.concat(this.extVersions));this.enable_multilink&&(o=o.concat(this.mulilinkVersions)),this.configVersions(o.join(","))},w.prototype.checkFromUrl=function(){var e=c(window.location.href);return e&&e.vid?e.vid:""},w.prototype.updateVersions=function(){var t=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(t=t.concat(this.mulilinkVersions)),this.configVersions(t.join(",")),this.updateABCache(),0<this.changeListener.size&&this.changeListener.forEach(function(e){"function"==typeof e&&e(t)})},w.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},w.prototype.getVar=function(e,t,i){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof i)throw new Error("callback must be a function");t={name:e,defaultValue:t,callback:i,type:Ke.Var};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(t,e):this.callbacks.push(t)},w.prototype.getRealVar=function(e,t){var i,n=e.name,o=e.defaultValue,e=e.callback,r=this.data;r?B(r[n])?(i=r[n].vid,"$ab_url"===t?this.mulilinkVersions.includes(i)||this.mulilinkVersions.push(i):this.versions.includes(i)||this.versions.push(i),this.updateVersions(),this.fechEvent(i,t,o),e(r[n].val),this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 曝光了实验"+n,level:"info",time:Date.now(),data:r[n]})):(this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getVar",level:"info",time:Date.now(),data:o}),e(o)):e(o)},w.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");e={callback:e,type:Ke.All};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(e):this.callbacks.push(e)},w.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getAllVars",level:"info",time:Date.now(),data:this.data})},w.prototype.fechEvent=function(e,t,i){try{var n,o,r,a,s,c;this.config.disable_track_event||e&&(o=(n=this.collect.configManager.get()).header,r=n.user,(a=this.getABCache())&&a.uuid&&a.uuid!==r.user_unique_id||(s={event:"abtest_exposure",ab_sdk_version:""+e,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?i:window.location.href}),local_time_ms:Date.now()},o.custom=JSON.stringify(o.custom),c={events:[s],user:r,header:o},"$ab_url"===t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify([c])):this.reportExposure(c)))}catch(e){this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},w.prototype.reportExposure=function(e){var t=this;this.exposureCache.push(e),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report():this.reportTimeout=setTimeout(function(){t.report(),clearTimeout(t.reportTimeout)},this.ab_batch_time)},w.prototype.report=function(){var t=this,e=this.config.enable_encryption?"data="+N(JSON.stringify(this.exposureCache)):this.exposureCache;this.fetch(this.reportUrl,e,1e5,!1,function(){},function(){},"","POST",this.config.enable_encryption||!1),this.exposureCache.forEach(function(e){t.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:[e],code:200,status:"success"})}),this.exposureCache=[]},w.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},w.prototype.getABconfig=function(e,t){var i=Object.keys(e);i&&i.length&&this.collect.configManager.set(e),this.fetchAB(t)},w.prototype.get=function(e){var t;return this.ab_cross?(t=this.cacheStorgae.getCookie(e,this.ab_cookie_domain))?JSON.parse(t):null:this.cacheStorgae.getItem(e)},w.prototype.set=function(e,t){this.ab_cross?this.cacheStorgae.setCookie(e,t,2592e6,this.ab_cookie_domain):this.cacheStorgae.setItem(e,t),this.collect.configManager.setAbCache(t)},w.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""},t=this.get(this.abKey)||t;return 2592e6<=Date.now()-t.timestamp?(this.cacheStorgae.removeItem(this.abKey),null):e?t[e]:t},w.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.set(this.abKey,e)},w.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.set(this.abKey,t)},w.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[],this.collect.configManager.clearAbCache()},w.prototype.openOverlayer=function(e){var t,i,n,o,r=this;document.getElementById(Oe)||(i="body { opacity: 0 !important; }",n=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("style")).id=Oe,o.type="text/css",o.styleSheet?o.styleSheet.cssText=i:o.appendChild(document.createTextNode(i)),n.appendChild(o)),e&&(t=setTimeout(function(){r.closeOverlayer(),clearTimeout(t)},e))},w.prototype.closeOverlayer=function(){var e;(e=document.getElementById(Oe))&&e.parentElement.removeChild(e)},w.prototype.fetchComplete=function(t,e){var n=this;if(t&&"[object Object]"==Object.prototype.toString.call(t)){this.data=t,this.setAbCache(e);var o,r,i=[],e=(Object.keys(t).forEach(function(e){e=t[e].vid;e&&i.push(e)}),this.versions=this.versions.filter(function(e){return i.includes(e)}),t.$ab_url),a=t.$ab_modification;if(a&&a.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,function(){var e=a.val;window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=e,H("https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-ab-loader.js?query="+Date.now(),function(){console.log("load visual render success")},function(){console.log("load visual render fail")}),n.closeOverlayer()})}else e&&this.enable_multilink&&(this.mulilinkVersions=this.mulilinkVersions.filter(function(e){return i.includes(e)}),o=e.val,r=e.vid,o)&&r&&this.getVar("$ab_url",o,function(){n.editMode||(o!==window.location.href?setTimeout(function(){if(!n.collect.destroyInstance){var e=-1===(e=""+o).indexOf("http")?"https://"+e:e,t=z(e).host;try{var i=new URL(e);t!==location.host?i.searchParams.append("vid",r):window.history.replaceState("","",e),window.location.href=i.href}catch(t){window.location.href=e}}},100):n.closeOverlayer())});this.updateVersions()}else this.closeOverlayer();this.callbacks.forEach(function(e){return n[e.type===Ke.Var?"getRealVar":"getRealAllVars"](e,"")}),this.callbacks=[]},w.prototype.fetchAB=function(i){var n=this,o=this.collect.configManager.get(),e=o.header,t=o.user,t=(this.config.enable_anonymousid&&delete t.web_id,{header:l({aid:this.config.app_id},t||{},e||{},{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})});this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 发起AB实验请求",level:"info",logType:"fetch",time:Date.now(),data:t}),this.fetch(this.fetchUrl,t,this.config.ab_timeout||3e3,!1,function(e){n.fetchStatus="complete",n.refreshFetchStatus="complete";var t=e.data;"success"===e.message?(n.fetchComplete(t,o.user.user_unique_id),i&&i(t)):(n.fetchComplete(null,o.user.user_unique_id),i&&i(null)),n.collect.emit(n.types.AbComplete,t),n.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求成功",level:"info",logType:"fetch",time:Date.now(),data:t})},function(){n.fetchStatus="complete",n.refreshFetchStatus="complete",n.fetchComplete(null,o.user.user_unique_id),i&&i(null),n.collect.emit(n.types.AbTimeout),n.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求网络异常",level:"error",logType:"fetch",time:Date.now()})})},w.prototype.filterUrl=function(e){try{var t="",i=(-1!==e.indexOf("&multilink=true")?t="&multilink=true[\0-ÿ]*":-1!==e.indexOf("?multilink=true")&&(t="\\?multilink=true[\0-ÿ]*"),new RegExp(t,"g"));e=e.replace(i,"")}catch(e){}return e};var He=w;function w(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[]}try{var We=Se();We&&(We.LogAb=function(e,t){(new He).apply(e,t)})}catch(l){console.log(l)}Qe.prototype.apply=function(e,t){var i=this,n=e.adapters.fetch;t.event_verify_url&&("string"==typeof t.event_verify_url?(this.url=t.event_verify_url+"/v1/list_test",this.url&&(t=e.Types,e.on(t.SubmitBefore,function(e){n(i.url,e,3e4)}))):console.log("please use correct et_test url"))};var W=Qe,$e=(T.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},T.prototype.resetParams=function(e,t,i){this.url_path=e,this.url=i,this.title=t},T.prototype.enable=function(e,t,i){this.url_path=e||this.url_path,this.url=i||this.url,this.title=t||this.title,this.disableCallback=this.enablePageAlive(),this.options.params instanceof Function?this.customParmas=this.options.params():this.customParmas=this.options.params},T.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},T.prototype.sendEvent=function(e,t){t=(t=void 0===t?!1:t)?this.aliveDTime:Date.now()-this.sessionStartTime;t<0||t>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,l({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:t,is_support_visibility_change:L(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e},this.customParmas)),this.sessionStartTime=Date.now(),this.resetParams(location.pathname,document.title,location.href))},T.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},T.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)},1e3)},T.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},T.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},T.prototype.enablePageAlive=function(){var e=this,t=(this.timerHandler=this.setUpTimer(),this.visibilitychange.bind(this)),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},T),Fe=(k.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},k.prototype.resetParams=function(e,t,i){this.url_path=e,this.url=i,this.title=t},k.prototype.enable=function(e,t,i){this.url_path=e||this.url_path,this.url=i||this.url,this.title=t||this.title,this.disableCallback=this.enablePageClose()},k.prototype.disable=function(){this.disableCallback()},k.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0,this.options.params instanceof Function?this.customParmas=this.options.params():this.customParmas=this.options.params,this.resetParams(location.pathname,document.title,location.href)},k.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,l({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:L()},this.customParmas)),this.pageStartTime=Date.now(),this.resetData())},k.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},k.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},k),Xe=(S.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.config.enable_stay_duration&&(this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new $e(e,t),this.pageClose=new Fe(e,t),e=this.collect.Types,this.collect.on(e.ResetStay,function(e){var t=e.url_path;i.resetStayDuration(t,e.title,e.url)}),this.collect.on(e.RouteChange,function(e){e.init||t.disable_route_report||i.resetStayDuration()}),this.collect.on(e.SetStay,function(e){var t=e.url_path;i.setStayParmas(t,e.title,e.url)}),this.enable(this.url_path,this.title,this.url),this.ready(e.Stay),this.collect.emit(e.StayReady))},S.prototype.ready=function(e){var i=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var n=this.collect.hook._hooksCache[e];if(Object.keys(n).length)for(var t in n)(t=>{n[t].length&&n[t].forEach(function(e){i.collect.hook.emit(t,e)})})(t)}},S.prototype.enable=function(e,t,i){this.pageAlive.enable(e,t,i),this.pageClose.enable(e,t,i)},S.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},S.prototype.setStayParmas=function(e,t,i){this.pageAlive.setParams(e=void 0===e?"":e,t=void 0===t?"":t,i=void 0===i?"":i),this.pageClose.setParams(e,t,i),this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},S.prototype.reset=function(e,t,i){this.disable(),this.enable(e,t,i)},S.prototype.resetStayDuration=function(e,t,i){this.reset(e,t,i),this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},S);function S(){}function k(e,t){var i=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?i.activeEndTime=Date.now():"visible"===document.visibilityState&&(i.activeEndTime&&(i.totalTime+=i.activeEndTime-i.activeStartTime,i.activeTimes+=1),i.activeEndTime=void 0,i.activeStartTime=Date.now())},this.beforeunload=function(){if(i.totalTime+=(i.activeEndTime||Date.now())-i.activeStartTime,i.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:i.totalTime,page_title:document.title||location.pathname}))}catch(e){}i.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||864e5,this.pageStartTime=Date.now(),B(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.resetData()}function T(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,B(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration))}function Qe(){}try{var Ze=Se();Ze&&(Ze.LogStay=function(e,t){(new Xe).apply(e,t)})}catch(l){console.log(l)}D.prototype.apply=function(e,t){var i=this,n=(this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list",e.Types),o=e.adapters.fetch;this.eventCheck=new ee(e,t),this.fetch=o,this.cache={},this.collect.on(n.ProfileSet,function(e){i.setProfile(e)}),this.collect.on(n.ProfileSetOnce,function(e){i.setOnceProfile(e)}),this.collect.on(n.ProfileUnset,function(e){i.unsetProfile(e)}),this.collect.on(n.ProfileIncrement,function(e){i.incrementProfile(e)}),this.collect.on(n.ProfileAppend,function(e){i.appendProfile(e)}),this.collect.on(n.ProfileClear,function(){i.cache={}}),this.ready(n.Profile)},D.prototype.ready=function(e){var i=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var n=this.collect.hook._hooksCache[e];if(Object.keys(n).length)for(var t in n)(t=>{n[t].length&&n[t].forEach(function(e){i.collect.hook.emit(t,e)})})(t)}},D.prototype.report=function(e,t){void 0===t&&(t={});try{var i,n,o,r;this.config.disable_track_event||((i=[]).push(this.collect.processEvent(e,t)),n=this.collect.eventManager.merge(i,!0),o=this.config.enable_encryption?"data="+N(JSON.stringify(n)):n,r=this.config.enable_encryption?this.reportUrl+"?encryption=1":this.reportUrl,this.fetch(r,o,1e5,!1,function(){},function(){},"","POST",this.config.enable_encryption||!1),this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:n,code:200,status:"success"}))}catch(e){this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},D.prototype.setProfile=function(e){e=this.formatParams(e);e&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set",l({},e,{profile:!0})))},D.prototype.setOnceProfile=function(e){e=this.formatParams(e,!0);e&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set_once",l({},e,{profile:!0})))},D.prototype.incrementProfile=function(e){e?this.report("__profile_increment",l({},e,{profile:!0})):console.warn("please check the params, must be object!!!")},D.prototype.unsetProfile=function(e){var t;e?((t={})[e]="1",this.report("__profile_unset",l({},t,{profile:!0}))):console.warn("please check the key, must be string!!!")},D.prototype.appendProfile=function(e){if(e){var t,i={};for(t in e)"string"==typeof e[t]||"Array"===Object.prototype.toString.call(e[t]).slice(8,-1)?i[t]=e[t]:console.warn("please check the value of param: "+t+", must be string or array !!!");Object.keys(i).length&&this.report("__profile_append",l({},i,{profile:!0}))}else console.warn("please check the params, must be object!!!")},D.prototype.pushCache=function(t){var i=this;Object.keys(t).forEach(function(e){i.cache[e]={val:i.clone(t[e]),timestamp:Date.now()}})},D.prototype.formatParams=function(i,n){var o=this;void 0===n&&(n=!1);try{if(i&&"[object Object]"===Object.prototype.toString.call(i)){var e,r={};for(e in i)"string"==typeof i[e]||"number"==typeof i[e]||"Array"===Object.prototype.toString.call(i[e]).slice(8,-1)?r[e]=i[e]:console.warn("please check the value of params:"+e+", must be string,number,Array !!!");var a,t=Object.keys(r);if(t.length)return a=Date.now(),t.filter(function(e){var t=o.cache[e];return n?!t:!(t&&o.compare(t.val,i[e])&&a-t.timestamp<o.duration)}).reduce(function(e,t){return e[t]=r[t],e},{})}else console.warn("please check the params type, must be object !!!")}catch(i){this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message}),console.log("error")}},D.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),!1}},D.prototype.clone=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),t}},D.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")};var A=D,We=(et.prototype.apply=function(e,t){var i=this;this.collect=e,t.disable_heartbeat||(this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval(),e=this.collect.Types,this.collect.on(e.SessionReset,function(){i.process()}))},et.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},et.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},et),Ze=(Ye.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.config.channel_domain||this.config.disable_track_event||this.config.disable_sdk_monitor||this.config.enable_encryption||(t=e.adapters.fetch,this.fetch=t,this.url=e.configManager.getUrl("event"),t=this.collect.Types,this.collect.on(t.Ready,function(){i.sdkOnload()}),this.collect.on(t.SubmitError,function(e){"f_data"===e.type&&i.sdkError(e.eventData,e.errorCode)}))},Ye.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),i=t.header,n=t.user,o=i.app_id,r=i.app_name,a=i.sdk_version,s=n.web_id,c=n.anonymous_id,l={events:[{event:"onload",params:JSON.stringify({app_id:o,app_name:r||"",sdk_version:a,sdk_type:"script",sdk_config:this.config,sdk_desc:"TOB"}),local_time_ms:Date.now()}],user:{user_unique_id:this.config.enable_anonymousid?c:s},header:{}};setTimeout(function(){e.fetch(e.url,[l],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(e){}},Ye.prototype.sdkError=function(e,t){var i=this;try{var n=e[0],o=n.user,r=n.header,a=[],s=(e.forEach(function(e){e.events.forEach(function(e){a.push(e)})}),{events:a.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:r.app_id,app_name:r.app_name||"",error_event:e.event,sdk_version:r.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(r),user:JSON.stringify(o)}),local_time_ms:Date.now()}}),user:{user_unique_id:o.user_unique_id},header:{}});setTimeout(function(){i.fetch(i.url,[s],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(e){}},Ye);function Ye(){}function et(){var e=this;this.setInterval=function(){var i,n,o,r;e.clearIntervalFunc=(i=function(){e.isSessionhasEvent&&e.endCurrentSession()},n=e.sessionInterval,void 0===i&&(i=function(){}),void 0===n&&(n=1e3),o=Date.now()+n,r=window.setTimeout(function e(){var t=Date.now()-o;i(),o+=n,r=window.setTimeout(e,Math.max(0,n-t))},n),function(){window.clearTimeout(r)})},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}function D(){}function tt(e,t){if(void 0===t&&(t="list"),e)if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return 1;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return 1;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return 1}else{if(["A","BUTTON"].includes(e.nodeName))return 1;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return 1;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return 1;if(e.hasAttribute&&at(e,"ss"))return 1}}var it=function(e,t){return!!at(e,t)};function nt(e){for(var t=e;t&&!tt(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}function ot(e){var t="";return 3===e.nodeType?t=e.textContent.trim():e.dataset&&e.dataset.hasOwnProperty("teaTitle")||e.hasAttribute("ata-tea-title")?t=e.getAttribute("data-tea-title"):e.hasAttribute("title")?t=e.getAttribute("title"):"INPUT"===e.nodeName&&["button","submit"].includes(e.getAttribute("type"))?t=e.getAttribute("value"):"IMG"===e.nodeName&&e.getAttribute("alt")&&(t=e.getAttribute("alt")),t.slice(0,200)}var rt=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},at=function(e,t){if("string"==typeof t)return rt(e,t);if(J(t)){for(var i=!1,n=0;n<t.length;n++)if(rt(e,t[n])){i=!0;break}return i}},st=function(e,t){var i={};if("string"==typeof t)rt(e,t)&&(i.attrs=e.getAttribute(t));else if(J(t))for(var n=0;n<t.length;n++)rt(e,t[n])&&(i[t[n]]=e.getAttribute(t[n]));return i},ct=(pt.prototype.init=function(e){this.eventHandel=e;e=this.config.mode;this.addListener(e)},pt.prototype.addListener=function(e){var i=this;if("proxy-capturing"===e&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",function(e){var t=e.config;i.getPageViewEvent(t,e.name)}),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",function(){i.beatEvent(i.beatTime)});var t=0,n=null,o=(window.addEventListener("scroll",function(){clearTimeout(n),n=setTimeout(o,500),t=document.documentElement.scrollTop||document.body.scrollTop}),function(){(document.documentElement.scrollTop||document.body.scrollTop)==t&&i.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})})}catch(e){}try{var r=window.performance&&window.performance.getEntriesByType("paint");r&&r.length?(new PerformanceObserver(function(e){e=e.getEntries(),e=e[e.length-1],e=e.renderTime||e.loadTime;i.statistics||(i.getPageLoadEvent(e),i.statistics=!0)}).observe({entryTypes:["largest-contentful-paint"]}),setTimeout(function(){i.statistics||(i.getPageLoadEvent(r[0].startTime||0),i.statistics=!0)},2e3)):this.getPageLoadEvent(0)}catch(e){this.getPageLoadEvent(0)}}},pt.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},pt.prototype.beatEvent=function(e){var t,i=this;try{this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(t=setInterval(function(){i.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})},e)),V(function(){i.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),i.beatTime&&clearInterval(t)})}catch(e){}},pt),lt={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},ht=(ut.prototype.getConfig=function(){return this.config},ut.prototype.setConfig=function(e){return this.config=e},ut);function ut(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}function pt(e,t,i){var n=this;this.clickEvent=function(e){((e,t)=>{if(1===e.nodeType&&(t.svg||!(e=>{if("svg"===e.tagName.toLowerCase())return!0;for(var t=e.parentElement,i=!1;t;)"svg"===t.tagName.toLowerCase()?i=!(t=null):t=t.parentElement;return i})(e))&&!["HTML","BODY"].includes(e.tagName.toUpperCase()))return"none"!==(e=e).style.display&&(tt(e,"container")||t.track_attr&&it(e,t.track_attr)||!(t=e).children.length||(t=t.children,![].slice.call(t).some(function(e){return 0<e.children.length})))})(e.target,n.options)&&n.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){n.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){n.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(e,t){t&&"pushState"===t&&n.eventHandel({eventType:"dom",eventName:"beat"},l({beat_type:0},e)),n.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(e){n.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=i.getConfig().eventConfig,this.collect=t,this.options=e,this.beatTime=e.beat,this.statistics=!1}function dt(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var i=[],n=[];return t.forEach(function(e){var e=(e=>{if(null===e)return{str:"",index:0};var t=0,i=e.parentElement;if(i)for(var n=i.children,o=0;o<n.length&&n[o]!==e;o++)n[o].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),tt(e,"list")?"[]":""].join(""),index:t}})(e),t=e.str,e=e.index;i.unshift(t),n.unshift(e)}),{element_path:"/"+i.join("/"),positions:n}}function ft(e,i,t,n){var r,a,o={},s=(()=>{var e,t;if(i)return t=(e=i.getBoundingClientRect()).width,{left:e.left,top:e.top,element_width:t,element_height:e.height}})(),c=(c=s,e=(h=void 0===(h=e)?{}:e).clientX,h=h.clientY,l=(c=void 0===c?{}:c).left,c=c.top,h=0<=h-c?h-c:0,{touch_x:Math.floor(0<=e-l?e-l:0),touch_y:Math.floor(h)}),e=s.element_width,l=s.element_height,h=c.touch_x,s=c.touch_y,c=dt(i),u=c.element_path,c=c.positions,p=(p=nt(i),r=[],function e(t){var i=ot(t);if(i&&-1===r.indexOf(i)&&r.push(i),0<t.childNodes.length)for(var n=t.childNodes,o=0;o<n.length;o++)8!==n[o].nodeType&&e(n[o])}(p),r),d=window.performance.timing.navigationStart,f=Date.now()-d,c=c.map(function(e){return""+e}),g=null;if(window.TEAVisualEditor.getOriginXpath&&(g=window.TEAVisualEditor.getOriginXpath({xpath:u,positions:c})),o.element_path=g&&g.xpath||u,o.positions=g&&g.positions||c,n&&!n.text&&(o.texts=p,o.element_title=(u=nt(i),a="",function e(t){var i=ot(t);if(i&&(a+=i),0<t.childNodes.length)for(var n=t.childNodes,o=0;o<n.length;o++)3===n[o].nodeType&&e(n[o])}(u),a)),o.element_id=i.getAttribute("id")||"",o.element_class_name=i.getAttribute("class")||"",o.element_type=i.nodeType,o.element_width=Math.floor(e),o.element_height=Math.floor(l),o.touch_x=h,o.touch_y=s,o.page_manual_key="",o.elememt_manual_key="",o.since_page_start_ms=f,o.page_start_ms=d,o.page_path=location.pathname,o.page_host=location.host,t.track_attr&&it(i,t.track_attr)){var m,_=st(i,t.track_attr);for(m in _)o[m]=_[m]}g=nt(i);return"A"===g.tagName&&(o.href=g.getAttribute("href")),"IMG"===i.tagName&&(o.src=i.getAttribute("src")),o}function gt(e,t,i,n,o){return l({event:e},ft(t,i,n,o),{is_html:1,page_key:window.location.href,page_title:document.title})}kt.prototype.handleEvent=function(t,e){try{if((()=>{for(var e=t.target;e&&e.parentNode;){if(e.hasAttribute("data-tea-ignore"))return 1;if("HTML"===e.nodeName||"body"===e.nodeName)return;e=e.parentNode}})())return null;var i="bav2b_click";switch(e){case"click":return i=this.eventName.click,gt(i,t,t.target,this.options,this.ignore);case"exposure":return i=this.eventName.exposure,gt(i,t,t.target,this.options,this.ignore);case"change":return l({},gt(i="bav2b_change",t,t.target,this.options),((e,t)=>{try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(e){return{}}})(i,t.target));case"submit":return gt(i="bav2b_submit",t,t.target,this.options)}}catch(e){return console.error(e),null}},kt.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t,i=window.sessionStorage.getItem("_tea_cache_duration");i&&(t=JSON.parse(i),e.refer_page_duration_ms=t?t.duration:""),e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("page event error "+JSON.stringify(e))}return e},kt.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var i=e.lcp,n=window.performance.timing,o=n.loadEventEnd-n.navigationStart;t.page_init_cost_ms=parseInt(i||(0<o?o:0)),t.page_start_ms=n.navigationStart}catch(e){console.log("page_statistics event error "+JSON.stringify(e))}return t},kt.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("beat event error "+JSON.stringify(e))}return e};var mt=kt,_t=(St.prototype.send=function(e,t){var e=e.eventSend,i=t.event;delete t.event,e&&"becon"===e?this.collect.beconEvent(i,t):this.collect.event(i,t)},St.prototype.get=function(e,t){t=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t);fetch(e,t)},St.prototype.post=function(e,t){t=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t);fetch(e,t)},St),vt="_TEA_VE_OPEN",yt="_TEA_VE_APIHOST",bt="lang",Et="_VISUAL_EDITOR_V",wt="_VISUAL_EDITOR_U";function St(e){this.collect=e,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}function kt(e,t){this.ignore={text:!1},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"bav2b_exposure"},t&&!1===t.text&&(this.ignore.text=!0),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName)}function Tt(){try{var e=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||h.get(bt),t=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||h.get(yt),i=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||h.get(Et),n=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||h.get(wt),o=+new Date,r=new Date(18e5+o);h.set(vt,"1",{expires:r}),h.set(yt,t,{expires:r}),h.set(wt,n,{expires:r}),h.set(bt,e,{expires:r}),h.set(Et,i||"",{expires:r})}catch(e){console.log("set cookie err")}}var At=!1;function Dt(e){var t=e.event,i=e.autoTrackInstance;At||(At=!0,H(e.editorUrl,function(){Ue(t,"editorScriptloadSuccess"),i.destroy()},function(){t&&Ue(t,"editorScriptloadError"),At=!1}))}function Ot(o,e){window.TEAVisualEditor=window.TEAVisualEditor||{};var r="",a="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/visual-editor-rangers.js?query="+Date.now(),s=(window.TEAVisualEditor.appId=e.app_id,e.channel_domain),c="";if(Pe(["*"]),s){var t,i="";try{var n=window.performance.getEntriesByType("resource");if(n&&n.length&&(n.forEach(function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(i=e.name)}),i||document.currentScript&&(i=document.currentScript.src),i)&&(t=i.split("/"))&&t.length){c="https:/";for(var l=2;l<t.length&&l!==t.length-1;l++)c=c+"/"+t[l];c&&c.indexOf("/5.0")&&(c=c.split("/5.0")[0]||c)}}catch(o){}}if(ze(e,u),"1"===h.get(vt)){n=(()=>{var e=h.get(yt);try{e=JSON.parse(e)}catch(e){}return e})(),e="";n&&(window.TEAVisualEditor.__editor_ajax_domain=n,e=h.get(wt)),Dt({event:null,editorUrl:e||a,autoTrackInstance:o}),Tt()}else try{Ve("tea:openVisualEditor",function(e){var t,i,n=e.data;if("string"==typeof e.data)try{n=JSON.parse(e.data)}catch(e){n=void 0}n&&(i=n.referrer,t=n.lang,i&&(window.TEAVisualEditor.__editor_ajax_domain=i),r=a,s&&(i=n.version,r=c?c+(i?"/visual-editor-rangers-v"+i:"/visual-editor-rangers-v1.0.0")+".js":a,window.TEAVisualEditor.__editor_verison=i),window.TEAVisualEditor.__editor_url=r,window.TEAVisualEditor.lang=t,Dt({event:e,editorUrl:r,autoTrackInstance:o}),Tt())}),window.TEAVisualEditor.openAutotrackEditor=function(){Dt({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:o})}}catch(o){console.log("receive message error")}try{Ve("tea:openHeatMapCore",function(e){Dt({event:e,editorUrl:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/heatmap-core.js?query="+Date.now(),autoTrackInstance:o})})}catch(o){console.log("openHeatMapCore error")}}x.prototype.init=function(){var t=this;MutationObserver?(this._instance=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&t.attributeChangeObserve(e),"childList"===e.type&&t.modifyNodeObserve(e)})}),this._instance.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})):console.log("your browser cannot support MutationObserver")},x.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},x.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd)}),Array.prototype.forEach.call(e.removedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove)})},x.prototype.mapChild=function(e,t){var i=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),i.mapChild(e,t)})},x.prototype.exposureAdd=function(e,t){try{this._intersection&&this._intersection.exposureAdd(e,t)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},x.prototype.exposureRemove=function(e){try{this._intersection&&this._intersection.exposureRemove(e)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},x._exposure_observer=null;var Ct=x,xt=(C.prototype.buildObserver=function(){var t=this;return C._observer_instance?(console.log("your browser cannot support IntersectionObserver"),null):C._observer_instance=IntersectionObserver?new IntersectionObserver(function(e){e.forEach(function(e){t.observeMap.get(e.target._observeId)&&t.exposureEvent(e)})},{threshold:[.01,.25,.5,.75,1]}):C._observer_instance},C.prototype.exposureAdd=function(e,t){var i=e,t=(i="mutation"===t?e.target:i)._observeId;t||this.observeMap.has(t)?!1===i.visible&&0<=(t=i.getBoundingClientRect()).top&&t.bottom<=window.innerHeight&&0<=t.left&&t.right<=window.innerWidth&&(i.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e)):(i._observeId=this.count,i.visible=!1,this.observeMap.set(this.count,i),this.observe(i),this.count++)},C.prototype.exposureRemove=function(e){this.observeMap.has(e._observeId)&&(this.observeMap.delete(e._observeId),this.unobserve(e))},C.prototype.exposureEvent=function(e){e.intersectionRatio>=this.Ratio&&e.isIntersecting?"0"!==e.target.style.opacity&&"hidden"!==e.target.style.visibility&&!0!==e.target.visible&&(e.target.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e)):e.target.visible=!1},C.prototype.observe=function(e){this.instance&&this.instance.observe(e)},C.prototype.unobserve=function(e){this.instance&&this.instance.unobserve(e)},C._observer_instance=null,C._observer_map=new Map,C),Gt=(Rt.prototype.initObserver=function(){var t=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(e){t._intersection.exposureAdd(e,"intersect")})},Rt),Mt={hashTag:!1,impr:!1},It=(O.prototype.apply=function(e,t){this.autoTrackStart=!1,this.collect=e,(this.config=t).autotrack&&(e=e.Types,t.autotrack&&t.autotrack.collect_url&&!t.autotrack.collect_url()||(this.ready(e.Autotrack),this.collect.emit(e.AutotrackReady)))},O.prototype.ready=function(e){this.collect.set(e);e="object"==typeof(e=this.config.autotrack)?e:{};e=Object.assign(Mt,e),this.destroyed=!1,this.options=e,this.Config=new ht(lt,this.options),this.Exposure=new Gt(this.config,this.handle.bind(this)),this.Listener=new ct(e,this.collect,this.Config),this.EventHandle=new mt(this.config,e),this.Request=new _t(this.collect),this.autoTrackStart=!0,this.init(),Ot(this,this.config)},O.prototype.init=function(){this.Listener.init(this.handle.bind(this))},O.prototype.handle=function(e,t){"dom"===e.eventType&&this.handleDom(e,t)},O.prototype.handleDom=function(e,t){try{var i,n,o,r,a=e.eventName;"click"===a||"exposure"===a||"change"===a||"submit"===a?null!==(i=this.EventHandle.handleEvent(t,a))&&this.Request.send({eventType:"custom",eventName:"report_"+a+"_event",extra:{methods:"GET"}},i):"page_view"===a||"page_statistics"===a?(n=void 0,n="page_view"===a?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t),this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"}},n)):"beat"===a&&(o=this.EventHandle.handleBeadtEvent(t),r=e.eventSend,this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"},eventSend:r},o))}catch(e){console.log("handel dom event error "+JSON.stringify(e))}},O.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},O);function O(){}function Rt(e,t){e.autotrack&&e.autotrack.exposure&&(this._intersection=new xt(e,t),this._observer=new Ct(this._intersection),this._intersection&&this._observer?this.initObserver():console.log("your browser version cannot support exposure, please update~"))}function C(e,t){this.count=1,this.instance=this.buildObserver(),this.observeMap=C._observer_map,e.autotrack.exposure.ratio?this.Ratio=e.autotrack.exposure.ratio:0===e.autotrack.exposure.ratio?this.Ratio=0:this.Ratio=.5,this.EventHandle=t}function x(e){this._instance=null,this._intersection=e,this._intersection&&this.init()}try{var G=Se();G&&(G.LogAutoTrack=function(e,t){(new It).apply(e,t)})}catch(l){}var Pt={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},Bt=(M.prototype.apply=function(e,t){var i=this;this.ready=t.app_id&&t.enable_tracer&&!t.disable_track_event,this.ready&&(this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=e,this.appid=t.app_id,this.reportUrl=e.configManager.getUrl("event"),t=this.collect.Types,e=e.adapters.fetch,this.fetch=e,this.collect.on(t.Event,function(){i.addCount("log")}),this.collect.on(t.SubmitError,function(e){var t=e.type;i.addErrorCount(e.eventDate,t,e.errorCode,e.response)}),this.listener(),this.collect.emit(t.TracerReady))},M.prototype.addCount=function(e,t,i){void 0===t&&(t="net"),void 0===i&&(i=1);try{this.tracerCache||(this.tracerCache=new Map);var n,o=void 0;this.tracerCache.has(e)?(n=this.tracerCache.get(e)).has(t)?(o=n.get(t).params.count,o++,n.set(t,this.processTracer(o,e,t))):(o=i,n.set(t,this.processTracer(i,e,t))):(n=new Map,o=i,n.set(t,this.processTracer(i,e,t)),this.tracerCache.set(e,n)),"net"===t&&o>=this.limit[e]&&this.report(!1)}catch(e){console.log(e)}},M.prototype.addErrorCount=function(e,n,o,t){var i,r=this;try{e&&e.length&&(i=e[0].events)&&i.length&&("f_data"===n?(t&&t.hasOwnProperty("sc")?this.addCount("log",n,i.length-t.sc):this.addCount("log",n,i.length),this.errorCode[n]=o):i.forEach(function(e){var t,i="log";for(t in Pt)if(-1!==Pt[t].indexOf(e.event)){i=t;break}r.addCount(i,n,1),r.errorCode[n]=o}))}catch(e){}},M.prototype.report=function(e){var t;this.tracerCache&&(t=[],this.tracerCache.forEach(function(e){console.log(e),e.forEach(function(e){t.push(e)})}),t)&&t.length&&this.sendTracer(t,e)},M.prototype.sendTracer=function(e,t){try{var i=this.collect.eventManager.merge(e);t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(i)):this.fetch(this.reportUrl,i),this.tracerCache=null}catch(e){}},M.prototype.processTracer=function(e,t,i){e={count:e,state:i,key:t,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:u},"f_net"!==i&&"f_data"!==i||(e.errorCode=this.errorCode[i]),t=this.collect.processEvent("applog_trace",e);if(t&&t.event)return delete t.is_bav,t},M.prototype.listener=function(){var e=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.leavePage()}),V(function(){e.leavePage()})},M.prototype.leavePage=function(){this.report(!0)},M);function M(){}try{var Nt=Se();Nt&&(Nt.LogTracer=function(e,t){(new Bt).apply(e,t)})}catch(l){console.log(l)}var Ut=Se(),G=(Lt.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},Lt.prototype.loadExtend=function(){var o=this;try{this.collect.remotePlugin.forEach(function(e,t){var i,n;"sdk"===e?we.hasOwnProperty(t)?(i=we[t].object,n=we[t].src[o.channel]+"?query="+Date.now(),o.exist(t,i,n)):console.warn("your"+t+" is not exist，please check plugin name"):"object"==typeof e&&(e.src?o.exist(t,e.call,e.src):o.process(t,e.instance,"INSTANCE"))})}catch(o){this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:o.message}),console.log("load extend error")}},Lt.prototype.exist=function(e,t,i){var n=this;Ut[t]?this.process(e,Ut[t]):this.loadPlugin(e,i,function(){n.process(e,Ut[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","–","load plugin:"+e+" success","-")},function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","–","load plugin:"+e+" error","-")})},Lt.prototype.process=function(e,t,i){try{var n;i?((n=new t).apply&&n.apply(this.collect,this.config),console.log("excude "+e+" success")):t&&t(this.collect,this.config)}catch(t){this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),console.log("excude "+e+" error, message:"+t.message)}},Lt.prototype.loadPlugin=function(e,t,i,n){var o=this;try{var r=document.createElement("script");r.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(i),r.onerror=function(){n(t)},r.onload=function(){o._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(r)}catch(e){this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},Lt),Nt=(R.prototype.apply=function(e,t){var i=this;this.collector=e,this.config=t,this.eventStorage=[],this.collector.on("submit-verify-h5",function(e){e&&e.length&&i.eventStore(e[0])}),this.checkUrl(),this.heartbeat()},R.prototype.checkUrl=function(){var e=window.location.href,e=c(e);e._r_d_&&e._r_c_k_?(this.verifyReady=!0,this.domain=e._r_d_,this.key=e._r_c_k_,this.checkCache()):this.collector.off("submit-verify-h5")},R.prototype.checkCache=function(){this.eventStorage.length&&this.postVerify(this.eventStorage)},R.prototype.heartbeat=function(){var n=this;this.heart=setInterval(function(){var e={event:"simulator_test__",local_time_ms:Date.now()},t=n.collector.configManager.get(),i=t.header;n.eventStore({events:[e],user:t.user,header:i})},6e4)},R.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e):this.eventStorage.push(e))},R.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[],clearInterval(this.heart)},R.prototype.postVerify=function(e){var t=this;try{var i=JSON.parse(JSON.stringify(e));J(e)?i.forEach(function(e){t.fetchLog(e)}):this.fetchLog(i)}catch(e){console.log("web verify post error ~")}},R.prototype.fetchLog=function(e){he(this.domain+"/simulator/h5/log?connection_key="+this.key,e,2e4,!1)},R.prototype.leave=function(){var e=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.cleanVerify()}),V(function(){e.cleanVerify()})},R),Vt=(I.prototype.apply=function(e,t){(t.spa||t.autotrack)&&(this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),t=e.Types,e.emit(t.RouteReady))},I.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:location.href,refer_title:document.title||location.pathname,refer_manual_key:""},this.config.autotrack&&"object"==typeof this.config.autotrack&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},I.prototype.hack=function(){var o=this,r=window.history.pushState,a=(history.pushState=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];"function"==typeof history.onpushstate&&history.onpushstate({state:e});var n,e=r.call.apply(r,s([history,e],t));if(o.lastLocation!==location.href)return n=o.getPopStateChangeEventData(),o.lastLocation=location.href,o.sendPv(n,"pushState"),e},history.replaceState);history.replaceState=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];"function"==typeof history.onreplacestate&&history.onreplacestate({state:e});var n,e=a.call.apply(a,s([history,e],t));if(o.lastLocation!==location.href)return n=o.getPopStateChangeEventData(),o.lastLocation=location.href,o.sendPv(n),e}},I.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},I.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},I.prototype.listener=function(){var i=this,n=null;window.addEventListener("hashchange",function(e){var t;i.lastLocation!==window.location.href&&(clearTimeout(n),i.allowHash)&&(i.lastLocation=window.location.href,t=i.getPopStateChangeEventData(),i.sendPv(t))}),window.addEventListener("popstate",function(e){i.lastLocation!==window.location.href&&(n=setTimeout(function(){i.lastLocation=window.location.href;var e=i.getPopStateChangeEventData();i.sendPv(e)},10))})},I.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},I.prototype.pageConfig=function(){try{var e=this.storage.getItem(this.cache_key)||{},t=document.referrer||e&&e.refer_key||"",i=this.storage.getItem("__tea_cache_first_"+this.appid),n=!i||1!=i;return{is_html:1,url:location.href,referrer:t,page_key:location.href,refer_page_key:t,page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:e&&e.refer_manual_key||"",refer_page_title:e&&e.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+n}}catch(t){return this.collect.emit(p.DEBUGGER_MESSAGE,{type:p.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),{}}},I.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},I);function I(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}function R(){this.verifyReady=!1,this.cleanStatus=!1}function Lt(){}try{var zt=Se();zt&&(zt.LogRoute=function(e,t){(new Vt).apply(e,t)})}catch(l){console.log(l)}Wt.prototype.apply=function(e,t){var i,n,o,r=this;!t.enable_storage||t.disable_storage||(this.collect=e,this.config=t,this.collect.destroyInstance)||(i=e.Types,n=(o=e.adapters).storage,o=o.fetch,this.storage=new n(!1),this.fetch=o,this.eventUrl=this.collect.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+t.app_id,this.storageNum=t.storage_num||50,this.retryNum=t.retry_num||3,this.retryInterval=1e3,e.on(i.SubmitError,function(e){"f_data"===e.type&&r.storeData(e)}),e.on(i.Ready,function(){r.checkStorage()}))},Wt.prototype.retryRightNow=function(t){var i,n,o=this;this.retryStatus?this.errorCache.push(t):(i=0,this.retryStatus=!0,n=setInterval(function(){var e;3===i?(o.storeData(o.errorCache),o.retryStatus=!1,clearInterval(n)):(e=t.eventData,o.fetchData(e,function(){o.retryStatus=!1,clearInterval(n),o.retryCacheStatus&&o.errorCache.splice(0,1),o.errorCache.length&&(o.retryCacheStatus=!0,o.retryRightNow(o.errorCache[0]))},function(){i++}))},this.retryInterval))},Wt.prototype.storeData=function(e){var t=this.storage.getItem(this.eventKey),e=e.eventData;Object.keys(t).length!==this.storageNum&&(t[Date.now()]=e,this.storage.setItem(this.eventKey,t))},Wt.prototype.checkStorage=function(){var i,e,n=this;try{window.navigator.onLine&&(i=this.storage.getItem(this.eventKey))&&Object.keys(i).length&&(e={events:[{event:"ontest",params:{app_id:this.config.app_id},local_time_ms:Date.now()}],user:{user_unique_id:this.collect.configManager.get("web_id")},header:{}},this.fetchData([e],function(){var e,t=JSON.parse(JSON.stringify(i));for(e in i)(e=>{n.fetchData(i[e],function(){delete t[e],n.storage.setItem(n.eventKey,t)},function(){},!1)})(e)},function(){},!0))}catch(n){console.warn("error check storage")}},Wt.prototype.fetchData=function(e,t,i,n){this.fetch(this.eventUrl,e,3e4,!1,function(){t&&t()},function(){i&&i(),console.log("network error，compensate report failk")},n&&!this.config.channel_domain?"566f58151b0ed37e":"")};var zt=Wt,jt=(P.prototype.apply=function(e,t){var i=this,t=(this.collector=e,this.config=t,e.Types);e.on(t.TrackDurationStart,function(e){i.trackStart(e)}),e.on(t.TrackDurationEnd,function(e){i.trackEnd(e)}),e.on(t.TrackDurationPause,function(e){i.trackPause(e)}),e.on(t.TrackDurationResume,function(e){i.trackResume(e)}),this.Types=t,this.TrackMap=new Map,this.ready(t.TrackDuration)},P.prototype.ready=function(e){var i=this;if(this.collector.set(e),this.collector.hook._hooksCache.hasOwnProperty(e)){var n=this.collector.hook._hooksCache[e];if(Object.keys(n).length)for(var t in n)(t=>{n[t].length&&n[t].forEach(function(e){i.collector.hook.emit(t,e)})})(t)}},P.prototype.trackStart=function(e){this.TrackMap.set(e,{startTime:Date.now(),isPause:!1,pauseTime:0,resumeTime:0})},P.prototype.trackEnd=function(e){var t,i,n=e.eventName,e=e.params;this.TrackMap.has(n)&&(t=0,t=(i=this.TrackMap.get(n)).isPause?i.pauseTime-i.startTime:i.resumeTime?i.pauseTime-i.startTime+(Date.now()-i.resumeTime):Date.now()-i.startTime,i=Object.assign(e,{event_duration:t}),this.collector.event(n,i),this.cleanTrack(n))},P.prototype.trackPause=function(e){var t;this.TrackMap.has(e)&&!(t=this.TrackMap.get(e)).isPause&&(t.isPause=!0,t.pauseTime=Date.now(),this.TrackMap.set(e,t))},P.prototype.trackResume=function(e){var t;this.TrackMap.has(e)&&(t=this.TrackMap.get(e)).isPause&&(t.isPause=!1,t.resumeTime=Date.now(),this.TrackMap.set(e,t))},P.prototype.cleanTrack=function(e){this.TrackMap.delete(e)},P),Kt=["getConfig","getAbSdkVersion"],qt=["init","usePlugin","autoInitializationRangers"],Jt=(Ht.prototype.processTask=function(){var i,n=this;this.task.length&&(-1!==(i=this.findIndex(this.task,qt,"0"))?(this.processCmd.apply(this,s(this.task[i])),this.task.forEach(function(e,t){t!==i&&n.processCmd.apply(n,s(e))}),this.task=[]):console.warn("init or use must be first call"))},Ht.prototype.processCmd=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(J(e)){var i=this.processScope(e[0]),n=i.scope,i=i.cmd;if(e.splice(0,1),-1!==Kt.indexOf(i))return this.callCmd(n,i,e);this.callCmd(n,i,e)}},Ht.prototype.callCmd=function(e,t,i){try{if(-1===qt.indexOf(t)||this.collectMap.get(e)||(this.collect=new this.Collector(e),this.collectMap.set(e,this.collect)),this.collectMap.get(e)){var n=this.collectMap.get(e);if(n.__proto__.hasOwnProperty(t))if("event"===t)n.event.apply(n,s([t],i));else{if(-1!==Kt.indexOf(t))return n[t].apply(n,s(i));n[t].apply(n,s(i))}else n.event.apply(n,s([t],i))}else console.log("init or use must be first call")}catch(e){console.log("callCmd error")}},Ht.prototype.findIndex=function(e,i,n){var o=this,r=-1;try{e.forEach(function(e,t){e=void 0!==n?e[n]:e,e=o.processScope(e).cmd;-1!==i.indexOf(e)&&(r=t)})}catch(e){}return r},Ht.prototype.processScope=function(e){var t,i="default";try{"string"==typeof e&&-1<e.indexOf(".")&&(i=(t=e.split("."))[0],e=t[1])}catch(t){}return{scope:i,cmd:e}},Ht);function Ht(e){this.task=[],this.Collector=e,this.collectMap=new Map}function P(){}function Wt(){this.retryWaitTime=3e3,this.retryStatus=!1,this.retryCacheStatus=!1}r.usePlugin(G,"extend"),r.usePlugin(He,"ab"),r.usePlugin(Xe,"stay"),r.usePlugin(It,"autotrack"),r.usePlugin(jt,"trackDuration"),r.usePlugin(zt,"store"),r.usePlugin(Nt,"verify_h5"),r.usePlugin(W,"et"),r.usePlugin(A,"profile"),r.usePlugin(We,"heartbeat"),r.usePlugin(Ze,"monitor"),r.usePlugin(Vt,"route"),r.usePlugin(Bt,"tracer"),G=new Jt(r),"undefined"!=typeof window&&(jt=(()=>{if("undefined"!=typeof window)return window.LogAnalyticsObject||window.TeaAnalyticsObject})())&&window[jt]&&((zt=window[jt]).sdkLoad?console.log("you page has load sdk file already, do not load another sdk file"):(G.task=zt.q||[],window[jt]=G.processCmd.bind(G),window[jt].sdkLoad=!0,G.processTask()))})();