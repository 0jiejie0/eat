var window=window||{};window.ReplaySDK=(()=>{var Ub=Object.create;var Jn=Object.defineProperty,Pb=Object.defineProperties,Ab=Object.getOwnPropertyDescriptor,Db=Object.getOwnPropertyDescriptors,Vb=Object.getOwnPropertyNames,Ko=Object.getOwnPropertySymbols,wd=Object.getPrototypeOf,Ul=Object.prototype.hasOwnProperty,xd=Object.prototype.propertyIsEnumerable,Nb=Reflect.get;var Lb=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r);var jo=Math.pow,Ml=(r,e,t)=>e in r?Jn(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,H=(r,e)=>{for(var t in e||(e={}))Ul.call(e,t)&&Ml(r,t,e[t]);if(Ko)for(var t of Ko(e))xd.call(e,t)&&Ml(r,t,e[t]);return r},Zn=(r,e)=>Pb(r,Db(e));var nr=(r,e)=>{var t={};for(var n in r)Ul.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Ko)for(var n of Ko(r))e.indexOf(n)<0&&xd.call(r,n)&&(t[n]=r[n]);return t};var $=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),qd=(r,e)=>{for(var t in e)Jn(r,t,{get:e[t],enumerable:!0})},Td=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Vb(e))!Ul.call(r,i)&&i!==t&&Jn(r,i,{get:()=>e[i],enumerable:!(n=Ab(e,i))||n.enumerable});return r};var Z=(r,e,t)=>(t=r!=null?Ub(wd(r)):{},Td(e||!r||!r.__esModule?Jn(t,"default",{value:r,enumerable:!0}):t,r)),Gb=r=>Td(Jn({},"__esModule",{value:!0}),r);var W=(r,e,t)=>Ml(r,typeof e!="symbol"?e+"":e,t);var Pl=(r,e,t)=>Nb(wd(r),t,e);var V=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Ho=function(r,e){this[0]=r,this[1]=e},Bd=(r,e,t)=>{var n=(s,a,l,c)=>{try{var u=t[s](a),h=(a=u.value)instanceof Ho,d=u.done;Promise.resolve(h?a[0]:a).then(f=>h?n(s==="return"?s:"next",a[1]?{done:f.done,value:f.value}:f,l,c):l({value:f,done:d})).catch(f=>n("throw",f,l,c))}catch(f){c(f)}},i=s=>o[s]=a=>new Promise((l,c)=>n(s,a,l,c)),o={};return t=t.apply(r,e),o[Lb("asyncIterator")]=()=>o,i("next"),i("throw"),i("return"),o};var Oe=$((Al,Sd)=>{"use strict";var Xn=function(r){return r&&r.Math===Math&&r};Sd.exports=Xn(typeof globalThis=="object"&&globalThis)||Xn(typeof window=="object"&&window)||Xn(typeof self=="object"&&self)||Xn(typeof global=="object"&&global)||Xn(typeof Al=="object"&&Al)||function(){return this}()||Function("return this")()});var $t=$((AC,Ed)=>{"use strict";Ed.exports=function(r){try{return!!r()}catch(e){return!0}}});var Mt=$((DC,kd)=>{"use strict";var Jb=$t();kd.exports=!Jb(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})});var Dl=$((VC,Rd)=>{"use strict";var Zb=$t();Rd.exports=!Zb(function(){var r=function(){}.bind();return typeof r!="function"||r.hasOwnProperty("prototype")})});var Jo=$((NC,Od)=>{"use strict";var Qb=Dl(),zo=Function.prototype.call;Od.exports=Qb?zo.bind(zo):function(){return zo.apply(zo,arguments)}});var Ud=$(Md=>{"use strict";var Cd={}.propertyIsEnumerable,Id=Object.getOwnPropertyDescriptor,Xb=Id&&!Cd.call({1:2},1);Md.f=Xb?function(e){var t=Id(this,e);return!!t&&t.enumerable}:Cd});var Vl=$((GC,Pd)=>{"use strict";Pd.exports=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}}});var ht=$((WC,Vd)=>{"use strict";var Ad=Dl(),Dd=Function.prototype,Nl=Dd.call,Yb=Ad&&Dd.bind.bind(Nl,Nl);Vd.exports=Ad?Yb:function(r){return function(){return Nl.apply(r,arguments)}}});var Gd=$((FC,Ld)=>{"use strict";var Nd=ht(),e0=Nd({}.toString),t0=Nd("".slice);Ld.exports=function(r){return t0(e0(r),8,-1)}});var Fd=$((KC,Wd)=>{"use strict";var r0=ht(),n0=$t(),i0=Gd(),Ll=Object,o0=r0("".split);Wd.exports=n0(function(){return!Ll("z").propertyIsEnumerable(0)})?function(r){return i0(r)==="String"?o0(r,""):Ll(r)}:Ll});var Gl=$((jC,Kd)=>{"use strict";Kd.exports=function(r){return r==null}});var Wl=$((HC,jd)=>{"use strict";var s0=Gl(),a0=TypeError;jd.exports=function(r){if(s0(r))throw new a0("Can't call method on "+r);return r}});var Zo=$((zC,Hd)=>{"use strict";var l0=Fd(),c0=Wl();Hd.exports=function(r){return l0(c0(r))}});var Ye=$((JC,zd)=>{"use strict";var Fl=typeof document=="object"&&document.all;zd.exports=typeof Fl=="undefined"&&Fl!==void 0?function(r){return typeof r=="function"||r===Fl}:function(r){return typeof r=="function"}});var Hr=$((ZC,Jd)=>{"use strict";var u0=Ye();Jd.exports=function(r){return typeof r=="object"?r!==null:u0(r)}});var jl=$((QC,Zd)=>{"use strict";var Kl=Oe(),h0=Ye(),d0=function(r){return h0(r)?r:void 0};Zd.exports=function(r,e){return arguments.length<2?d0(Kl[r]):Kl[r]&&Kl[r][e]}});var Xd=$((XC,Qd)=>{"use strict";var p0=ht();Qd.exports=p0({}.isPrototypeOf)});var rp=$((YC,tp)=>{"use strict";var f0=Oe(),Yd=f0.navigator,ep=Yd&&Yd.userAgent;tp.exports=ep?String(ep):""});var cp=$((eI,lp)=>{"use strict";var ap=Oe(),Hl=rp(),np=ap.process,ip=ap.Deno,op=np&&np.versions||ip&&ip.version,sp=op&&op.v8,et,Qo;sp&&(et=sp.split("."),Qo=et[0]>0&&et[0]<4?1:+(et[0]+et[1]));!Qo&&Hl&&(et=Hl.match(/Edge\/(\d+)/),(!et||et[1]>=74)&&(et=Hl.match(/Chrome\/(\d+)/),et&&(Qo=+et[1])));lp.exports=Qo});var zl=$((tI,hp)=>{"use strict";var up=cp(),m0=$t(),g0=Oe(),v0=g0.String;hp.exports=!!Object.getOwnPropertySymbols&&!m0(function(){var r=Symbol("symbol detection");return!v0(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&up&&up<41})});var Jl=$((rI,dp)=>{"use strict";var _0=zl();dp.exports=_0&&!Symbol.sham&&typeof Symbol.iterator=="symbol"});var Zl=$((nI,pp)=>{"use strict";var y0=jl(),b0=Ye(),$0=Xd(),w0=Jl(),x0=Object;pp.exports=w0?function(r){return typeof r=="symbol"}:function(r){var e=y0("Symbol");return b0(e)&&$0(e.prototype,x0(r))}});var mp=$((iI,fp)=>{"use strict";var q0=String;fp.exports=function(r){try{return q0(r)}catch(e){return"Object"}}});var vp=$((oI,gp)=>{"use strict";var T0=Ye(),B0=mp(),S0=TypeError;gp.exports=function(r){if(T0(r))return r;throw new S0(B0(r)+" is not a function")}});var yp=$((sI,_p)=>{"use strict";var E0=vp(),k0=Gl();_p.exports=function(r,e){var t=r[e];return k0(t)?void 0:E0(t)}});var $p=$((aI,bp)=>{"use strict";var Ql=Jo(),Xl=Ye(),Yl=Hr(),R0=TypeError;bp.exports=function(r,e){var t,n;if(e==="string"&&Xl(t=r.toString)&&!Yl(n=Ql(t,r))||Xl(t=r.valueOf)&&!Yl(n=Ql(t,r))||e!=="string"&&Xl(t=r.toString)&&!Yl(n=Ql(t,r)))return n;throw new R0("Can't convert object to primitive value")}});var xp=$((lI,wp)=>{"use strict";wp.exports=!1});var Xo=$((cI,Tp)=>{"use strict";var qp=Oe(),O0=Object.defineProperty;Tp.exports=function(r,e){try{O0(qp,r,{value:e,configurable:!0,writable:!0})}catch(t){qp[r]=e}return e}});var Yo=$((uI,Ep)=>{"use strict";var C0=xp(),I0=Oe(),M0=Xo(),Bp="__core-js_shared__",Sp=Ep.exports=I0[Bp]||M0(Bp,{});(Sp.versions||(Sp.versions=[])).push({version:"3.42.0",mode:C0?"pure":"global",copyright:"\xA9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"})});var ec=$((hI,Rp)=>{"use strict";var kp=Yo();Rp.exports=function(r,e){return kp[r]||(kp[r]=e||{})}});var Cp=$((dI,Op)=>{"use strict";var U0=Wl(),P0=Object;Op.exports=function(r){return P0(U0(r))}});var Ut=$((pI,Ip)=>{"use strict";var A0=ht(),D0=Cp(),V0=A0({}.hasOwnProperty);Ip.exports=Object.hasOwn||function(e,t){return V0(D0(e),t)}});var tc=$((fI,Mp)=>{"use strict";var N0=ht(),L0=0,G0=Math.random(),W0=N0(1 .toString);Mp.exports=function(r){return"Symbol("+(r===void 0?"":r)+")_"+W0(++L0+G0,36)}});var Ap=$((mI,Pp)=>{"use strict";var F0=Oe(),K0=ec(),Up=Ut(),j0=tc(),H0=zl(),z0=Jl(),zr=F0.Symbol,rc=K0("wks"),J0=z0?zr.for||zr:zr&&zr.withoutSetter||j0;Pp.exports=function(r){return Up(rc,r)||(rc[r]=H0&&Up(zr,r)?zr[r]:J0("Symbol."+r)),rc[r]}});var Lp=$((gI,Np)=>{"use strict";var Z0=Jo(),Dp=Hr(),Vp=Zl(),Q0=yp(),X0=$p(),Y0=Ap(),e$=TypeError,t$=Y0("toPrimitive");Np.exports=function(r,e){if(!Dp(r)||Vp(r))return r;var t=Q0(r,t$),n;if(t){if(e===void 0&&(e="default"),n=Z0(t,r,e),!Dp(n)||Vp(n))return n;throw new e$("Can't convert object to primitive value")}return e===void 0&&(e="number"),X0(r,e)}});var nc=$((vI,Gp)=>{"use strict";var r$=Lp(),n$=Zl();Gp.exports=function(r){var e=r$(r,"string");return n$(e)?e:e+""}});var Kp=$((_I,Fp)=>{"use strict";var i$=Oe(),Wp=Hr(),ic=i$.document,o$=Wp(ic)&&Wp(ic.createElement);Fp.exports=function(r){return o$?ic.createElement(r):{}}});var oc=$((yI,jp)=>{"use strict";var s$=Mt(),a$=$t(),l$=Kp();jp.exports=!s$&&!a$(function(){return Object.defineProperty(l$("div"),"a",{get:function(){return 7}}).a!==7})});var sc=$(zp=>{"use strict";var c$=Mt(),u$=Jo(),h$=Ud(),d$=Vl(),p$=Zo(),f$=nc(),m$=Ut(),g$=oc(),Hp=Object.getOwnPropertyDescriptor;zp.f=c$?Hp:function(e,t){if(e=p$(e),t=f$(t),g$)try{return Hp(e,t)}catch(n){}if(m$(e,t))return d$(!u$(h$.f,e,t),e[t])}});var Zp=$(($I,Jp)=>{"use strict";var v$=Mt(),_$=$t();Jp.exports=v$&&_$(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})});var ac=$((wI,Qp)=>{"use strict";var y$=Hr(),b$=String,$$=TypeError;Qp.exports=function(r){if(y$(r))return r;throw new $$(b$(r)+" is not an object")}});var ts=$(Yp=>{"use strict";var w$=Mt(),x$=oc(),q$=Zp(),es=ac(),Xp=nc(),T$=TypeError,lc=Object.defineProperty,B$=Object.getOwnPropertyDescriptor,cc="enumerable",uc="configurable",hc="writable";Yp.f=w$?q$?function(e,t,n){if(es(e),t=Xp(t),es(n),typeof e=="function"&&t==="prototype"&&"value"in n&&hc in n&&!n[hc]){var i=B$(e,t);i&&i[hc]&&(e[t]=n.value,n={configurable:uc in n?n[uc]:i[uc],enumerable:cc in n?n[cc]:i[cc],writable:!1})}return lc(e,t,n)}:lc:function(e,t,n){if(es(e),t=Xp(t),es(n),x$)try{return lc(e,t,n)}catch(i){}if("get"in n||"set"in n)throw new T$("Accessors not supported");return"value"in n&&(e[t]=n.value),e}});var dc=$((qI,ef)=>{"use strict";var S$=Mt(),E$=ts(),k$=Vl();ef.exports=S$?function(r,e,t){return E$.f(r,e,k$(1,t))}:function(r,e,t){return r[e]=t,r}});var nf=$((TI,rf)=>{"use strict";var pc=Mt(),R$=Ut(),tf=Function.prototype,O$=pc&&Object.getOwnPropertyDescriptor,fc=R$(tf,"name"),C$=fc&&function(){}.name==="something",I$=fc&&(!pc||pc&&O$(tf,"name").configurable);rf.exports={EXISTS:fc,PROPER:C$,CONFIGURABLE:I$}});var sf=$((BI,of)=>{"use strict";var M$=ht(),U$=Ye(),mc=Yo(),P$=M$(Function.toString);U$(mc.inspectSource)||(mc.inspectSource=function(r){return P$(r)});of.exports=mc.inspectSource});var cf=$((SI,lf)=>{"use strict";var A$=Oe(),D$=Ye(),af=A$.WeakMap;lf.exports=D$(af)&&/native code/.test(String(af))});var df=$((EI,hf)=>{"use strict";var V$=ec(),N$=tc(),uf=V$("keys");hf.exports=function(r){return uf[r]||(uf[r]=N$(r))}});var gc=$((kI,pf)=>{"use strict";pf.exports={}});var vf=$((RI,gf)=>{"use strict";var L$=cf(),mf=Oe(),G$=Hr(),W$=dc(),vc=Ut(),_c=Yo(),F$=df(),K$=gc(),ff="Object already initialized",yc=mf.TypeError,j$=mf.WeakMap,rs,Yn,ns,H$=function(r){return ns(r)?Yn(r):rs(r,{})},z$=function(r){return function(e){var t;if(!G$(e)||(t=Yn(e)).type!==r)throw new yc("Incompatible receiver, "+r+" required");return t}};L$||_c.state?(tt=_c.state||(_c.state=new j$),tt.get=tt.get,tt.has=tt.has,tt.set=tt.set,rs=function(r,e){if(tt.has(r))throw new yc(ff);return e.facade=r,tt.set(r,e),e},Yn=function(r){return tt.get(r)||{}},ns=function(r){return tt.has(r)}):(or=F$("state"),K$[or]=!0,rs=function(r,e){if(vc(r,or))throw new yc(ff);return e.facade=r,W$(r,or,e),e},Yn=function(r){return vc(r,or)?r[or]:{}},ns=function(r){return vc(r,or)});var tt,or;gf.exports={set:rs,get:Yn,has:ns,enforce:H$,getterFor:z$}});var $f=$((OI,bf)=>{"use strict";var $c=ht(),J$=$t(),Z$=Ye(),is=Ut(),bc=Mt(),Q$=nf().CONFIGURABLE,X$=sf(),yf=vf(),Y$=yf.enforce,ew=yf.get,_f=String,os=Object.defineProperty,tw=$c("".slice),rw=$c("".replace),nw=$c([].join),iw=bc&&!J$(function(){return os(function(){},"length",{value:8}).length!==8}),ow=String(String).split("String"),sw=bf.exports=function(r,e,t){tw(_f(e),0,7)==="Symbol("&&(e="["+rw(_f(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!is(r,"name")||Q$&&r.name!==e)&&(bc?os(r,"name",{value:e,configurable:!0}):r.name=e),iw&&t&&is(t,"arity")&&r.length!==t.arity&&os(r,"length",{value:t.arity});try{t&&is(t,"constructor")&&t.constructor?bc&&os(r,"prototype",{writable:!1}):r.prototype&&(r.prototype=void 0)}catch(i){}var n=Y$(r);return is(n,"source")||(n.source=nw(ow,typeof e=="string"?e:"")),r};Function.prototype.toString=sw(function(){return Z$(this)&&ew(this).source||X$(this)},"toString")});var xf=$((CI,wf)=>{"use strict";var aw=Ye(),lw=ts(),cw=$f(),uw=Xo();wf.exports=function(r,e,t,n){n||(n={});var i=n.enumerable,o=n.name!==void 0?n.name:e;if(aw(t)&&cw(t,o,n),n.global)i?r[e]=t:uw(e,t);else{try{n.unsafe?r[e]&&(i=!0):delete r[e]}catch(s){}i?r[e]=t:lw.f(r,e,{value:t,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return r}});var Tf=$((II,qf)=>{"use strict";var hw=Math.ceil,dw=Math.floor;qf.exports=Math.trunc||function(e){var t=+e;return(t>0?dw:hw)(t)}});var wc=$((MI,Bf)=>{"use strict";var pw=Tf();Bf.exports=function(r){var e=+r;return e!==e||e===0?0:pw(e)}});var Ef=$((UI,Sf)=>{"use strict";var fw=wc(),mw=Math.max,gw=Math.min;Sf.exports=function(r,e){var t=fw(r);return t<0?mw(t+e,0):gw(t,e)}});var Rf=$((PI,kf)=>{"use strict";var vw=wc(),_w=Math.min;kf.exports=function(r){var e=vw(r);return e>0?_w(e,9007199254740991):0}});var Cf=$((AI,Of)=>{"use strict";var yw=Rf();Of.exports=function(r){return yw(r.length)}});var Uf=$((DI,Mf)=>{"use strict";var bw=Zo(),$w=Ef(),ww=Cf(),If=function(r){return function(e,t,n){var i=bw(e),o=ww(i);if(o===0)return!r&&-1;var s=$w(n,o),a;if(r&&t!==t){for(;o>s;)if(a=i[s++],a!==a)return!0}else for(;o>s;s++)if((r||s in i)&&i[s]===t)return r||s||0;return!r&&-1}};Mf.exports={includes:If(!0),indexOf:If(!1)}});var Df=$((VI,Af)=>{"use strict";var xw=ht(),xc=Ut(),qw=Zo(),Tw=Uf().indexOf,Bw=gc(),Pf=xw([].push);Af.exports=function(r,e){var t=qw(r),n=0,i=[],o;for(o in t)!xc(Bw,o)&&xc(t,o)&&Pf(i,o);for(;e.length>n;)xc(t,o=e[n++])&&(~Tw(i,o)||Pf(i,o));return i}});var Nf=$((NI,Vf)=>{"use strict";Vf.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]});var Gf=$(Lf=>{"use strict";var Sw=Df(),Ew=Nf(),kw=Ew.concat("length","prototype");Lf.f=Object.getOwnPropertyNames||function(e){return Sw(e,kw)}});var Ff=$(Wf=>{"use strict";Wf.f=Object.getOwnPropertySymbols});var jf=$((WI,Kf)=>{"use strict";var Rw=jl(),Ow=ht(),Cw=Gf(),Iw=Ff(),Mw=ac(),Uw=Ow([].concat);Kf.exports=Rw("Reflect","ownKeys")||function(e){var t=Cw.f(Mw(e)),n=Iw.f;return n?Uw(t,n(e)):t}});var Jf=$((FI,zf)=>{"use strict";var Hf=Ut(),Pw=jf(),Aw=sc(),Dw=ts();zf.exports=function(r,e,t){for(var n=Pw(e),i=Dw.f,o=Aw.f,s=0;s<n.length;s++){var a=n[s];!Hf(r,a)&&!(t&&Hf(t,a))&&i(r,a,o(e,a))}}});var Qf=$((KI,Zf)=>{"use strict";var Vw=$t(),Nw=Ye(),Lw=/#|\.prototype\./,ei=function(r,e){var t=Ww[Gw(r)];return t===Kw?!0:t===Fw?!1:Nw(e)?Vw(e):!!e},Gw=ei.normalize=function(r){return String(r).replace(Lw,".").toLowerCase()},Ww=ei.data={},Fw=ei.NATIVE="N",Kw=ei.POLYFILL="P";Zf.exports=ei});var Yf=$((jI,Xf)=>{"use strict";var ss=Oe(),jw=sc().f,Hw=dc(),zw=xf(),Jw=Xo(),Zw=Jf(),Qw=Qf();Xf.exports=function(r,e){var t=r.target,n=r.global,i=r.stat,o,s,a,l,c,u;if(n?s=ss:i?s=ss[t]||Jw(t,{}):s=ss[t]&&ss[t].prototype,s)for(a in e){if(c=e[a],r.dontCallGetSet?(u=jw(s,a),l=u&&u.value):l=s[a],o=Qw(n?a:t+(i?".":"#")+a,r.forced),!o&&l!==void 0){if(typeof c==typeof l)continue;Zw(c,l)}(r.sham||l&&l.sham)&&Hw(c,"sham",!0),zw(s,a,c,r)}}});var em=$(()=>{"use strict";var Xw=Yf(),qc=Oe();Xw({global:!0,forced:qc.globalThis!==qc},{globalThis:qc})});var rm=$((JI,tm)=>{"use strict";em();tm.exports=Oe()});var im=$((ZI,nm)=>{"use strict";var Yw=rm();nm.exports=Yw});var Q=$((QI,om)=>{"use strict";var ex=im();om.exports=ex});var Om=$((DM,Zc)=>{"use strict";var Xx=Object.prototype.hasOwnProperty,we="~";function li(){}Object.create&&(li.prototype=Object.create(null),new li().__proto__||(we=!1));function Yx(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function Rm(r,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new Yx(t,n||r,i),s=we?we+e:e;return r._events[s]?r._events[s].fn?r._events[s]=[r._events[s],o]:r._events[s].push(o):(r._events[s]=o,r._eventsCount++),r}function fs(r,e){--r._eventsCount===0?r._events=new li:delete r._events[e]}function ge(){this._events=new li,this._eventsCount=0}ge.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)Xx.call(t,n)&&e.push(we?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};ge.prototype.listeners=function(e){var t=we?we+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s};ge.prototype.listenerCount=function(e){var t=we?we+e:e,n=this._events[t];return n?n.fn?1:n.length:0};ge.prototype.emit=function(e,t,n,i,o,s){var a=we?we+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,u,h;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,o),!0;case 6:return l.fn.call(l.context,t,n,i,o,s),!0}for(h=1,u=new Array(c-1);h<c;h++)u[h-1]=arguments[h];l.fn.apply(l.context,u)}else{var d=l.length,f;for(h=0;h<d;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),c){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,n);break;case 4:l[h].fn.call(l[h].context,t,n,i);break;default:if(!u)for(f=1,u=new Array(c-1);f<c;f++)u[f-1]=arguments[f];l[h].fn.apply(l[h].context,u)}}return!0};ge.prototype.on=function(e,t,n){return Rm(this,e,t,n,!1)};ge.prototype.once=function(e,t,n){return Rm(this,e,t,n,!0)};ge.prototype.removeListener=function(e,t,n,i){var o=we?we+e:e;if(!this._events[o])return this;if(!t)return fs(this,o),this;var s=this._events[o];if(s.fn)s.fn===t&&(!i||s.once)&&(!n||s.context===n)&&fs(this,o);else{for(var a=0,l=[],c=s.length;a<c;a++)(s[a].fn!==t||i&&!s[a].once||n&&s[a].context!==n)&&l.push(s[a]);l.length?this._events[o]=l.length===1?l[0]:l:fs(this,o)}return this};ge.prototype.removeAllListeners=function(e){var t;return e?(t=we?we+e:e,this._events[t]&&fs(this,t)):(this._events=new li,this._eventsCount=0),this};ge.prototype.off=ge.prototype.removeListener;ge.prototype.addListener=ge.prototype.on;ge.prefixed=we;ge.EventEmitter=ge;typeof Zc!="undefined"&&(Zc.exports=ge)});var RC={};qd(RC,{DataLevel:()=>Ib,MultithreadedRecorder:()=>_d,StandardRecorder:()=>vd});var Wb=Object.defineProperty,Fb=(r,e,t)=>e in r?Wb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kb=(r,e,t)=>Fb(r,typeof e!="symbol"?e+"":e,t),oe=class extends Error{constructor(e,t){var n;super(e,t),Kb(this,"localizedMessage"),this.name="bytereplay.core.RuntimeError",this.localizedMessage=(n=t==null?void 0:t.localizedMessage)!=null?n:e}};var jb=Object.defineProperty,Hb=(r,e,t)=>e in r?jb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zb=(r,e,t)=>Hb(r,typeof e!="symbol"?e+"":e,t),It=class extends oe{constructor(e,t){super(e,t),zb(this,"_code"),this.name="bytereplay.core.ServerError",this._code=t==null?void 0:t.code}get code(){return this._code}};(function(){var r;function e(p){var g=0;return function(){return g<p.length?{done:!1,value:p[g++]}:{done:!0}}}var t=typeof Object.defineProperties=="function"?Object.defineProperty:function(p,g,v){return p==Array.prototype||p==Object.prototype||(p[g]=v.value),p};function n(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof global=="object"&&global];for(var g=0;g<p.length;++g){var v=p[g];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var i=n(this);function o(p,g){if(g)e:{var v=i;p=p.split(".");for(var b=0;b<p.length-1;b++){var x=p[b];if(!(x in v))break e;v=v[x]}p=p[p.length-1],b=v[p],g=g(b),g!=b&&g!=null&&t(v,p,{configurable:!0,writable:!0,value:g})}}o("Symbol",function(p){function g(K){if(this instanceof g)throw new TypeError("Symbol is not a constructor");return new v(b+(K||"")+"_"+x++,K)}function v(K,be){this.A=K,t(this,"description",{configurable:!0,writable:!0,value:be})}if(p)return p;v.prototype.toString=function(){return this.A};var b="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",x=0;return g}),o("Symbol.iterator",function(p){if(p)return p;p=Symbol("Symbol.iterator");for(var g="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),v=0;v<g.length;v++){var b=i[g[v]];typeof b=="function"&&typeof b.prototype[p]!="function"&&t(b.prototype,p,{configurable:!0,writable:!0,value:function(){return s(e(this))}})}return p});function s(p){return p={next:p},p[Symbol.iterator]=function(){return this},p}function a(p){var g=typeof Symbol!="undefined"&&Symbol.iterator&&p[Symbol.iterator];return g?g.call(p):{next:e(p)}}var l;if(typeof Object.setPrototypeOf=="function")l=Object.setPrototypeOf;else{var c;e:{var u={a:!0},h={};try{h.__proto__=u,c=h.a;break e}catch(p){}c=!1}l=c?function(p,g){if(p.__proto__=g,p.__proto__!==g)throw new TypeError(p+" is not extensible");return p}:null}var d=l;function f(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function y(p){if(p.m)throw new TypeError("Generator is already running");p.m=!0}f.prototype.o=function(p){this.v=p},f.prototype.s=function(p){this.l={D:p,F:!0},this.h=this.C||this.u},f.prototype.return=function(p){this.l={return:p},this.h=this.u};function _(p,g){return p.h=3,{value:g}}function q(p){this.g=new f,this.G=p}q.prototype.o=function(p){return y(this.g),this.g.j?O(this,this.g.j.next,p,this.g.o):(this.g.o(p),U(this))};function k(p,g){y(p.g);var v=p.g.j;return v?O(p,"return"in v?v.return:function(b){return{value:b,done:!0}},g,p.g.return):(p.g.return(g),U(p))}q.prototype.s=function(p){return y(this.g),this.g.j?O(this,this.g.j.throw,p,this.g.o):(this.g.s(p),U(this))};function O(p,g,v,b){try{var x=g.call(p.g.j,v);if(!(x instanceof Object))throw new TypeError("Iterator result "+x+" is not an object");if(!x.done)return p.g.m=!1,x;var K=x.value}catch(be){return p.g.j=null,p.g.s(be),U(p)}return p.g.j=null,b.call(p.g,K),U(p)}function U(p){for(;p.g.h;)try{var g=p.G(p.g);if(g)return p.g.m=!1,{value:g.value,done:!1}}catch(v){p.g.v=void 0,p.g.s(v)}if(p.g.m=!1,p.g.l){if(g=p.g.l,p.g.l=null,g.F)throw g.D;return{value:g.return,done:!0}}return{value:void 0,done:!0}}function L(p){this.next=function(g){return p.o(g)},this.throw=function(g){return p.s(g)},this.return=function(g){return k(p,g)},this[Symbol.iterator]=function(){return this}}function D(p,g){return g=new L(new q(g)),d&&p.prototype&&d(g,p.prototype),g}function ee(p,g){p instanceof String&&(p+="");var v=0,b=!1,x={next:function(){if(!b&&v<p.length){var K=v++;return{value:g(K,p[K]),done:!1}}return b=!0,{done:!0,value:void 0}}};return x[Symbol.iterator]=function(){return x},x}if(o("Array.prototype.entries",function(p){return p||function(){return ee(this,function(g,v){return[g,v]})}}),typeof Blob!="undefined"&&(typeof FormData=="undefined"||!FormData.prototype.keys)){var G=function(p,g){for(var v=0;v<p.length;v++)g(p[v])},C=function(p){return p.replace(/\r?\n|\r/g,`\r
`)},S=function(p,g,v){return g instanceof Blob?(v=v!==void 0?v+"":typeof g.name=="string"?g.name:"blob",(g.name!==v||Object.prototype.toString.call(g)==="[object Blob]")&&(g=new File([g],v)),[String(p),g]):[String(p),String(g)]},te=function(p,g){if(p.length<g)throw new TypeError(g+" argument required, but only "+p.length+" present.")},j=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,_e=j.FormData,ut=j.XMLHttpRequest&&j.XMLHttpRequest.prototype.send,ke=j.Request&&j.fetch,Re=j.navigator&&j.navigator.sendBeacon,ne=j.Element&&j.Element.prototype,F=j.Symbol&&Symbol.toStringTag;F&&(Blob.prototype[F]||(Blob.prototype[F]="Blob"),"File"in j&&!File.prototype[F]&&(File.prototype[F]="File"));try{new File([],"")}catch(p){j.File=function(g,v,b){return g=new Blob(g,b||{}),Object.defineProperties(g,{name:{value:v},lastModified:{value:+(b&&b.lastModified!==void 0?new Date(b.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),F&&Object.defineProperty(g,F,{value:"File"}),g}}var ye=function(p){return p.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},ie=function(p){this.i=[];var g=this;p&&G(p.elements,function(v){if(v.name&&!v.disabled&&v.type!=="submit"&&v.type!=="button"&&!v.matches("form fieldset[disabled] *"))if(v.type==="file"){var b=v.files&&v.files.length?v.files:[new File([],"",{type:"application/octet-stream"})];G(b,function(x){g.append(v.name,x)})}else v.type==="select-multiple"||v.type==="select-one"?G(v.options,function(x){!x.disabled&&x.selected&&g.append(v.name,x.value)}):v.type==="checkbox"||v.type==="radio"?v.checked&&g.append(v.name,v.value):(b=v.type==="textarea"?C(v.value):v.value,g.append(v.name,b))})};if(r=ie.prototype,r.append=function(p,g,v){te(arguments,2),this.i.push(S(p,g,v))},r.delete=function(p){te(arguments,1);var g=[];p=String(p),G(this.i,function(v){v[0]!==p&&g.push(v)}),this.i=g},r.entries=function p(){var g,v=this;return D(p,function(b){if(b.h==1&&(g=0),b.h!=3)return g<v.i.length?b=_(b,v.i[g]):(b.h=0,b=void 0),b;g++,b.h=2})},r.forEach=function(p,g){te(arguments,1);for(var v=a(this),b=v.next();!b.done;b=v.next()){var x=a(b.value);b=x.next().value,x=x.next().value,p.call(g,x,b,this)}},r.get=function(p){te(arguments,1);var g=this.i;p=String(p);for(var v=0;v<g.length;v++)if(g[v][0]===p)return g[v][1];return null},r.getAll=function(p){te(arguments,1);var g=[];return p=String(p),G(this.i,function(v){v[0]===p&&g.push(v[1])}),g},r.has=function(p){te(arguments,1),p=String(p);for(var g=0;g<this.i.length;g++)if(this.i[g][0]===p)return!0;return!1},r.keys=function p(){var g=this,v,b,x,K,be;return D(p,function($e){if($e.h==1&&(v=a(g),b=v.next()),$e.h!=3){if(b.done){$e.h=0;return}return x=b.value,K=a(x),be=K.next().value,_($e,be)}b=v.next(),$e.h=2})},r.set=function(p,g,v){te(arguments,2),p=String(p);var b=[],x=S(p,g,v),K=!0;G(this.i,function(be){be[0]===p?K&&(K=!b.push(x)):b.push(be)}),K&&b.push(x),this.i=b},r.values=function p(){var g=this,v,b,x,K,be;return D(p,function($e){if($e.h==1&&(v=a(g),b=v.next()),$e.h!=3){if(b.done){$e.h=0;return}return x=b.value,K=a(x),K.next(),be=K.next().value,_($e,be)}b=v.next(),$e.h=2})},ie.prototype._asNative=function(){for(var p=new _e,g=a(this),v=g.next();!v.done;v=g.next()){var b=a(v.value);v=b.next().value,b=b.next().value,p.append(v,b)}return p},ie.prototype._blob=function(){var p="----formdata-polyfill-"+Math.random(),g=[],v="--"+p+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(b,x){return typeof b=="string"?g.push(v+ye(C(x))+(`"\r
\r
`+C(b)+`\r
`)):g.push(v+ye(C(x))+('"; filename="'+ye(b.name)+`"\r
Content-Type: `+(b.type||"application/octet-stream")+`\r
\r
`),b,`\r
`)}),g.push("--"+p+"--"),new Blob(g,{type:"multipart/form-data; boundary="+p})},ie.prototype[Symbol.iterator]=function(){return this.entries()},ie.prototype.toString=function(){return"[object FormData]"},ne&&!ne.matches&&(ne.matches=ne.matchesSelector||ne.mozMatchesSelector||ne.msMatchesSelector||ne.oMatchesSelector||ne.webkitMatchesSelector||function(p){p=(this.document||this.ownerDocument).querySelectorAll(p);for(var g=p.length;0<=--g&&p.item(g)!==this;);return-1<g}),F&&(ie.prototype[F]="FormData"),ut){var zn=j.XMLHttpRequest.prototype.setRequestHeader;j.XMLHttpRequest.prototype.setRequestHeader=function(p,g){zn.call(this,p,g),p.toLowerCase()==="content-type"&&(this.B=!0)},j.XMLHttpRequest.prototype.send=function(p){p instanceof ie?(p=p._blob(),this.B||this.setRequestHeader("Content-Type",p.type),ut.call(this,p)):ut.call(this,p)}}ke&&(j.fetch=function(p,g){return g&&g.body&&g.body instanceof ie&&(g.body=g.body._blob()),ke.call(this,p,g)}),Re&&(j.navigator.sendBeacon=function(p,g){return g instanceof ie&&(g=g._asNative()),Re.call(this,p,g)}),j.FormData=ie}})();function Qn(){return new FormData}function ir(r){return r instanceof FormData}var _M=Z(Q());var Cc={};qd(Cc,{compressionStream:()=>ix,fetch:()=>ax,performance:()=>rx,performanceNow:()=>nx,performanceObserver:()=>tx,structuredClone:()=>Oc,webSockets:()=>sx,webWorkers:()=>ox});function re(r){return typeof r=="function"}function Tc(r){return r instanceof Request}function Bc(r){return r instanceof Headers}function sr(r){return Object.prototype.toString.call(r)==="[object Object]"}function T(r){return typeof r=="string"||r instanceof String}function Sc(r){return r instanceof SVGAnimatedString}function Ec(r){return typeof r=="symbol"}function kc(r){return r.trim()===""}function Rc(r){if(!sr(r))return!1;let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e||Object.getPrototypeOf(r)===null}function tx(){return!!globalThis.PerformanceObserver}function rx(){return!!globalThis.performance}function nx(){var r;return re((r=globalThis.performance)==null?void 0:r.now)}function ix(){return re(globalThis.CompressionStream)}function Oc(){return re(globalThis.structuredClone)}function ox(){return!!globalThis.Worker}function sx(){return!!globalThis.WebSocket}function ax(r){var e;return re((e=r!=null?r:globalThis)==null?void 0:e.fetch)}var sm=typeof self=="object"?self:globalThis,hx=(r,e)=>{let t=(i,o)=>(r.set(o,i),i),n=i=>{if(r.has(i))return r.get(i);let[o,s]=e[i];switch(o){case 0:case-1:return t(s,i);case 1:{let a=t([],i);for(let l of s)a.push(n(l));return a}case 2:{let a=t({},i);for(let[l,c]of s)a[n(l)]=n(c);return a}case 3:return t(new Date(s),i);case 4:{let{source:a,flags:l}=s;return t(new RegExp(a,l),i)}case 5:{let a=t(new Map,i);for(let[l,c]of s)a.set(n(l),n(c));return a}case 6:{let a=t(new Set,i);for(let l of s)a.add(n(l));return a}case 7:{let{name:a,message:l}=s;return t(new sm[a](l),i)}case 8:return t(BigInt(s),i);case"BigInt":return t(Object(BigInt(s)),i);case"ArrayBuffer":return t(new Uint8Array(s).buffer,s);case"DataView":{let{buffer:a}=new Uint8Array(s);return t(new DataView(a),s)}}return t(new sm[o](s),i)};return n},Uc=r=>hx(new Map,r)(0);var Jr="",{toString:dx}={},{keys:px}=Object,ti=r=>{let e=typeof r;if(e!=="object"||!r)return[0,e];let t=dx.call(r).slice(8,-1);switch(t){case"Array":return[1,Jr];case"Object":return[2,Jr];case"Date":return[3,Jr];case"RegExp":return[4,Jr];case"Map":return[5,Jr];case"Set":return[6,Jr];case"DataView":return[1,t]}return t.includes("Array")?[1,t]:t.includes("Error")?[7,t]:[2,t]},ls=([r,e])=>r===0&&(e==="function"||e==="symbol"),fx=(r,e,t,n)=>{let i=(s,a)=>{let l=n.push(s)-1;return t.set(a,l),l},o=s=>{if(t.has(s))return t.get(s);let[a,l]=ti(s);switch(a){case 0:{let u=s;switch(l){case"bigint":a=8,u=s.toString();break;case"function":case"symbol":if(r)throw new TypeError("unable to serialize "+l);u=null;break;case"undefined":return i([-1],s)}return i([a,u],s)}case 1:{if(l){let d=s;return l==="DataView"?d=new Uint8Array(s.buffer):l==="ArrayBuffer"&&(d=new Uint8Array(s)),i([l,[...d]],s)}let u=[],h=i([a,u],s);for(let d of s)u.push(o(d));return h}case 2:{if(l)switch(l){case"BigInt":return i([l,s.toString()],s);case"Boolean":case"Number":case"String":return i([l,s.valueOf()],s)}if(e&&"toJSON"in s)return o(s.toJSON());let u=[],h=i([a,u],s);for(let d of px(s))(r||!ls(ti(s[d])))&&u.push([o(d),o(s[d])]);return h}case 3:return i([a,s.toISOString()],s);case 4:{let{source:u,flags:h}=s;return i([a,{source:u,flags:h}],s)}case 5:{let u=[],h=i([a,u],s);for(let[d,f]of s)(r||!(ls(ti(d))||ls(ti(f))))&&u.push([o(d),o(f)]);return h}case 6:{let u=[],h=i([a,u],s);for(let d of s)(r||!ls(ti(d)))&&u.push(o(d));return h}}let{message:c}=s;return i([a,{name:l,message:c}],s)};return o},Pc=(r,{json:e,lossy:t}={})=>{let n=[];return fx(!(e||t),!!e,new Map,n)(r),n};var hm=typeof structuredClone=="function"?(r,e)=>e&&("json"in e||"lossy"in e)?Uc(Pc(r,e)):structuredClone(r):(r,e)=>Uc(Pc(r,e));var sM=Z(Q());var wt=Cc;function P(){return wt.performanceNow()?globalThis.performance.now():Date.now()}var se={offset:0,now(){return P()+se.offset},sync(r){se.offset=r-P()}};function z(r){return performance.timeOrigin+r}var cs=globalThis.requestIdleCallback;cs||(cs=function(r,e){let t=P();return setTimeout(()=>{var n;let i=P()-t;r({didTimeout:(n=(e==null?void 0:e.timeout)!=null&&i>e.timeout)!=null?n:!1,timeRemaining(){return Math.max(0,7-i)}})})});var Ac=globalThis.cancelIdleCallback;Ac||(Ac=function(r){clearTimeout(r)});var mx=Object.defineProperty,gx=Object.defineProperties,vx=Object.getOwnPropertyDescriptors,dm=Object.getOwnPropertySymbols,_x=Object.prototype.hasOwnProperty,yx=Object.prototype.propertyIsEnumerable,pm=(r,e,t)=>e in r?mx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,bx=(r,e)=>{for(var t in e||(e={}))_x.call(e,t)&&pm(r,t,e[t]);if(dm)for(var t of dm(e))yx.call(e,t)&&pm(r,t,e[t]);return r},$x=(r,e)=>gx(r,vx(e)),Zr=class extends It{constructor(e,t,n,i){super(`Error occurs when invoking API "${e}": ${n}`,$x(bx({},i!=null?i:{}),{code:t})),this.path=e,this.name="bytereplay.core.APIError"}};function Dc(r){return r instanceof Zr}var ri="bytereplay";var wx=Object.defineProperty,fm=Object.getOwnPropertySymbols,xx=Object.prototype.hasOwnProperty,qx=Object.prototype.propertyIsEnumerable,Lc=(r,e,t)=>e in r?wx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vc=(r,e)=>{for(var t in e||(e={}))xx.call(e,t)&&Lc(r,t,e[t]);if(fm)for(var t of fm(e))qx.call(e,t)&&Lc(r,t,e[t]);return r},Nc=(r,e,t)=>Lc(r,typeof e!="symbol"?e+"":e,t),us=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),rt=class{constructor(r){Nc(this,"_env"),Nc(this,"_interceptors"),Nc(this,"_requestInterceptor"),this._env=r}get apiURL(){return`${this._env.baseURL}${this._env.apiPrefix}`}get env(){return this._env}set interceptors(r){this._interceptors=r}set requestInterceptor(value){T(value)?this._requestInterceptor=eval(value):this._requestInterceptor=value}get(r,e,t){return us(this,null,function*(){return this._request("GET",r,e,t)})}post(r,e,t){return us(this,null,function*(){return this._request("POST",r,e,t)})}sendBeacon(r,e){try{navigator.sendBeacon(this._makeURL(r).href,e)}catch(t){}}_request(r,e,t,n){return us(this,null,function*(){var i,o,s,a;let l={path:e,headers:n},c=(o=(i=this._interceptors)==null?void 0:i.rewrite)!=null?o:this._requestInterceptor;if(c!=null)try{l=c(e,n)}catch(_){}let u=this._makeURL(l.path),h=r==="POST";if(r==="GET"&&t!=null){for(let[_,q]of Object.entries(t))if(q!=null){let k;q instanceof Date?k=q.toISOString():k=q.toString(),u.searchParams.set(_,k)}}let d={},f;h&&(ir(t)?f=t:(f=JSON.stringify(t),d["Content-Type"]="application/json"));let y=((a=(s=this._interceptors)==null?void 0:s.request)!=null?a:fetch)(u.href,{method:r,mode:"cors",body:f,headers:Vc(Vc(Vc({},d),this._env.headers||{}),l.headers||{}),[ri]:!0});return this._dealWithResponse(l.path,y)})}_dealWithResponse(r,e){return us(this,null,function*(){let t;try{t=yield e}catch(i){throw new It(`Error occurs when invoking API "${r}": ${i.message}`,{cause:i})}let n;if(t instanceof Response)try{n=yield t.json()}catch(i){throw new It(`Response of API "${r}" is not a valid fetch response.`,{cause:i})}else n=t;if(n.success)return n.data;throw new Zr(r,n.code,n.message)})}_makeURL(r){return new URL(r,this.apiURL)}};var ni=class{};var Fc=(r,e)=>e.some(t=>r instanceof t),mm,gm;function Tx(){return mm||(mm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Bx(){return gm||(gm=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Kc=new WeakMap,Gc=new WeakMap,hs=new WeakMap;function Sx(r){let e=new Promise((t,n)=>{let i=()=>{r.removeEventListener("success",o),r.removeEventListener("error",s)},o=()=>{t(ar(r.result)),i()},s=()=>{n(r.error),i()};r.addEventListener("success",o),r.addEventListener("error",s)});return hs.set(e,r),e}function Ex(r){if(Kc.has(r))return;let e=new Promise((t,n)=>{let i=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",s),r.removeEventListener("abort",s)},o=()=>{t(),i()},s=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",o),r.addEventListener("error",s),r.addEventListener("abort",s)});Kc.set(r,e)}var jc={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Kc.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ar(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function bm(r){jc=r(jc)}function kx(r){return Bx().includes(r)?function(...e){return r.apply(Hc(this),e),ar(this.request)}:function(...e){return ar(r.apply(Hc(this),e))}}function Rx(r){return typeof r=="function"?kx(r):(r instanceof IDBTransaction&&Ex(r),Fc(r,Tx())?new Proxy(r,jc):r)}function ar(r){if(r instanceof IDBRequest)return Sx(r);if(Gc.has(r))return Gc.get(r);let e=Rx(r);return e!==r&&(Gc.set(r,e),hs.set(e,r)),e}var Hc=r=>hs.get(r);function $m(r,e,{blocked:t,upgrade:n,blocking:i,terminated:o}={}){let s=indexedDB.open(r,e),a=ar(s);return n&&s.addEventListener("upgradeneeded",l=>{n(ar(s.result),l.oldVersion,l.newVersion,ar(s.transaction),l)}),t&&s.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}var Ox=["get","getKey","getAll","getAllKeys","count"],Cx=["put","add","delete","clear"],Wc=new Map;function vm(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Wc.get(e))return Wc.get(e);let t=e.replace(/FromIndex$/,""),n=e!==t,i=Cx.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||Ox.includes(t)))return;let o=function(s,...a){return V(this,null,function*(){let l=this.transaction(s,i?"readwrite":"readonly"),c=l.store;return n&&(c=c.index(a.shift())),(yield Promise.all([c[t](...a),i&&l.done]))[0]})};return Wc.set(e,o),o}bm(r=>Zn(H({},r),{get:(e,t,n)=>vm(e,t)||r.get(e,t,n),has:(e,t)=>!!vm(e,t)||r.has(e,t)}));var Ix=["continue","continuePrimaryKey","advance"],_m={},zc=new WeakMap,wm=new WeakMap,Mx={get(r,e){if(!Ix.includes(e))return r[e];let t=_m[e];return t||(t=_m[e]=function(...n){zc.set(this,wm.get(this)[e](...n))}),t}};function Ux(...r){return Bd(this,null,function*(){let e=this;if(e instanceof IDBCursor||(e=yield new Ho(e.openCursor(...r))),!e)return;e=e;let t=new Proxy(e,Mx);for(wm.set(t,e),hs.set(t,Hc(e));e;)yield t,e=yield new Ho(zc.get(t)||e.continue()),zc.delete(t)})}function ym(r,e){return e===Symbol.asyncIterator&&Fc(r,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Fc(r,[IDBIndex,IDBObjectStore])}bm(r=>Zn(H({},r),{get(e,t,n){return ym(e,t)?Ux:r.get(e,t,n)},has(e,t){return ym(e,t)||r.has(e,t)}}));var xm="bytereplay-database",ds="recordings";var Px=Object.defineProperty,Ax=(r,e,t)=>e in r?Px(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qm=(r,e,t)=>Ax(r,typeof e!="symbol"?e+"":e,t),ps=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),ii=class extends ni{constructor(){super(...arguments),qm(this,"_db"),qm(this,"_openLock")}getRecordings(){return ps(this,null,function*(){return(yield this._getDatabase()).getAll(ds)})}putRecordings(e,t){return ps(this,null,function*(){if(e.length>0){let n=(yield this._getDatabase()).transaction(ds,"readwrite");if(yield Promise.all(e.map(i=>n.store.put(i))),t!=null){let i=(yield n.store.count())-t;if(i>0){let o=yield n.store.openCursor();for(;i>0&&o;)i--,yield o.delete(),o=yield o.continue()}}yield n.done}})}deleteRecordings(...e){return ps(this,null,function*(){if(e.length>0){let t=e.map(i=>i.id),n=yield(yield this._getDatabase()).transaction(ds,"readwrite").store.openCursor();for(;n;)t.some(i=>(n==null?void 0:n.value.id)===i)&&(yield n.delete(),n=yield n.continue())}})}_getDatabase(){return ps(this,null,function*(){return this._db!=null?this._db:(this._openLock==null&&(this._openLock=$m(xm,1,{upgrade(e){e.createObjectStore("recordings",{autoIncrement:!0})}}).then(e=>(this._db=e,e))),this._openLock)})}};var Dx=Object.defineProperty,Vx=(r,e,t)=>e in r?Dx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Nx=(r,e,t)=>Vx(r,typeof e!="symbol"?e+"":e,t),oi=class{constructor(){Nx(this,"_storage")}getStorage(){return this._storage||(this._storage=new ii),this._storage}};var Lx=Object.defineProperty,Gx=(r,e,t)=>e in r?Lx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wx=(r,e,t)=>Gx(r,typeof e!="symbol"?e+"":e,t),si=class{constructor(){Wx(this,"_textDecoder",new TextDecoder)}decode(e){let t=this._textDecoder.decode(e);return this.decodeString(t)}decodeString(e){let t=e.split(`
`),n=[];for(let i of t)if(i)try{let o=JSON.parse(i),s={time:o[0],trackType:o[1],event:{eventType:o[2],data:o[3]}};n.push(s)}catch(o){}return n}};var Fx=Object.defineProperty,Kx=(r,e,t)=>e in r?Fx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jx=(r,e,t)=>Kx(r,typeof e!="symbol"?e+"":e,t),ai=class{constructor(){jx(this,"_queue",[])}get length(){return this._queue.length}clear(){this._queue.length>0&&this._queue.splice(0,this._queue.length)}dequeue(){return this._queue.shift()}enqueue(...e){return this._queue.push(...e)}find(e,t){return this._queue.find(e,t)}findIndex(e,t){return this._queue.findIndex(e,t)}forEach(e,t){this._queue.forEach(e,t||this)}map(e,t){return this._queue.map(e,t||this)}peek(){return this._queue[0]}remove(e){return this._queue.splice(e,1)[0]}slice(e,t){return this._queue.slice(e,t)}toArray(){return[...this._queue]}};var Hx=Object.defineProperty,Tm=Object.getOwnPropertySymbols,zx=Object.prototype.hasOwnProperty,Jx=Object.prototype.propertyIsEnumerable,Zx=Math.pow,Jc=(r,e,t)=>e in r?Hx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qx=(r,e)=>{for(var t in e||(e={}))zx.call(e,t)&&Jc(r,t,e[t]);if(Tm)for(var t of Tm(e))Jx.call(e,t)&&Jc(r,t,e[t]);return r},Sm=(r,e,t)=>Jc(r,typeof e!="symbol"?e+"":e,t),Bm=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Em=class km{constructor(e){Sm(this,"_options"),this._options=this._normalize(e)}attempt(e,t){return Bm(this,null,function*(){return typeof e!="function"?Promise.reject(new Error("executor is not function")):this._attempt(e,this._normalize(t,this._options))})}_attempt(e,t,n=1){return Bm(this,null,function*(){return e().catch(i=>{if(t.shouldRetry&&!t.shouldRetry(i))throw i;if(n<t.retries)return this._delay(this._randomTimeout(n,t)).then(()=>this._attempt(e,t,n+1));throw i})})}_normalize(e,t=km.DEFAULT_OPTIONS){let n=Qx({},t);if(e){let{retries:i,initialTimeout:o,maxTimeout:s,randomize:a}=e;i!=null&&i>=0&&(n.retries=i),o!=null&&o>=0&&(n.initialTimeout=o),s!=null&&s>=n.initialTimeout&&(n.maxTimeout=s),a!=null&&a>=1&&a<=2&&(a<1?n.randomize=1:a>2?n.randomize=2:n.randomize=a),e!=null&&e.shouldRetry&&(n.shouldRetry=e.shouldRetry)}return n}_delay(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}_randomTimeout(e,t){let{randomize:n,initialTimeout:i,maxTimeout:o,factor:s}=t;return Math.min(n*i*Zx(s,e),o)}};Sm(Em,"DEFAULT_OPTIONS",{retries:3,initialTimeout:1e3,maxTimeout:1/0,randomize:1.5,factor:1.5,shouldRetry:()=>!0});var nt=Em;var R=Z(Om(),1);var eq=Object.defineProperty,tq=(r,e,t)=>e in r?eq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Cm=(r,e,t)=>tq(r,typeof e!="symbol"?e+"":e,t),lr=class extends ai{constructor(e){super(),Cm(this,"_size"),Cm(this,"_emitter"),this._size=Math.max(e,1),this._emitter=new R.default}get isFull(){return this._size===this.length}enqueue(...e){let t=0,n=!1,i=e.length,o=this.length+i-this._size;o>0&&(n=!0,this._queue.splice(0,o));let s=i-this._size;return s>0?(n=!0,t=super.enqueue(...e.slice(s))):t=super.enqueue(...e),n&&this._emitter.emit("rotated"),t}on(e,t){return this._emitter.on(e,t),this}off(e,t){return this._emitter.off(e,t),this}};var jM=Z(Q());function X(r,e){return r==null?!1:r.indexOf(e)!==-1}var Y=(r=>(r[r.ElementNode=1]="ElementNode",r[r.TextNode=3]="TextNode",r[r.CommentNode=8]="CommentNode",r[r.DocumentNode=9]="DocumentNode",r[r.HTMLNode=10]="HTMLNode",r[r.DocumentFragmentNode=11]="DocumentFragmentNode",r[r.AndroidNode=12]="AndroidNode",r))(Y||{});var rq={INPUT:!0,TEXTAREA:!0},nq={checkbox:!0,radio:!0},Qc={BUTTON:!0,INPUT:!0,METER:!0,OUTPUT:!0,PROGRESS:!0,SELECT:!0,TEXTAREA:!0};function ms(r){return(r==null?void 0:r.tagName)==="STYLE"}function Pt(r){return r.tagName==="INPUT"}function Qr(r){return r.tagName==="OPTION"}function ci(r){return r.tagName==="SCRIPT"}function cr(r){return r.tagName==="SELECT"}function gs(r){return r.tagName==="TEXTAREA"}function dt(r){return typeof r=="object"&&!!r&&"window"in r&&r.window===r}function it(r){return(r==null?void 0:r.nodeType)===Node.ELEMENT_NODE}function vs(r){return r instanceof HTMLInputElement&&r.type!=null&&nq[r.type.toLowerCase()]&&typeof r.checked=="boolean"}function _s(r){return!(vs(r)||cr(r))}function ys(r){return rq[r.tagName]?!1:!!r.isContentEditable}function bs(r){return r!=null&&r.id!=null&&r.type!=null&&!(r instanceof Node)}function ur(r){return"children"in r}function Ge(r){return r.type===Y.ElementNode}function Xc(r){return Ge(r)&&r.tag==="A"}function Yc(r){return Ge(r)&&r.tag==="IMG"}function eu(r){return Ge(r)&&r.tag==="AUDIO"}function tu(r){return Ge(r)&&r.tag==="VIDEO"}function ru(r){return Ge(r)&&r.tag==="SOURCE"}function nu(r){return r.type===Y.TextNode}function iu(r){return r!==null&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function ui(r){let e=r.target;if(e!=null){if(Pt(e)||gs(e)||cr(e)||ys(e))return e;try{e=r.composedPath()[0]}catch(t){}return e==null?void 0:e}}var iq=Object.defineProperty,oq=(r,e,t)=>e in r?iq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Im=(r,e,t)=>oq(r,typeof e!="symbol"?e+"":e,t),N=class{constructor(e,t="*"){Im(this,"_searchCondition"),Im(this,"_maskingCharacter"),this._searchCondition=e,this._maskingCharacter=t}mask(e){return e.replace(this._searchCondition,t=>this.maskSubstring(t,this._maskingCharacter))}};var YM=Z(Q());var Mm="data-bytereplay-mask";function $s(r){Mm=r}function We(){return Mm}var ou=["","true"],Fe={ignore:"ignore",name:"name",strict:"strict",balance:"balance"};function hi(r){return X(ou,r)}function di(r){return r===Fe.name}function pi(r){return r===Fe.balance}function Xr(r){return r===Fe.strict}var cq={STYLE:!0,SCRIPT:!0,svg:!0},uq={alt:!0,"aria-label":!0,"aria-valuetext":!0,placeholder:!0,title:!0,value:!0},hq={href:!0,src:!0,srcset:!0};function fi(r){return!!(r&&it(r)&&r.getAttribute(We())===Fe.ignore)}function su(r){var e;return(e=hq[r])!=null?e:!1}function Yr(r){return r.type===Y.CommentNode?!1:r.type===Y.ElementNode?!cq[r.tag]:!0}function au(r){var e;return(e=uq[r])!=null?e:!1}function ws(r){return r.map(e=>{if(e instanceof N)throw console.log("\u{1F3A5} %cPlease note that custom DataMasks are not fully supported in multithreaded mode yet, you should pass a serializable function array to make it work.","font-weight:bold;color:#446EEA"),new Error("Customize DataMasks through AbstractDataMask are not yet supported in multithreaded mode.");return T(e)?e:String(e.mask)})}function mi(dataMasks){return dataMasks==null?dataMasks:dataMasks.map(dataMask=>{if(dataMask instanceof N)return dataMask;if(T(dataMask)){let mask;return dataMask.startsWith("function")||dataMask.startsWith("(")?mask={mask:eval(`(${dataMask})`)}:mask={mask:eval(`(function ${dataMask})`)},mask}return dataMask})}var pU=Z(Q());var gi=["BOE","DEV","PROD-INTERNAL","PROD-PUBLIC","PROD-SG","PROD-PUBLIC-SG","PROD-PUBLIC-SG-TT","PROD-VA","PROD-PUBLIC-VA","PROD-PUBLIC-VA-TT","PROD-US-TTP","PROD-PUBLIC-US-TTP"];var dq="PROD-INTERNAL",pq=dq;function Um(){return pq}var yU=Z(Q());var At=class extends oe{constructor(e,t){super(e,t),this.name="bytereplay.core.UnsupportedError"}};var vi=class extends oe{constructor(e,t){super(e,t),this.name="bytereplay.core.IOError"}};function lu(r){return new ReadableStream({start(e){return e.enqueue(r),e.close(),Promise.resolve()}})}function cu(r,e){let t=e===void 0?r.reduce((o,s)=>o+s.length,0):e,n=new Uint8Array(t),i=0;for(let o of r)n.set(o,i),i+=o.length;return n}var Pm=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())});function uu(r){return Pm(this,null,function*(){let e=r.getReader();return Am(e)})}function Am(r){return Pm(this,null,function*(){let e,t=[];for(;!(e=yield r.read()).done;)t.push(e.value);return cu(t)})}var _i=(r=>(r.Ping="ping",r.Pong="pong",r))(_i||{});function xt(r){return r==="pong"||r==="ping"}var mq=Object.defineProperty,Dm=Object.getOwnPropertySymbols,gq=Object.prototype.hasOwnProperty,vq=Object.prototype.propertyIsEnumerable,hu=(r,e,t)=>e in r?mq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vm=(r,e)=>{for(var t in e||(e={}))gq.call(e,t)&&hu(r,t,e[t]);if(Dm)for(var t of Dm(e))vq.call(e,t)&&hu(r,t,e[t]);return r},yi=(r,e,t)=>hu(r,typeof e!="symbol"?e+"":e,t),Nm=class Lm extends R.default{constructor(e,t){super(),yi(this,"_options"),yi(this,"_timer"),yi(this,"_handleMessage",n=>{n!=null&&(n===_i.Ping&&this._pong(),this._resetTimeout())}),yi(this,"_handleTimeout",()=>{this.stop(),this.emit("timeout")}),this.connection=e,this._options=Vm(Vm({},Lm.DEFAULT_OPTIONS),t)}start(){this.connection.on("message",this._handleMessage),this._startTimeout()}stop(){this._clearTimeout(),this.connection.off("message",this._handleMessage)}_pong(){this.connection.send(_i.Pong,!1)}_startTimeout(){this._resetTimeout()}_resetTimeout(){this._clearTimeout(),this._timer=setTimeout(this._handleTimeout,this._options.timeout)}_clearTimeout(){clearTimeout(this._timer),this._timer=void 0}};yi(Nm,"DEFAULT_OPTIONS",{timeout:12e3});var du=Nm;var PU=Z(Q());var _q=Object.defineProperty,yq=(r,e,t)=>e in r?_q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,en=(r,e,t)=>yq(r,typeof e!="symbol"?e+"":e,t),Gm=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),bi=class extends R.default{constructor(e,t){var n;super(),en(this,"_client"),en(this,"_isOpen",!1),en(this,"_retry"),en(this,"_mailbox"),en(this,"_isSending",!1),en(this,"_handleRotated",()=>{this._requestCompensation()}),this._client=e,this._retry=new nt(t==null?void 0:t.retry),this._mailbox=new lr((n=t==null?void 0:t.bufferSize)!=null?n:20),this._mailbox.on("rotated",this._handleRotated)}open(){this._isOpen||(this._isOpen=!0,this._sendNext())}send(e){this._isOpen&&(this._mailbox.enqueue(e),this._sendNext())}close(){this._close(!0)}_close(e){this._isOpen&&(this._isOpen=!1,this.removeAllListeners(),e&&this._flush(),this._mailbox.clear())}_sendNext(){return Gm(this,null,function*(){var e;if(!this._isSending){this._isSending=!0;let t=this._mailbox.dequeue();if(t==null)this._isSending=!1;else try{let{path:n,data:i,headers:o}=t;yield this._retry.attempt(()=>this._client.post(n,i,o)),this._isSending=!1,this._sendNext()}catch(n){this._isSending=!1,Dc(n)&&(e=n.code)!=null&&e.startsWith("BR_AUTH_TOKEN_")?(this.emit("error",n),this._close(!1)):this._requestCompensation()}}})}_flush(){return Gm(this,null,function*(){let e=this._mailbox.toArray();try{for(let t of e)yield this._retry.attempt(()=>this._client.post(t.path,t.data,t.headers))}catch(t){}})}_requestCompensation(){this._mailbox.clear(),this.emit("compensate")}};var $i=class extends oe{constructor(e,t){super(e,t),this.name="bytereplay.core.NetworkError"}};var Ke=(r=>(r[r.ACK=0]="ACK",r[r.Chunk=1]="Chunk",r[r.Command=10]="Command",r))(Ke||{});var QU=Z(Q());var hr=(r=>(r.ClosedByClient="ClosedByClient",r.ClosedByServer="ClosedByServer",r.HeartbeatTimeout="HeartbeatTimeout",r))(hr||{});function pu(r){if(r.code===1e3)return"ClosedByClient";if(r.code===3001)return"HeartbeatTimeout";if(r.code>=3e3)return"ClosedByServer"}var bq=Object.defineProperty,$q=(r,e,t)=>e in r?bq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ot=(r,e,t)=>$q(r,typeof e!="symbol"?e+"":e,t),Wm=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),wi=class{constructor(e,t){ot(this,"_url"),ot(this,"_emitter"),ot(this,"_heartbeat"),ot(this,"_retry"),ot(this,"_ws"),ot(this,"_opening"),ot(this,"_closing"),ot(this,"_closeReason"),ot(this,"_handleClose",n=>{this._unsubscribe(n.target),this._closeReason==null&&(this._closeReason=pu(n)),this._heartbeat.stop(),this._reopen()}),ot(this,"_handleMessage",n=>{let{data:i}=n;if(T(i)&&!xt(i))try{this._emitter.emit("message",JSON.parse(i))}catch(o){}else this._emitter.emit("message",i)}),ot(this,"_handleHeartbeatTimeout",()=>{this._closeReason==null&&(this._close(hr.HeartbeatTimeout),this._reopen())}),this._url=e,this._emitter=new R.default,this._heartbeat=new du(this,t==null?void 0:t.heartbeat),this._heartbeat.on("timeout",this._handleHeartbeatTimeout),this._retry=new nt(t==null?void 0:t.retry)}get isReady(){var e;return((e=this._ws)==null?void 0:e.readyState)===WebSocket.OPEN}on(e,t,n){return this._emitter.on(e,t,n),this}off(e,t,n){return this._emitter.off(e,t,n),this}open(){return Wm(this,null,function*(){return this._opening||(this._opening=new Promise((e,t)=>{this._unsubscribe(this._ws),this._ws=new WebSocket(this._url);let n=o=>{let s=o.target;s.removeEventListener("open",n),s.removeEventListener("close",i),this._subscribe(s),this._emitter.emit("open"),this._heartbeat.start(),this._opening=void 0,e()},i=o=>{let s=o.target;s.removeEventListener("open",n),s.removeEventListener("close",i),this._opening=void 0,t(new $i(`Failed to create websocket connection to "${this._url}"`))};this._ws.addEventListener("open",n),this._ws.addEventListener("close",i)})),this._closeReason=void 0,this._opening})}send(e,t=!0){xt(e)?this._send(e):e.type===Ke.Command?this._send(JSON.stringify(e)):this._send(e.data),t&&this._emitter.emit("send",e)}close(){return this._close(hr.ClosedByClient)}_send(e){var t;this.isReady&&((t=this._ws)==null||t.send(e))}_subscribe(e){e==null||e.addEventListener("close",this._handleClose),e==null||e.addEventListener("message",this._handleMessage)}_unsubscribe(e){e==null||e.removeEventListener("close",this._handleClose),e==null||e.removeEventListener("message",this._handleMessage)}_close(e){return Wm(this,null,function*(){if(this._closeReason=e,this._ws)return this._ws.readyState===WebSocket.CLOSED||this._ws.readyState===WebSocket.CLOSING?void 0:(this._closing||(this._closing=new Promise(t=>{var n,i;let o=s=>{let a=s.target;a.removeEventListener("close",o),this._unsubscribe(a),this._closing=void 0,t()};(n=this._ws)==null||n.addEventListener("close",o),(i=this._ws)==null||i.close(1e3)})),this._closing)})}_reopen(){this._closeReason===hr.ClosedByClient||this._closeReason===hr.ClosedByServer?this._emitter.emit("closed"):this._retry.attempt(()=>this.open()).catch(e=>{this._emitter.emit("closed",e)})}};var lP=Z(Q());var uP=new Uint8Array([34,112,97,99,107,101,116,34]);var fP=Z(Q());var dr="0.16.36/1.0.15.75";function fu(r=document,e=window){return{device:{appCodeName:e.navigator.appCodeName,appName:e.navigator.appName,appVersion:e.navigator.appVersion,deviceMemory:e.navigator.deviceMemory,hardwareConcurrency:e.navigator.hardwareConcurrency,language:e.navigator.language,languages:[...e.navigator.languages],platform:e.navigator.platform,userAgent:e.navigator.userAgent},screen:[e.screen.width,e.screen.height],window:{location:e.location.href,size:[e.innerWidth,e.innerHeight]},document:{title:r.title,size:[r.body.scrollWidth,r.body.scrollHeight],referrer:r.referrer},version:dr}}var SP=Z(Q());var E=(r=>(r.Blackbox="blackbox",r.Blocking="blocking",r.InMemory="in-memory",r.LiveStreaming="live-streaming",r.Streaming="streaming",r.StreamingHttp="streaming-http",r))(E||{});function mu(r,e){for(let t=r.length-1;t>=0;t--){let n=r[t];if(e(n,t,r))return n}}var wP=Z(Q());var xq=Object.defineProperty,qq=(r,e,t)=>e in r?xq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xs=(r,e,t)=>qq(r,typeof e!="symbol"?e+"":e,t),gu=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),xi=class{constructor(e,t=[]){xs(this,"_lastReadTime",0),xs(this,"_frames"),xs(this,"_snapshotIndexes"),xs(this,"_currentPosition",0),this._frames=e,this._snapshotIndexes=t}get size(){return this._frames.length}get frames(){return this._frames}getFirstFrameTime(){var e,t;return(t=(e=this._frames[0])==null?void 0:e.time)!=null?t:0}getLastFrameTime(){var e,t;return(t=(e=this._frames[this._frames.length-1])==null?void 0:e.time)!=null?t:1/0}getNextFrameTime(){var e,t;return(t=(e=this._frames[this._currentPosition+1])==null?void 0:e.time)!=null?t:null}get currentPosition(){return this._currentPosition}peek(){return this._frames[this._currentPosition]}get(e){return this._frames[e]}read(){return gu(this,null,function*(){let e=this.peek();return this.moveNext(),e})}readToTime(e){return gu(this,null,function*(){let t=[],n;for(;(n=yield this.peek())!=null&&n.time<=e;)t.push(n),this._lastReadTime=n.time,this.moveNext();return t})}seek(e){return gu(this,null,function*(){if(e>this._lastReadTime){if(this._snapshotIndexes.length===0)return;let t=this._snapshotIndexes.find(n=>n>this._currentPosition&&this._frames[n].time<=e)||0;t>0&&this.setCurrentPosition(t)}else{let t=mu(this._snapshotIndexes,n=>n<this._currentPosition)||0;t>0?this.setCurrentPosition(t):this.setCurrentPosition(0)}})}setCurrentPosition(e){var t;let n=e;n<0&&(n=0),n>this._frames.length-1&&(n=this._frames.length),this._currentPosition=n,this._lastReadTime=(t=this._frames[n])==null?void 0:t.time}moveNext(){this.setCurrentPosition(this._currentPosition+1)}hasNext(){return this._currentPosition<=this._frames.length-1}reset(){this._currentPosition=0,this._lastReadTime=0}close(){this.reset(),this._frames=[],this._snapshotIndexes=[]}};var Tq=Object.defineProperty,Bq=(r,e,t)=>e in r?Tq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Dt=(r,e,t)=>Bq(r,typeof e!="symbol"?e+"":e,t),Sq=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Vt=class r{constructor(e,t,n){Dt(this,"_id"),Dt(this,"_frames"),Dt(this,"_createTime"),Dt(this,"_duration"),Dt(this,"_environment"),Dt(this,"_meta"),Dt(this,"_trackers",[]),Dt(this,"_reader");var i,o,s,a;this._id=e,this._duration=(o=(i=t[t.length-1])==null?void 0:i.time)!=null?o:0,this._frames=t,this._reader=new xi(t),this._createTime=(s=n==null?void 0:n.createTime)!=null?s:Date.now(),this._environment=n==null?void 0:n.environment,this._meta=n==null?void 0:n.meta,this._trackers=(a=n==null?void 0:n.trackers)!=null?a:[]}static from(e,t,n){return t instanceof Uint8Array?new r(e,new si().decode(t),n):new r(e,t,n)}static clone(e){return new r(e.id,e.frames,{createTime:e.createTime,environment:e.environment,meta:e.meta,trackers:e.trackers})}get id(){return this._id}get frames(){return this._frames}get createTime(){return this._createTime}get duration(){return this._duration}get mode(){return E.InMemory}get environment(){return this._environment}get meta(){return this._meta}get trackers(){return this._trackers}getReader(){return Sq(this,null,function*(){return this._reader})}};var E2=Z(Q());var IP=Z(Q());var Eq=Object.defineProperty,kq=(r,e,t)=>e in r?Eq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tn=(r,e,t)=>kq(r,typeof e!="symbol"?e+"":e,t),rn=class{constructor(e,t){tn(this,"_callback"),tn(this,"_interval"),tn(this,"_lastData"),tn(this,"_lastSampleTime",0),tn(this,"_timer"),tn(this,"_nextData",()=>{this._timer!=null&&(clearTimeout(this._timer),this._timer=void 0),this._lastData!=null&&(this._callback(this._lastData),this._lastData=void 0)}),this._interval=Math.floor(1e3/(t!=null?t:24)*1e3)/1e3,this._callback=e}sample(e){this._lastData=e;let t=performance.now();this._lastSampleTime===0||t-this._lastSampleTime>this._interval?(this._lastSampleTime=t,this._nextData()):this._timer==null&&(this._timer=setTimeout(()=>{this._lastSampleTime=performance.now(),this._nextData()},this._interval))}stop(){this._nextData(),this._lastSampleTime=0}};var VP=Z(Q());var Rq=Object.defineProperty,Fm=Object.getOwnPropertySymbols,Oq=Object.prototype.hasOwnProperty,Cq=Object.prototype.propertyIsEnumerable,Km=(r,e,t)=>e in r?Rq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jm=(r,e)=>{for(var t in e||(e={}))Oq.call(e,t)&&Km(r,t,e[t]);if(Fm)for(var t of Fm(e))Cq.call(e,t)&&Km(r,t,e[t]);return r},Hm={maxDepth:5,maxKeys:50};function vu(r,e){let t=[],n=[],i=jm(jm({},Hm),e);return JSON.stringify(r,function(o,s){if(t.length>0){let a=t.indexOf(this);~a?t.splice(a+1):t.push(this),~a?n.splice(a,1/0,o):n.push(o),~t.indexOf(s)&&(t[0]===s?s="[Circular ~]":s="[Circular ~."+n.slice(0,t.indexOf(s)).join(".")+"]")}else t.push(s);return s===null?s:s===void 0?"undefined":Iq(s,i)?String(s):s})}function zm(r,e){return e<=0?!1:Object.keys(r).length>e}function Jm(r,e){return e<=0?!1:Zm(r,e)}function Zm(r,e){if(e===0)return!0;for(let t of Object.values(r))if(sr(t)&&Zm(t,e-1))return!0;return!1}function Iq(r,e){return!!(r instanceof Blob||r instanceof Error||r instanceof Event||r instanceof EventTarget||ir(r)||re(r)||Ec(r)||iu(r)||sr(r)&&(zm(r,e.maxKeys)||Jm(r,e.maxDepth)))}var _u=function(r,e){return _u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},_u(r,e)};function Nt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");_u(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Qm(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(h){s(h)}}function l(u){try{c(n.throw(u))}catch(h){s(h)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})}function qs(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(t=0)),t;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function qt(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Lt(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return o}function Gt(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))}function pr(r){return this instanceof pr?(this.v=r,this):new pr(r)}function Xm(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(f){return function(y){return Promise.resolve(y).then(f,h)}}function a(f,y){n[f]&&(i[f]=function(_){return new Promise(function(q,k){o.push([f,_,q,k])>1||l(f,_)})},y&&(i[f]=y(i[f])))}function l(f,y){try{c(n[f](y))}catch(_){d(o[0][3],_)}}function c(f){f.value instanceof pr?Promise.resolve(f.value.v).then(u,h):d(o[0][2],f)}function u(f){l("next",f)}function h(f){l("throw",f)}function d(f,y){f(y),o.shift(),o.length&&l(o[0][0],o[0][1])}}function Ym(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof qt=="function"?qt(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=r[o]&&function(s){return new Promise(function(a,l){s=r[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}function I(r){return typeof r=="function"}function Ts(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Bs=Ts(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function qi(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var nn=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=qt(s),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(_){e={error:_}}finally{try{l&&!l.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(I(u))try{u()}catch(_){o=_ instanceof Bs?_.errors:[_]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var d=qt(h),f=d.next();!f.done;f=d.next()){var y=f.value;try{eg(y)}catch(_){o=o!=null?o:[],_ instanceof Bs?o=Gt(Gt([],Lt(o)),Lt(_.errors)):o.push(_)}}}catch(_){n={error:_}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}if(o)throw new Bs(o)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)eg(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&qi(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&qi(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}();var yu=nn.EMPTY;function Ss(r){return r instanceof nn||r&&"closed"in r&&I(r.remove)&&I(r.add)&&I(r.unsubscribe)}function eg(r){I(r)?r():r.unsubscribe()}var st={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var on={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=on.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Gt([r,e],Lt(t))):setTimeout.apply(void 0,Gt([r,e],Lt(t)))},clearTimeout:function(r){var e=on.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Es(r){on.setTimeout(function(){var e=st.onUnhandledError;if(e)e(r);else throw r})}function bu(){}var tg=function(){return $u("C",void 0,void 0)}();function rg(r){return $u("E",void 0,r)}function ng(r){return $u("N",r,void 0)}function $u(r,e,t){return{kind:r,value:e,error:t}}var fr=null;function sn(r){if(st.useDeprecatedSynchronousErrorHandling){var e=!fr;if(e&&(fr={errorThrown:!1,error:null}),r(),e){var t=fr,n=t.errorThrown,i=t.error;if(fr=null,n)throw i}}else r()}function ig(r){st.useDeprecatedSynchronousErrorHandling&&fr&&(fr.errorThrown=!0,fr.error=r)}var Ti=function(r){Nt(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Ss(t)&&t.add(n)):n.destination=Aq,n}return e.create=function(t,n,i){return new mr(t,n,i)},e.prototype.next=function(t){this.isStopped?xu(ng(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?xu(rg(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?xu(tg,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(nn);var Mq=Function.prototype.bind;function wu(r,e){return Mq.call(r,e)}var Uq=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){ks(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){ks(n)}else ks(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){ks(t)}},r}(),mr=function(r){Nt(e,r);function e(t,n,i){var o=r.call(this)||this,s;if(I(t)||!t)s={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:i!=null?i:void 0};else{var a;o&&st.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&wu(t.next,a),error:t.error&&wu(t.error,a),complete:t.complete&&wu(t.complete,a)}):s=t}return o.destination=new Uq(s),o}return e}(Ti);function ks(r){st.useDeprecatedSynchronousErrorHandling?ig(r):Es(r)}function Pq(r){throw r}function xu(r,e){var t=st.onStoppedNotification;t&&on.setTimeout(function(){return t(r,e)})}var Aq={closed:!0,next:bu,error:Pq,complete:bu};var an=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ln(r){return r}function og(r){return r.length===0?ln:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}var ce=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,o=Vq(e)?e:new mr(e,t,n);return sn(function(){var s=i,a=s.operator,l=s.source;o.add(a?a.call(o,l):l?i._subscribe(o):i._trySubscribe(o))}),o},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=sg(t),new t(function(i,o){var s=new mr({next:function(a){try{e(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[an]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return og(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=sg(e),new e(function(n,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},r.create=function(e){return new r(e)},r}();function sg(r){var e;return(e=r!=null?r:st.Promise)!==null&&e!==void 0?e:Promise}function Dq(r){return r&&I(r.next)&&I(r.error)&&I(r.complete)}function Vq(r){return r&&r instanceof Ti||Dq(r)&&Ss(r)}function Nq(r){return I(r==null?void 0:r.lift)}function je(r){return function(e){if(Nq(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Tt(r,e,t,n,i){return new Lq(r,e,t,n,i)}var Lq=function(r){Nt(e,r);function e(t,n,i,o,s,a){var l=r.call(this,t)||this;return l.onFinalize=s,l.shouldUnsubscribe=a,l._next=n?function(c){try{n(c)}catch(u){t.error(u)}}:r.prototype._next,l._error=o?function(c){try{o(c)}catch(u){t.error(u)}finally{this.unsubscribe()}}:r.prototype._error,l._complete=i?function(){try{i()}catch(c){t.error(c)}finally{this.unsubscribe()}}:r.prototype._complete,l}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Ti);var ag=Ts(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var Wt=function(r){Nt(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new lg(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new ag},e.prototype.next=function(t){var n=this;sn(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=qt(n.currentObservers),a=s.next();!a.done;a=s.next()){var l=a.value;l.next(t)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;sn(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;sn(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?yu:(this.currentObservers=null,a.push(t),new nn(function(){n.currentObservers=null,qi(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new ce;return t.source=this,t},e.create=function(t,n){return new lg(t,n)},e}(ce);var lg=function(r){Nt(e,r);function e(t,n){var i=r.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:yu},e}(Wt);var cg=new ce(function(r){return r.complete()});function ug(r){return r&&I(r.schedule)}function hg(r){return r[r.length-1]}function dg(r){return ug(hg(r))?r.pop():void 0}function pg(r,e){return typeof hg(r)=="number"?r.pop():e}var Rs=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function Os(r){return I(r==null?void 0:r.then)}function Cs(r){return I(r[an])}function Is(r){return Symbol.asyncIterator&&I(r==null?void 0:r[Symbol.asyncIterator])}function Ms(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Gq(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Us=Gq();function Ps(r){return I(r==null?void 0:r[Us])}function As(r){return Xm(this,arguments,function(){var t,n,i,o;return qs(this,function(s){switch(s.label){case 0:t=r.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,pr(t.read())];case 3:return n=s.sent(),i=n.value,o=n.done,o?[4,pr(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,pr(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Ds(r){return I(r==null?void 0:r.getReader)}function xe(r){if(r instanceof ce)return r;if(r!=null){if(Cs(r))return Wq(r);if(Rs(r))return Fq(r);if(Os(r))return Kq(r);if(Is(r))return fg(r);if(Ps(r))return jq(r);if(Ds(r))return Hq(r)}throw Ms(r)}function Wq(r){return new ce(function(e){var t=r[an]();if(I(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Fq(r){return new ce(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function Kq(r){return new ce(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Es)})}function jq(r){return new ce(function(e){var t,n;try{for(var i=qt(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}function fg(r){return new ce(function(e){zq(r,e).catch(function(t){return e.error(t)})})}function Hq(r){return fg(As(r))}function zq(r,e){var t,n,i,o;return Qm(this,void 0,void 0,function(){var s,a;return qs(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),t=Ym(r),l.label=1;case 1:return[4,t.next()];case 2:if(n=l.sent(),!!n.done)return[3,4];if(s=n.value,e.next(s),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function He(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var o=e.schedule(function(){t(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(o),!i)return o}function Vs(r,e){return e===void 0&&(e=0),je(function(t,n){t.subscribe(Tt(n,function(i){return He(n,r,function(){return n.next(i)},e)},function(){return He(n,r,function(){return n.complete()},e)},function(i){return He(n,r,function(){return n.error(i)},e)}))})}function Ns(r,e){return e===void 0&&(e=0),je(function(t,n){n.add(r.schedule(function(){return t.subscribe(n)},e))})}function mg(r,e){return xe(r).pipe(Ns(e),Vs(e))}function gg(r,e){return xe(r).pipe(Ns(e),Vs(e))}function vg(r,e){return new ce(function(t){var n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}function _g(r,e){return new ce(function(t){var n;return He(t,e,function(){n=r[Us](),He(t,e,function(){var i,o,s;try{i=n.next(),o=i.value,s=i.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return I(n==null?void 0:n.return)&&n.return()}})}function Ls(r,e){if(!r)throw new Error("Iterable cannot be null");return new ce(function(t){He(t,e,function(){var n=r[Symbol.asyncIterator]();He(t,e,function(){n.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function yg(r,e){return Ls(As(r),e)}function bg(r,e){if(r!=null){if(Cs(r))return mg(r,e);if(Rs(r))return vg(r,e);if(Os(r))return gg(r,e);if(Is(r))return Ls(r,e);if(Ps(r))return _g(r,e);if(Ds(r))return yg(r,e)}throw Ms(r)}function $g(r,e){return e?bg(r,e):xe(r)}function wg(r,e){return je(function(t,n){var i=0;t.subscribe(Tt(n,function(o){n.next(r.call(e,o,i++))}))})}function xg(r,e,t,n,i,o,s,a){var l=[],c=0,u=0,h=!1,d=function(){h&&!l.length&&!c&&e.complete()},f=function(_){return c<n?y(_):l.push(_)},y=function(_){o&&e.next(_),c++;var q=!1;xe(t(_,u++)).subscribe(Tt(e,function(k){i==null||i(k),o?f(k):e.next(k)},function(){q=!0},void 0,function(){if(q)try{c--;for(var k=function(){var O=l.shift();s?He(e,s,function(){return y(O)}):y(O)};l.length&&c<n;)k();d()}catch(O){e.error(O)}}))};return r.subscribe(Tt(e,f,function(){h=!0,d()})),function(){a==null||a()}}function qu(r,e,t){return t===void 0&&(t=1/0),I(e)?qu(function(n,i){return wg(function(o,s){return e(n,o,i,s)})(xe(r(n,i)))},t):(typeof e=="number"&&(t=e),je(function(n,i){return xg(n,i,r,t)}))}function qg(r){return r===void 0&&(r=1/0),qu(ln,r)}function Tu(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=dg(r),n=pg(r,1/0),i=r;return i.length?i.length===1?xe(i[0]):qg(n)($g(i,t)):cg}function Su(r){r===void 0&&(r={});var e=r.connector,t=e===void 0?function(){return new Wt}:e,n=r.resetOnError,i=n===void 0?!0:n,o=r.resetOnComplete,s=o===void 0?!0:o,a=r.resetOnRefCountZero,l=a===void 0?!0:a;return function(c){var u,h,d,f=0,y=!1,_=!1,q=function(){h==null||h.unsubscribe(),h=void 0},k=function(){q(),u=d=void 0,y=_=!1},O=function(){var U=u;k(),U==null||U.unsubscribe()};return je(function(U,L){f++,!_&&!y&&q();var D=d=d!=null?d:t();L.add(function(){f--,f===0&&!_&&!y&&(h=Bu(O,l))}),D.subscribe(L),!u&&f>0&&(u=new mr({next:function(ee){return D.next(ee)},error:function(ee){_=!0,q(),h=Bu(k,i,ee),D.error(ee)},complete:function(){y=!0,q(),h=Bu(k,s),D.complete()}}),xe(U).subscribe(u))})(c)}}function Bu(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(e===!0){r();return}if(e!==!1){var i=new mr({next:function(){i.unsubscribe(),r()}});return xe(e.apply(void 0,Gt([],Lt(t)))).subscribe(i)}}function Eu(r,e,t){var n=I(r)||e||t?{next:r,error:e,complete:t}:r;return n?je(function(i,o){var s;(s=n.subscribe)===null||s===void 0||s.call(n);var a=!0;i.subscribe(Tt(o,function(l){var c;(c=n.next)===null||c===void 0||c.call(n,l),o.next(l)},function(){var l;a=!1,(l=n.complete)===null||l===void 0||l.call(n),o.complete()},function(l){var c;a=!1,(c=n.error)===null||c===void 0||c.call(n,l),o.error(l)},function(){var l,c;a&&((l=n.unsubscribe)===null||l===void 0||l.call(n)),(c=n.finalize)===null||c===void 0||c.call(n)}))}):ln}var Jq=Object.defineProperty,Zq=(r,e,t)=>e in r?Jq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Tg=(r,e,t)=>Zq(r,typeof e!="symbol"?e+"":e,t),J=class{constructor(){Tg(this,"_downstream",new Wt),Tg(this,"pipe",this._downstream.pipe.bind(this._downstream))}output(e){this._downstream.next(e)}asPipeable(){return e=>(e.subscribe(t=>{this.handleInput(t)}),this._downstream)}};var Bg=Symbol("bytereplay.CustomSnapshot");var m=(r=>(r[r.EOF=0]="EOF",r[r.HTMLSnapshot=101]="HTMLSnapshot",r[r.HTMLMutations=102]="HTMLMutations",r[r.HTMLScroll=103]="HTMLScroll",r[r.HTMLFocus=104]="HTMLFocus",r[r.HTMLBlur=105]="HTMLBlur",r[r.HTMLValueChange=106]="HTMLValueChange",r[r.HTMLSelectionChange=107]="HTMLSelectionChange",r[r.HTMLResize=110]="HTMLResize",r[r.HTMLIncrementalSnapshot=111]="HTMLIncrementalSnapshot",r[r.HTMLNavigation=115]="HTMLNavigation",r[r.HTMLCanvas=120]="HTMLCanvas",r[r.HTMLImage=122]="HTMLImage",r[r.HTMLVideo=123]="HTMLVideo",r[r.HTMLIFrame=130]="HTMLIFrame",r[r.MouseMove=201]="MouseMove",r[r.MouseDown=202]="MouseDown",r[r.MouseUp=203]="MouseUp",r[r.MouseClick=204]="MouseClick",r[r.MouseEnter=290]="MouseEnter",r[r.MouseLeave=291]="MouseLeave",r[r.TouchStart=205]="TouchStart",r[r.TouchMove=206]="TouchMove",r[r.TouchEnd=207]="TouchEnd",r[r.TouchCancel=208]="TouchCancel",r[r.KeyDown=301]="KeyDown",r[r.ConsoleAssert=401]="ConsoleAssert",r[r.ConsoleDebug=402]="ConsoleDebug",r[r.ConsoleDir=403]="ConsoleDir",r[r.ConsoleDirxml=404]="ConsoleDirxml",r[r.ConsoleError=405]="ConsoleError",r[r.ConsoleInfo=406]="ConsoleInfo",r[r.ConsoleLog=407]="ConsoleLog",r[r.ConsoleTable=408]="ConsoleTable",r[r.ConsoleTrace=409]="ConsoleTrace",r[r.ConsoleWarn=410]="ConsoleWarn",r[r.ERROR_SCRIPT=501]="ERROR_SCRIPT",r[r.ERROR_RUNTIME=502]="ERROR_RUNTIME",r[r.ERROR_NOTFOUND=503]="ERROR_NOTFOUND",r[r.ERROR_PROMISEREJECTION=504]="ERROR_PROMISEREJECTION",r[r.NETWORK_SEND=601]="NETWORK_SEND",r[r.NETWORK_DONE=602]="NETWORK_DONE",r[r.NETWORK_ABORT=603]="NETWORK_ABORT",r[r.NETWORK_ERROR=604]="NETWORK_ERROR",r[r.NETWORK_TIMEOUT=605]="NETWORK_TIMEOUT",r[r.INSIGHT_RAGE_CLICK=701]="INSIGHT_RAGE_CLICK",r[r.INSIGHT_DEAD_CLICK=702]="INSIGHT_DEAD_CLICK",r[r.INSIGHT_LONG_HOVER=703]="INSIGHT_LONG_HOVER",r[r.INSIGHT_EXCESSIVE_SCROLLING=704]="INSIGHT_EXCESSIVE_SCROLLING",r[r.PERFORMANCE_LONG_TASK=801]="PERFORMANCE_LONG_TASK",r[r.PERFORMANCE_RESOURCE=802]="PERFORMANCE_RESOURCE",r[r.PERFORMANCE_NAVIGATION=803]="PERFORMANCE_NAVIGATION",r))(m||{});var gN=Z(Q());var w=(r=>(r[r.EOF=0]="EOF",r[r.HTML=100]="HTML",r[r.Mouse=200]="Mouse",r[r.Keyboard=300]="Keyboard",r[r.Console=400]="Console",r[r.Error=500]="Error",r[r.Network=600]="Network",r[r.Insight=700]="Insight",r[r.Performance=800]="Performance",r))(w||{});function Ft(r){return r>=1001&&r<=1999}function Gs(r){if(!Ft(r))throw new Error("Custom TrackerType must be in range [1001 ~ 1999]");return r}function ku(r,e){let t=X(e,r);if(t)throw new Error(`Custom TrackerType ${r} is duplicated, please choose a new one in range [1001 ~ 1999]`);return t}function cn(r,e,t){return{time:t,trackType:r,event:e}}function Ru(r){return cn(w.EOF,{eventType:m.EOF,data:0},r)}var ze=(r=>(r.StartRecording="startRecording",r.StopRecording="stopRecording",r.Unload="unload",r.Load="load",r))(ze||{});var Sg="ReplayIFrameEvent";function Ou(r){return new CustomEvent(Sg,{detail:r})}var pt=(r=>(r.Loading="loading",r.Loaded="loaded",r.Recording="recording",r))(pt||{});var un=(r=>(r.RecorderStopped="RecorderStopped",r.ReceiverStopped="ReceiverStopped",r.RecorderDisconnected="RecorderDisconnected",r.SyncBlock="SyncBlock",r.SyncPacket="SyncPacket",r))(un||{});var M=(r=>(r[r.AddNode=1]="AddNode",r[r.RemoveNode=2]="RemoveNode",r[r.ChangeAttributes=3]="ChangeAttributes",r[r.CharacterData=4]="CharacterData",r[r.Document=10]="Document",r[r.StyleSheetRule=20]="StyleSheetRule",r[r.StyleSheetAdopted=21]="StyleSheetAdopted",r[r.AndroidUpdateNode=22]="AndroidUpdateNode",r))(M||{});var Xq=Object.defineProperty,Yq=(r,e,t)=>e in r?Xq(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,eT=(r,e,t)=>Yq(r,typeof e!="symbol"?e+"":e,t),Je=class{constructor(...e){eT(this,"_masks"),this._masks=e}mask(e){return this._masks.reduce((t,n)=>n.mask(t),e)}};var Pe=(r=>(r.BALANCE="BALANCE",r.STRICT="STRICT",r))(Pe||{});var vr=class extends N{constructor(){super(/\b[1-9](?:\d{18}|\d{17}|\d{16}|\d{15}|\d{11})\b/gm)}maskSubstring(e,t){return`${e.slice(0,-4).replace(/\S/g,t)}${e.slice(-4)}`}};var Bi=class extends N{constructor(){super(/[\u4e00-\u9fa5]+([\u4e00-\u9fa5]+)*/gm)}maskSubstring(e,t){let n=e.length<=3?1:2;return`${e.slice(0,n).replace(/\S/g,t)}${e.slice(n)}`}};var _r=class extends N{constructor(){super(/[A-Za-z0-9.\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(?:\.[a-zA-Z0-9_-]+)+/gim)}maskSubstring(e,t){let n=e.indexOf("@");return`${e.slice(0,n).slice(0,3)}${t.repeat(3)}${e.slice(n)}`}};var Si=class extends N{constructor(){super(/(?:[a-zA-Z']{2,} ?)+/gm)}maskSubstring(e,t){let n=e.indexOf(" ");return n===-1?`${e.slice(0,1)}${e.slice(1).replace(/\S/g,t)}`:`${e.slice(0,n).replace(/\S/g,t)}${e.slice(n)}`}};var yr=class extends N{constructor(){super(/([1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx])|([1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}[0-9Xx])/gm)}maskSubstring(e,t){return`${e.slice(0,1)}${e.slice(1,-1).replace(/\S/g,t)}${e.slice(-1)}`}};var br=class extends N{constructor(){super(/((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/gm)}maskSubstring(e,t){let n=e.indexOf(".")+1;return`${e.slice(0,n)}${e.slice(n).replace(/[^.]/g,t)}`}};var $r=class extends N{constructor(){super(/([][A-Z](([0-9]{5}[DF])|([DF]([A-HJ-NP-Z0-9])[0-9]{4})))|([][A-Z][A-HJ-NP-Z0-9]{4}[A-HJ-NP-Z0-9])/gm)}maskSubstring(e,t){return`${e.slice(0,2)}${e.slice(2,-3).replace(/\S/g,t)}${e.slice(-3)}`}};var wr=class extends N{constructor(){super(/(([0-9A-Fa-f]{2}:){5}([0-9A-Fa-f]{2}))|(([0-9A-Fa-f]{2}-){5}([0-9A-Fa-f]{2}))/gm)}maskSubstring(e,t){let n=e.indexOf(":")+1,i=e.indexOf("-")+1,o=n===0?i:n;return`${e.slice(0,o)}${e.slice(o).replace(/[^:]/g,t)}`}};var tT=Object.defineProperty,rT=(r,e,t)=>e in r?tT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nT=(r,e,t)=>rT(r,typeof e!="symbol"?e+"":e,t),xr=class extends N{constructor(){super(/\b(?:(?:\+?86)?1(?:3\d{3}|5[^4\D]\d{2}|8\d{3}|7(?:[0-35-9]\d{2}|4(?:0\d|1[0-2]|9\d))|9[0-35-9]\d{2}|6[2567]\d{2}|4(?:(?:10|4[01])\d{3}|[68]\d{4}|[579]\d{2}))\d{6})|(0?(?:10|(?:2|3[1,5,7]|4[1,5,7]|5[1,3,5,7]|7[1,3,5,7,9]|8[1,3,7,9])[0-9]|91[0-7,9]|(?:43|59|85)[1-9]|39[1-8]|54[3,6]|(?:701|580|349|335)|54[3,6]|69[1-2]|44[0,8]|48[2,3]|46[4,7,8,9]|52[0,3,7]|42[1,7,9]|56[1-6]|63[1-5]|66[0-3,8]|72[2,4,8]|74[3-6]|76[0,2,3,5,6,8,9]|82[5-7]|88[1,3,6-8]|90[1-3,6,8,9])\-?\d{7,8})\b/gm),nT(this,"_regexCountryCode",/^\+?86/)}maskSubstring(e,t){let n="",i=e,o=this._regexCountryCode.exec(e);return o&&(n=o[0],i=e.slice(n.length)),`${n}${i.slice(0,3)}${i.slice(3,-2).replace(/\S/g,t)}${i.slice(-2)}`}};var qr=class extends N{constructor(){super(/\S+/gm)}maskSubstring(e,t){return t.repeat(e.length)}};var Tr=class extends N{constructor(){super(/\b[A-HJ-NPR-Z\d]{17}\b/gm)}maskSubstring(e,t){return`${e.slice(0,3)}${e.slice(3,-3).replace(/\S/g,t)}${e.slice(-3)}`}};var cL=Z(Q());var iT=Object.defineProperty,oT=(r,e,t)=>e in r?iT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hn=(r,e,t)=>oT(r,typeof e!="symbol"?e+"":e,t),Ae=class{constructor(e){hn(this,"_domains",["bytedance","zijieapi","tiktok-row","byteintl","tiktok-usts","tiktokw","tiktok"]),hn(this,"DEFAULT_ENV_TYPE","PROD-INTERNAL"),hn(this,"_type",this.DEFAULT_ENV_TYPE),hn(this,"_baseURL"),hn(this,"_apiPrefix"),hn(this,"_headers");var t;this.baseURL=e==null?void 0:e.baseURL,this.type=(t=e==null?void 0:e.type)!=null?t:Um(),this.apiPrefix=e==null?void 0:e.apiPrefix,this.headers=e==null?void 0:e.headers}set type(e){if(e!=null){let t=this.parse(e);if(t){this._type=t;return}throw new Error(`Invalid environment type, it must be one of the following: ${gi.join(", ")}.`)}}get type(){return this._type}set baseURL(e){if(e==null||kc(e))this._baseURL=void 0;else try{this._baseURL=new URL(e).href}catch(t){throw new oe("Invalid base URL: "+e)}}set apiPrefix(e){e&&(e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")||(e+="/")),this._apiPrefix=e!=null?e:"api/"}get apiPrefix(){return this._apiPrefix}set headers(e){this._headers=e}get headers(){return this._headers}get baseURL(){return this._baseURL!=null?this._baseURL.startsWith("//")?location.protocol+":"+this._baseURL:this._baseURL:this.isBOE()?`https://bytereplay-boe.${this._domains[0]}.net/`:this.isDev()?"http://localhost:6789/":this.isProdPublic()?"https://bytereplay."+this._domains[1]+".com/":this.isProdSG()?"https://bytereplay-sg."+this._domains[2]+".net/":this.isProdPublicSG()?"https://bytereplay-sg."+this._domains[3]+"api.com/":this.isProdVA()?"https://bytereplay-va."+this._domains[2]+".net/":this.isProdPublicVA()?"https://bytereplay-va."+this._domains[3]+"api.com/":this.isProdUS_TTP()?"https://bytereplay."+this._domains[4]+".net/":this.isProdPublicUS_TTP()?"https://bytereplay."+this._domains[5]+".us/":this.isProdPublicSGForTT()?"https://tsr16-normal-alisg."+this._domains[6]+".com/":this.isProdPublicVATForTT()?"https://tsr16-normal-useast1a."+this._domains[6]+".com/":`https://bytereplay.${this._domains[0]}.net/`}getFullUrl(e,t=!1){if(/^(wss?:\/\/|https?:\/\/|\/\/)/.test(e))return e;let n=this.baseURL.replace(/^https?:\/\/|\/+$/g,""),i=e.replace(/^\/+/,"");return`${this._getProtocol(t)}://${n}/${this.apiPrefix}${i}`}parse(e){if(T(e)){let t=e.trim().toUpperCase();if(X(gi,t))return t}}isBOE(){return this._type==="BOE"}isDev(){return this._type==="DEV"}isProdInternal(){return this._type==="PROD-INTERNAL"}isProdPublic(){return this._type==="PROD-PUBLIC"}isProdSG(){return this._type==="PROD-SG"}isProdPublicSG(){return this._type==="PROD-PUBLIC-SG"}isProdPublicSGForTT(){return this._type==="PROD-PUBLIC-SG-TT"}isProdVA(){return this._type==="PROD-VA"}isProdPublicVA(){return this._type==="PROD-PUBLIC-VA"}isProdPublicVATForTT(){return this._type==="PROD-PUBLIC-VA-TT"}isProdUS_TTP(){return this._type==="PROD-US-TTP"}isProdPublicUS_TTP(){return this.type==="PROD-PUBLIC-US-TTP"}toOptions(){return{type:this.type,baseURL:this.baseURL,apiPrefix:this.apiPrefix,headers:this.headers}}_getProtocol(e=!1){return this.baseURL.startsWith("http:")?e?"ws":"http":e?"wss":"https"}};var sT=Oc()?globalThis.structuredClone:hm;function at(r){return sT(r)}var aT=Object.defineProperty,Eg=Object.getOwnPropertySymbols,lT=Object.prototype.hasOwnProperty,cT=Object.prototype.propertyIsEnumerable,kg=(r,e,t)=>e in r?aT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,uT=(r,e)=>{for(var t in e||(e={}))lT.call(e,t)&&kg(r,t,e[t]);if(Eg)for(var t of Eg(e))cT.call(e,t)&&kg(r,t,e[t]);return r};function dn(r){let e={};return r!=null&&(Bc(r)?r.forEach((t,n)=>{e[n]=t}):Array.isArray(r)?r.forEach(([t,n])=>{e[t]=n}):T(r)?r.trim().split(/[\r\n]+/).forEach(t=>{let n=t.split(": "),i=n[0];i!=null&&i.trim()!==""&&(e[i]=n[1])}):e=uT({},r)),Object.keys(e).length>0?e:void 0}function Cu(r){let e={};return r.forEach((t,n)=>{t instanceof File?e[n]="[object File]":e[n]=t}),e}function ve(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,r=>(r^crypto.getRandomValues(new Uint8Array(1))[0]&15>>r/4).toString(16))}var Ei=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createConicGradient","createImageData","createLinearGradient","createPattern","createRadialGradient","drawFocusIfNeeded","drawImage","ellipse","fill","fillRect","fillText","getContextAttributes","getImageData","getLineDash","getTransform","isContextLost","isPointInPath","isPointInStroke","lineTo","measureText","moveTo","putImageData","quadraticCurveTo","rect","reset","resetTransform","restore","rotate","roundRect","save","scale","scrollPathIntoView","setLineDash","setTransform","stroke","strokeRect","strokeText","transform","translate"],Iu={setTransform:0,lineTo:1,beginPath:2,fill:3,setAttr:4,stroke:5,clip:6,save:7,restore:8,fillText:9,fillRect:10,arc:11,arcTo:12,bezierCurveTo:13,clearRect:14,closePath:15,createConicGradient:16,createImageData:17,createLinearGradient:18,createPattern:19,createRadialGradient:20,drawFocusIfNeeded:21,drawImage:22,ellipse:23,getContextAttributes:24,getImageData:25,getLineDash:26,getTransform:27,isContextLost:28,isPointInPath:29,isPointInStroke:30,measureText:31,moveTo:32,putImageData:33,quadraticCurveTo:34,rect:35,reset:36,resetTransform:37,rotate:38,roundRect:39,scale:40,scrollPathIntoView:41,setLineDash:42,strokeRect:43,strokeText:44,transform:45,translate:46,snapshot:47},pn=Object.keys(Iu),Og={arc:!1,arcTo:!1,beginPath:!0,bezierCurveTo:!1,clearRect:!0,clip:!1,closePath:!0,createConicGradient:!1,createImageData:!1,createLinearGradient:!1,createPattern:!1,createRadialGradient:!1,drawFocusIfNeeded:!1,drawImage:!0,ellipse:!1,fill:!0,fillRect:!0,fillText:!0,getContextAttributes:!1,getImageData:!1,getLineDash:!1,getTransform:!1,isContextLost:!1,isPointInPath:!1,isPointInStroke:!1,lineTo:!1,measureText:!1,moveTo:!1,putImageData:!1,quadraticCurveTo:!1,rect:!1,reset:!1,resetTransform:!1,restore:!1,rotate:!1,roundRect:!1,save:!1,scale:!1,scrollPathIntoView:!1,setLineDash:!1,setTransform:!1,stroke:!0,strokeRect:!0,strokeText:!0,transform:!1,translate:!1},Cg=["resetTransform","setLineDash","setTransform"],Mu=["direction","fillStyle","filter","font","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","imageSmoothingQuality","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","strokeStyle","textAlign","textBaseline"],Br={textRendering:0,fillStyle:1,strokeStyle:2,font:3,textAlign:4,wordSpacing:5,lineCap:6,lineDashOffset:7,lineJoin:8,letterSpacing:9,direction:10,filter:11,fontKerning:12,fontStretch:13,fontVariantCaps:14,lineWidth:15,globalCompositeOperation:16,imageSmoothingEnabled:17,imageSmoothingQuality:18,miterLimit:19,shadowBlur:20,shadowColor:21,shadowOffsetX:22,shadowOffsetY:23,textBaseline:24,globalAlpha:25},Sr=Object.keys(Br),Ws=[];var Fs=function(r){return r&&r.Math===Math&&r},pe=Fs(typeof globalThis=="object"&&globalThis)||Fs(typeof window=="object"&&window)||Fs(typeof self=="object"&&self)||Fs(!1)||function(){return this}()||Function("return this")();var Er=class extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(let[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){let n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){let t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){let t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){let i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){let t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");let t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(let[e]of this)yield e}*values(){for(let[,e]of this)yield e}*[Symbol.iterator](){for(let e of this.cache){let[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(let e of this.oldCache){let[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){let n=e[t],[i,o]=n;this._deleteIfExpired(i,o)===!1&&(yield[i,o.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){let n=e[t],[i,o]=n;this.cache.has(i)||this._deleteIfExpired(i,o)===!1&&(yield[i,o.value])}}*entriesAscending(){for(let[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(let t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(let[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}};var Uu=class{constructor(){this._imageCache=new Er({maxSize:1e3,maxAge:2e4})}deserialize(e){return V(this,null,function*(){if(!e)return;let t=this._imageCache.get(e);return t||new Promise(n=>{let i=new Image;i.onload=()=>{n(i)},i.src=e,this._imageCache.set(e,i)})})}},ki=new Uu;var Pu=class{constructor(){this._serializeCache=new WeakMap,this._canvas=null}serialize(e){if(e instanceof HTMLCanvasElement)return{type:e.constructor.name,src:e.toDataURL()};if(e instanceof OffscreenCanvas){let t=e.transferToImageBitmap(),n=this._serializeCache.get(t);if(n)return n;let i=e.transferToImageBitmap(),o={type:e.constructor.name,src:this._convertImageBitmapIntoBase64(i)};return this._serializeCache.set(i,o),o}if(pe.VideoFrame&&e instanceof VideoFrame){let t={type:e.constructor.name,src:this._convertVideoFrameIntoBase64(e)};return this._serializeCache.set(e,t),t}else if(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof Image){let t={type:e.constructor.name,src:e.src};return this._serializeCache.set(e,t),t}else if(e instanceof ImageBitmap){let t={type:e.constructor.name,src:this._convertImageBitmapIntoBase64(e)};return this._serializeCache.set(e,t),t}else if(e instanceof SVGImageElement){let t={type:e.constructor.name,src:e.href.baseVal};return this._serializeCache.set(e,t),t}}isCanvasImageSource(e){return e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof Image||e instanceof ImageBitmap||e instanceof OffscreenCanvas||e instanceof SVGImageElement||pe.VideoFrame&&e instanceof VideoFrame}_convertImageBitmapIntoBase64(e){let t=this.canvas;return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png",1)}_convertVideoFrameIntoBase64(e){let t=document.createElement("canvas");return t.width=e.displayWidth,t.height=e.displayHeight,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png",1)}get canvas(){return this._canvas||(this._canvas=document.createElement("canvas")),this._canvas}},Ri=new Pu;function Ig(r){if(r)return[r.a,r.b,r.c,r.d,r.e,r.f]}function Mg(r){return new DOMMatrix(r)}function Ug(r){let e=!1,t;return function(...n){return e||(e=!0,t=r.apply(this,n)),t}}var gT={value:()=>{}};function Ag(){for(var r=0,e=arguments.length,t={},n;r<e;++r){if(!(n=arguments[r]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new Ks(t)}function Ks(r){this._=r}function vT(r,e){return r.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}Ks.prototype=Ag.prototype={constructor:Ks,on:function(r,e){var t=this._,n=vT(r+"",t),i,o=-1,s=n.length;if(arguments.length<2){for(;++o<s;)if((i=(r=n[o]).type)&&(i=_T(t[i],r.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(r=n[o]).type)t[i]=Pg(t[i],r.name,e);else if(e==null)for(i in t)t[i]=Pg(t[i],r.name,null);return this},copy:function(){var r={},e=this._;for(var t in e)r[t]=e[t].slice();return new Ks(r)},call:function(r,e){if((i=arguments.length-2)>0)for(var t=new Array(i),n=0,i,o;n<i;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(o=this._[r],n=0,i=o.length;n<i;++n)o[n].value.apply(e,t)},apply:function(r,e,t){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var n=this._[r],i=0,o=n.length;i<o;++i)n[i].value.apply(e,t)}};function _T(r,e){for(var t=0,n=r.length,i;t<n;++t)if((i=r[t]).name===e)return i.value}function Pg(r,e,t){for(var n=0,i=r.length;n<i;++n)if(r[n].name===e){r[n]=gT,r=r.slice(0,n).concat(r.slice(n+1));break}return t!=null&&r.push({name:e,value:t}),r}var Au=Ag;var js="http://www.w3.org/1999/xhtml",Du={svg:"http://www.w3.org/2000/svg",xhtml:js,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Bt(r){var e=r+="",t=e.indexOf(":");return t>=0&&(e=r.slice(0,t))!=="xmlns"&&(r=r.slice(t+1)),Du.hasOwnProperty(e)?{space:Du[e],local:r}:r}function yT(r){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===js&&e.documentElement.namespaceURI===js?e.createElement(r):e.createElementNS(t,r)}}function bT(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function Hs(r){var e=Bt(r);return(e.local?bT:yT)(e)}function $T(){}function kr(r){return r==null?$T:function(){return this.querySelector(r)}}function Dg(r){typeof r!="function"&&(r=kr(r));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var o=e[i],s=o.length,a=n[i]=new Array(s),l,c,u=0;u<s;++u)(l=o[u])&&(c=r.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new ae(n,this._parents)}function Vu(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function wT(){return[]}function Oi(r){return r==null?wT:function(){return this.querySelectorAll(r)}}function xT(r){return function(){return Vu(r.apply(this,arguments))}}function Vg(r){typeof r=="function"?r=xT(r):r=Oi(r);for(var e=this._groups,t=e.length,n=[],i=[],o=0;o<t;++o)for(var s=e[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&(n.push(r.call(l,l.__data__,c,s)),i.push(l));return new ae(n,i)}function Ci(r){return function(){return this.matches(r)}}function zs(r){return function(e){return e.matches(r)}}var qT=Array.prototype.find;function TT(r){return function(){return qT.call(this.children,r)}}function BT(){return this.firstElementChild}function Ng(r){return this.select(r==null?BT:TT(typeof r=="function"?r:zs(r)))}var ST=Array.prototype.filter;function ET(){return Array.from(this.children)}function kT(r){return function(){return ST.call(this.children,r)}}function Lg(r){return this.selectAll(r==null?ET:kT(typeof r=="function"?r:zs(r)))}function Gg(r){typeof r!="function"&&(r=Ci(r));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var o=e[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&r.call(l,l.__data__,c,o)&&a.push(l);return new ae(n,this._parents)}function Js(r){return new Array(r.length)}function Wg(){return new ae(this._enter||this._groups.map(Js),this._parents)}function Ii(r,e){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=e}Ii.prototype={constructor:Ii,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,e){return this._parent.insertBefore(r,e)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function Fg(r){return function(){return r}}function RT(r,e,t,n,i,o){for(var s=0,a,l=e.length,c=o.length;s<c;++s)(a=e[s])?(a.__data__=o[s],n[s]=a):t[s]=new Ii(r,o[s]);for(;s<l;++s)(a=e[s])&&(i[s]=a)}function OT(r,e,t,n,i,o,s){var a,l,c=new Map,u=e.length,h=o.length,d=new Array(u),f;for(a=0;a<u;++a)(l=e[a])&&(d[a]=f=s.call(l,l.__data__,a,e)+"",c.has(f)?i[a]=l:c.set(f,l));for(a=0;a<h;++a)f=s.call(r,o[a],a,o)+"",(l=c.get(f))?(n[a]=l,l.__data__=o[a],c.delete(f)):t[a]=new Ii(r,o[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(d[a])===l&&(i[a]=l)}function CT(r){return r.__data__}function Kg(r,e){if(!arguments.length)return Array.from(this,CT);var t=e?OT:RT,n=this._parents,i=this._groups;typeof r!="function"&&(r=Fg(r));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=n[c],h=i[c],d=h.length,f=IT(r.call(u,u&&u.__data__,c,n)),y=f.length,_=a[c]=new Array(y),q=s[c]=new Array(y),k=l[c]=new Array(d);t(u,h,_,q,k,f,e);for(var O=0,U=0,L,D;O<y;++O)if(L=_[O]){for(O>=U&&(U=O+1);!(D=q[U])&&++U<y;);L._next=D||null}}return s=new ae(s,n),s._enter=a,s._exit=l,s}function IT(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function jg(){return new ae(this._exit||this._groups.map(Js),this._parents)}function Hg(r,e,t){var n=this.enter(),i=this,o=this.exit();return typeof r=="function"?(n=r(n),n&&(n=n.selection())):n=n.append(r+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?o.remove():t(o),n&&i?n.merge(i).order():i}function zg(r){for(var e=r.selection?r.selection():r,t=this._groups,n=e._groups,i=t.length,o=n.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var c=t[l],u=n[l],h=c.length,d=a[l]=new Array(h),f,y=0;y<h;++y)(f=c[y]||u[y])&&(d[y]=f);for(;l<i;++l)a[l]=t[l];return new ae(a,this._parents)}function Jg(){for(var r=this._groups,e=-1,t=r.length;++e<t;)for(var n=r[e],i=n.length-1,o=n[i],s;--i>=0;)(s=n[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function Zg(r){r||(r=MT);function e(h,d){return h&&d?r(h.__data__,d.__data__):!h-!d}for(var t=this._groups,n=t.length,i=new Array(n),o=0;o<n;++o){for(var s=t[o],a=s.length,l=i[o]=new Array(a),c,u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(e)}return new ae(i,this._parents).order()}function MT(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function Qg(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function Xg(){return Array.from(this)}function Yg(){for(var r=this._groups,e=0,t=r.length;e<t;++e)for(var n=r[e],i=0,o=n.length;i<o;++i){var s=n[i];if(s)return s}return null}function ev(){let r=0;for(let e of this)++r;return r}function tv(){return!this.node()}function rv(r){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],o=0,s=i.length,a;o<s;++o)(a=i[o])&&r.call(a,a.__data__,o,i);return this}function UT(r){return function(){this.removeAttribute(r)}}function PT(r){return function(){this.removeAttributeNS(r.space,r.local)}}function AT(r,e){return function(){this.setAttribute(r,e)}}function DT(r,e){return function(){this.setAttributeNS(r.space,r.local,e)}}function VT(r,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(r):this.setAttribute(r,t)}}function NT(r,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,t)}}function nv(r,e){var t=Bt(r);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((e==null?t.local?PT:UT:typeof e=="function"?t.local?NT:VT:t.local?DT:AT)(t,e))}function Zs(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function LT(r){return function(){this.style.removeProperty(r)}}function GT(r,e,t){return function(){this.style.setProperty(r,e,t)}}function WT(r,e,t){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(r):this.style.setProperty(r,n,t)}}function iv(r,e,t){return arguments.length>1?this.each((e==null?LT:typeof e=="function"?WT:GT)(r,e,t==null?"":t)):Kt(this.node(),r)}function Kt(r,e){return r.style.getPropertyValue(e)||Zs(r).getComputedStyle(r,null).getPropertyValue(e)}function FT(r){return function(){delete this[r]}}function KT(r,e){return function(){this[r]=e}}function jT(r,e){return function(){var t=e.apply(this,arguments);t==null?delete this[r]:this[r]=t}}function ov(r,e){return arguments.length>1?this.each((e==null?FT:typeof e=="function"?jT:KT)(r,e)):this.node()[r]}function sv(r){return r.trim().split(/^|\s+/)}function Nu(r){return r.classList||new av(r)}function av(r){this._node=r,this._names=sv(r.getAttribute("class")||"")}av.prototype={add:function(r){var e=this._names.indexOf(r);e<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var e=this._names.indexOf(r);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function lv(r,e){for(var t=Nu(r),n=-1,i=e.length;++n<i;)t.add(e[n])}function cv(r,e){for(var t=Nu(r),n=-1,i=e.length;++n<i;)t.remove(e[n])}function HT(r){return function(){lv(this,r)}}function zT(r){return function(){cv(this,r)}}function JT(r,e){return function(){(e.apply(this,arguments)?lv:cv)(this,r)}}function uv(r,e){var t=sv(r+"");if(arguments.length<2){for(var n=Nu(this.node()),i=-1,o=t.length;++i<o;)if(!n.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?JT:e?HT:zT)(t,e))}function ZT(){this.textContent=""}function QT(r){return function(){this.textContent=r}}function XT(r){return function(){var e=r.apply(this,arguments);this.textContent=e==null?"":e}}function hv(r){return arguments.length?this.each(r==null?ZT:(typeof r=="function"?XT:QT)(r)):this.node().textContent}function YT(){this.innerHTML=""}function eB(r){return function(){this.innerHTML=r}}function tB(r){return function(){var e=r.apply(this,arguments);this.innerHTML=e==null?"":e}}function dv(r){return arguments.length?this.each(r==null?YT:(typeof r=="function"?tB:eB)(r)):this.node().innerHTML}function rB(){this.nextSibling&&this.parentNode.appendChild(this)}function pv(){return this.each(rB)}function nB(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function fv(){return this.each(nB)}function mv(r){var e=typeof r=="function"?r:Hs(r);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function iB(){return null}function gv(r,e){var t=typeof r=="function"?r:Hs(r),n=e==null?iB:typeof e=="function"?e:kr(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function oB(){var r=this.parentNode;r&&r.removeChild(this)}function vv(){return this.each(oB)}function sB(){var r=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function aB(){var r=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function _v(r){return this.select(r?aB:sB)}function yv(r){return arguments.length?this.property("__data__",r):this.node().__data__}function lB(r){return function(e){r.call(this,e,this.__data__)}}function cB(r){return r.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function uB(r){return function(){var e=this.__on;if(e){for(var t=0,n=-1,i=e.length,o;t<i;++t)o=e[t],(!r.type||o.type===r.type)&&o.name===r.name?this.removeEventListener(o.type,o.listener,o.options):e[++n]=o;++n?e.length=n:delete this.__on}}}function hB(r,e,t){return function(){var n=this.__on,i,o=lB(e);if(n){for(var s=0,a=n.length;s<a;++s)if((i=n[s]).type===r.type&&i.name===r.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=t),i.value=e;return}}this.addEventListener(r.type,o,t),i={type:r.type,name:r.name,value:e,listener:o,options:t},n?n.push(i):this.__on=[i]}}function bv(r,e,t){var n=cB(r+""),i,o=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(i=0,u=a[l];i<o;++i)if((s=n[i]).type===u.type&&s.name===u.name)return u.value}return}for(a=e?hB:uB,i=0;i<o;++i)this.each(a(n[i],e,t));return this}function $v(r,e,t){var n=Zs(r),i=n.CustomEvent;typeof i=="function"?i=new i(e,t):(i=n.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),r.dispatchEvent(i)}function dB(r,e){return function(){return $v(this,r,e)}}function pB(r,e){return function(){return $v(this,r,e.apply(this,arguments))}}function wv(r,e){return this.each((typeof e=="function"?pB:dB)(r,e))}function*xv(){for(var r=this._groups,e=0,t=r.length;e<t;++e)for(var n=r[e],i=0,o=n.length,s;i<o;++i)(s=n[i])&&(yield s)}var fB=[null];function ae(r,e){this._groups=r,this._parents=e}function qv(){return new ae([[document.documentElement]],fB)}function mB(){return this}ae.prototype=qv.prototype={constructor:ae,select:Dg,selectAll:Vg,selectChild:Ng,selectChildren:Lg,filter:Gg,data:Kg,enter:Wg,exit:jg,join:Hg,merge:zg,selection:mB,order:Jg,sort:Zg,call:Qg,nodes:Xg,node:Yg,size:ev,empty:tv,each:rv,attr:nv,style:iv,property:ov,classed:uv,text:hv,html:dv,raise:pv,lower:fv,append:mv,insert:gv,remove:vv,clone:_v,datum:yv,on:bv,dispatch:wv,[Symbol.iterator]:xv};var St=qv;function Qs(r,e,t){r.prototype=e.prototype=t,t.constructor=r}function Lu(r,e){var t=Object.create(r.prototype);for(var n in e)t[n]=e[n];return t}function Pi(){}var Mi=.7,ea=1/Mi,fn="\\s*([+-]?\\d+)\\s*",Ui="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ft="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gB=/^#([0-9a-f]{3,8})$/,vB=new RegExp(`^rgb\\(${fn},${fn},${fn}\\)$`),_B=new RegExp(`^rgb\\(${ft},${ft},${ft}\\)$`),yB=new RegExp(`^rgba\\(${fn},${fn},${fn},${Ui}\\)$`),bB=new RegExp(`^rgba\\(${ft},${ft},${ft},${Ui}\\)$`),$B=new RegExp(`^hsl\\(${Ui},${ft},${ft}\\)$`),wB=new RegExp(`^hsla\\(${Ui},${ft},${ft},${Ui}\\)$`),Tv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Qs(Pi,jt,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:Bv,formatHex:Bv,formatHex8:xB,formatHsl:qB,formatRgb:Sv,toString:Sv});function Bv(){return this.rgb().formatHex()}function xB(){return this.rgb().formatHex8()}function qB(){return Iv(this).formatHsl()}function Sv(){return this.rgb().formatRgb()}function jt(r){var e,t;return r=(r+"").trim().toLowerCase(),(e=gB.exec(r))?(t=e[1].length,e=parseInt(e[1],16),t===6?Ev(e):t===3?new Ce(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Xs(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Xs(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=vB.exec(r))?new Ce(e[1],e[2],e[3],1):(e=_B.exec(r))?new Ce(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=yB.exec(r))?Xs(e[1],e[2],e[3],e[4]):(e=bB.exec(r))?Xs(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=$B.exec(r))?Ov(e[1],e[2]/100,e[3]/100,1):(e=wB.exec(r))?Ov(e[1],e[2]/100,e[3]/100,e[4]):Tv.hasOwnProperty(r)?Ev(Tv[r]):r==="transparent"?new Ce(NaN,NaN,NaN,0):null}function Ev(r){return new Ce(r>>16&255,r>>8&255,r&255,1)}function Xs(r,e,t,n){return n<=0&&(r=e=t=NaN),new Ce(r,e,t,n)}function TB(r){return r instanceof Pi||(r=jt(r)),r?(r=r.rgb(),new Ce(r.r,r.g,r.b,r.opacity)):new Ce}function mn(r,e,t,n){return arguments.length===1?TB(r):new Ce(r,e,t,n==null?1:n)}function Ce(r,e,t,n){this.r=+r,this.g=+e,this.b=+t,this.opacity=+n}Qs(Ce,mn,Lu(Pi,{brighter(r){return r=r==null?ea:Math.pow(ea,r),new Ce(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Mi:Math.pow(Mi,r),new Ce(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new Ce(Or(this.r),Or(this.g),Or(this.b),ta(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:kv,formatHex:kv,formatHex8:BB,formatRgb:Rv,toString:Rv}));function kv(){return`#${Rr(this.r)}${Rr(this.g)}${Rr(this.b)}`}function BB(){return`#${Rr(this.r)}${Rr(this.g)}${Rr(this.b)}${Rr((isNaN(this.opacity)?1:this.opacity)*255)}`}function Rv(){let r=ta(this.opacity);return`${r===1?"rgb(":"rgba("}${Or(this.r)}, ${Or(this.g)}, ${Or(this.b)}${r===1?")":`, ${r})`}`}function ta(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function Or(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Rr(r){return r=Or(r),(r<16?"0":"")+r.toString(16)}function Ov(r,e,t,n){return n<=0?r=e=t=NaN:t<=0||t>=1?r=e=NaN:e<=0&&(r=NaN),new lt(r,e,t,n)}function Iv(r){if(r instanceof lt)return new lt(r.h,r.s,r.l,r.opacity);if(r instanceof Pi||(r=jt(r)),!r)return new lt;if(r instanceof lt)return r;r=r.rgb();var e=r.r/255,t=r.g/255,n=r.b/255,i=Math.min(e,t,n),o=Math.max(e,t,n),s=NaN,a=o-i,l=(o+i)/2;return a?(e===o?s=(t-n)/a+(t<n)*6:t===o?s=(n-e)/a+2:s=(e-t)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new lt(s,a,l,r.opacity)}function Mv(r,e,t,n){return arguments.length===1?Iv(r):new lt(r,e,t,n==null?1:n)}function lt(r,e,t,n){this.h=+r,this.s=+e,this.l=+t,this.opacity=+n}Qs(lt,Mv,Lu(Pi,{brighter(r){return r=r==null?ea:Math.pow(ea,r),new lt(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Mi:Math.pow(Mi,r),new lt(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,e=isNaN(r)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*e,i=2*t-n;return new Ce(Gu(r>=240?r-240:r+120,i,n),Gu(r,i,n),Gu(r<120?r+240:r-120,i,n),this.opacity)},clamp(){return new lt(Cv(this.h),Ys(this.s),Ys(this.l),ta(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let r=ta(this.opacity);return`${r===1?"hsl(":"hsla("}${Cv(this.h)}, ${Ys(this.s)*100}%, ${Ys(this.l)*100}%${r===1?")":`, ${r})`}`}}));function Cv(r){return r=(r||0)%360,r<0?r+360:r}function Ys(r){return Math.max(0,Math.min(1,r||0))}function Gu(r,e,t){return(r<60?e+(t-e)*r/60:r<180?t:r<240?e+(t-e)*(240-r)/60:e)*255}function Wu(r,e,t,n,i){var o=r*r,s=o*r;return((1-3*r+3*o-s)*e+(4-6*o+3*s)*t+(1+3*r+3*o-3*s)*n+s*i)/6}function Uv(r){var e=r.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,e-1):Math.floor(t*e),i=r[n],o=r[n+1],s=n>0?r[n-1]:2*i-o,a=n<e-1?r[n+2]:2*o-i;return Wu((t-n/e)*e,s,i,o,a)}}function Pv(r){var e=r.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*e),i=r[(n+e-1)%e],o=r[n%e],s=r[(n+1)%e],a=r[(n+2)%e];return Wu((t-n/e)*e,i,o,s,a)}}var Fu=r=>()=>r;function SB(r,e){return function(t){return r+t*e}}function EB(r,e,t){return r=Math.pow(r,t),e=Math.pow(e,t)-r,t=1/t,function(n){return Math.pow(r+n*e,t)}}function Av(r){return(r=+r)==1?ra:function(e,t){return t-e?EB(e,t,r):Fu(isNaN(e)?t:e)}}function ra(r,e){var t=e-r;return t?SB(r,t):Fu(isNaN(r)?e:r)}var na=function r(e){var t=Av(e);function n(i,o){var s=t((i=mn(i)).r,(o=mn(o)).r),a=t(i.g,o.g),l=t(i.b,o.b),c=ra(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return n.gamma=r,n}(1);function Dv(r){return function(e){var t=e.length,n=new Array(t),i=new Array(t),o=new Array(t),s,a;for(s=0;s<t;++s)a=mn(e[s]),n[s]=a.r||0,i[s]=a.g||0,o[s]=a.b||0;return n=r(n),i=r(i),o=r(o),a.opacity=1,function(l){return a.r=n(l),a.g=i(l),a.b=o(l),a+""}}}var kB=Dv(Uv),RB=Dv(Pv);function Ze(r,e){return r=+r,e=+e,function(t){return r*(1-t)+e*t}}var ju=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ku=new RegExp(ju.source,"g");function OB(r){return function(){return r}}function CB(r){return function(e){return r(e)+""}}function Hu(r,e){var t=ju.lastIndex=Ku.lastIndex=0,n,i,o,s=-1,a=[],l=[];for(r=r+"",e=e+"";(n=ju.exec(r))&&(i=Ku.exec(e));)(o=i.index)>t&&(o=e.slice(t,o),a[s]?a[s]+=o:a[++s]=o),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:Ze(n,i)})),t=Ku.lastIndex;return t<e.length&&(o=e.slice(t),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?CB(l[0].x):OB(e):(e=l.length,function(c){for(var u=0,h;u<e;++u)a[(h=l[u]).i]=h.x(c);return a.join("")})}var Vv=180/Math.PI,ia={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function zu(r,e,t,n,i,o){var s,a,l;return(s=Math.sqrt(r*r+e*e))&&(r/=s,e/=s),(l=r*t+e*n)&&(t-=r*l,n-=e*l),(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a,l/=a),r*n<e*t&&(r=-r,e=-e,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(e,r)*Vv,skewX:Math.atan(l)*Vv,scaleX:s,scaleY:a}}var oa;function Nv(r){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(r+"");return e.isIdentity?ia:zu(e.a,e.b,e.c,e.d,e.e,e.f)}function Lv(r){return r==null?ia:(oa||(oa=document.createElementNS("http://www.w3.org/2000/svg","g")),oa.setAttribute("transform",r),(r=oa.transform.baseVal.consolidate())?(r=r.matrix,zu(r.a,r.b,r.c,r.d,r.e,r.f)):ia)}function Gv(r,e,t,n){function i(c){return c.length?c.pop()+" ":""}function o(c,u,h,d,f,y){if(c!==h||u!==d){var _=f.push("translate(",null,e,null,t);y.push({i:_-4,x:Ze(c,h)},{i:_-2,x:Ze(u,d)})}else(h||d)&&f.push("translate("+h+e+d+t)}function s(c,u,h,d){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),d.push({i:h.push(i(h)+"rotate(",null,n)-2,x:Ze(c,u)})):u&&h.push(i(h)+"rotate("+u+n)}function a(c,u,h,d){c!==u?d.push({i:h.push(i(h)+"skewX(",null,n)-2,x:Ze(c,u)}):u&&h.push(i(h)+"skewX("+u+n)}function l(c,u,h,d,f,y){if(c!==h||u!==d){var _=f.push(i(f)+"scale(",null,",",null,")");y.push({i:_-4,x:Ze(c,h)},{i:_-2,x:Ze(u,d)})}else(h!==1||d!==1)&&f.push(i(f)+"scale("+h+","+d+")")}return function(c,u){var h=[],d=[];return c=r(c),u=r(u),o(c.translateX,c.translateY,u.translateX,u.translateY,h,d),s(c.rotate,u.rotate,h,d),a(c.skewX,u.skewX,h,d),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,d),c=u=null,function(f){for(var y=-1,_=d.length,q;++y<_;)h[(q=d[y]).i]=q.x(f);return h.join("")}}}var Ju=Gv(Nv,"px, ","px)","deg)"),Zu=Gv(Lv,", ",")",")");var gn=0,Di=0,Ai=0,Fv=1e3,sa,Vi,aa=0,Cr=0,la=0,Ni=typeof performance=="object"&&performance.now?performance:Date,Kv=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function Gi(){return Cr||(Kv(IB),Cr=Ni.now()+la)}function IB(){Cr=0}function Li(){this._call=this._time=this._next=null}Li.prototype=ca.prototype={constructor:Li,restart:function(r,e,t){if(typeof r!="function")throw new TypeError("callback is not a function");t=(t==null?Gi():+t)+(e==null?0:+e),!this._next&&Vi!==this&&(Vi?Vi._next=this:sa=this,Vi=this),this._call=r,this._time=t,Qu()},stop:function(){this._call&&(this._call=null,this._time=1/0,Qu())}};function ca(r,e,t){var n=new Li;return n.restart(r,e,t),n}function jv(){Gi(),++gn;for(var r=sa,e;r;)(e=Cr-r._time)>=0&&r._call.call(void 0,e),r=r._next;--gn}function Wv(){Cr=(aa=Ni.now())+la,gn=Di=0;try{jv()}finally{gn=0,UB(),Cr=0}}function MB(){var r=Ni.now(),e=r-aa;e>Fv&&(la-=e,aa=r)}function UB(){for(var r,e=sa,t,n=1/0;e;)e._call?(n>e._time&&(n=e._time),r=e,e=e._next):(t=e._next,e._next=null,e=r?r._next=t:sa=t);Vi=r,Qu(n)}function Qu(r){if(!gn){Di&&(Di=clearTimeout(Di));var e=r-Cr;e>24?(r<1/0&&(Di=setTimeout(Wv,r-Ni.now()-la)),Ai&&(Ai=clearInterval(Ai))):(Ai||(aa=Ni.now(),Ai=setInterval(MB,Fv)),gn=1,Kv(Wv))}}function ua(r,e,t){var n=new Li;return e=e==null?0:+e,n.restart(i=>{n.stop(),r(i+e)},e,t),n}var PB=Au("start","end","cancel","interrupt"),AB=[],Jv=0,Hv=1,da=2,ha=3,zv=4,pa=5,Wi=6;function Ht(r,e,t,n,i,o){var s=r.__transition;if(!s)r.__transition={};else if(t in s)return;DB(r,t,{name:e,index:n,group:i,on:PB,tween:AB,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Jv})}function Fi(r,e){var t=le(r,e);if(t.state>Jv)throw new Error("too late; already scheduled");return t}function fe(r,e){var t=le(r,e);if(t.state>ha)throw new Error("too late; already running");return t}function le(r,e){var t=r.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function DB(r,e,t){var n=r.__transition,i;n[e]=t,t.timer=ca(o,0,t.time);function o(c){t.state=Hv,t.timer.restart(s,t.delay,t.time),t.delay<=c&&s(c-t.delay)}function s(c){var u,h,d,f;if(t.state!==Hv)return l();for(u in n)if(f=n[u],f.name===t.name){if(f.state===ha)return ua(s);f.state===zv?(f.state=Wi,f.timer.stop(),f.on.call("interrupt",r,r.__data__,f.index,f.group),delete n[u]):+u<e&&(f.state=Wi,f.timer.stop(),f.on.call("cancel",r,r.__data__,f.index,f.group),delete n[u])}if(ua(function(){t.state===ha&&(t.state=zv,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=da,t.on.call("start",r,r.__data__,t.index,t.group),t.state===da){for(t.state=ha,i=new Array(d=t.tween.length),u=0,h=-1;u<d;++u)(f=t.tween[u].value.call(r,r.__data__,t.index,t.group))&&(i[++h]=f);i.length=h+1}}function a(c){for(var u=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=pa,1),h=-1,d=i.length;++h<d;)i[h].call(r,u);t.state===pa&&(t.on.call("end",r,r.__data__,t.index,t.group),l())}function l(){t.state=Wi,t.timer.stop(),delete n[e];for(var c in n)return;delete r.__transition}}function fa(r,e){var t=r.__transition,n,i,o=!0,s;if(t){e=e==null?null:e+"";for(s in t){if((n=t[s]).name!==e){o=!1;continue}i=n.state>da&&n.state<pa,n.state=Wi,n.timer.stop(),n.on.call(i?"interrupt":"cancel",r,r.__data__,n.index,n.group),delete t[s]}o&&delete r.__transition}}function Zv(r){return this.each(function(){fa(this,r)})}function VB(r,e){var t,n;return function(){var i=fe(this,r),o=i.tween;if(o!==t){n=t=o;for(var s=0,a=n.length;s<a;++s)if(n[s].name===e){n=n.slice(),n.splice(s,1);break}}i.tween=n}}function NB(r,e,t){var n,i;if(typeof t!="function")throw new Error;return function(){var o=fe(this,r),s=o.tween;if(s!==n){i=(n=s).slice();for(var a={name:e,value:t},l=0,c=i.length;l<c;++l)if(i[l].name===e){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function Qv(r,e){var t=this._id;if(r+="",arguments.length<2){for(var n=le(this.node(),t).tween,i=0,o=n.length,s;i<o;++i)if((s=n[i]).name===r)return s.value;return null}return this.each((e==null?VB:NB)(t,r,e))}function vn(r,e,t){var n=r._id;return r.each(function(){var i=fe(this,n);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return le(i,n).value[e]}}function ma(r,e){var t;return(typeof e=="number"?Ze:e instanceof jt?na:(t=jt(e))?(e=t,na):Hu)(r,e)}function LB(r){return function(){this.removeAttribute(r)}}function GB(r){return function(){this.removeAttributeNS(r.space,r.local)}}function WB(r,e,t){var n,i=t+"",o;return function(){var s=this.getAttribute(r);return s===i?null:s===n?o:o=e(n=s,t)}}function FB(r,e,t){var n,i=t+"",o;return function(){var s=this.getAttributeNS(r.space,r.local);return s===i?null:s===n?o:o=e(n=s,t)}}function KB(r,e,t){var n,i,o;return function(){var s,a=t(this),l;return a==null?void this.removeAttribute(r):(s=this.getAttribute(r),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=e(n=s,a)))}}function jB(r,e,t){var n,i,o;return function(){var s,a=t(this),l;return a==null?void this.removeAttributeNS(r.space,r.local):(s=this.getAttributeNS(r.space,r.local),l=a+"",s===l?null:s===n&&l===i?o:(i=l,o=e(n=s,a)))}}function Xv(r,e){var t=Bt(r),n=t==="transform"?Zu:ma;return this.attrTween(r,typeof e=="function"?(t.local?jB:KB)(t,n,vn(this,"attr."+r,e)):e==null?(t.local?GB:LB)(t):(t.local?FB:WB)(t,n,e))}function HB(r,e){return function(t){this.setAttribute(r,e.call(this,t))}}function zB(r,e){return function(t){this.setAttributeNS(r.space,r.local,e.call(this,t))}}function JB(r,e){var t,n;function i(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&zB(r,o)),t}return i._value=e,i}function ZB(r,e){var t,n;function i(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&HB(r,o)),t}return i._value=e,i}function Yv(r,e){var t="attr."+r;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var n=Bt(r);return this.tween(t,(n.local?JB:ZB)(n,e))}function QB(r,e){return function(){Fi(this,r).delay=+e.apply(this,arguments)}}function XB(r,e){return e=+e,function(){Fi(this,r).delay=e}}function e_(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?QB:XB)(e,r)):le(this.node(),e).delay}function YB(r,e){return function(){fe(this,r).duration=+e.apply(this,arguments)}}function eS(r,e){return e=+e,function(){fe(this,r).duration=e}}function t_(r){var e=this._id;return arguments.length?this.each((typeof r=="function"?YB:eS)(e,r)):le(this.node(),e).duration}function tS(r,e){if(typeof e!="function")throw new Error;return function(){fe(this,r).ease=e}}function r_(r){var e=this._id;return arguments.length?this.each(tS(e,r)):le(this.node(),e).ease}function rS(r,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;fe(this,r).ease=t}}function n_(r){if(typeof r!="function")throw new Error;return this.each(rS(this._id,r))}function i_(r){typeof r!="function"&&(r=Ci(r));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var o=e[i],s=o.length,a=n[i]=[],l,c=0;c<s;++c)(l=o[c])&&r.call(l,l.__data__,c,o)&&a.push(l);return new qe(n,this._parents,this._name,this._id)}function o_(r){if(r._id!==this._id)throw new Error;for(var e=this._groups,t=r._groups,n=e.length,i=t.length,o=Math.min(n,i),s=new Array(n),a=0;a<o;++a)for(var l=e[a],c=t[a],u=l.length,h=s[a]=new Array(u),d,f=0;f<u;++f)(d=l[f]||c[f])&&(h[f]=d);for(;a<n;++a)s[a]=e[a];return new qe(s,this._parents,this._name,this._id)}function nS(r){return(r+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function iS(r,e,t){var n,i,o=nS(e)?Fi:fe;return function(){var s=o(this,r),a=s.on;a!==n&&(i=(n=a).copy()).on(e,t),s.on=i}}function s_(r,e){var t=this._id;return arguments.length<2?le(this.node(),t).on.on(r):this.each(iS(t,r,e))}function oS(r){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==r)return;e&&e.removeChild(this)}}function a_(){return this.on("end.remove",oS(this._id))}function l_(r){var e=this._name,t=this._id;typeof r!="function"&&(r=kr(r));for(var n=this._groups,i=n.length,o=new Array(i),s=0;s<i;++s)for(var a=n[s],l=a.length,c=o[s]=new Array(l),u,h,d=0;d<l;++d)(u=a[d])&&(h=r.call(u,u.__data__,d,a))&&("__data__"in u&&(h.__data__=u.__data__),c[d]=h,Ht(c[d],e,t,d,c,le(u,t)));return new qe(o,this._parents,e,t)}function c_(r){var e=this._name,t=this._id;typeof r!="function"&&(r=Oi(r));for(var n=this._groups,i=n.length,o=[],s=[],a=0;a<i;++a)for(var l=n[a],c=l.length,u,h=0;h<c;++h)if(u=l[h]){for(var d=r.call(u,u.__data__,h,l),f,y=le(u,t),_=0,q=d.length;_<q;++_)(f=d[_])&&Ht(f,e,t,_,d,y);o.push(d),s.push(u)}return new qe(o,s,e,t)}var sS=St.prototype.constructor;function u_(){return new sS(this._groups,this._parents)}function aS(r,e){var t,n,i;return function(){var o=Kt(this,r),s=(this.style.removeProperty(r),Kt(this,r));return o===s?null:o===t&&s===n?i:i=e(t=o,n=s)}}function h_(r){return function(){this.style.removeProperty(r)}}function lS(r,e,t){var n,i=t+"",o;return function(){var s=Kt(this,r);return s===i?null:s===n?o:o=e(n=s,t)}}function cS(r,e,t){var n,i,o;return function(){var s=Kt(this,r),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(r),Kt(this,r))),s===l?null:s===n&&l===i?o:(i=l,o=e(n=s,a))}}function uS(r,e){var t,n,i,o="style."+e,s="end."+o,a;return function(){var l=fe(this,r),c=l.on,u=l.value[o]==null?a||(a=h_(e)):void 0;(c!==t||i!==u)&&(n=(t=c).copy()).on(s,i=u),l.on=n}}function d_(r,e,t){var n=(r+="")=="transform"?Ju:ma;return e==null?this.styleTween(r,aS(r,n)).on("end.style."+r,h_(r)):typeof e=="function"?this.styleTween(r,cS(r,n,vn(this,"style."+r,e))).each(uS(this._id,r)):this.styleTween(r,lS(r,n,e),t).on("end.style."+r,null)}function hS(r,e,t){return function(n){this.style.setProperty(r,e.call(this,n),t)}}function dS(r,e,t){var n,i;function o(){var s=e.apply(this,arguments);return s!==i&&(n=(i=s)&&hS(r,s,t)),n}return o._value=e,o}function p_(r,e,t){var n="style."+(r+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,dS(r,e,t==null?"":t))}function pS(r){return function(){this.textContent=r}}function fS(r){return function(){var e=r(this);this.textContent=e==null?"":e}}function f_(r){return this.tween("text",typeof r=="function"?fS(vn(this,"text",r)):pS(r==null?"":r+""))}function mS(r){return function(e){this.textContent=r.call(this,e)}}function gS(r){var e,t;function n(){var i=r.apply(this,arguments);return i!==t&&(e=(t=i)&&mS(i)),e}return n._value=r,n}function m_(r){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(r==null)return this.tween(e,null);if(typeof r!="function")throw new Error;return this.tween(e,gS(r))}function g_(){for(var r=this._name,e=this._id,t=ga(),n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)if(l=s[c]){var u=le(l,e);Ht(l,r,t,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new qe(n,this._parents,r,t)}function v_(){var r,e,t=this,n=t._id,i=t.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};t.each(function(){var c=fe(this,n),u=c.on;u!==r&&(e=(r=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),i===0&&o()})}var vS=0;function qe(r,e,t,n){this._groups=r,this._parents=e,this._name=t,this._id=n}function __(r){return St().transition(r)}function ga(){return++vS}var Et=St.prototype;qe.prototype=__.prototype={constructor:qe,select:l_,selectAll:c_,selectChild:Et.selectChild,selectChildren:Et.selectChildren,filter:i_,merge:o_,selection:u_,transition:g_,call:Et.call,nodes:Et.nodes,node:Et.node,size:Et.size,empty:Et.empty,each:Et.each,on:s_,attr:Xv,attrTween:Yv,style:d_,styleTween:p_,text:f_,textTween:m_,remove:a_,tween:Qv,delay:e_,duration:t_,ease:r_,easeVarying:n_,end:v_,[Symbol.iterator]:Et[Symbol.iterator]};function va(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var _S={time:null,delay:0,duration:250,ease:va};function yS(r,e){for(var t;!(t=r.__transition)||!(t=t[e]);)if(!(r=r.parentNode))throw new Error(`transition ${e} not found`);return t}function y_(r){var e,t;r instanceof qe?(e=r._id,r=r._name):(e=ga(),(t=_S).time=Gi(),r=r==null?null:r+"");for(var n=this._groups,i=n.length,o=0;o<i;++o)for(var s=n[o],a=s.length,l,c=0;c<a;++c)(l=s[c])&&Ht(l,r,e,c,s,t||yS(l,e));return new qe(n,this._parents,r,e)}St.prototype.interrupt=Zv;St.prototype.transition=y_;var{abs:Ej,max:kj,min:Rj}=Math;function b_(r){return[+r[0],+r[1]]}function bS(r){return[b_(r[0]),b_(r[1])]}var Oj={name:"x",handles:["w","e"].map(Xu),input:function(r,e){return r==null?null:[[+r[0],e[0][1]],[+r[1],e[1][1]]]},output:function(r){return r&&[r[0][0],r[1][0]]}},Cj={name:"y",handles:["n","s"].map(Xu),input:function(r,e){return r==null?null:[[e[0][0],+r[0]],[e[1][0],+r[1]]]},output:function(r){return r&&[r[0][1],r[1][1]]}},Ij={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(Xu),input:function(r){return r==null?null:bS(r)},output:function(r){return r}};function Xu(r){return{type:r}}var Yu=Math.PI,eh=2*Yu,Ir=1e-6,$S=eh-Ir;function $_(r){this._+=r[0];for(let e=1,t=r.length;e<t;++e)this._+=arguments[e]+r[e]}function wS(r){let e=Math.floor(r);if(!(e>=0))throw new Error(`invalid digits: ${r}`);if(e>15)return $_;let t=jo(10,e);return function(n){this._+=n[0];for(let i=1,o=n.length;i<o;++i)this._+=Math.round(arguments[i]*t)/t+n[i]}}var Ki=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?$_:wS(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,i){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(e,t,n,i,o,s){this._append`C${+e},${+t},${+n},${+i},${this._x1=+o},${this._y1=+s}`}arcTo(e,t,n,i,o){if(e=+e,t=+t,n=+n,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,l=n-e,c=i-t,u=s-e,h=a-t,d=u*u+h*h;if(this._x1===null)this._append`M${this._x1=e},${this._y1=t}`;else if(d>Ir)if(!(Math.abs(h*l-c*u)>Ir)||!o)this._append`L${this._x1=e},${this._y1=t}`;else{let f=n-s,y=i-a,_=l*l+c*c,q=f*f+y*y,k=Math.sqrt(_),O=Math.sqrt(d),U=o*Math.tan((Yu-Math.acos((_+d-q)/(2*k*O)))/2),L=U/O,D=U/k;Math.abs(L-1)>Ir&&this._append`L${e+L*u},${t+L*h}`,this._append`A${o},${o},0,0,${+(h*f>u*y)},${this._x1=e+D*l},${this._y1=t+D*c}`}}arc(e,t,n,i,o,s){if(e=+e,t=+t,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(i),l=n*Math.sin(i),c=e+a,u=t+l,h=1^s,d=s?i-o:o-i;this._x1===null?this._append`M${c},${u}`:(Math.abs(this._x1-c)>Ir||Math.abs(this._y1-u)>Ir)&&this._append`L${c},${u}`,n&&(d<0&&(d=d%eh+eh),d>$S?this._append`A${n},${n},0,1,${h},${e-a},${t-l}A${n},${n},0,1,${h},${this._x1=c},${this._y1=u}`:d>Ir&&this._append`A${n},${n},0,${+(d>=Yu)},${h},${this._x1=e+n*Math.cos(o)},${this._y1=t+n*Math.sin(o)}`)}rect(e,t,n,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}};function _a(){return new Ki}_a.prototype=Ki.prototype;function zt(r,e,t){this.k=r,this.x=e,this.y=t}zt.prototype={constructor:zt,scale:function(r){return r===1?this:new zt(this.k*r,this.x,this.y)},translate:function(r,e){return r===0&e===0?this:new zt(this.k,this.x+this.k*r,this.y+this.k*e)},apply:function(r){return[r[0]*this.k+this.x,r[1]*this.k+this.y]},applyX:function(r){return r*this.k+this.x},applyY:function(r){return r*this.k+this.y},invert:function(r){return[(r[0]-this.x)/this.k,(r[1]-this.y)/this.k]},invertX:function(r){return(r-this.x)/this.k},invertY:function(r){return(r-this.y)/this.k},rescaleX:function(r){return r.copy().domain(r.range().map(this.invertX,this).map(r.invert,r))},rescaleY:function(r){return r.copy().domain(r.range().map(this.invertY,this).map(r.invert,r))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var th=new zt(1,0,0);rh.prototype=zt.prototype;function rh(r){for(;!r.__zoom;)if(!(r=r.parentNode))return th;return r.__zoom}function w_(){if(pe.Path2D){class r extends pe.Path2D{constructor(t){super(t),this.path=t,this._d3Path=_a();let n=Object.getPrototypeOf(this),i=Object.getPrototypeOf(n),o=Object.getOwnPropertyDescriptors(i),s=Object.getPrototypeOf(this._d3Path),a=Object.getOwnPropertyDescriptors(s);return Object.keys(o).forEach(l=>{Object.defineProperty(this,l,{writable:!0,value:(...c)=>(Reflect.apply(a[l].value,this._d3Path,c),Reflect.apply(o[l].value,this,c))})}),this}toJSON(){return{type:"Path2D",value:this._d3Path.toString()}}}return r.CANVAS_OBSERVER_PROXYED_PATH2D=!0,r}return null}function ya(r){return r!=null&&r.CANVAS_OBSERVER_PROXYED_PATH2D===!0}var ba=class{constructor(e){this._stringRecorder=[];let{canvas:t}=e;this._stringRecorder=[],this._canvas=t}decode(e){return V(this,null,function*(){let{api:t,args:n}=e,i=pn[t],o=i==="setAttr"?yield this.decodeAttr(n):this.decodeArgs(n);if(i==="stroke"&&o.length&&!ya(o[0]))throw new Error("argument type invalid, Path2D is not ProxyPath2D");return{api:i,args:o||[]}})}decodeAttr(e){return V(this,null,function*(){let t=[],n=0;for(;n<e.length-1;){let i=e[n],o=e[n+1];if(Ws.includes(Sr[i])&&typeof o=="string"||typeof o=="number")if(typeof o=="number"){let s=this._stringRecorder[o];t.push({key:Sr[i],value:s})}else t.push({key:Sr[i],value:o}),this._stringRecorder.push(o);else(o==null?void 0:o.type)==="ProxyLinearGradient"?t.push({key:Sr[i],value:qS(o.value,this._canvas)}):(o==null?void 0:o.type)==="ProxyPattern"?t.push({key:Sr[i],value:yield TS(o.value,this._canvas)}):t.push({key:Sr[i],value:o});n+=2}return t})}decodeArgs(e){return e!=null&&e.map?e.map(t=>xS(t)?new pe.Path2D(t.value):t):e}};function xS(r){return(r==null?void 0:r.type)==="Path2D"}function qS(r,e){let t=e.getContext("2d");if(!t)return null;let n=r[0],i=t.createLinearGradient(n[0],n[1],n[2],n[3]);for(let o=1;o<r.length;o++){let s=r[o];i.addColorStop(s[0],s[1])}return i}function TS(r,e){return V(this,null,function*(){var t,n;let i=e.getContext("2d");if(!i)return null;let o=(t=r[0])!==null&&t!==void 0?t:[],s=yield ki.deserialize((n=o[0])===null||n===void 0?void 0:n.src);if(!s)return;let a=i.createPattern(s,o[1]);if(a)for(let l=1;l<r.length;l++){let c=r[l];c&&a.setTransform(Mg(c))}return a})}var wa=class{constructor(e){this._prevApi=-1,this._instructionsQueue=[],this._executePromise=null;let{canvas:t}=e;this._canvas=t,this._decoder=new ba({canvas:t})}get canvas(){return this._canvas}execute(e){e!=null&&e.length&&(this._instructionsQueue.length?this._instructionsQueue.push(...e):(this._instructionsQueue.push(...e),this._execute()))}_execute(){return V(this,null,function*(){for(;this._instructionsQueue.length;){let e=this._instructionsQueue.shift();if(x_(e)){let n=e;if(this._instructionsQueue.length>0&&$a(this._instructionsQueue[0])){let o=this._instructionsQueue.shift();yield this.executeOne({api:n,args:o}),this._executePromise=null}else yield this.executeOne({api:n,args:[]}),this._executePromise=null;this._prevApi=n}else $a(e)?(yield this.executeOne({api:this._prevApi,args:e}),this._executePromise=null):console.log("sth error")}})}executeOne(e){return V(this,null,function*(){return this._executePromise=new Promise((t,n)=>V(this,null,function*(){var i,o,s;let a=(o=(i=this._canvas)===null||i===void 0?void 0:i.getContext)===null||o===void 0?void 0:o.call(i,"2d");if(!this._decoder||!this._canvas||!a){n(-1);return}try{let{api:l,args:c}=yield this._decoder.decode(e);if(!(l!=null&&l.length))console.log("invalid api"),t(-1);else if(l==="setAttr"){for(let u=0;u<c.length;u++){let{key:h,value:d}=c[u];a[h]=d}t(1)}else if(l==="snapshot")ki.deserialize(c).then(u=>{a.drawImage(u,0,0),t(1)});else if(l==="lineTo"){let u=0;for(;u<c.length-1;){let h=c[u],d=c[u+1];a[l].apply(a,[h,d]),u+=2}t(1)}else l==="drawImage"&&Array.isArray(c)&&(!((s=c[0])===null||s===void 0)&&s.src)?ki.deserialize(c[0].src).then(u=>{c[0].__drawFullPage&&a.clearRect(0,0,this._canvas.width,this._canvas.height),a.drawImage(u,...c.slice(1)),t(1)}):(a[l].apply(a,[...c]),t(1))}catch(l){localStorage&&localStorage.bytereplay_debug&&console.error("[bytereplay] Execute canvas command error",l,{instruction:e}),t(-1)}})),this._executePromise})}snapshot(){return V(this,null,function*(){if(this.canvas instanceof OffscreenCanvas){let e=yield this.canvas.convertToBlob({type:"image/png",quality:1});return yield new Promise(n=>{let i=new FileReader;i.addEventListener("load",()=>n(i.result)),i.readAsDataURL(e)})}else return this.canvas.toDataURL("image/png",1)})}decode(e){return V(this,null,function*(){let t=[];if(!(e!=null&&e.length)||!this._decoder)return t;let n=[...e];for(;n.length;){let i=n.shift();if(x_(i)){let s=i;if(n.length>0&&$a(n[0])){let l=n.shift();t.push(yield this._decoder.decode({api:s,args:l}))}else t.push(yield this._decoder.decode({api:s,args:[]}));this._prevApi=s}else $a(i)?t.push(yield this._decoder.decode({api:this._prevApi,args:i})):console.log("sth error")}return t})}};function x_(r){return typeof r=="string"||typeof r=="undefined"?!1:pn[r]==="setAttr"||pn[r]==="snapshot"||Ei.includes(pn[r])}function $a(r){return!!(typeof r=="object"||typeof r=="string"&&r.startsWith("data:"))}var nh=Ug(()=>{if(pe.CanvasRenderingContext2D){let r=CanvasRenderingContext2D.prototype.createLinearGradient;CanvasRenderingContext2D.prototype.createLinearGradient=function(...t){let n=r.apply(this,t),i=n.addColorStop;return n._values=[t],n._type="ProxyLinearGradient",n.addColorStop=(...o)=>{i.apply(n,o),n._values.push(o)},n};let e=CanvasRenderingContext2D.prototype.createPattern;if(CanvasRenderingContext2D.prototype.createPattern=function(...t){let n=e.apply(this,t);if(!n)return null;let i=n.setTransform;return n._type="ProxyPattern",n._values=[[Ri.serialize(t[0]),t[1]]],n.setTransform=o=>{i.apply(n,[o]),o&&(n._values[1]=Ig(o))},n},pe.Path2D&&!ya(pe.Path2D)){let t=w_();t&&(pe.Path2D=t)}}});var xa=class{constructor(e){this.canvas=null,this.callback=()=>{},this.lastCtxAttrs=[],this.originApis=null,this.wrappedApis=null,this.sampler=null;let{canvas:t,callback:n,sampler:i}=e;this.canvas=t,this.callback=n,this.originApis=new Map,this.wrappedApis=new Map,this.sampler=i}observe(e){if(!this.canvas)return;let t=this.canvas.getContext("2d");Mu.forEach(n=>{this.lastCtxAttrs.push({key:n,value:t[n]})}),this.callback({api:"setAttr",args:this.lastCtxAttrs}),this.context2DWrapper(this.canvas),e!=null&&e.snapshot&&this.callback({api:"snapshot",args:this.getSnapshot()})}disconnect(){if(!this.canvas)return;let e=this.canvas.getContext("2d");Ei.forEach(t=>{this.wrappedApis.get(t)===e[t]&&(e[t]=this.originApis.get(t))}),this.sampler.close()}getSnapshot(){if(this.canvas)return String(this.canvas.toDataURL("image/png",1))}context2DWrapper(e){let t=this,n=e.getContext("2d");Ei.forEach(i=>{let o=n[i],s=function(...a){if(Og[i]){let c=t.getChangedAttrs(n);c!=null&&c.length&&t.callback({api:"setAttr",args:c})}return t.callback({api:i,args:a}),o.apply(n,[...a])};this.originApis.set(i,o),this.wrappedApis.set(i,s),n[i]=s})}getChangedAttrs(e){let t=[];return Mu.forEach(n=>{this.lastCtxAttrs[n]!==e[n]&&(t.push({key:n,value:e[n]}),this.lastCtxAttrs[n]=e[n])}),t}};var qa=class{constructor(){this.stringRecorder=[],this.stringRecorder=[]}encode(e,t){var n;let i=Iu[e];if(t!=null&&t.length||t&&(!((n=Object.keys(t))===null||n===void 0)&&n.length)){let o=e==="setAttr"?this.encodeAttr(t):this.encodeArgs(t);return[i,o]}else return[i]}encodeAttr(e){let t=[];return e.forEach(n=>{let{key:i,value:o}=n;Ws.includes(i)&&typeof o=="string"?this.stringRecorder.includes(o)?t.push(Br[i],this.stringRecorder.indexOf(o)):(this.stringRecorder.push(o),t.push(Br[i],o)):(o==null?void 0:o._type)==="ProxyLinearGradient"?t.push(Br[i],{type:"ProxyLinearGradient",value:o._values}):(o==null?void 0:o._type)==="ProxyPattern"?t.push(Br[i],{type:"ProxyPattern",value:o._values}):t.push(Br[i],o)}),t}encodeArgs(e){return e!=null&&e.map?e.map(t=>t!=null&&t._d3Path?t.toJSON():Ri.isCanvasImageSource(t)?Ri.serialize(t):t):e}};var Ta=class{constructor(e){let{callback:t,canvas:n}=e;this._canvas=n,this._records=[],this._callback=t,this._encoder=new qa,this._animationHandle=pe.requestAnimationFrame(i=>this.producer())}sample(e){this._records.push(e)}close(){pe.cancelAnimationFrame(this._animationHandle)}producer(){let e=this._sample(this._records);this._callback(e,this._canvas),this._records=[],this._animationHandle=pe.requestAnimationFrame(()=>this.producer())}_sample(e){var t;if(!(e!=null&&e.length))return[];let n=[],i=0,o=[];for(;i<e.length;){let a=e[i],l=i===e.length-1?{api:""}:e[i+1],c=a.api===l.api&&SS(a.api),u=a.api===l.api&&a.api==="lineTo";if(!c){let h=a.api,{args:d}=a;h==="clip"&&typeof d[0]!="undefined"&&typeof d[1]=="undefined"&&(a.args=[d[0]]),d=(t=d==null?void 0:d.map)===null||t===void 0?void 0:t.call(d,f=>typeof f=="number"?BS(f):f),u?o.push(...d):h==="lineTo"?(n.push({api:h,args:[...o,...d]}),o=[]):n.push({api:h,args:a.args})}i++}let s=[];return n.forEach(a=>{let{api:l,args:c}=a,u=this._encoder.encode(l,c);s.push(...u)}),s}},BS=r=>Number(r.toString().match(/^\d+(?:\.\d{0,2})?/)),SS=r=>Cg.includes(r);var ih=class{constructor(){this._offscreenMap=new Er({maxSize:1e3,maxAge:1e3*60*4}),this.clear=()=>{this._offscreenMap.clear()}}toBase64(e,t){return V(this,null,function*(){let n=`${e.width}x${e.height}`,i=this._offscreenMap.get(n);i||(i=new OffscreenCanvas(e.width,e.height),this._offscreenMap.set(n,i));let o=i.getContext("bitmaprenderer");o==null||o.transferFromImageBitmap(e);try{let s=yield i.convertToBlob(t);return new Promise((a,l)=>{let c=new FileReader;c.onload=()=>{a(c.result)},c.onerror=u=>{l(u)},c.readAsDataURL(s)})}catch(s){}})}},q_=new ih;var oh={fps:3,dataURLOptions:{type:"image/webp",quality:.6}},Ba=class{constructor(e,t){this._canvas=e,this._callback=t,this._animeId=null,this._prevImg=null,this.observe=n=>{var i;this._animeId!==null&&cancelAnimationFrame(this._animeId);let o=(n==null?void 0:n.sampling)===!0||!(n!=null&&n.sampling)?oh:n.sampling,s=0,a=1e3/((i=o.fps)!==null&&i!==void 0?i:oh.fps),l=c=>V(this,null,function*(){if(s&&c-s<a){this._animeId=requestAnimationFrame(l);return}s=c;let u=yield this._snapshotCanvas(o.dataURLOptions||oh.dataURLOptions);u&&u!==this._prevImg&&(this._callback({api:"drawImage",args:[{src:u,__drawFullPage:!0},0,0,this._canvas.width,this._canvas.height]}),this._prevImg=u),this._animeId=requestAnimationFrame(l)});this._animeId=requestAnimationFrame(l)},this.disconnect=()=>{this._animeId!==null&&cancelAnimationFrame(this._animeId)},this.getSnapshot=()=>{if(this._canvas)return String(this._canvas.toDataURL("image/png",1))},this._snapshotCanvas=n=>V(this,null,function*(){if(!this._canvas||this._canvas.width===0||this._canvas.height===0)return;let i=yield createImageBitmap(this._canvas);return q_.toBase64(i,n)})}};nh();var ES={snapshot:!0,sampling:!1},Sa=class{constructor(e){this._canvasMap=new WeakMap,this._callback=e,this._canvasList=[]}observe(e,t){let n=this._canvasMap.get(e);if(n)n.observe();else{let i=new Ta({canvas:e,callback:this._callback});if(t!=null&&t.sampling)new Ba(e,s=>i.sample(s)).observe(t);else{let o=new xa({canvas:e,callback:s=>i.sample(s),sampler:i});this._canvasMap.set(e,o),this._canvasList.push(e),o.observe(H(H({},ES),t))}}}disconnect(e){if(!e)return this.disconnectAll();let t=this._canvasMap.get(e);if(t){t.disconnect(),this._canvasMap.delete(e);let n=this._canvasList.indexOf(e);n>=0&&this._canvasList.splice(n,1)}else console.error("no recorder to disconnect")}disconnectAll(){this._canvasList.forEach(e=>{let t=this._canvasMap.get(e);t&&t.disconnect()}),this._canvasList=[],this._canvasMap=new WeakMap}getSnapshot(e){if(!e)return{};let t=this._canvasMap.get(e);return t?{url:t.getSnapshot(),width:e.width,height:e.height}:(console.error("no recorder to getSnapshot"),{})}};var kS=Object.defineProperty,RS=(r,e,t)=>e in r?kS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,sh=(r,e,t)=>RS(r,typeof e!="symbol"?e+"":e,t),_n=class{constructor(e,t){sh(this,"_canvasObserver"),sh(this,"_canvas",new WeakMap),sh(this,"_handleCanvasInstructions",(n,i)=>{var o;let s=(o=this._canvas.get(i))==null?void 0:o.nodes.getNodeId(i);s!=null&&this.callback({eventType:m.HTMLCanvas,data:{target:s,data:n}})}),this.options=e,this.callback=t,this._canvasObserver=new Sa(this._handleCanvasInstructions)}get nodeNames(){return["CANVAS"]}observe(e,t,n){this._canvasObserver.observe(t,this.options),this._canvas.set(t,e),n.extra={image:t.toDataURL("image/png",.6),width:t.width,height:t.height}}disconnect(e){this._canvasObserver.disconnect(e),this._canvas.delete(e)}disconnectAll(){this._canvasObserver.disconnectAll()}};var OS={HEAD:!0,BASE:!0,LINK:!0,META:!0,NOSCRIPT:!0,SCRIPT:!0,STYLE:!0,TITLE:!0,TEMPLATE:!0,AUDIO:!0,CANVAS:!0,EMBED:!0,IFRAME:!0,IMG:!0,math:!0,OBJECT:!0,PICTURE:!0,SOURCE:!0,svg:!0,VIDEO:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,A:!0,BUTTON:!0,DETAILS:!0,INPUT:!0,LABEL:!0,SELECT:!0,OPTION:!0,B:!0,BR:!0,CITE:!0,DFN:!0,EM:!0,HR:!0,MARK:!0,STRONG:!0};function ah(r,e=!1){let t={autoplay:r.autoplay,controls:r.controls,loop:r.loop,playbackRate:r.playbackRate,muted:r.muted,volume:r.volume,currentTime:r.currentTime,paused:r.paused};if(e){let n=Ea(r);n!=null&&(t.meta=n)}return t}function Ea(r){let e,t=T_(r);return t!=null&&(e={type:"xg-video",vid:t}),e}function ka(r,e,t){r&&e&&(e.autoplay!==void 0&&(r.autoplay=e.autoplay),e.controls!==void 0&&(r.controls=e.controls),e.loop!==void 0&&(r.loop=e.loop),e.playbackRate!==void 0&&(r.playbackRate=e.playbackRate),e.muted!==void 0&&(r.muted=e.muted),e.volume!==void 0&&(r.volume=e.volume),e.currentTime!==void 0&&(r.paused||Math.abs(r.currentTime-e.currentTime)>1)&&(r.currentTime=e.currentTime),e.paused!==void 0&&(e.paused?r.paused||r.pause():r.paused&&r.play().catch(n=>{t&&t(n)})))}function lh(r,e){if(r&&e&&r.extra){let t=r.extra;e.autoplay!==void 0&&(t.autoplay=e.autoplay),e.controls!==void 0&&(t.controls=e.controls),e.loop!==void 0&&(t.loop=e.loop),e.playbackRate!==void 0&&(t.playbackRate=e.playbackRate),e.muted!==void 0&&(t.muted=e.muted),e.volume!==void 0&&(t.volume=e.volume),e.currentTime!==void 0&&(t.currentTime=e.currentTime),e.paused!==void 0&&(t.paused=e.paused),e.meta!==void 0&&(t.meta=e.meta)}}function T_(r){var e,t,n,i;return(i=(n=(t=(e=r.ownerDocument)==null?void 0:e.defaultView)==null?void 0:t.player)==null?void 0:n.config)==null?void 0:i.vid}function ch(r){return OS[r]!==!0&&r===r.toUpperCase()}function S_(r,e){let t=e.nodes.getNodeId(r);console.assert(t===1,`Unexpected id: expected 1 but got ${t}.`);let n=E_(r.documentElement,e);return{id:t,type:Y.DocumentNode,title:r.title,baseURI:r.baseURI,root:n,visibilityState:r.visibilityState,scrollSize:[r.documentElement.scrollWidth,r.documentElement.scrollHeight],offsetSize:[r.documentElement.offsetWidth,r.documentElement.offsetHeight]}}function ji(r,e,t){switch(r.nodeType){case Y.ElementNode:let n=E_(r,e,t);return e.onNodeCapture(r,n),n;case Y.DocumentFragmentNode:let i=CS(r,e,t);return e.onNodeCapture(r,i),i;case Y.TextNode:case Y.CommentNode:let o=uh(r,e,t);return e.onNodeCapture(r,o),o;case Y.HTMLNode:return;default:return}}function E_(r,e,t){let n=uh(r,e,t);if(n.type=Y.ElementNode,n.tag=R_(r),IS(r,n),MS(r,n,t),n.ignored||(US(r,n),PS(r,n),AS(r,n)),k_(r,e,n),r.shadowRoot){let i=ji(r.shadowRoot,e,n);i&&(i.parentId=n.id,n.shadowRoot=i)}return n}function CS(r,e,t){let n=uh(r,e,t);return n.tag=r.nodeName,k_(r,e,n),n}function uh(r,e,t){let n={id:e.nodes.getNodeId(r),type:r.nodeType};return ci(r)&&(n.ignored=!0),t?bs(t)?(n.parentId=t.id,t.ignored&&(n.ignored=t.ignored)):(n.parentId=B_(r,e,t),fi(t)&&(n.ignored=!0)):n.parentId=B_(r,e),!n.ignored&&r.nodeValue!=null&&(n.text=ci(r)?"":r.nodeValue),n}function B_(r,e,t){let n=t!=null?t:r.parentNode;if(n){let i=e.nodes.getNodeId(n,!1);return i==null&&console.warn("Parent node is not captured yet."),i}else return}function k_(r,e,t){if(r.hasChildNodes()){let n=[];r.childNodes.forEach(i=>{let o=ji(i,e,t);o&&n.push(o)}),t.children=n}}function IS(r,e){r.namespaceURI&&!r.ownerDocument.isDefaultNamespace(r.namespaceURI)&&(e.ns=r.namespaceURI)}function MS(r,e,t){var n;if(r.hasAttributes()){fi(r)&&(e.ignored=!0);let s=!1,a={};for(let l of r.getAttributeNames())if(!e.ignored||!su(l)){let c=r.getAttribute(l);c!=null&&(a[l]=c,s=!0)}s&&(e.attrs=a)}let i=We(),o;if(t){if(bs(t))o=(n=t==null?void 0:t.attrs)==null?void 0:n[i];else if(it(t))if(t.hasAttribute(i))o=t.getAttribute(i);else{let s=t.parentElement;for(;s;){if(s.hasAttribute(i)){o=s.getAttribute(i);break}s=s.parentElement}}}o!=null&&(e.attrs==null?e.attrs={[i]:o}:e.attrs[i]==null&&(e.attrs[i]=o))}function US(r,e){let t,n,i=!1;Pt(r)||cr(r)?(t=r.value,n=r.getAttribute("value"),i=r.type==="password"):gs(r)&&(t=r.value,n=r.textContent),T(t)&&t!==n&&(e.value=i?"*".repeat(t.length):t)}function PS(r,e){Pt(r)?e.checked=r.checked:Qr(r)&&(e.checked=r.selected)}function AS(r,e){ch(R_(r))&&(e.scroll=[r.scrollLeft,r.scrollTop])}function R_(r){return T(r.tagName)?r.tagName:T(r.nodeName)?r.nodeName:"UNKNOWN"}function yn(r,e){e.optimizer.start();for(let n of r){let i=e.nodes.getNodeId(n.target,!1);if(i!==void 0)switch(n.type){case"attributes":let o=DS(i,n);e.optimizer.onAttributesMutation(o);break;case"childList":if(n.addedNodes.length){let a=VS(i,n,e);e.optimizer.onNodeAddMutation(...a)}if(n.removedNodes.length){let a=NS(i,n,e);e.optimizer.onNodeRemoveMutation(...a)}break;case"characterData":let s=LS(i,n);e.optimizer.onCharacterMutation(s);break;default:throw new At(`Unsupported mutation type: ${n.type}`)}}let t=e.optimizer.merge();return e.optimizer.stop(),t}function DS(r,e){let t=e.attributeName,n=e.target.getAttribute(t);return{type:M.ChangeAttributes,target:r,data:{[t]:n}}}function VS(r,e,t){let n=[],i;return e.nextSibling&&(i=t.nodes.getNodeId(e.nextSibling,!1)),e.addedNodes.forEach(o=>{let s=o.parentNode,a=r;if(s){let c=t.nodes.getNodeId(s,!1);c&&c!==r&&(a=c)}let l=t.nodes.getNodeId(o,!1);if(l===void 0||!t.optimizer.isNewAddedNode(l)){let c=ji(o,t,e.target);if(!c)return;let u={type:M.AddNode,target:a,data:{node:c}};i&&(u.data.before=i),n.push(u)}else O_(o,t,n)}),n}function O_(r,e,t){if(!e.nodes.has(r))if(r.parentElement){let n=e.nodes.getNodeId(r.parentElement,!1);if(n){let i=ji(r,e,r.parentElement);if(!i)return;t.push({type:M.AddNode,target:n,data:{node:i}})}else console.warn("parent id is null",r.parentElement)}else console.warn("parent is null",r);r.childNodes.forEach(n=>{O_(n,e,t)})}function NS(r,e,t){let n=[];return e.removedNodes.forEach(i=>{let o=t.nodes.getNodeId(i,!1);if(o===void 0)return;let s=[],a=r;if(i.parentNode){let l=t.nodes.getNodeId(i.parentNode,!1);l&&l!==r&&(a=l)}t.onNodeRemove(i,o),t.nodes.removeNode(i,!0,s),s.length>0&&s[s.length-1]===o&&s.pop(),o&&n.push({type:M.RemoveNode,target:a,data:{id:o,children:s}})}),n}function LS(r,e){let t=e.target.nodeValue;return{type:M.CharacterData,target:r,data:t}}function C_(r,e){switch(r.type){case"scroll":return hh(r,e);case"focus":case"blur":return dh(r,e);case"input":return ph(r,e);case"change":return fh(r,e);case"resize":return mh()}}function hh({target:r},e){let t;r===document?document.scrollingElement?t=document.scrollingElement:t=document.documentElement:t=r;let n=e.nodes.getNodeId(t,!1);if(n!=null)return{eventType:m.HTMLScroll,data:{target:n,scroll:[t.scrollLeft,t.scrollTop]}}}function dh(r,e){let t=ui(r);if(t!=null){let n=e.nodes.getNodeId(t,!1);if(n==null&&dt(t)&&(n=1),n!=null)return{eventType:r.type==="focus"?m.HTMLFocus:m.HTMLBlur,data:{target:n}}}}function ph(r,e){let t=ui(r);if(t!=null&&_s(t))return Ra(t,e)}function fh(r,e){let t=ui(r);if(t!=null&&!_s(t))return Ra(t,e)}function mh(){return{eventType:m.HTMLResize,data:{size:[window.innerWidth,window.innerHeight]}}}function Ra(r,e){if(ys(r))return;let t=r,n=e.nodes.getNodeId(t,!1);if(n!=null){if(vs(t))return{eventType:m.HTMLValueChange,data:{target:n,value:t.checked}};let i=t.value;return T(i)||(i=String(i)),Pt(t)&&t.type==="password"&&(i="*".repeat(t.value.length)),{eventType:m.HTMLValueChange,data:{target:n,value:i}}}}var GS=Object.defineProperty,I_=Object.getOwnPropertySymbols,WS=Object.prototype.hasOwnProperty,FS=Object.prototype.propertyIsEnumerable,M_=(r,e,t)=>e in r?GS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,U_=(r,e)=>{for(var t in e||(e={}))WS.call(e,t)&&M_(r,t,e[t]);if(I_)for(var t of I_(e))FS.call(e,t)&&M_(r,t,e[t]);return r},Hi=class{constructor(e,t){this.options=e,this.callback=t}get nodeNames(){return["IMG"]}observe(e,t,n){if(this.options.captureStatus&&(t.decode().then(()=>{let i=e.nodes.getNodeId(t,!1);i!=null&&this.callback({eventType:m.HTMLImage,data:{target:i,data:{status:"loaded"}}})}).catch(()=>{let i=e.nodes.getNodeId(t,!1);i!=null&&this.callback({eventType:m.HTMLImage,data:{target:i,data:{status:"failed"}}})}),n.extra={status:"unknown"}),this.options.captureAttributes){let i=this.options.captureAttributes(t),o=n;o.attrs=U_(U_({},o.attrs),i)}}disconnect(e){}disconnectAll(){}};var KS=Object.defineProperty,jS=(r,e,t)=>e in r?KS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gh=(r,e,t)=>jS(r,typeof e!="symbol"?e+"":e,t),Oa=class{constructor(){gh(this,"_events",new R.default),gh(this,"_map",new WeakMap),gh(this,"_sequentialId",0),this.reset()}has(e){return this._map.has(e)}getNodeId(e,t=!0){if(this.has(e))return this._map.get(e);if(t)return this.addNode(e)}reset(){this._sequentialId=0,this._map=new WeakMap}addNode(e){if(this.has(e))throw new oe("Node already added.");let t=this._nextId();this._map.set(e,t);try{this._events.emit("nodeAdded",e,t)}catch(n){}return t}removeNode(e,t=!1,n=[]){t&&e.hasChildNodes()&&e.childNodes.forEach(o=>{this.removeNode(o,!0,n)}),e instanceof Element&&e.shadowRoot&&this.removeNode(e.shadowRoot,!0,n);let i=this._map.get(e);if(this._map.delete(e),i&&i>=0){n.push(i);try{this._events.emit("nodeRemoved",e,i)}catch(o){}}}_nextId(){return++this._sequentialId}on(e,t,n){return this._events.on(e,t,n)}once(e,t,n){return this._events.once(e,t,n)}off(e,t,n,i){return this._events.off(e,t,n,i)}addListener(e,t,n){return this._events.addListener(e,t,n)}removeListener(e,t,n,i){return this._events.removeListener(e,t,n,i)}};function P_(r){return{location:r.location.href,size:[r.innerWidth,r.innerHeight]}}function Ca(r,e){try{return Object.getOwnPropertyDescriptor(r,e)}catch(t){return}}function HS(r,e){try{return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(r),e)}catch(t){return}}function zi(r,e){let t=Ca(r,e);return t==null&&(t=HS(r,e)),t}var zS=Object.defineProperty,JS=(r,e,t)=>e in r?zS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ZS=(r,e,t)=>JS(r,typeof e!="symbol"?e+"":e,t),Jt=class{constructor(){ZS(this,"_enabled",!0)}get enabled(){return this._enabled}disable(){this._enabled=!1}};var QS=Object.defineProperty,XS=(r,e,t)=>e in r?QS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,A_=(r,e,t)=>XS(r,typeof e!="symbol"?e+"":e,t),Zt=class{constructor(){A_(this,"_hookedMap",new WeakMap),A_(this,"_hookedSet",new Set)}hook(e,t,n,i){this.unhook(e,t);try{Object.defineProperty(e,t,n);let o=this._hookedMap.get(e);o==null&&(o=new Map,this._hookedMap.set(e,o),this._hookedSet.add(o)),o.set(t,i)}catch(o){}}unhook(e,t,n){var i;n==null||n.disable();let o=this._hookedMap.get(e);o!=null&&((i=o.get(t))==null||i.disable(),o.delete(t),o.size===0&&(this._hookedMap.delete(e),this._hookedSet.delete(o)))}unhookAll(){for(let e of this._hookedSet){for(let t of e.values())t.disable();e.clear()}this._hookedSet.clear(),this._hookedMap=new WeakMap}};var YS=Object.defineProperty,eE=(r,e,t)=>e in r?YS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,D_=(r,e,t)=>eE(r,typeof e!="symbol"?e+"":e,t),Ia=class{constructor(e){D_(this,"_propertyHook",new Zt),D_(this,"METHOD_TO_HOOK","attachShadow"),this.callback=e}hook(){let e=new Jt,t=Ca(Element.prototype,this.METHOD_TO_HOOK);if(t!=null&&re(t.value)){let n=this;this._propertyHook.hook(Element.prototype,this.METHOD_TO_HOOK,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value(...i){var o;let s=(o=t.value)==null?void 0:o.apply(this,i);try{e.enabled&&n.callback.call(this,s,this)}catch(a){}return s}},e)}}unhook(){let e=Ca(Element.prototype,this.METHOD_TO_HOOK);e!=null&&re(e.value)&&this._propertyHook.unhook(Element.prototype,this.METHOD_TO_HOOK)}};var tE=Object.defineProperty,rE=(r,e,t)=>e in r?tE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mr=(r,e,t)=>rE(r,typeof e!="symbol"?e+"":e,t),Ji=class{constructor(e){Mr(this,"_elementAttachShadowHook"),Mr(this,"_mutationObserver"),Mr(this,"_context"),Mr(this,"_handleMutationObserver",t=>{if(!this._context)return;let n=yn(t,this._context);this.callback({eventType:m.HTMLMutations,data:n})}),Mr(this,"_handleElementAttachShadow",(t,n)=>{this._handleMutationObserver([{type:"childList",target:n,addedNodes:[t],removedNodes:[],attributeName:null,attributeNamespace:null,nextSibling:null,oldValue:null,previousSibling:null}])}),Mr(this,"_handleDocumentVisibilityChange",()=>{this.callback({eventType:m.HTMLMutations,data:[{type:M.Document,target:1,data:{visibilityState:document.visibilityState}}]})}),Mr(this,"_handleSelectionChange",()=>{if(!this._context)return;let t=document.getSelection();if(!t)return;let n=[];for(let i=0;i<t.rangeCount;i++){let o=t.getRangeAt(i),s=this._context.getNodeId(o.startContainer),a=this._context.getNodeId(o.endContainer);s!=null&&a!=null&&n.push({startTargetId:s,startOffset:o.startOffset,endTargetId:a,endOffset:o.endOffset})}this.callback({eventType:m.HTMLSelectionChange,data:n})}),this.callback=e,this._elementAttachShadowHook=new Ia(this._handleElementAttachShadow),this._mutationObserver=new MutationObserver(this._handleMutationObserver)}observe(e,t){this._context=e,this._elementAttachShadowHook.hook(),this._mutationObserver.observe(t,{childList:!0,subtree:!0,attributes:!0,characterData:!0});let n=this.capture(e);t.addEventListener("visibilitychange",this._handleDocumentVisibilityChange),t.addEventListener("selectionchange",this._handleSelectionChange),this.callback({eventType:m.HTMLSnapshot,data:n})}disconnect(e){this._mutationObserver.disconnect(),this._elementAttachShadowHook.unhook(),e.removeEventListener("visibilitychange",this._handleDocumentVisibilityChange),e.removeEventListener("selectionchange",this._handleSelectionChange)}disconnectAll(){this.disconnect(document)}capture(e){return{version:1,window:P_(window),document:S_(document,e),id:ve()}}};var nE=Object.defineProperty,iE=(r,e,t)=>e in r?nE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mt=(r,e,t)=>iE(r,typeof e!="symbol"?e+"":e,t),Zi=class{constructor(e){mt(this,"_context"),mt(this,"_handleFocusBlur",t=>{this._context&&this._triggerEvent(dh(t,this._context))}),mt(this,"_handleInput",t=>{this._context&&this._triggerEvent(ph(t,this._context))}),mt(this,"_handleChange",t=>{this._context&&this._triggerEvent(fh(t,this._context))}),mt(this,"_handleScrollSampleCallback",t=>{this._context&&this._triggerEvent(hh(t,this._context))}),mt(this,"_scrollSampler",new rn(this._handleScrollSampleCallback,16)),mt(this,"_handleScroll",t=>{this._scrollSampler.sample(t)}),mt(this,"_handleResizeSampleCallback",()=>{this._triggerEvent(mh())}),mt(this,"_resizeSampler",new rn(this._handleResizeSampleCallback)),mt(this,"_handleResize",t=>{this._resizeSampler.sample(t)}),this.callback=e}observe(e,t){this._context=e,this._subscribe(t)}disconnect(e){this._unsubscribe(e)}disconnectAll(){this._scrollSampler.stop(),this._resizeSampler.stop(),this._context=void 0,this._unsubscribe(window)}_subscribe(e){dt(e)&&(e.addEventListener("focus",this._handleFocusBlur,!0),e.addEventListener("blur",this._handleFocusBlur,!0),e.addEventListener("input",this._handleInput),e.addEventListener("change",this._handleChange)),e.addEventListener("scroll",this._handleScroll,{capture:!0,passive:!0}),e.addEventListener("resize",this._handleResize,{capture:!0,passive:!0})}_unsubscribe(e){dt(e)&&(e.removeEventListener("focus",this._handleFocusBlur,!0),e.removeEventListener("blur",this._handleFocusBlur,!0),e.removeEventListener("input",this._handleInput),e.removeEventListener("change",this._handleChange)),e.removeEventListener("scroll",this._handleScroll,!0),e.removeEventListener("resize",this._handleResize,!0)}_triggerEvent(e){e&&this.callback(e)}};var oE=Object.defineProperty,sE=(r,e,t)=>e in r?oE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qt=(r,e,t)=>sE(r,typeof e!="symbol"?e+"":e,t),Ma=class{constructor(e){Qt(this,"mutations",[]),Qt(this,"nodes",new Set),Qt(this,"attributeChangingMutationMap",new Map),Qt(this,"characterDataMutationMap",new Map),Qt(this,"removedNodes",new Map),Qt(this,"addedNodes",new Map),Qt(this,"handleNodeAdd",(t,n)=>{this.nodes.add(n),this.addedNodes.set(n,!0)}),Qt(this,"handleNodeRemove",(t,n)=>{this.addedNodes.has(n)&&this.removedNodes.set(n,!0),this.nodes.delete(n)}),this.context=e}start(){this.context.nodes.on("nodeAdded",this.handleNodeAdd),this.context.nodes.on("nodeRemoved",this.handleNodeRemove)}stop(){this.context.nodes.off("nodeAdded",this.handleNodeAdd),this.context.nodes.off("nodeRemoved",this.handleNodeRemove),this.mutations=[],this.nodes.clear(),this.attributeChangingMutationMap.clear(),this.characterDataMutationMap.clear(),this.removedNodes.clear(),this.addedNodes.clear()}onAttributesMutation(e){let t=e.target,n=this.attributeChangingMutationMap.get(t);n?Object.assign(n.data,e.data):this.removedNodes.has(e.target)||(this.attributeChangingMutationMap.set(t,e),this.mutations.push(e))}onNodeAddMutation(...e){this.mutations.push(...e)}onNodeRemoveMutation(...e){this.mutations.push(...e)}onCharacterMutation(e){let t=e.target,n=this.characterDataMutationMap.get(t);n?n.data=e.data:this.removedNodes.has(t)||(this.characterDataMutationMap.set(t,e),this.mutations.push(e))}merge(){let e=new Set;return this.mutations.filter(t=>{if(this.removedNodes.has(t.target)||e.has(t.target))return!1;if(t.type===M.RemoveNode){let n;if(typeof t.data=="number"?n=t.data:n=t.data.id,this.removedNodes.has(n)&&e.has(n))return!1}else if(t.type===M.AddNode&&this.removedNodes.has(t.data.node.id))return this.visitIgnoreNode(t.data.node,e),!1;return!0})}visitIgnoreNode(e,t){var n;t.add(e.id),(n=e.children)==null||n.forEach(i=>{this.visitIgnoreNode(i,t)})}isNewAddedNode(e){return this.nodes.has(e)}};var aE=Object.defineProperty,lE=(r,e,t)=>e in r?aE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ur=(r,e,t)=>lE(r,typeof e!="symbol"?e+"":e,t),Qi=class extends R.default{constructor(e){super(),Ur(this,"_map",new Oa),Ur(this,"_nodeObservers",new Map),Ur(this,"_documentObserver"),Ur(this,"_globalEventObserver"),Ur(this,"_observedStyleSheet",new WeakMap),Ur(this,"optimizer",new Ma(this)),Ur(this,"_sheetId",0),this.callback=e,this._documentObserver=new Ji(this.callback),this._globalEventObserver=new Zi(this.callback)}get documentObserver(){return this._documentObserver}get eventsObserver(){return this._globalEventObserver}get nodes(){return this._map}getNodeId(e){return this._map.getNodeId(e)}reset(){this.disconnectAll(),this._map.reset()}registerNodeObserver(e){e.nodeNames.forEach(t=>{if(this._nodeObservers.has(t))throw new Error(`NodeObserver for ${t} already registered.`);this._nodeObservers.set(t,e)})}onNodeRemove(e,t){try{let n=this._nodeObservers.get(e.nodeName);n&&n.disconnect(e)}catch(n){}}onNodeCapture(e,t){let n=this._nodeObservers.get(e.nodeName);try{n&&n.observe(this,e,t)}catch(i){console.error(i)}}disconnectAll(){this._nodeObservers.forEach(e=>{e.disconnectAll()})}getNextStyleSheetId(){return++this._sheetId}getStyleSheetId(e){return this._observedStyleSheet.get(e)}setStyleSheetId(e,t){return this._observedStyleSheet.set(e,t)}deleteStyleSheet(e){return this._observedStyleSheet.delete(e)}clearStyleSheet(){return this._observedStyleSheet=new WeakMap}};var cE=Object.defineProperty,uE=(r,e,t)=>e in r?cE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hE=(r,e,t)=>uE(r,typeof e!="symbol"?e+"":e,t),Ua=class{constructor(){hE(this,"_propertyHook",new Zt)}hook(e,t,n,i){let o=zi(e,t);o==null||o.set==null||o.get==null||(i=i!=null?i:new Jt,this._propertyHook.hook(e,t,{enumerable:o.enumerable,configurable:o.configurable,get(){var s;return(s=o.get)==null?void 0:s.call(this)},set(s){var a,l;let c=(a=o.get)==null?void 0:a.call(this);(l=o.set)==null||l.call(this,s);try{i.enabled&&c!==s&&n.call(this,e)}catch(u){}}},i))}unhook(e,t){this._propertyHook.unhook(e,t)}unhookAll(){this._propertyHook.unhookAll()}};var dE=Object.defineProperty,pE=(r,e,t)=>e in r?dE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,bn=(r,e,t)=>pE(r,typeof e!="symbol"?e+"":e,t),Xi=class{constructor(e){bn(this,"_context"),bn(this,"_setterHook",new Ua),bn(this,"_hookedSet",new WeakSet),bn(this,"_isAllDisconnected",!1),bn(this,"PROPERTIES_TO_OBSERVE",{INPUT:["checked","value"],OPTION:["selected"],SELECT:["value","selectedIndex"],TEXTAREA:["value"]}),bn(this,"_handleSet",t=>{if(this._isAllDisconnected||!this._context)return;let n=t;if(Qr(n)){let o=n.parentElement;for(;o;){if(cr(o)){n=o;break}o=o.parentElement}}let i=Ra(n,this._context);i!=null&&this.callback(i)}),this.callback=e}get nodeNames(){return["INPUT","OPTION","SELECT","TEXTAREA"]}observe(e,t){if(this._hookedSet.has(t))return;this._isAllDisconnected=!1,this._context||(this._context=e);let n=this.PROPERTIES_TO_OBSERVE[t.tagName];n!=null&&(n.forEach(i=>{this._setterHook.hook(t,i,this._handleSet)}),this._hookedSet.add(t))}disconnect(e){let t=this.PROPERTIES_TO_OBSERVE[e.tagName];t!=null&&(t.forEach(n=>{this._setterHook.unhook(e,n)}),this._hookedSet.delete(e))}disconnectAll(){this._isAllDisconnected=!0,this._context=void 0,this._setterHook.unhookAll(),this._hookedSet=new WeakSet}};var fE=Object.defineProperty,mE=(r,e,t)=>e in r?fE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,V_=(r,e,t)=>mE(r,typeof e!="symbol"?e+"":e,t),Pa=class{constructor(){V_(this,"_propertyHook",new Zt),V_(this,"METHODS_TO_HOOK",["insertRule","deleteRule","replace","replaceSync","addRule","removeRule"])}hook(e,t,n){n=n!=null?n:new Jt;for(let i of this.METHODS_TO_HOOK){let o=zi(e,i);o!=null&&re(o.value)&&this._propertyHook.hook(e,i,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value(...s){var a;let l=(a=o.value)==null?void 0:a.apply(this,s);try{n.enabled&&t.call(this,e,i,s)}catch(c){}return l}},n)}}unhook(e){for(let t of this.METHODS_TO_HOOK){let n=zi(e,t);n!=null&&re(n.value)&&this._propertyHook.unhook(e,t)}}unhookAll(){this._propertyHook.unhookAll()}};var gE={insertRule:0,deleteRule:1,replace:2,replaceSync:3,addRule:4,removeRule:5},vE={0:"insertRule",1:"deleteRule",2:"replace",3:"replaceSync",4:"addRule",5:"removeRule"};function Aa(r){return gE[r]}function vh(r){return vE[r]}var _E=Object.defineProperty,yE=(r,e,t)=>e in r?_E(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yi=(r,e,t)=>yE(r,typeof e!="symbol"?e+"":e,t),Pr=class{constructor(e,t){Yi(this,"_context"),Yi(this,"_cssStyleSheetHook",new Pa),Yi(this,"_isAllDisconnected",!1),Yi(this,"_hostNodeId"),Yi(this,"_handleCSSStyleSheetMethodCall",(n,i,o)=>{var s;if(this._isAllDisconnected)return;let a=(s=this._context)==null?void 0:s.getStyleSheetId(n);if(a==null)return;let l=this._getHostNodeId();if(l==null)return;let c=Aa(i);c!=null&&this.callback({eventType:m.HTMLMutations,data:[{type:M.StyleSheetRule,target:l,data:[c,o],sheetId:a}]})}),this.host=e,this.callback=t}observe(e,t){this._isAllDisconnected=!1,this._context||(this._context=e),this._context.getStyleSheetId(t)==null&&(this._context.setStyleSheetId(t,this._context.getNextStyleSheetId()),this._cssStyleSheetHook.hook(t,this._handleCSSStyleSheetMethodCall))}captureRules(e){let t=[],n=e.cssRules;if(n){let i=Aa("insertRule");for(let o=0;o<n.length;o++)t.push([i,[n[o].cssText,o]])}return t}disconnect(e){var t;this._cssStyleSheetHook.unhook(e),(t=this._context)==null||t.deleteStyleSheet(e)}disconnectAll(){this._isAllDisconnected=!0,this._hostNodeId=void 0,this._cssStyleSheetHook.unhookAll(),this._context!=null&&(this._context.clearStyleSheet(),this._context=void 0)}_getHostNodeId(){var e;return this._hostNodeId==null&&(this._hostNodeId=(e=this._context)==null?void 0:e.nodes.getNodeId(this.host,!1)),this._hostNodeId}};var bE=Object.defineProperty,$E=(r,e,t)=>e in r?bE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,eo=(r,e,t)=>$E(r,typeof e!="symbol"?e+"":e,t),N_=Symbol("bytereplay.adoptedStyleSheets"),L_=Symbol("bytereplay.adoptedStyleSheets.push"),to=class{constructor(e){eo(this,"mutationObservers",new WeakMap),eo(this,"styleSheetObservers",new WeakMap),eo(this,"_context"),eo(this,"_handleAdoptedStyleSheetsChange",(t,n)=>{let i=this._context;if(!i)return;let o=i.nodes.getNodeId(t,!1);if(o==null)return;let s=this.styleSheetObservers.get(t);if(s==null)return;let a=!1,l={sheets:[],rules:{}};n.forEach(c=>{let u=i.getStyleSheetId(c);if(u!=null){l.sheets.push(u),a=!0;return}if(s.observe(i,c),u=i.getStyleSheetId(c),u!=null){l.sheets.push(u);let h=s.captureRules(c);l.rules[u]=h,a=!0}}),a&&this.callback({eventType:m.HTMLMutations,data:[{type:M.StyleSheetAdopted,target:o,data:l}]})}),eo(this,"_handleMutationObserver",t=>{if(!this._context)return;let n=yn(t,this._context);this.callback({eventType:m.HTMLMutations,data:n})}),this.callback=e}get nodeNames(){return["#document-fragment"]}observe(e,t,n){this._context||(this._context=e);let i=new MutationObserver(this._handleMutationObserver);i.observe(t,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),this.mutationObservers.set(t,i),n.extra={styleSheets:this._observerAdoptedStyleSheets(e,t)},e.eventsObserver.observe(e,t)}_observerAdoptedStyleSheets(e,t){let n=new Pr(t,this.callback);this.styleSheetObservers.set(t,n),this._watchAdoptedStyleSheetsChange(t);let i=t.adoptedStyleSheets,o={sheets:[],rules:{}};if(i.length===0)return o;for(let s=0;s<i.length;s++){let a=i[s],l=e.getStyleSheetId(a);if(l==null){if(n.observe(e,a),l=e.getStyleSheetId(a),l!=null){let c=n.captureRules(a);o.sheets.push(l),o.rules[l]=c}}else o.sheets.push(l)}return o}_watchAdoptedStyleSheetsChange(e){var t;try{let n=e;if(n[N_])return;let i=this,o=(t=Object.getOwnPropertyDescriptor(n,"adoptedStyleSheets"))!=null?t:Object.getOwnPropertyDescriptor(Object.getPrototypeOf(n),"adoptedStyleSheets");Object.defineProperty(e,"adoptedStyleSheets",{enumerable:o==null?void 0:o.enumerable,configurable:o==null?void 0:o.configurable,get(){var s;let a=(s=o==null?void 0:o.get)==null?void 0:s.call(this);if(a!=null&&!a[L_])try{let l=a.push;Object.defineProperty(a,"push",{enumerable:!1,configurable:!0,writable:!0,value:function(...c){try{i._handleAdoptedStyleSheetsChange(e,c)}catch(u){}return l.apply(this,c)}}),a[L_]=!0}catch(l){}return a},set(s){var a;let l=(a=o==null?void 0:o.set)==null?void 0:a.call(this,s);try{i._handleAdoptedStyleSheetsChange(e,s)}catch(c){}return l}}),n[N_]=!0}catch(n){}}disconnect(e){var t;(t=this._context)==null||t.eventsObserver.disconnect(e),this._context=void 0;let n=this.mutationObservers.get(e);n==null||n.disconnect();let i=this.styleSheetObservers.get(e),o=e.adoptedStyleSheets;for(let s=0;s<o.length;s++){let a=o[s];i==null||i.disconnect(a)}}disconnectAll(){this._context=void 0,this.mutationObservers=new WeakMap,this.styleSheetObservers=new WeakMap}};var wE=Object.defineProperty,xE=(r,e,t)=>e in r?wE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qE=(r,e,t)=>xE(r,typeof e!="symbol"?e+"":e,t),ro=class{constructor(e){qE(this,"observers",new WeakMap),this.callback=e}get nodeNames(){return["STYLE"]}observe(e,t,n){let{sheet:i}=t;if(i!=null){let o=new Pr(t,this.callback),s=o.captureRules(i);s.length>0&&(n.extra={commands:s}),o.observe(e,i),this.observers.set(t,o)}}disconnect(e){var t;let{sheet:n}=e;n!=null&&((t=this.observers.get(e))==null||t.disconnect(n))}disconnectAll(){this.observers=new WeakMap}};var TE=Object.defineProperty,G_=Object.getOwnPropertySymbols,BE=Object.prototype.hasOwnProperty,SE=Object.prototype.propertyIsEnumerable,_h=(r,e,t)=>e in r?TE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,EE=(r,e)=>{for(var t in e||(e={}))BE.call(e,t)&&_h(r,t,e[t]);if(G_)for(var t of G_(e))SE.call(e,t)&&_h(r,t,e[t]);return r},Xt=(r,e,t)=>_h(r,typeof e!="symbol"?e+"":e,t),no=class{constructor(e){Xt(this,"_samplingInterval",2e3),Xt(this,"_lastSamplingTime",0),Xt(this,"_videos",new WeakMap),Xt(this,"_handlePlay",t=>{var n;let i=t.target,o=(n=this._videos.get(i))==null?void 0:n.nodes.getNodeId(i,!1);if(o!=null){let s;i.paused||(s=Ea(i)),this.callback({eventType:m.HTMLVideo,data:{target:o,properties:EE({paused:i.paused,currentTime:i.currentTime},s==null?s:{meta:s})}})}}),Xt(this,"_handleTimeUpdate",t=>{var n;if(this._lastSamplingTime===0||kE(this._lastSamplingTime)>this._samplingInterval){this._lastSamplingTime=P();let i=t.target,o=(n=this._videos.get(i))==null?void 0:n.nodes.getNodeId(i,!1);o!=null&&this.callback({eventType:m.HTMLVideo,data:{target:o,properties:{currentTime:i.currentTime}}})}}),Xt(this,"_handleSeeked",t=>{var n;let i=t.target,o=(n=this._videos.get(i))==null?void 0:n.nodes.getNodeId(i,!1);o!=null&&this.callback({eventType:m.HTMLVideo,data:{target:o,properties:{paused:i.paused,currentTime:i.currentTime}}})}),Xt(this,"_handleRateChange",t=>{var n;let i=t.target,o=(n=this._videos.get(i))==null?void 0:n.nodes.getNodeId(i,!1);o!=null&&this.callback({eventType:m.HTMLVideo,data:{target:o,properties:{playbackRate:i.playbackRate}}})}),Xt(this,"_handleVolumeChange",t=>{var n;let i=t.target,o=(n=this._videos.get(i))==null?void 0:n.nodes.getNodeId(i,!1);o!=null&&this.callback({eventType:m.HTMLVideo,data:{target:o,properties:{muted:i.muted,volume:i.volume}}})}),this.callback=e}get nodeNames(){return["VIDEO"]}observe(e,t,n){this._videos.set(t,e),this._onVideoInit(t,n),this._subscribe(t)}disconnect(e){this._unsubscribe(e),this._videos.delete(e)}disconnectAll(){let e=document.getElementsByTagName("video");for(let t=0;t<e.length;t++)this.disconnect(e[t]);this._videos=new WeakMap}_onVideoInit(e,t){t.extra=ah(e)}_subscribe(e){e.addEventListener("play",this._handlePlay),e.addEventListener("pause",this._handlePlay),e.addEventListener("timeupdate",this._handleTimeUpdate),e.addEventListener("seeked",this._handleSeeked),e.addEventListener("ratechange",this._handleRateChange),e.addEventListener("volumechange",this._handleVolumeChange)}_unsubscribe(e){e.removeEventListener("play",this._handlePlay),e.removeEventListener("pause",this._handlePlay),e.removeEventListener("timeupdate",this._handleTimeUpdate),e.removeEventListener("seeked",this._handleSeeked),e.removeEventListener("ratechange",this._handleRateChange),e.removeEventListener("volumechange",this._handleVolumeChange)}};function kE(r){return P()-r}function W_(r,e){let{token:t,safety:n,data:i}=e,o={};return t&&(o.Authorization=t),r.post(n?"snapshot/safe/take":"snapshot/take",i,o)}var RE=Object.defineProperty,F_=Object.getOwnPropertySymbols,OE=Object.prototype.hasOwnProperty,CE=Object.prototype.propertyIsEnumerable,IE=(r,e,t)=>e in r?RE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ME=(r,e)=>{var t={};for(var n in r)OE.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&F_)for(var n of F_(r))e.indexOf(n)<0&&CE.call(r,n)&&(t[n]=r[n]);return t},K_=(r,e,t)=>IE(r,typeof e!="symbol"?e+"":e,t),UE=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Da=class{constructor(){K_(this,"_env"),K_(this,"_apiClient")}render(e,t){return UE(this,null,function*(){let n=JSON.stringify(e),i=new TextEncoder().encode(n),o=new Blob([i]),s=t,{token:a,environment:l,safety:c}=s,u=ME(s,["token","environment","safety"]),h=Qn();return h.append("snapshot",o),h.append("options",JSON.stringify(u)),W_(this.getAPIClient(l),{token:a,safety:c,data:h})})}getAPIClient(e){return this._env?(this._env.baseURL=e==null?void 0:e.baseURL,this._env.type=e==null?void 0:e.type):this._env=new Ae(e),this._apiClient||(this._apiClient=new rt(this._env)),this._apiClient}};var PE=Object.defineProperty,AE=(r,e,t)=>e in r?PE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,j_=(r,e,t)=>AE(r,typeof e!="symbol"?e+"":e,t),DE=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),$n=class extends R.default{constructor(e){var t,n;super(),j_(this,"context"),j_(this,"_handleEventObserver",i=>{this.emit("event",i)}),this.options=e,this.context=new Qi(this._handleEventObserver),(t=this.options)!=null&&t.canvas&&(globalThis.Path2D?this.registerNodeObserver(_n,sr(this.options.canvas)?this.options.canvas:void 0):console.warn("canvas not supported in this runtime.")),(n=this.options)!=null&&n.image&&this.registerNodeObserver(Hi,this.options.image),this.registerNodeObserver(no),this.registerNodeObserver(ro),this.registerNodeObserver(to),this.registerNodeObserver(Xi)}get nodes(){return this.context.nodes}getNodeId(e){return this.nodes.getNodeId(e,!1)}reset(){this.context.reset()}registerNodeObserver(e,...t){let n=Reflect.construct(e,[...t,this._handleEventObserver]);this.context.registerNodeObserver(n)}start(){this.context.documentObserver.observe(this.context,document),this.context.eventsObserver.observe(this.context,window)}stop(){this.context.documentObserver.disconnect(document),this.context.eventsObserver.disconnect(window),this.reset()}captureSnapshot(){return this.context.documentObserver.capture(this.context)}captureMutations(e){return yn(e,this.context)}captureEvent(e){return C_(e,this.context)}screenshot(e){return DE(this,null,function*(){let t=this.captureSnapshot();return yield new Da().render(t,e)})}};var wn=class extends oe{constructor(e,t){super(e,t),this.name="SnapshotError"}};var Te=class extends wn{constructor(e,t){super(e,t),this.name="RenderingError"}};var gt=(r=>(r.VanillaDOM="VanillaDOM",r.VirtualDOM="VirtualDOM",r))(gt||{});var VE=Object.defineProperty,NE=(r,e,t)=>e in r?VE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,H_=(r,e,t)=>NE(r,typeof e!="symbol"?e+"":e,t),z_=class Ie{constructor(){H_(this,"tag","CANVAS")}static registerPlayer(e,t,n,i){let o={player:new wa(n),order:i},s=Ie.players.get(`${e}/${t}`);s?s.order<o.order&&Ie.players.set(`${e}/${t}`,o):Ie.players.set(`${e}/${t}`,o)}static resolvePlayer(e,t,n){let i=Ie.players.get(`${e}/${t}`);if(i&&i.order<=n)return i.player}static removePlayer(e,t){Ie.players.delete(`${e}/${t}`)}static resetPlayer(e){let t=Ie.players.keys();Array.from(t).forEach(n=>{n.startsWith(e)&&Ie.players.delete(n)})}onRender(e,t){var n,i,o;let s=(n=t.extra)==null?void 0:n.image;if(!s)return;let a=this.getPerformOrder(e);if(e.isVanilla()){let l=e.getNode(t.id),c=l.getContext("2d");e.enqueueConcurrentTask(new Promise(u=>{let h=new Image;h.onload=()=>{c==null||c.drawImage(h,0,0,h.width,h.height),u({element:l,failed:!1,timeout:!1})},h.onerror=()=>{u({element:l,failed:!0,timeout:!1})},h.src=s})),Ie.registerPlayer(e.snapshotId,t.id,l,a)}else{let l=new OffscreenCanvas(parseFloat(((i=t.attrs)==null?void 0:i.width)||"300")||300,parseFloat(((o=t.attrs)==null?void 0:o.height)||"150")||150);Ie.registerPlayer(e.snapshotId,t.id,l,a)}}onRemove(e,t){Ie.removePlayer(e.snapshotId,t)}performEvent(e,t){if(t.eventType===m.HTMLCanvas){let{target:n,data:i}=t.data,o=this.getPerformOrder(e),s=Ie.resolvePlayer(e.snapshotId,n,o);s&&s.execute(i)}}onReset(e){Ie.resetPlayer(e.snapshotId)}onCapture(e,t){if(e.isVirtual()){let n=e.getNode(t);if(n&&n.tag===this.tag){let i=this.getPerformOrder(e),o=Ie.resolvePlayer(e.snapshotId,t,i);o&&e.enqueueConcurrentTask(new Promise((s,a)=>{o.snapshot().then(l=>{n.extra={image:l},s({element:void 0,failed:!1,timeout:!1})}).catch(()=>{a({element:void 0,failed:!0,timeout:!1})})}))}}}getPerformOrder(e){return e.mode===gt.VanillaDOM?2:e.isIncremental?0:1}};H_(z_,"players",new Map);var yh=z_;var LE=Object.defineProperty,GE=Object.defineProperties,WE=Object.getOwnPropertyDescriptors,J_=Object.getOwnPropertySymbols,FE=Object.prototype.hasOwnProperty,KE=Object.prototype.propertyIsEnumerable,Z_=(r,e,t)=>e in r?LE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jE=(r,e)=>{for(var t in e||(e={}))FE.call(e,t)&&Z_(r,t,e[t]);if(J_)for(var t of J_(e))KE.call(e,t)&&Z_(r,t,e[t]);return r},HE=(r,e)=>GE(r,WE(e)),io=class{constructor(e){this.options=e}get tag(){return"IMAGE"}onRender(e,t,n){e.isVanilla()&&this._triggerEvent(n,t.extra)}performEvent(e,t){if(t.eventType===m.HTMLImage){let{target:n,data:i}=t.data;if(e.isVanilla())this._triggerEvent(e.getNode(n),i);else{let o=e.getNode(n);o&&(o.extra=HE(jE({},o==null?void 0:o.extra),{status:i.status}))}}}onRemove(){}_triggerEvent(e,t){var n,i;(n=this.options)!=null&&n.onError&&(t==null?void 0:t.status)==="failed"&&this.options.onError(e),(i=this.options)!=null&&i.onLoad&&t.status==="loaded"&&this.options.onLoad(e)}};var zE=Object.defineProperty,JE=(r,e,t)=>e in r?zE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ZE=(r,e,t)=>JE(r,typeof e!="symbol"?e+"":e,t),oo=class{constructor(e){ZE(this,"_options"),this._options=e}get tag(){return"LINK"}onRender(e,t,n){if(e.isVanilla()){let i=n;(i.as==="script"||i.rel==="dns-prefetch"||i.rel==="preconnect")&&(i.setAttribute("data-bytereplay-href",i.href),i.href="#"),this._triggerEvent(n)}}onRemove(){}performEvent(){}_triggerEvent(e){var t;(t=this._options)!=null&&t.onLoad&&e.hasAttribute("href")&&e.href!=="#"&&this._options.onLoad(e)}};var W6=10*1e3;function bh(r,e=0){return new Promise(t=>{setTimeout(()=>{let n=r();t(n)},e)})}var QE=Object.defineProperty,XE=(r,e,t)=>e in r?QE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,YE=(r,e,t)=>XE(r,typeof e!="symbol"?e+"":e,t),xn=class{constructor(){YE(this,"_tasks",[])}enqueue(e){this._tasks.push(e)}clear(){this._tasks.splice(0,this._tasks.length)}toArray(){return[...this._tasks]}};var ek=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Va=class extends xn{execute(){return ek(this,null,function*(){let e=this.toArray();this.clear(),yield Promise.all(e)})}};var tk=Object.defineProperty,rk=(r,e,t)=>e in r?tk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nk=(r,e,t)=>rk(r,typeof e!="symbol"?e+"":e,t),Q_=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Na=class extends xn{constructor(){super(...arguments),nk(this,"_chain",Promise.resolve())}execute(){return Q_(this,null,function*(){let e=this.toArray();return this.clear(),this._chain=this._chain.then(()=>Q_(this,null,function*(){for(let t of e)yield t()})),this._chain})}};var ik=Object.defineProperty,ok=(r,e,t)=>e in r?ik(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,sk=(r,e,t)=>ok(r,typeof e!="symbol"?e+"":e,t),qn=class extends R.default{constructor(){super(...arguments),sk(this,"_map",new Map)}reset(){this._map.clear(),this.emit("nodeReset")}has(e){return this._map.has(e)}getNode(e){return this._map.get(e)}addNode(e,t){this._map.set(e,t),t&&this.emit("nodeAdded",t,e)}keys(){return this._map.keys()}size(){return this._map.size}removeNode(e){let t=this._map.get(e);this._map.delete(e),t&&this.emit("nodeRemoved",t,e)}};var ak=Object.defineProperty,lk=(r,e,t)=>e in r?ak(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Tn=(r,e,t)=>lk(r,typeof e!="symbol"?e+"":e,t),ck=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),so=class{constructor(e){Tn(this,"_map",new qn),Tn(this,"_nodeRenderers",new Map),Tn(this,"_concurrentQueue",new Va),Tn(this,"_sequentialQueue",new Na),Tn(this,"_snapshotId"),Tn(this,"_isIncremental",!1),this.mode=e}get nodes(){return this._map}get snapshotId(){return this._snapshotId?`${this.mode}/${this._snapshotId}`:this.mode}setSnapshotId(e){this._snapshotId=e}get isIncremental(){return this._isIncremental}setIncremental(e){this._isIncremental=e}setNodes(e){this._map=e}getNode(e){return this._map.getNode(e)}registerNodeRenderer(e){this._nodeRenderers.set(e.tag,e)}onNodeRender(e,t){let n=this._nodeRenderers.get(e.tag);try{n&&n.onRender(this,e,t)}catch(i){console.error(i)}}onNodeRemove(e){let t=this.nodes.getNode(e);if(!t)return;let n;this.isVanilla()?n=this._nodeRenderers.get(t.tagName):n=this._nodeRenderers.get(t.tag);try{n&&n.onRemove(this,e)}catch(i){console.error(i)}}onPatch(e,t,n){if(e==="attrs")Reflect.set(t,e,Object.assign({},t[e],n[e]));else if(e==="extra"){let i=this._nodeRenderers.get(t.tag);i&&i.onPatchExtra&&i.onPatchExtra(t,n)}}performEvent(e){this._nodeRenderers.forEach(t=>{t.performEvent(this,e)})}enqueueConcurrentTask(e){this._concurrentQueue.enqueue(e)}enqueueSequentialTask(e){this._sequentialQueue.enqueue(e)}executeQueuedTasks(){return ck(this,null,function*(){yield this._concurrentQueue.execute(),yield this._sequentialQueue.execute()})}capture(){var e;for(let t of this._map.keys())for(let n of this._nodeRenderers.values())(e=n.onCapture)==null||e.call(n,this,t)}reset(){this._snapshotId&&this._nodeRenderers.forEach(e=>{var t;(t=e.onReset)==null||t.call(e,this)}),this._map.reset(),this._concurrentQueue.clear(),this._sequentialQueue.clear()}isVanilla(){return this.mode===gt.VanillaDOM}isVirtual(){return this.mode===gt.VirtualDOM}};var uk=Object.defineProperty,hk=Object.defineProperties,dk=Object.getOwnPropertyDescriptors,X_=Object.getOwnPropertySymbols,pk=Object.prototype.hasOwnProperty,fk=Object.prototype.propertyIsEnumerable,Y_=(r,e,t)=>e in r?uk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mk=(r,e)=>{for(var t in e||(e={}))pk.call(e,t)&&Y_(r,t,e[t]);if(X_)for(var t of X_(e))fk.call(e,t)&&Y_(r,t,e[t]);return r},gk=(r,e)=>hk(r,dk(e)),vk=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),La=class{get tag(){return"IFRAME"}performEvent(e,t){if(t.eventType===m.HTMLIFrame)if(e.isVanilla()){let n=e.getNode(t.data.target);n&&e.enqueueSequentialTask(()=>vk(this,null,function*(){n.dispatchEvent(Ou(t.data.action))}))}else{let{target:n,action:i}=t.data,o=e.getNode(n);if(!o)throw new Te(`Node with ID '${n}' not found.`);let s=o.extra||{state:pt.Loaded};switch(i.type){case ze.Load:s.state=pt.Loaded,s.recordings=void 0;break;case ze.Unload:s.state=pt.Loading,s.recordings=void 0;break;case ze.StartRecording:s.state=pt.Recording,s.recordings=gk(mk({},s.recordings),{[i.data.parentId]:i.data.recording});break;case ze.StopRecording:s.state=pt.Loaded,s.recordings&&delete s.recordings[i.data.parentId];break}o.extra=s}}onRender(){}onRemove(){}};var ey=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),ao=class{get tag(){return"STYLE"}onRender(e,t){var n;if(e.isVanilla()){let i=e.getNode(t.id);if(it(i)&&ms(i)){let o=(n=t.extra)==null?void 0:n.commands;o!=null&&e.enqueueSequentialTask(()=>ey(this,null,function*(){let{sheet:s}=i;s!=null&&o.forEach(a=>Ar(s,a))}))}}}onPatchExtra(e,t){var n,i,o;let s=e.extra;(n=s==null?void 0:s.commands)!=null&&n.length&&(s.commands=[...(o=(i=t.extra)==null?void 0:i.commands)!=null?o:[],...s.commands])}onRemove(){}performEvent(e,t){if(t.eventType===m.HTMLMutations){if(e.isVanilla()){t.data.forEach(n=>{if(n.type===M.StyleSheetRule){let i=e.getNode(n.target);it(i)&&ms(i)&&e.enqueueSequentialTask(()=>ey(this,null,function*(){i.sheet&&Ar(i.sheet,n.data)}))}});return}e.isVirtual()&&t.data.forEach(n=>{var i;if(n.type===M.StyleSheetRule){let o=e.getNode(n.target);o!=null&&((o.extra==null||o.extra.commands==null)&&(o.extra={commands:[]}),(i=o.extra.commands)==null||i.push(n.data))}})}}};function Ar(r,e){let t=vh(e[0]);if(t!=null){let n=Reflect.get(r,t);try{Reflect.apply(n,r,e[1])}catch(i){console.warn(`Failed to apply style sheet method: ${t}`,i)}}}var _k=Object.defineProperty,yk=Object.defineProperties,bk=Object.getOwnPropertyDescriptors,ty=Object.getOwnPropertySymbols,$k=Object.prototype.hasOwnProperty,wk=Object.prototype.propertyIsEnumerable,$h=(r,e,t)=>e in r?_k(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ry=(r,e)=>{for(var t in e||(e={}))$k.call(e,t)&&$h(r,t,e[t]);if(ty)for(var t of ty(e))wk.call(e,t)&&$h(r,t,e[t]);return r},ny=(r,e)=>yk(r,bk(e)),xk=(r,e,t)=>$h(r,typeof e!="symbol"?e+"":e,t),Ga=class{constructor(){xk(this,"_renderedSheets",new Map)}get tag(){return"#document-fragment"}onRender(e,t,n){let i=t.extra,o=i.styleSheets.sheets;if(e.isVanilla()){let s=n;e.enqueueConcurrentTask(new Promise(a=>{setTimeout(()=>{let l=[];for(let c=0;c<o.length;c++){let u=o[c],h=i.styleSheets.rules[u],d=this._renderedSheets.get(u);d==null&&(d=this._createHostedStyleSheet(s,h),this._renderedSheets.set(u,d)),l.push(d)}s.adoptedStyleSheets=[...s.adoptedStyleSheets,...l],a({failed:!1,timeout:!1,element:s})},0)}))}}onPatchExtra(e,t){let{sheets:n,rules:i}=t.extra.styleSheets,o={styleSheets:{sheets:[...n],rules:Object.keys(i).reduce((a,l)=>ny(ry({},a),{[l]:[...i[Number(l)]]}),{})}},s=e.extra.styleSheets;Object.keys(s.rules).forEach(a=>{let l=o.styleSheets.rules[Number(a)];l?l.push(...s.rules[Number(a)]):(o.styleSheets.rules[Number(a)]=[...s.rules[Number(a)]],o.styleSheets.sheets.push(Number(a)))}),e.extra=o}performEvent(e,t){t.eventType===m.HTMLMutations&&t.data.forEach(n=>{n.type===M.StyleSheetRule?this._performStyleSheetRuleChange(e,n):n.type===M.StyleSheetAdopted&&this._performStyleSheetAdoptedChange(e,n)})}_createHostedStyleSheet(e,t){var n;let i=(n=e.host.ownerDocument)==null?void 0:n.defaultView,o=i==null?new CSSStyleSheet:new i.CSSStyleSheet;return t==null||t.forEach(s=>{Ar(o,s)}),o}_performStyleSheetRuleChange(e,t){if(e.isVanilla()){let n=e.getNode(t.target);if(n==null||!(n instanceof ShadowRoot)||!t.sheetId)return;let i=this._renderedSheets.get(t.sheetId);i!=null&&Ar(i,t.data)}else if(e.isVirtual()){let n=e.getNode(t.target);if(!(n!=null&&n.tag===this.tag)||!t.sheetId)return;let i=n.extra;if(i||(i={styleSheets:{sheets:[],rules:{}}},n.extra=i),i&&i.styleSheets.rules){let o=i.styleSheets.rules[t.sheetId];o?o.push(t.data):(i.styleSheets.rules[t.sheetId]=[t.data],i.styleSheets.sheets.push(t.sheetId))}}}_performStyleSheetAdoptedChange(e,t){if(e.isVanilla()){let n=e.getNode(t.target);if(!n)return;e.enqueueConcurrentTask(bh(()=>{let i=n,{sheets:o,rules:s}=t.data,a=o.map(l=>{var c;let u=this._renderedSheets.get(l);return u!=null?(c=s[l])==null||c.forEach(h=>{Ar(u,h)}):(u=this._createHostedStyleSheet(i,s[l]),this._renderedSheets.set(l,u)),u});return i.adoptedStyleSheets=a,{failed:!1,timeout:!1,element:i}}))}else if(e.isVirtual()){let n=e.getNode(t.target);if(!n||n.tag!==this.tag)return;let{sheets:i,rules:o}=t.data,s=n.extra,a=s.styleSheets.rules;s.styleSheets.rules=i.reduce((l,c)=>ny(ry({},l),{[c]:a[c]||o[c]}),{}),s.styleSheets.sheets=i}}onRemove(){}onReset(){this._renderedSheets.clear()}};var qk=Object.defineProperty,iy=Object.getOwnPropertySymbols,Tk=Object.prototype.hasOwnProperty,Bk=Object.prototype.propertyIsEnumerable,wh=(r,e,t)=>e in r?qk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,oy=(r,e)=>{for(var t in e||(e={}))Tk.call(e,t)&&wh(r,t,e[t]);if(iy)for(var t of iy(e))Bk.call(e,t)&&wh(r,t,e[t]);return r},Sk=(r,e,t)=>wh(r,typeof e!="symbol"?e+"":e,t),Bn=class extends R.default{constructor(){super(...arguments),Sk(this,"_handleNotAllowed",()=>{this.emit("requestUserInteraction")})}get tag(){return"VIDEO"}onRender(e,t,n){e.isVanilla()&&e.enqueueConcurrentTask(new Promise(i=>{ka(n,t.extra,this._handleNotAllowed),i({})}))}performEvent(e,t){if(t.eventType===m.HTMLVideo){let{target:n,properties:i}=t.data;e.isVanilla()?ka(e.getNode(n),i,this._handleNotAllowed):e.isVirtual()&&lh(e.getNode(n),i)}}onPatchExtra(e,t){let n=e.extra;n&&(e.extra=oy(oy({},t.extra),n))}onRemove(){}};var Ek=Object.defineProperty,kk=(r,e,t)=>e in r?Ek(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lo=(r,e,t)=>kk(r,typeof e!="symbol"?e+"":e,t),xh=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Sn=class extends R.default{constructor(e,t){var n,i;super(),lo(this,"context"),lo(this,"_disableFocusChange"),lo(this,"_ignoreAutoplayPolicyError"),lo(this,"_suspended",!0),lo(this,"_needRebuildId2NodeMap",!1),this._disableFocusChange=(n=t==null?void 0:t.disableFocusChange)!=null?n:!1,this._ignoreAutoplayPolicyError=(i=t==null?void 0:t.ignoreAutoplayPolicyError)!=null?i:!1,this.context=new so(e),this.registerNodeRenderer(ao),this.registerNodeRenderer(La),this.registerNodeRenderer(yh),this.registerNodeRenderer(io,t==null?void 0:t.image),this.registerNodeRenderer(Bn),this.registerNodeRenderer(oo,t==null?void 0:t.link),this.registerNodeRenderer(Ga),this.context.nodes.on("nodeAdded",(o,s)=>{this.emit("nodeAdded",o,s)}),this.context.nodes.on("nodeRemoved",(o,s)=>{this.emit("nodeRemoved",o,s)}),this.context.nodes.on("nodeReset",()=>{this.emit("nodeReset")})}get suspended(){return this._suspended}getNode(e){return this.context.nodes.getNode(e)}reset(){this.context.reset()}suspend(){this._suspended=!0}resume(){this._suspended=!1}registerNodeRenderer(e,...t){let n=Reflect.construct(e,[...t]);this.context.registerNodeRenderer(n),this._ignoreAutoplayPolicyError||n instanceof Bn&&n.on("requestUserInteraction",()=>{this.emit("requestUserInteraction")})}render(e){return xh(this,null,function*(){if(e.version!==1)throw new At(`Unsupported snapshot version ${e.version}.`);this.context.setSnapshotId(e.id),this.reset();let t=this.suspended;this.suspend(),this.renderWindow(e.window),this.renderDocument(e.document),t||this.resume()})}performEvent(e){return xh(this,null,function*(){try{switch(e.eventType){case m.HTMLSnapshot:yield this.render(e.data);break;case m.HTMLMutations:this.performMutations(e.data);break;case m.HTMLNavigation:this.performNavigation(e.data);break;case m.HTMLScroll:this.performScroll(e.data);break;case m.HTMLFocus:this.performFocus(e.data);break;case m.HTMLBlur:this.performBlur(e.data);break;case m.HTMLValueChange:this.performValueChange(e.data);break;case m.HTMLSelectionChange:this.performSelectionChange(e.data);break;case m.HTMLResize:this.performResize(e.data);break}this.context.performEvent(e),yield this.performPostRendering()}catch(t){console.error(t)}if(this._needRebuildId2NodeMap){let t=new qn;this.rebuildNodes(t),this.context.setNodes(t),this._needRebuildId2NodeMap=!1}})}performMutations(e){for(let t of e)try{this.performMutation(t)}catch(n){console.error(n)}}performMutation(e){switch(e.type){case M.AddNode:this.performAddNodeMutation(e);break;case M.ChangeAttributes:this.performChangeAttributeMutation(e);break;case M.RemoveNode:try{this.performRemoveNodeMutation(e)}catch(t){}break;case M.CharacterData:this.performCharacterDataMutation(e);break;case M.Document:this.performDocumentMutation(e);break;case M.AndroidUpdateNode:this.performAndroidUpdateNodeMutation(e);break}}performPostRendering(){return xh(this,null,function*(){})}performChangeAttributeMutation(e){let t=this.getNode(e.target);if(!t)throw new Te(`Node with ID '${e.target}' not found.`);this.applyAttrs(e.data,t)}performScroll(e){let t=this.getNode(e.target);t&&this.applyScrolling(e.scroll,t)}performFocus(e){if(!this._disableFocusChange){let t=this.getNode(e.target);if(t)this.applyFocus(t);else throw new Te(`Node with ID '${e.target}' not found.`)}}performBlur(e){if(!this._disableFocusChange){let t=this.getNode(e.target);if(t)this.applyBlur(t);else throw new Te(`Node with ID '${e.target}' not found.`)}}performValueChange(e){let t=this.getNode(e.target);t&&(typeof e.value=="string"?this.applyValue(e.value,t):this.applyCheckedState(e.value,t))}performSelectionChange(e){this._disableFocusChange||this.applySelection(e)}performResize(e){this.applySize(e.size)}};var Rk=Object.defineProperty,Fa=Object.getOwnPropertySymbols,ay=Object.prototype.hasOwnProperty,ly=Object.prototype.propertyIsEnumerable,qh=(r,e,t)=>e in r?Rk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wa=(r,e)=>{for(var t in e||(e={}))ay.call(e,t)&&qh(r,t,e[t]);if(Fa)for(var t of Fa(e))ly.call(e,t)&&qh(r,t,e[t]);return r},Ok=(r,e)=>{var t={};for(var n in r)ay.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Fa)for(var n of Fa(r))e.indexOf(n)<0&&ly.call(r,n)&&(t[n]=r[n]);return t},sy=(r,e,t)=>qh(r,typeof e!="symbol"?e+"":e,t),Ck=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),vt=class extends Sn{constructor(e){super(gt.VirtualDOM,e),sy(this,"_contentWindow"),sy(this,"_contentDocument"),this._createNewContent()}get contentWindow(){return this._contentWindow}get contentDocument(){return this._contentDocument}get size(){return this.contentWindow.size}get documentTitle(){return this.contentDocument.title}get documentURL(){return this.contentWindow.location}get documentBaseURI(){return this.contentDocument.baseURI}getNode(e){return this.context.nodes.getNode(e)}reset(){super.reset(),this._createNewContent()}captureSnapshot(){return Ck(this,null,function*(){let e={version:1,window:this.contentWindow,document:this._contentDocument,id:this.context.snapshotId};return this.context.capture(),yield this.context.executeQueuedTasks(),at(e)})}mergeIncrementalSnapshot(e,t){let n=at(e);return t.forEach(i=>{let o=new Map;this.visitVElement(n.document.root,o),n=this.patchIncrementalSnapshot(n,at(i),o)}),n}visitVElement(e,t){var n;t.set(e.id,e),(n=e.children)==null||n.forEach(i=>{this.visitVElement(i,t)})}patchVElement(e,t){var n;let i=t.get(e.id);if(i){let o=i,{children:s,shadowRoot:a,id:l,type:c,tag:u,extra:h}=o,d=Ok(o,["children","shadowRoot","id","type","tag","extra"]),f=new Set(Object.keys(e));["id","type","tag",...Object.keys(d),"extra"].forEach(y=>{let _=y;f.has(_)?y==="attrs"?e.attrs=Wa(Wa({},d.attrs),e.attrs):this.context.onPatch(_,e,i):Reflect.set(e,_,i[_])}),ur(e)&&((n=e.children)==null||n.forEach(y=>{this.patchVElement(y,t)})),a&&(e.shadowRoot=this.patchVElement(a,t))}return e}patchIncrementalSnapshot(e,t,n){let i=this.patchVElement(t.document.root,n);e.window=Wa(Wa({},e.window),t.window);let{visibilityState:o}=t.document;return e.document.root=i,o&&(e.document.visibilityState=o),e}_createNewContent(){this._contentWindow={location:"about:blank",size:[0,0]},this._contentDocument={type:Y.DocumentNode,id:1,baseURI:"about:blank",title:"",root:{id:2,parentId:1,tag:"HTML",type:Y.ElementNode},visibilityState:"hidden"}}renderWindow(e){this._contentWindow=at(e)}renderDocument(e){this._contentDocument=at(e),this.context.nodes.addNode(this._contentDocument.id,this._contentDocument),this.renderNode(this._contentDocument.root,!1)}renderNode(e,t=!0){let n=t?at(e):e;return this.context.nodes.addNode(e.id,n),this.context.onNodeRender(e,n),Ge(n)&&this._renderElementNode(n),ur(n)&&this._renderChildren(n),n}_renderElementNode(e){e.shadowRoot&&this.renderNode(e.shadowRoot,!1)}_renderChildren(e){if(e.children)for(let t of e.children)this.renderNode(t,!1)}performNavigation(e){this._contentWindow.location=e.to,this.emit("navigate",e)}performAddNodeMutation(e){let t=this.getNode(e.target);if(!t)throw new Te(`Target with ID '${e.target}' not found.`);let n=this.renderNode(e.data.node);t.children||(t.children=[]);let i;e.data.before&&(i=this.getNode(e.data.before));let o;i&&(o=t.children.findIndex(s=>s.id===(i==null?void 0:i.id)))!==-1?t.children.splice(o,0,n):t.children.push(n)}performRemoveNodeMutation(e){let t=this.getNode(e.target);if(!t)throw new Te(`Node with ID '${e.target}' not found.`);let n,i=[];typeof e.data=="object"?(n=e.data.id,i=e.data.children):n=e.data;let o=this.getNode(n);if(!o)throw new Te(`Node with ID '${n}' not found.`);if(t.children){let s=t.children.findIndex(a=>a.id===o.id);s!==-1&&t.children.splice(s,1)}i.forEach(s=>{this.context.onNodeRemove(s),this.context.nodes.removeNode(s)}),this.context.onNodeRemove(n),this.context.nodes.removeNode(n)}performCharacterDataMutation(e){let t=this.getNode(e.target);if(!t)throw new Te(`Node with ID '${e.target}' not found.`);e.data!==null?t.text=e.data:delete t.text}performDocumentMutation(e){e.data.visibilityState&&(this.contentDocument.visibilityState=e.data.visibilityState)}applyAttrs(e,t){for(let[n,i]of Object.entries(e))i!==null?(t.attrs||(t.attrs={}),t.attrs[n]=i):t.attrs&&delete t.attrs[n]}applyScrolling(e,t){t.scroll=[...e]}applyValue(e,t){t.value=e}applyCheckedState(e,t){t.checked=e}applySize(e,t=!0){this.contentWindow.size=[...e],t&&this.emit("resize")}applyBlur(){}applyFocus(){}applySelection(){}rebuildNodes(e){e.addNode(this._contentDocument.root.id,this._contentDocument),this._rebuildNode(e,this._contentDocument.root)}_rebuildNode(e,t){var n;e.addNode(t.id,t),ur(t)&&((n=t.children)==null||n.forEach(i=>this._rebuildNode(e,i))),Ge(t)&&t.shadowRoot&&this._rebuildNode(e,t.shadowRoot)}performAndroidUpdateNodeMutation(e){}};var Ik=Object.defineProperty,Mk=(r,e,t)=>e in r?Ik(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Th=(r,e,t)=>Mk(r,typeof e!="symbol"?e+"":e,t),Uk=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),co=class extends vt{constructor(e){super(e),Th(this,"_changedWindow"),Th(this,"_changedDocument"),Th(this,"_changedCount",0),this.context.setIncremental(!0),this._initIncremental()}get size(){return this._changedWindow.size||super.size}get documentTitle(){return this._changedDocument.title||super.documentTitle}get documentURL(){return this._changedWindow.location||super.documentURL}get documentBaseURI(){return this._changedDocument.baseURI||super.documentBaseURI}reset(){super.reset(),this._initIncremental()}_initIncremental(){this._changedWindow={},this._changedDocument={},this._changedCount=0}getIncrementalPercent(){return this._changedCount/this.context.nodes.size()}renderWindow(e){super.renderWindow(e)}renderDocument(e){super.renderDocument(e),this._changedDocument.root=this.renderNode(e.root,!1)}captureIncrementalSnapshot(){return Uk(this,null,function*(){let e={version:1,window:this._changedWindow,document:this._changedDocument,id:this.context.snapshotId};this.context.capture(),yield this.context.executeQueuedTasks();let t=at(e);return this._initIncremental(),this.context.reset(),this._changedDocument.root=this.renderNode(e.document.root,!1),t})}renderNode(e,t=!0){let{id:n,type:i}=e,o=t?at(e):{id:n,type:i};return ur(e)&&(o.children=this.__renderChildren(e,t)),Ge(e)&&e.shadowRoot&&(o.shadowRoot=this.renderNode(e.shadowRoot,t)),this.context.nodes.addNode(e.id,o),o}__renderChildren(e,t=!0){if(e.children)return e.children.map(n=>this.renderNode(n,t))}performAddNodeMutation(e){super.performAddNodeMutation(e),this._changedCount++}performNavigation(e){this._changedWindow.location=e.to}applyAttrs(e,t){for(let[n,i]of Object.entries(e))t.attrs||(t.attrs={}),t.attrs[n]=i}applySize(e,t){this._changedWindow.size=e,t&&this.emit("resize")}rebuildNodes(e){this._changedDocument.id!=null&&e.addNode(this._changedDocument.root.id,this._changedDocument),this._rebuildNode(e,this._changedDocument.root)}};var Dr="bytereplay.bridging";function Bh(r){return typeof r=="object"&&!!r&&"topic"in r&&r.topic===Dr}var De=(r=>(r.Handshake="internal.handshake",r.Stopped="internal.stopped",r.Connected="internal.connected",r.Disconnected="internal.disconnected",r))(De||{});var Ka="__bytereplay_bridge__",Sh=class{get global(){return globalThis[Ka]}};var me=new Sh;var uy=Symbol("Comlink.proxy"),Nk=Symbol("Comlink.endpoint"),uo=Symbol("Comlink.releaseProxy"),Eh=Symbol("Comlink.finalizer"),Ha=Symbol("Comlink.thrown"),hy=r=>typeof r=="object"&&r!==null||typeof r=="function",Lk={canHandle:r=>hy(r)&&r[uy],serialize(r){let{port1:e,port2:t}=new MessageChannel;return kn(r,e),[t,[t]]},deserialize(r){return r.start(),Nr(r)}},Gk={canHandle:r=>hy(r)&&Ha in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},ho=new Map([["proxy",Lk],["throw",Gk]]);function Wk(r,e){for(let t of r)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function kn(r,e=globalThis,t=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!Wk(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}let{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(Vr),c;try{let u=a.slice(0,-1).reduce((d,f)=>d[f],r),h=a.reduce((d,f)=>d[f],r);switch(s){case"GET":c=h;break;case"SET":u[a.slice(-1)[0]]=Vr(i.data.value),c=!0;break;case"APPLY":c=h.apply(u,l);break;case"CONSTRUCT":{let d=new h(...l);c=kt(d)}break;case"ENDPOINT":{let{port1:d,port2:f}=new MessageChannel;kn(r,f),c=zk(d,[d])}break;case"RELEASE":c=void 0;break;default:return}}catch(u){c={value:u,[Ha]:0}}Promise.resolve(c).catch(u=>({value:u,[Ha]:0})).then(u=>{let[h,d]=Za(u);e.postMessage(Object.assign(Object.assign({},h),{id:o}),d),s==="RELEASE"&&(e.removeEventListener("message",n),dy(e),Eh in r&&typeof r[Eh]=="function"&&r[Eh]())}).catch(u=>{let[h,d]=Za({value:new TypeError("Unserializable return value"),[Ha]:0});e.postMessage(Object.assign(Object.assign({},h),{id:o}),d)})}),e.start&&e.start()}function Fk(r){return r.constructor.name==="MessagePort"}function dy(r){Fk(r)&&r.close()}function Nr(r,e){let t=new Map;return r.addEventListener("message",function(i){let{data:o}=i;if(!o||!o.id)return;let s=t.get(o.id);if(s)try{s(o)}finally{t.delete(o.id)}}),kh(r,t,[],e)}function ja(r){if(r)throw new Error("Proxy has been released and is not useable")}function py(r){return En(r,new Map,{type:"RELEASE"}).then(()=>{dy(r)})}var za=new WeakMap,Ja="FinalizationRegistry"in globalThis&&new FinalizationRegistry(r=>{let e=(za.get(r)||0)-1;za.set(r,e),e===0&&py(r)});function Kk(r,e){let t=(za.get(e)||0)+1;za.set(e,t),Ja&&Ja.register(r,e,r)}function jk(r){Ja&&Ja.unregister(r)}function kh(r,e,t=[],n=function(){}){let i=!1,o=new Proxy(n,{get(s,a){if(ja(i),a===uo)return()=>{jk(o),py(r),e.clear(),i=!0};if(a==="then"){if(t.length===0)return{then:()=>o};let l=En(r,e,{type:"GET",path:t.map(c=>c.toString())}).then(Vr);return l.then.bind(l)}return kh(r,e,[...t,a])},set(s,a,l){ja(i);let[c,u]=Za(l);return En(r,e,{type:"SET",path:[...t,a].map(h=>h.toString()),value:c},u).then(Vr)},apply(s,a,l){ja(i);let c=t[t.length-1];if(c===Nk)return En(r,e,{type:"ENDPOINT"}).then(Vr);if(c==="bind")return kh(r,e,t.slice(0,-1));let[u,h]=cy(l);return En(r,e,{type:"APPLY",path:t.map(d=>d.toString()),argumentList:u},h).then(Vr)},construct(s,a){ja(i);let[l,c]=cy(a);return En(r,e,{type:"CONSTRUCT",path:t.map(u=>u.toString()),argumentList:l},c).then(Vr)}});return Kk(o,r),o}function Hk(r){return Array.prototype.concat.apply([],r)}function cy(r){let e=r.map(Za);return[e.map(t=>t[0]),Hk(e.map(t=>t[1]))]}var fy=new WeakMap;function zk(r,e){return fy.set(r,e),r}function kt(r){return Object.assign(r,{[uy]:!0})}function Za(r){for(let[e,t]of ho)if(t.canHandle(r)){let[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},fy.get(r)||[]]}function Vr(r){switch(r.type){case"HANDLER":return ho.get(r.name).deserialize(r.value);case"RAW":return r.value}}function En(r,e,t,n){return new Promise(i=>{let o=Jk();e.set(o,i),r.start&&r.start(),r.postMessage(Object.assign({id:o},t),n)})}function Jk(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Qa=class extends J{constructor(e){super(),this.worker=e}handleInput(e){this._postFrame(e),this.output(e)}_postFrame(e){let t={topic:Dr,contentType:"bytereplay.core.Frame",content:e};try{this.worker.postMessage(t)}catch(n){console.error(`post frame(${e.trackType}, ${e.event.eventType}) to worker error.`,n)}}};var Zk=Object.defineProperty,Qk=(r,e,t)=>e in r?Zk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,my=(r,e,t)=>Qk(r,typeof e!="symbol"?e+"":e,t),Xa=class{constructor(e,t){my(this,"_isActive",!1),my(this,"_output",null),this.trackType=e,this.context=t}get isActive(){return this._isActive}get output(){return this._output||(this._output=this.createOutput()),this._output}activate(){this.setActive(!0),this.onActivate()}deactivate(){this.setActive(!1),this.onDeactivate()}onActivate(){}onDeactivate(){}setActive(e){this._isActive=e}};var Xk=Object.defineProperty,Yk=(r,e,t)=>e in r?Xk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,e1=(r,e,t)=>Yk(r,typeof e!="symbol"?e+"":e,t),ue=class extends Xa{constructor(){super(...arguments),e1(this,"_sequentialId",0)}track(e){if(this.isActive){let t=cn(this.trackType,e,P());this.output.next(t)}}createOutput(){return new Wt}nextId(){return++this._sequentialId}resetId(){this._sequentialId=0}};var t1=Object.defineProperty,r1=(r,e,t)=>e in r?t1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rn=(r,e,t)=>r1(r,typeof e!="symbol"?e+"":e,t),gy=class vy extends ue{constructor(e,t){super(w.Console,e),Rn(this,"_options"),Rn(this,"_eventTypesMapping"),Rn(this,"_vanillaMethods",new Map),Rn(this,"_hookedMethods",new Map),Rn(this,"_handleConsole",(n,...i)=>{this._eventTypesMapping&&this.track({eventType:this._eventTypesMapping[n],data:this._postProcess(i)})}),this._options=t}activate(){super.activate();let e=this._getAvailableMethodNames();this._eventTypesMapping=this._generateEventTypesMapping(e);for(let t of e)this._hook(t,this._handleConsole)}deactivate(){super.deactivate();let e=this._getAvailableMethodNames();for(let t of e)this._unhook(t);this._eventTypesMapping=void 0,this._vanillaMethods.clear(),this._hookedMethods.clear()}_hook(e,t){if(!this._vanillaMethods.has(e)){let n=window.console[e];this._vanillaMethods.set(e,n),window.console[e]=function(...i){t(e,...i),n.apply(this,i)},this._hookedMethods.set(e,window.console[e])}}_unhook(e){this._vanillaMethods.has(e)&&window.console[e]===this._hookedMethods.get(e)&&(window.console[e]=this._vanillaMethods.get(e))}_generateEventTypesMapping(e){let t={};for(let n of e)t[n]=m[`Console${n[0].toUpperCase()}${n.slice(1)}`];return t}_postProcess(e){return e.map(t=>{var n;try{return vu(t,(n=this._options)==null?void 0:n.stringifyOptions)}catch(i){return"[Can't stringify]"}})}_getAvailableMethodNames(){var e,t;return window.console?((t=(e=this._options)==null?void 0:e.levels)!=null?t:vy.CONSOLE_METHODS).filter(n=>re(window.console[n])):[]}};Rn(gy,"CONSOLE_METHODS",["error","log"]);var Rh=gy;var n1=Object.defineProperty,_y=Object.getOwnPropertySymbols,i1=Object.prototype.hasOwnProperty,o1=Object.prototype.propertyIsEnumerable,Oh=(r,e,t)=>e in r?n1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,s1=(r,e)=>{for(var t in e||(e={}))i1.call(e,t)&&Oh(r,t,e[t]);if(_y)for(var t of _y(e))o1.call(e,t)&&Oh(r,t,e[t]);return r},yy=(r,e,t)=>Oh(r,typeof e!="symbol"?e+"":e,t),po=class extends ue{constructor(e){super(w.Error,e),yy(this,"_handleError",t=>{var n,i,o,s,a,l;let c=this.nextId(),u=window.location.href;if(t instanceof ErrorEvent){let{message:h}=t;if(/^script error\.?$/i.test(h))this.track({eventType:m.ERROR_SCRIPT,data:{id:c,message:h,page:u}});else{let d={},{error:f}=t;f&&f.stack&&(d.stack=f.stack),this.track({eventType:m.ERROR_RUNTIME,data:s1({id:c,message:h,source:t.filename,lineno:t.lineno,colno:t.colno,page:u},d)})}}else{let h={id:c,message:"Resource Not Found."},d=t.target;if(d){h.page=(n=d.baseURI)!=null?n:u;let f=(l=(a=(s=(i=d.getAttribute)==null?void 0:i.call(d,"src"))!=null?s:(o=d.getAttribute)==null?void 0:o.call(d,"href"))!=null?a:d.src)!=null?l:d.href;T(f)?h.source=f:Sc(f)&&(h.source=f.baseVal)}this.track({eventType:m.ERROR_NOTFOUND,data:h})}}),yy(this,"_handleRejection",t=>{let n="Uncaught (in promise) Error",i={id:this.nextId(),message:`${n}.`,page:window.location.href},{reason:o}=t;o&&(T(o)?i.message=o:(o.message&&(i.message=`${n}: ${o.message}`),o.stack&&(i.stack=o.stack))),this.track({eventType:m.ERROR_PROMISEREJECTION,data:i})})}activate(){super.activate(),window.addEventListener("error",this._handleError,!0),window.addEventListener("unhandledrejection",this._handleRejection,!0)}deactivate(){super.deactivate(),window.removeEventListener("error",this._handleError,!0),window.removeEventListener("unhandledrejection",this._handleRejection,!0)}};var a1=Object.defineProperty,l1=(r,e,t)=>e in r?a1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,by=(r,e,t)=>l1(r,typeof e!="symbol"?e+"":e,t),Ya=class{constructor(e){by(this,"_iFrames",new WeakMap),by(this,"_contexts",new WeakMap);var t,n,i;this.callback=e,(t=me.global)==null||t.iframe.on("recordingStarted",(o,s)=>{let a=this._iFrames.get(s);a&&this._handleAction(a,{type:ze.StartRecording,data:o})}),(n=me.global)==null||n.iframe.on("recordingStopped",(o,s)=>{let a=this._iFrames.get(s);a&&this._handleAction(a,{type:ze.StopRecording,data:o})}),(i=me.global)==null||i.iframe.on("unload",o=>{let s=this._iFrames.get(o);s&&this._handleAction(s,{type:ze.Unload,data:{}})})}get nodeNames(){return["IFRAME"]}observe(e,t,n){var i;let o=t.contentWindow;if(o){let s=t.contentDocument==null;this._iFrames.set(o,t),this._contexts.set(t,e);let a="";if(!s)a=location.origin;else try{a=new URL(t.src).origin}catch(l){}(i=me.global)==null||i.iframe.connect(o,{isCrossOrigin:s,origin:a}),t.addEventListener("load",()=>{this.observe(e,t,{}),this._handleAction(t,{type:ze.Load,data:{}})},{once:!0})}n.extra={state:pt.Loaded}}disconnect(e){e.contentWindow&&(this._iFrames.delete(e.contentWindow),this._contexts.delete(e))}disconnectAll(){this._iFrames=new WeakMap,this._contexts=new WeakMap}_handleAction(e,t){var n;let i=(n=this._contexts.get(e))==null?void 0:n.nodes.getNodeId(e);i!=null&&this.callback({eventType:m.HTMLIFrame,data:{target:i,action:t}})}};var c1=Object.defineProperty,u1=(r,e,t)=>e in r?c1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,el=(r,e,t)=>u1(r,typeof e!="symbol"?e+"":e,t),tl=class{constructor(e,t){el(this,"prevUrl"),el(this,"_navigationHandler"),el(this,"_idleTimer"),el(this,"_watch",()=>{this.prevUrl!==location.href&&(this.callback({eventType:m.HTMLNavigation,data:{from:this.prevUrl||"",to:location.href,type:"unknown"}}),this.prevUrl=location.href)}),this.context=e,this.callback=t}start(){if("navigation"in globalThis){let e=t=>{this.callback({eventType:m.HTMLNavigation,data:{from:t.target.currentEntry.url,to:t.destination.url,type:t.navigationType}})};globalThis.navigation.addEventListener("navigate",e)}else this.prevUrl=location.href,this._idleTimer=this._nextTick()}_nextTick(){return setInterval(this._watch,1e3)}stop(){"navigation"in globalThis&&this._navigationHandler?globalThis.navigation.removeEventListener("navigate",this._navigationHandler):this._idleTimer!==void 0&&clearInterval(this._idleTimer)}};var h1=Object.defineProperty,d1=(r,e,t)=>e in r?h1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ch=(r,e,t)=>d1(r,typeof e!="symbol"?e+"":e,t),fo=class extends ue{constructor(e,t){super(w.HTML,e),Ch(this,"_snapshotCapturer"),Ch(this,"_navigationObserver"),Ch(this,"_handleTrackEvent",n=>{this.track(n)}),this._snapshotCapturer=new $n(t),t!=null&&t.navigation&&(this._navigationObserver=new tl(e,n=>{this.track(n)})),t!=null&&t.iframe&&this._snapshotCapturer.registerNodeObserver(Ya)}get snapshotCapturer(){return this._snapshotCapturer}activate(){var e;super.activate(),this._snapshotCapturer.on("event",this._handleTrackEvent),this._snapshotCapturer.start(),(e=this._navigationObserver)==null||e.start()}deactivate(){var e;super.deactivate(),this._snapshotCapturer.off("event",this._handleTrackEvent),this._snapshotCapturer.stop(),(e=this._navigationObserver)==null||e.stop()}getNodeId(e){return this._snapshotCapturer.getNodeId(e)}};var p1=Object.defineProperty,f1=(r,e,t)=>e in r?p1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,rl=(r,e,t)=>f1(r,typeof e!="symbol"?e+"":e,t),mo=class extends ue{constructor(e,t){var n;super(w.Keyboard,e),rl(this,"_config"),rl(this,"MODIFIER_KEYS",{Alt:!0,Shift:!0,Control:!0,Meta:!0}),rl(this,"ALLOWED_INPUT_TYPES",{button:!0,checkbox:!0,color:!0,file:!0,hidden:!0,image:!0,radio:!0,range:!0,reset:!0,submit:!0}),rl(this,"_handleKeyDown",i=>{let{key:o,target:s}=i;this._shouldIgnoreKey(o)||this.track({eventType:m.KeyDown,data:[o,i.code,i.altKey,i.ctrlKey,i.metaKey,i.shiftKey,this.context.getNodeId(s)]})}),this._config={ignoreModifierKeys:(n=t==null?void 0:t.ignoreModifierKeys)!=null?n:!0}}activate(){super.activate(),document.addEventListener("keydown",this._handleKeyDown,!0)}deactivate(){super.deactivate(),document.removeEventListener("keydown",this._handleKeyDown,!0)}_shouldIgnoreKey(e){return this._config.ignoreModifierKeys?this.MODIFIER_KEYS[e]===!0:!1}};var Ve=class extends oe{constructor(e,t){super(e,t),this.name="bytereplay.recorder.RecordingError"}};var nl=class extends Ve{constructor(e,t){super(e,t),this.name="bytereplay.recorder.TrackingError"}};var m1=Object.defineProperty,g1=(r,e,t)=>e in r?m1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,he=(r,e,t)=>g1(r,typeof e!="symbol"?e+"":e,t),v1={BUTTON:!0,A:!0,SPAN:!0,LABEL:!0,INPUT:!0,SELECT:!0,TH:!0,TD:!0,SUMMARY:!0,DETAILS:!0},go=class extends ue{constructor(e,t){var n,i,o,s;super(w.Mouse,e),he(this,"_samplingInterval"),he(this,"_samplingDistance",2),he(this,"_maxTextLength"),he(this,"_lastRecordTime",0),he(this,"_lastRecordPosition"),he(this,"_mouseTargetId"),he(this,"_mouseTargetContext"),he(this,"_isTouching",!1),he(this,"_handleMouseMove",a=>{this._isTouching||(this._lastRecordTime===0||P()-this._lastRecordTime>this._samplingInterval)&&(this._lastRecordPosition==null||y1(a,this._lastRecordPosition)>this._samplingDistance)&&(this._lastRecordTime=P(),this._lastRecordPosition==null?this._lastRecordPosition=[a.x,a.y]:(this._lastRecordPosition[0]=a.x,this._lastRecordPosition[1]=a.y),this.track(this._convertMouseEvent2TrackerEvent(a)))}),he(this,"_handleMouseDown",a=>{if(this._isTouching)return;this._lastRecordTime=0,this._lastRecordPosition=void 0;let l=a.target;this._mouseTargetId=this.context.getNodeId(l),this._mouseTargetContext=this._getTargetContext(l),this.track(this._convertMouseEvent2TrackerEvent(a,this._mouseTargetId,this._mouseTargetContext))}),he(this,"_handleMouseUp",a=>{this._isTouching||(this.track(this._convertMouseEvent2TrackerEvent(a,this._mouseTargetId,this._mouseTargetContext)),this._reset())}),he(this,"_handleMouseClick",a=>{if(!this._shouldIgnoreMouseClick(a)){let l=a.target;this.track(this._convertMouseEvent2TrackerEvent(a,this.context.getNodeId(l),this._getTargetContext(l)))}}),he(this,"_handleMouseEnter",a=>{let l=a.target;this.track(this._convertMouseEvent2TrackerEvent(a,this.context.getNodeId(l),this._getTargetContext(l)))}),he(this,"_handleMouseLeave",a=>{let l=a.target;this.track(this._convertMouseEvent2TrackerEvent(a,this.context.getNodeId(l),this._getTargetContext(l)))}),he(this,"_handleTouchStart",a=>{this._isTouching=!0,this._lastRecordTime=0;let l=this._gatherTouches(a.touches);l.length>0&&this.track({eventType:m.TouchStart,data:l})}),he(this,"_handleTouchMove",a=>{if(this._lastRecordTime===0||P()-this._lastRecordTime>this._samplingInterval){this._lastRecordTime=P();let l=this._gatherTouches(a.touches,!1,!1);l.length>0&&this.track({eventType:m.TouchMove,data:l})}}),he(this,"_handleTouchEnd",a=>{setTimeout(()=>this._isTouching=!1,20);let l=this._gatherTouches(a.changedTouches);l.length>0&&this.track({eventType:m.TouchEnd,data:l})}),he(this,"_handleTouchCancel",a=>{setTimeout(()=>this._isTouching=!1,20);let l=this._gatherTouches(a.changedTouches);l.length>0&&this.track({eventType:m.TouchCancel,data:l})}),this._samplingInterval=Math.floor(1e3/((n=t==null?void 0:t.samplingRate)!=null?n:8)*1e3)/1e3,this._maxTextLength=(i=t==null?void 0:t.maxTextLength)!=null?i:100,this._maxTextLength>199&&console.warn(`The option "maxTextLength" is set too high (${this._maxTextLength}), which may impact your web performance.`),(o=this.context.snapshotCapturer)==null||o.nodes.on("nodeAdded",a=>{a instanceof HTMLIFrameElement&&(a.addEventListener("mouseenter",this._handleMouseEnter,{capture:!1,once:!1}),a.addEventListener("mouseleave",this._handleMouseLeave,{capture:!1,once:!1}))}),(s=this.context.snapshotCapturer)==null||s.nodes.on("nodeRemoved",a=>{a instanceof HTMLIFrameElement&&(a.removeEventListener("mouseenter",this._handleMouseEnter,{capture:!1}),a.removeEventListener("mouseleave",this._handleMouseLeave,{capture:!1}))})}activate(){super.activate(),this._reset(),window.addEventListener("touchstart",this._handleTouchStart,!0),window.addEventListener("touchmove",this._handleTouchMove,!0),window.addEventListener("touchend",this._handleTouchEnd,!0),window.addEventListener("touchcancel",this._handleTouchCancel,!0),window.addEventListener("mousemove",this._handleMouseMove,!0),window.addEventListener("mousedown",this._handleMouseDown,!0),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("click",this._handleMouseClick,!0),document.addEventListener("mouseenter",this._handleMouseEnter,{capture:!1,once:!1}),document.addEventListener("mouseleave",this._handleMouseLeave,{capture:!1,once:!1})}deactivate(){super.deactivate(),this._reset(),window.removeEventListener("touchstart",this._handleTouchStart,!0),window.removeEventListener("touchmove",this._handleTouchMove,!0),window.removeEventListener("touchend",this._handleTouchEnd,!0),window.removeEventListener("touchcancel",this._handleTouchCancel,!0),window.removeEventListener("mousemove",this._handleMouseMove,!0),window.removeEventListener("mousedown",this._handleMouseDown,!0),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("click",this._handleMouseClick,!0),document.removeEventListener("mouseenter",this._handleMouseEnter,{capture:!1}),document.removeEventListener("mouseleave",this._handleMouseLeave,{capture:!1});let e=document.querySelectorAll("iframe");for(let t=0;t<e.length;t++){let n=e[t];n.removeEventListener("mouseenter",this._handleMouseEnter,{capture:!1}),n.removeEventListener("mouseleave",this._handleMouseLeave,{capture:!1})}}_convertMouseEvent2TrackerEvent(e,t,n){let i=[e.clientX,e.clientY,e.buttons];return t!=null&&n!=null?i.push(t,n):t!=null?i.push(t):n!=null&&(i[4]=n),{eventType:_1(e),data:i}}_gatherTouches(e,t=!0,n=!0){let i=[];for(let o=0;o<e.length;o++){let s=e[o],a=[Math.round(s.clientX),Math.round(s.clientY),s.identifier];if(t){let l=this.context.getNodeId(s.target);l!=null&&a.push(l)}if(n){let l=this._getTargetContext(s.target);l!=null&&(a[4]=l)}i.push(a)}return i}_getTargetContext(e){var t;if(e!=null&&it(e)){let n={tagName:e.tagName};if(v1[n.tagName]){let i=(t=e.textContent)!=null?t:void 0;i!=null&&(n.textContent=i.length>this._maxTextLength?i.slice(0,this._maxTextLength)+"...":i)}return n}}_shouldIgnoreMouseClick(e){let t=e.target;if(t==null||!Qc[t.tagName])return!1;let{detail:n,explicitOriginalTarget:i}=e;return n===0||i!=null&&i!==t}_reset(){this._lastRecordTime=0,this._lastRecordPosition=void 0,this._mouseTargetId=void 0,this._mouseTargetContext=void 0,this._isTouching=!1}};function _1(r){switch(r.type){case"mousemove":return m.MouseMove;case"mousedown":return m.MouseDown;case"mouseup":return m.MouseUp;case"click":return m.MouseClick;case"mouseenter":return m.MouseEnter;case"mouseleave":return m.MouseLeave;default:throw new nl(`Unknown mouse event type: ${r.type}`)}}function y1(r,e){return Math.abs(r.x-e[0])+Math.abs(r.y-e[1])}var b1=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())});function $y(r){let[e,t]=Ih(r)?r.data:r.data[0];return[e,t]}function wy(r){return(Ih(r)?r.data:r.data[0])[3]}function xy(r){return(Ih(r)?r.data:r.data[0])[4]}function Ih(r){let{eventType:e}=r;return e===m.MouseMove||e===m.MouseDown||e===m.MouseUp||e===m.MouseClick||e===m.MouseEnter||e===m.MouseLeave}function qy(r){return r.responseType===""||r.responseType==="text"||r.responseType==="json"?r.response:r.response&&r.response.toString()}function Ty(r,e=!0){return b1(this,null,function*(){var t,n,i,o;let s;try{let a=r.clone(),l=(n=(t=r.headers)==null?void 0:t.get("Content-Type"))==null?void 0:n.toLowerCase();try{if(X(l,"text/plain"))s=yield a.text();else if(X(l,"application/json"))s=yield a.json();else if(X(l,"application/octet-stream")){if(e){let c=yield a.arrayBuffer();s=new TextDecoder().decode(c)}}else s=(i=a.body)==null?void 0:i.toString()}catch(c){s=(o=a.body)==null?void 0:o.toString()}}catch(a){}return s})}var $1=Object.defineProperty,w1=Object.defineProperties,x1=Object.getOwnPropertyDescriptors,By=Object.getOwnPropertySymbols,q1=Object.prototype.hasOwnProperty,T1=Object.prototype.propertyIsEnumerable,Mh=(r,e,t)=>e in r?$1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,il=(r,e)=>{for(var t in e||(e={}))q1.call(e,t)&&Mh(r,t,e[t]);if(By)for(var t of By(e))T1.call(e,t)&&Mh(r,t,e[t]);return r},B1=(r,e)=>w1(r,x1(e)),Be=(r,e,t)=>Mh(r,typeof e!="symbol"?e+"":e,t),S1=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Rt=class Me extends ue{constructor(e,t){super(w.Network,e),Be(this,"_options"),Be(this,"_vanillaMethods",new Map),Be(this,"_hookedMethods",new Map),Be(this,"_xhrContexts",new WeakMap),Be(this,"_handleXHRSend",(n,i)=>{var o;if(n){let s=n.request;if(s.url=(o=this._parseURL(s.url))!=null?o:"",this._options.captureRequestBody){let a=this._parseBody(i);a!=null&&(s.body=a)}this.track({eventType:m.NETWORK_SEND,data:s})}}),Be(this,"_handleXHRAbort",n=>{let i=this._xhrContexts.get(n.target);i&&(i.eventType=m.NETWORK_ABORT)}),Be(this,"_handleXHRError",n=>{let i=this._xhrContexts.get(n.target);i&&(i.eventType=m.NETWORK_ERROR)}),Be(this,"_handleXHRTimeout",n=>{let i=this._xhrContexts.get(n.target);i&&(i.eventType=m.NETWORK_TIMEOUT)}),Be(this,"_handleXHRLoad",n=>{let i=this._xhrContexts.get(n.target);i&&(i.eventType=m.NETWORK_DONE)}),Be(this,"_handleXHRLoadEnd",n=>{let i=n.target,o=this._xhrContexts.get(i);if(o){this._xhrContexts.delete(i),i.responseURL!=null&&(o.response.url=i.responseURL);let s=dn(i.getAllResponseHeaders());s!=null&&(o.response.headers=s),i.status!=null&&(o.response.status=i.status),i.statusText!=null&&(o.response.statusText=i.statusText),i.responseType!=null&&(o.response.type=i.responseType);let a=qy(i);this._options.captureResponseBody&&a!=null&&(o.response.body=a),this._captureResponseStats(o,a),this.track({eventType:o.eventType,data:o.response})}}),this._options=il({captureResponseBody:!1,captureRequestBody:!0,captureRequestURLQuery:!0,disableDataMasking:!1,disableBuiltInDataMasks:!1,dataMasks:[],maskingLevel:Pe.BALANCE},t)}activate(){super.activate(),this._hookXHR(),this._hookFetch()}deactivate(){super.deactivate(),this._unhookXHR(),this._unhookFetch()}_hookXHR(){let e=this._options.xhr?this._options.xhr.prototype:XMLHttpRequest?XMLHttpRequest.prototype:void 0;if(e){let t=Me.XHR_METHODS.filter(n=>re(e[n]));for(let n of t)this._hookXHRMethod(e,n)}}_unhookXHR(){let e=this._options.xhr?this._options.xhr.prototype:XMLHttpRequest?XMLHttpRequest.prototype:void 0;if(e){let t=Me.XHR_METHODS.filter(n=>re(e[n]));for(let n of t)this._unhook(e,n);this._xhrContexts=new WeakMap}}_hookXHRMethod(e,t){if(!this._vanillaMethods.has(t)){let n=e[t];this._vanillaMethods.set(t,n);let i=this;e[t]=function(...o){var s,a;if(t===Me.XHR_OPEN){let l=i.nextId(),[c,u,h,d,f]=o,y={eventType:m.NETWORK_SEND,request:{id:l,type:"xhr",method:c,url:String(u)},response:{id:l}};h!=null&&(y.request.async=h),d!=null&&(y.request.user=d),f!=null&&(y.request.password=f),i._xhrContexts.set(this,y)}else if(t===Me.XHR_SEND){let l=i._xhrContexts.get(this);l&&(a=(s=i._options).shouldIgnoreRequest)!=null&&a.call(s,l.request)?i._xhrContexts.delete(this):(this.removeEventListener&&(this.removeEventListener("abort",i._handleXHRAbort),this.removeEventListener("error",i._handleXHRError),this.removeEventListener("timeout",i._handleXHRTimeout),this.removeEventListener("load",i._handleXHRLoad),this.removeEventListener("loadend",i._handleXHRLoadEnd)),this.addEventListener("abort",i._handleXHRAbort),this.addEventListener("error",i._handleXHRError),this.addEventListener("timeout",i._handleXHRTimeout),this.addEventListener("load",i._handleXHRLoad),this.addEventListener("loadend",i._handleXHRLoadEnd),i._handleXHRSend(l,o[0]))}else if(t===Me.XHR_SET_REQUEST_HEADER){let l=i._xhrContexts.get(this);if(l){let[c,u]=o;l.request.headers==null&&(l.request.headers={});let h=l.request.headers;h[c]==null?h[c]=u:h[c]=`${h[c]}, ${u}`}}n.apply(this,o)},this._hookedMethods.set(t,e[t])}}_hookFetch(){var e;let t=(e=this._options.fetchable)!=null?e:window;if(wt.fetch(t)&&!this._vanillaMethods.has(Me.FETCH_API)){let n=this,i=t[Me.FETCH_API];this._vanillaMethods.set(Me.FETCH_API,i),t[Me.FETCH_API]=function(o,s){var a,l;if(s!=null&&s[ri])return i.call(this,o,s);let c=n.nextId(),u={request:{id:c,type:"fetch",method:"GET",url:""},response:{id:c}};if(T(o))u.request.url=o;else if(Tc(o)){if(n._options.captureRequestBody){let h=n._parseBody(o.body);h!=null&&(u.request.body=h)}if(u.request.method=o.method,u.request.url=o.url,o.cache!=null&&(u.request.cache=o.cache),o.credentials!=null&&(u.request.credentials=o.credentials),o.headers!=null){let h=dn(o.headers);h!=null&&(u.request.headers=h)}o.integrity!=null&&(u.request.integrity=o.integrity),o.keepalive!=null&&(u.request.keepalive=o.keepalive),o.mode!=null&&(u.request.mode=o.mode),o.redirect!=null&&(u.request.redirect=o.redirect),o.referrer!=null&&(u.request.referrer=o.referrer),o.referrerPolicy!=null&&(u.request.referrerPolicy=o.referrerPolicy)}if((l=(a=n._options).shouldIgnoreRequest)!=null&&l.call(a,u.request))return i.call(this,o,s);if(s!=null&&(s.body!=null&&n._options.captureRequestBody&&(u.request.body=n._parseBody(s.body)),s.cache!=null&&(u.request.cache=s.cache),s.credentials!=null&&(u.request.credentials=s.credentials),s.integrity!=null&&(u.request.integrity=s.integrity),s.keepalive!=null&&(u.request.keepalive=s.keepalive),s.method!=null&&(u.request.method=s.method),s.mode!=null&&(u.request.mode=s.mode),s.redirect!=null&&(u.request.redirect=s.redirect),s.referrer!=null&&(u.request.referrer=s.referrer),s.referrerPolicy!=null&&(u.request.referrerPolicy=s.referrerPolicy),s.headers!=null)){let h=dn(s.headers);(u.request.headers!=null||h!=null)&&(u.request.headers=il(il({},u.request.headers),h))}return n._handleFetchEvent(u,m.NETWORK_SEND),i.call(this,o,s).then(h=>(n._handleFetchResponse(u,h),h)).catch(h=>{throw n._handleFetchEvent(u,m.NETWORK_ERROR),h})},t[Me.FETCH_API].toString=function(){return"function fetch() { [native code] }"},this._hookedMethods.set(Me.FETCH_API,t[Me.FETCH_API])}}_unhookFetch(){var e;let t=(e=this._options.fetchable)!=null?e:window;this._unhook(t,Me.FETCH_API)}_unhook(e,t){e&&this._vanillaMethods.has(t)&&this._hookedMethods.has(t)&&e[t]===this._hookedMethods.get(t)&&(e[t]=this._vanillaMethods.get(t),this._vanillaMethods.delete(t),this._hookedMethods.delete(t))}_handleFetchResponse(e,t){return S1(this,null,function*(){t.ok!=null&&(e.response.ok=t.ok),t.url!=null&&(e.response.url=t.url),t.redirected!=null&&(e.response.redirected=t.redirected),t.status!=null&&(e.response.status=t.status),t.statusText!=null&&(e.response.statusText=t.statusText),t.type!=null&&(e.response.type=t.type);let n=dn(t.headers);n!=null&&(e.response.headers=n);let i=yield Ty(t);this._options.captureResponseBody&&i!=null&&(e.response.body=i),this._captureResponseStats(e,i),this._handleFetchEvent(e,m.NETWORK_DONE)})}_handleFetchEvent(e,t){var n;let i;t===m.NETWORK_SEND?i=e.request:i=e.response,i.url=(n=this._parseURL(i.url))!=null?n:"",this.track({eventType:t,data:i})}_captureResponseStats(e,t){if(this._options.captureResponseStats)try{let n=this._options.captureResponseStats(e.request,B1(il({},e.response),{body:t}));n!=null&&(e.response.stats=n)}catch(n){}}_parseURL(e){let t=e;if(t!=null&&t!=="")try{if(!this._options.captureRequestURLQuery){let n=new URL(t);return n.search="",n.toString()}}catch(n){}return t}_parseBody(e){if(e!=null){if(ir(e))return Cu(e);if(e instanceof ReadableStream)return"[object ReadableStream]"}return e}};Be(Rt,"FETCH_API","fetch"),Be(Rt,"XHR_OPEN","open"),Be(Rt,"XHR_SEND","send"),Be(Rt,"XHR_SET_REQUEST_HEADER","setRequestHeader"),Be(Rt,"XHR_METHODS",[Rt.XHR_OPEN,Rt.XHR_SEND,Rt.XHR_SET_REQUEST_HEADER]);var Uh=Rt;var E1=Object.defineProperty,k1=Object.defineProperties,R1=Object.getOwnPropertyDescriptors,Sy=Object.getOwnPropertySymbols,O1=Object.prototype.hasOwnProperty,C1=Object.prototype.propertyIsEnumerable,Ph=(r,e,t)=>e in r?E1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ey=(r,e)=>{for(var t in e||(e={}))O1.call(e,t)&&Ph(r,t,e[t]);if(Sy)for(var t of Sy(e))C1.call(e,t)&&Ph(r,t,e[t]);return r},I1=(r,e)=>k1(r,R1(e)),Yt=(r,e,t)=>Ph(r,typeof e!="symbol"?e+"":e,t),ky="longtask",Ry="navigation",Oy="resource",vo=class extends ue{constructor(e,t){var n;super(w.Performance,e),Yt(this,"_performanceObserver"),Yt(this,"_config"),Yt(this,"_handlePerformance",o=>{this._traceLongTaskEntries(o.getEntriesByType(ky)),this._traceNavigationEntries(o.getEntriesByType(Ry)),this._traceResourceEntries(o.getEntriesByType(Oy))}),Yt(this,"_traceLongTaskEntries",o=>{let s=[];for(let a of o){let l={entryType:a.entryType,name:a.name,startTime:z(a.startTime),duration:Se(a.duration)};this._config.shouldIgnoreTiming(l)||s.push(l)}s.length>0&&this.track({eventType:m.PERFORMANCE_LONG_TASK,data:s})}),Yt(this,"_traceResourceEntries",o=>{if(o.length>0){let s=[];for(let a of o){let l=this._createResourceTiming(a);!this._isBuiltinTiming(l)&&!this._config.shouldIgnoreTiming(l)&&s.push(l)}s.length>0&&this.track({eventType:m.PERFORMANCE_RESOURCE,data:s})}}),Yt(this,"_traceNavigationEntries",o=>{if(o.length>0){let s=[];for(let a of o){let l=this._createNavigationTiming(a);!this._isBuiltinTiming(l)&&!this._config.shouldIgnoreTiming(l)&&s.push(l)}s.length>0&&this.track({eventType:m.PERFORMANCE_NAVIGATION,data:s})}}),Yt(this,"_createResourceTiming",o=>{var s;let a={entryType:o.entryType,name:o.name,startTime:z(o.startTime),duration:Se(o.duration),initiatorType:o.initiatorType,nextHopProtocol:o.nextHopProtocol,serverTiming:((s=o.serverTiming)!=null?s:[]).map(l=>({name:l.name,duration:Se(l.duration),description:l.description})),stats:{total:Se(o.duration)}};if(o.deliveryType!=null&&(a.deliveryType=o.deliveryType),o.notRestoredReasons!=null&&(a.notRestoredReasons=Cy(o.notRestoredReasons)),o.renderBlockingStatus!=null&&(a.renderBlockingStatus=o.renderBlockingStatus),o.responseStatus!=null&&(a.responseStatus=o.responseStatus),B(o.redirectStart)&&(a.redirectStart=z(o.redirectStart)),B(o.redirectEnd)&&(a.redirectEnd=z(o.redirectEnd)),B(o.workerStart)&&(a.workerStart=z(o.workerStart)),B(o.fetchStart)&&(a.fetchStart=z(o.fetchStart)),B(o.domainLookupStart)&&(a.domainLookupStart=z(o.domainLookupStart)),B(o.domainLookupEnd)&&(a.domainLookupEnd=z(o.domainLookupEnd)),B(o.connectStart)&&(a.connectStart=z(o.connectStart)),B(o.secureConnectionStart)&&(a.secureConnectionStart=z(o.secureConnectionStart)),B(o.connectEnd)&&(a.connectEnd=z(o.connectEnd)),B(o.requestStart)&&(a.requestStart=z(o.requestStart)),B(o.firstInterimResponseStart)&&(a.firstInterimResponseStart=z(o.firstInterimResponseStart)),B(o.responseStart)&&(a.responseStart=z(o.responseStart)),B(o.responseEnd)&&(a.responseEnd=z(o.responseEnd)),B(o.redirectEnd)&&B(o.redirectStart)&&(a.stats.redirect=Se(o.redirectEnd-o.redirectStart)),B(o.domainLookupStart)&&B(o.workerStart)&&(a.stats.serviceWorker=Se(o.domainLookupStart-o.workerStart)),B(o.domainLookupEnd)&&B(o.domainLookupStart)&&(a.stats.dns=Se(o.domainLookupEnd-o.domainLookupStart)),B(o.connectEnd)&&B(o.connectStart)&&(a.stats.tcp=Se(o.connectEnd-o.connectStart)),B(o.responseEnd)&&B(o.responseStart)&&(a.stats.contentDownload=Se(o.responseEnd-o.responseStart)),B(o.responseStart)&&(a.stats.ttfb=Se(o.responseStart-o.startTime)),o.serverTiming!=null&&o.serverTiming.length>0){let l=Math.max(...o.serverTiming.map(c=>c.duration));a.stats.server=Se(l),B(o.responseStart)&&(a.stats.client=Se(o.responseStart-o.startTime-l))}return a}),Yt(this,"_createNavigationTiming",o=>{let s=I1(Ey({},this._createResourceTiming(o)),{entryType:o.entryType,type:o.type,redirectCount:o.redirectCount});return B(o.unloadEventStart)&&(s.unloadEventStart=z(o.unloadEventStart)),B(o.unloadEventEnd)&&(s.unloadEventEnd=z(o.unloadEventEnd)),B(o.domInteractive)&&(s.domInteractive=z(o.domInteractive)),B(o.domContentLoadedEventStart)&&(s.domContentLoadedEventStart=z(o.domContentLoadedEventStart)),B(o.domContentLoadedEventEnd)&&(s.domContentLoadedEventEnd=z(o.domContentLoadedEventEnd)),B(o.domComplete)&&(s.domComplete=z(o.domComplete)),B(o.loadEventStart)&&(s.loadEventStart=z(o.loadEventStart)),B(o.loadEventEnd)&&(s.loadEventEnd=z(o.loadEventEnd)),B(o.unloadEventEnd)&&B(o.unloadEventStart)&&(s.stats.unload=Se(o.unloadEventEnd-o.unloadEventStart)),B(o.domComplete)&&B(o.domInteractive)&&(s.stats.domProcessing=Se(o.domComplete-o.domInteractive)),B(o.loadEventEnd)&&B(o.loadEventStart)&&(s.stats.load=Se(o.loadEventEnd-o.loadEventStart)),s});let i=t==null?void 0:t.buffered;this._config={buffered:i===!0||i===!1?{navigation:i,resource:i}:Ey({navigation:!0,resource:!1},i),shouldIgnoreTiming:(n=t==null?void 0:t.shouldIgnoreTiming)!=null?n:M1}}activate(){super.activate(),wt.performanceObserver()&&(this._performanceObserver=new PerformanceObserver(this._handlePerformance),this._performanceObserver.observe({type:ky}),this._performanceObserver.observe({type:Ry,buffered:this._config.buffered.navigation}),this._performanceObserver.observe({type:Oy,buffered:this._config.buffered.resource}))}deactivate(){var e;super.deactivate(),(e=this._performanceObserver)==null||e.disconnect(),this._performanceObserver=void 0}_isBuiltinTiming(e){var t;return(t=e.name)==null?void 0:t.startsWith(this.context.env.baseURL)}};function M1(){return!1}function B(r){return r!=null&&r>0}function Se(r){return Math.round(r*100)/100}function Cy(r){var e;let t={reasons:(e=r.reasons)==null?void 0:e.map(n=>({reason:n.reason}))};return r.src!=null&&(t.src=r.src),r.url!=null&&(t.url=r.url),r.id!=null&&(t.id=r.id),r.name!=null&&(t.name=r.name),r.children!=null&&r.children.length>0&&(t.children=r.children.map(Cy)),t}var U1=Object.defineProperty,P1=(r,e,t)=>e in r?U1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Iy=(r,e,t)=>P1(r,typeof e!="symbol"?e+"":e,t),_o=class{constructor(e){Iy(this,"_env"),Iy(this,"_snapshotCapturer",null),this._env=e}get env(){return this._env}get snapshotCapturer(){return this._snapshotCapturer}set snapshotCapturer(e){this._snapshotCapturer=e}getNodeId(e){var t;return(t=this.snapshotCapturer)==null?void 0:t.getNodeId(e)}};var A1=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())});function yo(r,e){let{id:t,token:n,mode:i,clientTime:o,meta:s,environment:a,parent:l,refType:c,trackers:u}=e;return r.post(`recording/${t!=null?t:ve()}/create`,{mode:i,clientTime:o,meta:s,environment:a,parent:l,refType:c,trackers:u},n?{Authorization:n}:void 0)}function On(r,e){return A1(this,null,function*(){let{path:t,data:n,headers:i}=Ah(e);return r.post(t,n,i)})}function Ah(r,e=!1){let{token:t,recordingId:n,blob:i,offset:o,count:s,firstFrameTime:a,lastFrameTime:l,isEOF:c,hasSnapshot:u}=r,h=Qn();h.append("offset",`${o}`),h.append("count",`${s}`),h.append("firstFrameTime",`${a}`),h.append("lastFrameTime",`${l}`),h.append("isEOF",`${c}`),u!=null&&h.append("hasSnapshot",`${u}`),h.append("block",i);let d={};return t&&(d.Authorization=t),{path:e?`storage/${n}/block/append`:`storage/${n}/block`,data:h,headers:d}}function My(r,e){r.sendBeacon(`storage/${e.recordingId}/block/eof?token=${e.token}`)}var D1=Object.defineProperty,V1=Object.defineProperties,N1=Object.getOwnPropertyDescriptors,Uy=Object.getOwnPropertySymbols,L1=Object.prototype.hasOwnProperty,G1=Object.prototype.propertyIsEnumerable,Py=(r,e,t)=>e in r?D1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,W1=(r,e)=>{for(var t in e||(e={}))L1.call(e,t)&&Py(r,t,e[t]);if(Uy)for(var t of Uy(e))G1.call(e,t)&&Py(r,t,e[t]);return r},F1=(r,e)=>V1(r,N1(e));function Ay(r){return T(r)?w[r]:r}function bo(r){let e=r==null?void 0:r.map(t=>Ay(t)).filter(t=>!!t);return e&&e.length>0?e:[w.HTML,w.Mouse]}function Cn(r){var e,t,n,i,o,s,a,l,c;let u=Dy(r),h={};return typeof((t=(e=u.html)==null?void 0:e.image)==null?void 0:t.captureAttributes)=="function"&&(h["options.html.image.captureAttributes"]=String(u.html.image.captureAttributes),(i=(n=u.html)==null?void 0:n.image)==null||delete i.captureAttributes),u.interceptors&&delete u.interceptors,(o=u.network)!=null&&o.xhr&&delete u.network.xhr,(s=u.network)!=null&&s.fetchable&&delete u.network.fetchable,(a=u.network)!=null&&a.shouldIgnoreRequest&&delete u.network.shouldIgnoreRequest,(l=u.network)!=null&&l.captureResponseStats&&delete u.network.captureResponseStats,(c=u.performance)!=null&&c.shouldIgnoreTiming&&delete u.performance.shouldIgnoreTiming,u.worker&&delete u.worker,F1(W1({},u),{fns:h})}function Dy(r){if(Rc(r)){let e={};for(let t of Object.keys(r))e[t]=Dy(r[t]);return e}return r}var t7=Z(Q());var ct=Uint8Array,Ne=Uint16Array,Wh=Int32Array,Fh=new ct([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Kh=new ct([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Vy=new ct([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wy=function(r,e){for(var t=new Ne(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Wh(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},Fy=Wy(Fh,2),K1=Fy.b,Vh=Fy.r;K1[28]=258,Vh[258]=28;var Ky=Wy(Kh,0),VZ=Ky.b,Ny=Ky.r,Nh=new Ne(32768);for(A=0;A<32768;++A)Ot=(A&43690)>>1|(A&21845)<<1,Ot=(Ot&52428)>>2|(Ot&13107)<<2,Ot=(Ot&61680)>>4|(Ot&3855)<<4,Nh[A]=((Ot&65280)>>8|(Ot&255)<<8)>>1;var Ot,A,xo=function(r,e,t){for(var n=r.length,i=0,o=new Ne(e);i<n;++i)r[i]&&++o[r[i]-1];var s=new Ne(e);for(i=1;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;var a;if(t){a=new Ne(1<<e);var l=15-e;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],u=e-r[i],h=s[r[i]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)a[Nh[h]>>l]=c}else for(a=new Ne(n),i=0;i<n;++i)r[i]&&(a[i]=Nh[s[r[i]-1]++]>>15-r[i]);return a},Lr=new ct(288);for(A=0;A<144;++A)Lr[A]=8;var A;for(A=144;A<256;++A)Lr[A]=9;var A;for(A=256;A<280;++A)Lr[A]=7;var A;for(A=280;A<288;++A)Lr[A]=8;var A,ol=new ct(32);for(A=0;A<32;++A)ol[A]=5;var A,j1=xo(Lr,9,0);var H1=xo(ol,5,0);var jy=function(r){return(r+7)/8|0},z1=function(r,e,t){return(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length),new ct(r.subarray(e,t))};var Ct=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8},$o=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8,r[n+2]|=t>>16},Dh=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,o=t.slice();if(!i)return{t:zy,l:0};if(i==1){var s=new ct(t[0].s+1);return s[t[0].s]=1,{t:s,l:1}}t.sort(function(D,ee){return D.f-ee.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,u=1,h=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=i-1;)a=t[t[c].f<t[h].f?c++:h++],l=t[c!=u&&t[c].f<t[h].f?c++:h++],t[u++]={s:-1,f:a.f+l.f,l:a,r:l};for(var d=o[0].s,n=1;n<i;++n)o[n].s>d&&(d=o[n].s);var f=new Ne(d+1),y=Lh(t[u-1],f,0);if(y>e){var n=0,_=0,q=y-e,k=1<<q;for(o.sort(function(ee,G){return f[G.s]-f[ee.s]||ee.f-G.f});n<i;++n){var O=o[n].s;if(f[O]>e)_+=k-(1<<y-f[O]),f[O]=e;else break}for(_>>=q;_>0;){var U=o[n].s;f[U]<e?_-=1<<e-f[U]++-1:++n}for(;n>=0&&_;--n){var L=o[n].s;f[L]==e&&(--f[L],++_)}y=e}return{t:new ct(f),l:y}},Lh=function(r,e,t){return r.s==-1?Math.max(Lh(r.l,e,t+1),Lh(r.r,e,t+1)):e[r.s]=t},Ly=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new Ne(++e),n=0,i=r[0],o=1,s=function(l){t[n++]=l},a=1;a<=e;++a)if(r[a]==i&&a!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(i),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(i);o=1,i=r[a]}return{c:t.subarray(0,n),n:e}},wo=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},Hy=function(r,e,t){var n=t.length,i=jy(e+2);r[i]=n&255,r[i+1]=n>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var o=0;o<n;++o)r[i+o+4]=t[o];return(i+4+n)*8},Gy=function(r,e,t,n,i,o,s,a,l,c,u){Ct(e,u++,t),++i[256];for(var h=Dh(i,15),d=h.t,f=h.l,y=Dh(o,15),_=y.t,q=y.l,k=Ly(d),O=k.c,U=k.n,L=Ly(_),D=L.c,ee=L.n,G=new Ne(19),C=0;C<O.length;++C)++G[O[C]&31];for(var C=0;C<D.length;++C)++G[D[C]&31];for(var S=Dh(G,7),te=S.t,j=S.l,_e=19;_e>4&&!te[Vy[_e-1]];--_e);var ut=c+5<<3,ke=wo(i,Lr)+wo(o,ol)+s,Re=wo(i,d)+wo(o,_)+s+14+3*_e+wo(G,te)+2*G[16]+3*G[17]+7*G[18];if(l>=0&&ut<=ke&&ut<=Re)return Hy(e,u,r.subarray(l,l+c));var ne,F,ye,ie;if(Ct(e,u,1+(Re<ke)),u+=2,Re<ke){ne=xo(d,f,0),F=d,ye=xo(_,q,0),ie=_;var zn=xo(te,j,0);Ct(e,u,U-257),Ct(e,u+5,ee-1),Ct(e,u+10,_e-4),u+=14;for(var C=0;C<_e;++C)Ct(e,u+3*C,te[Vy[C]]);u+=3*_e;for(var p=[O,D],g=0;g<2;++g)for(var v=p[g],C=0;C<v.length;++C){var b=v[C]&31;Ct(e,u,zn[b]),u+=te[b],b>15&&(Ct(e,u,v[C]>>5&127),u+=v[C]>>12)}}else ne=j1,F=Lr,ye=H1,ie=ol;for(var C=0;C<a;++C){var x=n[C];if(x>255){var b=x>>18&31;$o(e,u,ne[b+257]),u+=F[b+257],b>7&&(Ct(e,u,x>>23&31),u+=Fh[b]);var K=x&31;$o(e,u,ye[K]),u+=ie[K],K>3&&($o(e,u,x>>5&8191),u+=Kh[K])}else $o(e,u,ne[x]),u+=F[x]}return $o(e,u,ne[256]),u+F[256]},J1=new Wh([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),zy=new ct(0),Z1=function(r,e,t,n,i,o){var s=o.z||r.length,a=new ct(n+s+5*(1+Math.ceil(s/7e3))+i),l=a.subarray(n,a.length-i),c=o.l,u=(o.r||0)&7;if(e){u&&(l[0]=o.r>>3);for(var h=J1[e-1],d=h>>13,f=h&8191,y=(1<<t)-1,_=o.p||new Ne(32768),q=o.h||new Ne(y+1),k=Math.ceil(t/3),O=2*k,U=function(Il){return(r[Il]^r[Il+1]<<k^r[Il+2]<<O)&y},L=new Wh(25e3),D=new Ne(288),ee=new Ne(32),G=0,C=0,S=o.i||0,te=0,j=o.w||0,_e=0;S+2<s;++S){var ut=U(S),ke=S&32767,Re=q[ut];if(_[ke]=Re,q[ut]=ke,j<=S){var ne=s-S;if((G>7e3||te>24576)&&(ne>423||!c)){u=Gy(r,l,0,L,D,ee,C,te,_e,S-_e,u),te=G=C=0,_e=S;for(var F=0;F<286;++F)D[F]=0;for(var F=0;F<30;++F)ee[F]=0}var ye=2,ie=0,zn=f,p=ke-Re&32767;if(ne>2&&ut==U(S-p))for(var g=Math.min(d,ne)-1,v=Math.min(32767,S),b=Math.min(258,ne);p<=v&&--zn&&ke!=Re;){if(r[S+ye]==r[S+ye-p]){for(var x=0;x<b&&r[S+x]==r[S+x-p];++x);if(x>ye){if(ye=x,ie=p,x>g)break;for(var K=Math.min(p,x-2),be=0,F=0;F<K;++F){var $e=S-p+F&32767,Mb=_[$e],yd=$e-Mb&32767;yd>be&&(be=yd,Re=$e)}}}ke=Re,Re=_[ke],p+=ke-Re&32767}if(ie){L[te++]=268435456|Vh[ye]<<18|Ny[ie];var bd=Vh[ye]&31,$d=Ny[ie]&31;C+=Fh[bd]+Kh[$d],++D[257+bd],++ee[$d],j=S+ye,++G}else L[te++]=r[S],++D[r[S]]}}for(S=Math.max(S,j);S<s;++S)L[te++]=r[S],++D[r[S]];u=Gy(r,l,c,L,D,ee,C,te,_e,S-_e,u),c||(o.r=u&7|l[u/8|0]<<3,u-=7,o.h=q,o.p=_,o.i=S,o.w=j)}else{for(var S=o.w||0;S<s+c;S+=65535){var Cl=S+65535;Cl>=s&&(l[u/8|0]=c,Cl=s),u=Hy(l,u+1,r.subarray(S,Cl))}o.i=s}return z1(a,0,n+jy(u)+i)},Q1=function(){for(var r=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&-306674912)^t>>>1;r[e]=t}return r}(),X1=function(){var r=-1;return{p:function(e){for(var t=r,n=0;n<e.length;++n)t=Q1[t&255^e[n]]^t>>>8;r=t},d:function(){return~r}}};var Y1=function(r,e,t,n,i){if(!i&&(i={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),s=new ct(o.length+r.length);s.set(o),s.set(r,o.length),r=s,i.w=o.length}return Z1(r,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,n,i)};var Gh=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},eR=function(r,e){var t=e.filename;if(r[0]=31,r[1]=139,r[2]=8,r[8]=e.level<2?4:e.level==9?2:0,r[9]=3,e.mtime!=0&&Gh(r,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){r[3]=8;for(var n=0;n<=t.length;++n)r[n+10]=t.charCodeAt(n)}};var tR=function(r){return 10+(r.filename?r.filename.length+1:0)};function Jy(r,e){e||(e={});var t=X1(),n=r.length;t.p(r);var i=Y1(r,e,tR(e),8),o=i.length;return eR(i,e),Gh(i,o-8,t.d()),Gh(i,o-4,n),i}var rR=typeof TextDecoder!="undefined"&&new TextDecoder,nR=0;try{rR.decode(zy,{stream:!0}),nR=1}catch(r){}var In=class{canHandle(e){return e instanceof Vt}serialize(e){let{port1:t,port2:n}=new MessageChannel;if(e instanceof Vt){let i={id:e.id,frames:e.frames,createTime:e.createTime,duration:e.duration,mode:e.mode,environment:e.environment,meta:e.meta,trackers:e.trackers};t.postMessage({type:"InMemoryRecordingManifest",value:{id:ve(),staticProperties:i,exposeMethods:["getReader"]}})}return kn(e,t),[n,[n]]}deserialize(e){let t,n=new Set,i=new Set,o=new Set,s=Nr(e),a=new Proxy(s,{get(l,c,u){let h=c;if(!t)throw new Error("InMemoryRecording manifest not found from worker");if(n.has(h))return t.staticProperties[h];let d=Reflect.get(l,c,u);if(i.has(h))return(...f)=>{let y=f.map(_=>{if(typeof _=="function"){let q=kt(_);return o.add(q),q}return _});return Reflect.apply(d,l,[...y])};if(c==="then"||c===uo)return d}});return new Promise(l=>{let c=u=>{typeof u.data=="object"&&u.data.type==="InMemoryRecordingManifest"&&(t=u.data.value,Object.keys(t.staticProperties).forEach(h=>{n.add(h)}),t.exposeMethods.forEach(h=>{i.add(h)}),l(),e.removeEventListener("message",c))};e.addEventListener("message",c,!0),e.start()}).then(()=>a)}};var iR=Object.defineProperty,oR=(r,e,t)=>e in r?iR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,er=(r,e,t)=>oR(r,typeof e!="symbol"?e+"":e,t),Qe=class{constructor(e,t,n){er(this,"manager"),er(this,"_id"),er(this,"_recording"),er(this,"_startTime"),er(this,"_offsetTime"),er(this,"_trackers"),er(this,"_transmitter"),er(this,"_events",new R.default);var i,o;this.options=n,this.manager=e,this._recording=t,this._id=t.id,this._startTime=(i=n.startTime)!=null?i:P(),this._trackers=n.trackers,this._offsetTime=this.getOffsetTime(this._startTime);let s=(o=n.transport)==null?void 0:o.strategies.find(a=>a.mode===n.mode&&"channelType"in a);this._transmitter={strategy:s}}get id(){return this._id}get recording(){return this._recording}get baseURL(){return this.manager.env.baseURL}get env(){return this.manager.env}get startTime(){return this._startTime}get offsetTime(){return this._offsetTime}get now(){return P()+this._offsetTime}get transmitter(){return this._transmitter}get trackers(){return this._trackers}dumpRecording(e){return this.manager.dumpRecording(this._id,e)}dumpInMemoryRecording(e){return this.manager.dumpInMemoryRecording(this._id,e)}cacheRecordings(){return this.manager.cacheRecordings()}stopRecording(){return this.manager.stopRecordingContext(this._id)}toString(){return JSON.stringify(this._recording)}emit(e,...t){return this._events.emit(e,...t)}on(e,t){this._events.on(e,t,{})}once(e,t){this._events.once(e,t,{})}off(e,t){this._events.off(e,t,{})}addListener(e,t){this._events.addListener(e,t,{})}removeListener(e,t){this._events.removeListener(e,t,{})}getOffsetTime(e){return e-P()}};var sR=Object.defineProperty,aR=Object.getPrototypeOf,lR=Reflect.get,cR=(r,e,t)=>e in r?sR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,uR=(r,e,t)=>cR(r,typeof e!="symbol"?e+"":e,t),hR=(r,e,t)=>lR(aR(r),t,e),Zy=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Gr=class r extends Qe{constructor(e,t,n){var i;super(e,t,n),uR(this,"_dumpConfig");let o=(i=n.transport)==null?void 0:i.strategies.find(s=>s.name==="blackbox-record-dump");o?this._dumpConfig=o==null?void 0:o.config:this._dumpConfig={id:ve(),token:n.token}}get dumpConfig(){return this._dumpConfig}set dumpConfig(e){this._dumpConfig=e}dumpRecording(e){return Zy(this,null,function*(){let t=yield hR(r.prototype,this,"dumpRecording").call(this,e);return this.emit("dumped",t.id,this.dumpConfig),t.id})}getDumpConfig(){return Zy(this,null,function*(){return Promise.resolve(this.dumpConfig)})}};var qo=(r=>(r.Worker="worker",r.Main="main",r))(qo||{}),Mn=class{constructor(e){this.position=e}canHandle(e){return e instanceof Qe}serialize(e){let{port1:t,port2:n}=new MessageChannel;if(e instanceof Qe){let i={id:e.id,startTime:e.startTime,recording:e.recording,transmitter:e.transmitter,baseURL:e.baseURL,trackers:e.trackers};e instanceof Gr&&(i.dumpConfig=e.dumpConfig),t.postMessage({type:"RecordingContextManifest",value:{id:ve(),staticProperties:i,exposeMethods:["on","once","off","stopRecording","cacheRecordings","dumpRecording","dumpInMemoryRecording","getDumpConfig","addListener","removeListener"]}})}return kn(e,t),[n,[n]]}deserialize(e){let t,n=new Set,i=new Set,o=Nr(e),s=new Proxy(o,{get(a,l,c){let u=l;if(!t)throw new Error("RecordingContext manifest not found from worker");if(n.has(u))return t.staticProperties[u];if(u==="toString")return()=>JSON.stringify(t==null?void 0:t.staticProperties.recording);let h=Reflect.get(a,l,c);if(i.has(u))return(...d)=>{let f=d.map(y=>typeof y=="function"?kt(y):y);return Reflect.apply(h,a,[...f])};if(l==="then"||l===uo)return h}});return new Promise(a=>{let l=c=>{typeof c.data=="object"&&c.data.type==="RecordingContextManifest"&&(t=c.data.value,Object.keys(t.staticProperties).forEach(u=>{n.add(u)}),t.exposeMethods.forEach(u=>{i.add(u)}),a(s),e.removeEventListener("message",l))};e.addEventListener("message",l,!0),e.start()})}};ho.set("RecordingContext",new Mn(qo.Main));ho.set("InMemoryRecording",new In);function jh(r){return Nr(r)}var Xy='var it=Object.defineProperty,st=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols,at=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,ct=Reflect.get;var lt=(B,$)=>($=Symbol[B])?$:Symbol.for("Symbol."+B);var Ve=(B,$,q)=>$ in B?it(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,Oe=(B,$)=>{for(var q in $||($={}))Ye.call($,q)&&Ve(B,q,$[q]);if(je)for(var q of je($))Xe.call($,q)&&Ve(B,q,$[q]);return B},Ne=(B,$)=>st(B,ot($));var Je=(B,$)=>{var q={};for(var U in B)Ye.call(B,U)&&$.indexOf(U)<0&&(q[U]=B[U]);if(B!=null&&je)for(var U of je(B))$.indexOf(U)<0&&Xe.call(B,U)&&(q[U]=B[U]);return q};var se=(B,$,q)=>Ve(B,typeof $!="symbol"?$+"":$,q);var Ze=(B,$,q)=>ct(at(B),q,$);var me=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())}),Be=function(B,$){this[0]=B,this[1]=$},Qe=(B,$,q)=>{var U=(K,J,W,Z)=>{try{var Q=q[K](J),ee=(J=Q.value)instanceof Be,te=Q.done;Promise.resolve(ee?J[0]:J).then(ne=>ee?U(K==="return"?K:"next",J[1]?{done:ne.done,value:ne.value}:ne,W,Z):W({value:ne,done:te})).catch(ne=>U("throw",ne,W,Z))}catch(ne){Z(ne)}},V=K=>G[K]=J=>new Promise((W,Z)=>U(K,J,W,Z)),G={};return q=q.apply(B,$),G[lt("asyncIterator")]=()=>G,V("next"),V("throw"),V("return"),G};(function(){"use strict";var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getDefaultExportFromCjs(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}var es_globalThis={},globalThis_1,hasRequiredGlobalThis$3;function requireGlobalThis$3(){if(hasRequiredGlobalThis$3)return globalThis_1;hasRequiredGlobalThis$3=1;var B=function($){return $&&$.Math===Math&&$};return globalThis_1=B(typeof globalThis=="object"&&globalThis)||B(typeof window=="object"&&window)||B(typeof self=="object"&&self)||B(typeof commonjsGlobal=="object"&&commonjsGlobal)||B(typeof globalThis_1=="object"&&globalThis_1)||function(){return this}()||Function("return this")(),globalThis_1}var objectGetOwnPropertyDescriptor={},fails,hasRequiredFails;function requireFails(){return hasRequiredFails||(hasRequiredFails=1,fails=function(B){try{return!!B()}catch($){return!0}}),fails}var descriptors,hasRequiredDescriptors;function requireDescriptors(){if(hasRequiredDescriptors)return descriptors;hasRequiredDescriptors=1;var B=requireFails();return descriptors=!B(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),descriptors}var functionBindNative,hasRequiredFunctionBindNative;function requireFunctionBindNative(){if(hasRequiredFunctionBindNative)return functionBindNative;hasRequiredFunctionBindNative=1;var B=requireFails();return functionBindNative=!B(function(){var $=function(){}.bind();return typeof $!="function"||$.hasOwnProperty("prototype")}),functionBindNative}var functionCall,hasRequiredFunctionCall;function requireFunctionCall(){if(hasRequiredFunctionCall)return functionCall;hasRequiredFunctionCall=1;var B=requireFunctionBindNative(),$=Function.prototype.call;return functionCall=B?$.bind($):function(){return $.apply($,arguments)},functionCall}var objectPropertyIsEnumerable={},hasRequiredObjectPropertyIsEnumerable;function requireObjectPropertyIsEnumerable(){if(hasRequiredObjectPropertyIsEnumerable)return objectPropertyIsEnumerable;hasRequiredObjectPropertyIsEnumerable=1;var B={}.propertyIsEnumerable,$=Object.getOwnPropertyDescriptor,q=$&&!B.call({1:2},1);return objectPropertyIsEnumerable.f=q?function(V){var G=$(this,V);return!!G&&G.enumerable}:B,objectPropertyIsEnumerable}var createPropertyDescriptor,hasRequiredCreatePropertyDescriptor;function requireCreatePropertyDescriptor(){return hasRequiredCreatePropertyDescriptor||(hasRequiredCreatePropertyDescriptor=1,createPropertyDescriptor=function(B,$){return{enumerable:!(B&1),configurable:!(B&2),writable:!(B&4),value:$}}),createPropertyDescriptor}var functionUncurryThis,hasRequiredFunctionUncurryThis;function requireFunctionUncurryThis(){if(hasRequiredFunctionUncurryThis)return functionUncurryThis;hasRequiredFunctionUncurryThis=1;var B=requireFunctionBindNative(),$=Function.prototype,q=$.call,U=B&&$.bind.bind(q,q);return functionUncurryThis=B?U:function(V){return function(){return q.apply(V,arguments)}},functionUncurryThis}var classofRaw,hasRequiredClassofRaw;function requireClassofRaw(){if(hasRequiredClassofRaw)return classofRaw;hasRequiredClassofRaw=1;var B=requireFunctionUncurryThis(),$=B({}.toString),q=B("".slice);return classofRaw=function(U){return q($(U),8,-1)},classofRaw}var indexedObject,hasRequiredIndexedObject;function requireIndexedObject(){if(hasRequiredIndexedObject)return indexedObject;hasRequiredIndexedObject=1;var B=requireFunctionUncurryThis(),$=requireFails(),q=requireClassofRaw(),U=Object,V=B("".split);return indexedObject=$(function(){return!U("z").propertyIsEnumerable(0)})?function(G){return q(G)==="String"?V(G,""):U(G)}:U,indexedObject}var isNullOrUndefined,hasRequiredIsNullOrUndefined;function requireIsNullOrUndefined(){return hasRequiredIsNullOrUndefined||(hasRequiredIsNullOrUndefined=1,isNullOrUndefined=function(B){return B==null}),isNullOrUndefined}var requireObjectCoercible,hasRequiredRequireObjectCoercible;function requireRequireObjectCoercible(){if(hasRequiredRequireObjectCoercible)return requireObjectCoercible;hasRequiredRequireObjectCoercible=1;var B=requireIsNullOrUndefined(),$=TypeError;return requireObjectCoercible=function(q){if(B(q))throw new $("Can\'t call method on "+q);return q},requireObjectCoercible}var toIndexedObject,hasRequiredToIndexedObject;function requireToIndexedObject(){if(hasRequiredToIndexedObject)return toIndexedObject;hasRequiredToIndexedObject=1;var B=requireIndexedObject(),$=requireRequireObjectCoercible();return toIndexedObject=function(q){return B($(q))},toIndexedObject}var isCallable,hasRequiredIsCallable;function requireIsCallable(){if(hasRequiredIsCallable)return isCallable;hasRequiredIsCallable=1;var B=typeof document=="object"&&document.all;return isCallable=typeof B=="undefined"&&B!==void 0?function($){return typeof $=="function"||$===B}:function($){return typeof $=="function"},isCallable}var isObject$1,hasRequiredIsObject;function requireIsObject(){if(hasRequiredIsObject)return isObject$1;hasRequiredIsObject=1;var B=requireIsCallable();return isObject$1=function($){return typeof $=="object"?$!==null:B($)},isObject$1}var getBuiltIn,hasRequiredGetBuiltIn;function requireGetBuiltIn(){if(hasRequiredGetBuiltIn)return getBuiltIn;hasRequiredGetBuiltIn=1;var B=requireGlobalThis$3(),$=requireIsCallable(),q=function(U){return $(U)?U:void 0};return getBuiltIn=function(U,V){return arguments.length<2?q(B[U]):B[U]&&B[U][V]},getBuiltIn}var objectIsPrototypeOf,hasRequiredObjectIsPrototypeOf;function requireObjectIsPrototypeOf(){if(hasRequiredObjectIsPrototypeOf)return objectIsPrototypeOf;hasRequiredObjectIsPrototypeOf=1;var B=requireFunctionUncurryThis();return objectIsPrototypeOf=B({}.isPrototypeOf),objectIsPrototypeOf}var environmentUserAgent,hasRequiredEnvironmentUserAgent;function requireEnvironmentUserAgent(){if(hasRequiredEnvironmentUserAgent)return environmentUserAgent;hasRequiredEnvironmentUserAgent=1;var B=requireGlobalThis$3(),$=B.navigator,q=$&&$.userAgent;return environmentUserAgent=q?String(q):"",environmentUserAgent}var environmentV8Version,hasRequiredEnvironmentV8Version;function requireEnvironmentV8Version(){if(hasRequiredEnvironmentV8Version)return environmentV8Version;hasRequiredEnvironmentV8Version=1;var B=requireGlobalThis$3(),$=requireEnvironmentUserAgent(),q=B.process,U=B.Deno,V=q&&q.versions||U&&U.version,G=V&&V.v8,K,J;return G&&(K=G.split("."),J=K[0]>0&&K[0]<4?1:+(K[0]+K[1])),!J&&$&&(K=$.match(/Edge\\/(\\d+)/),(!K||K[1]>=74)&&(K=$.match(/Chrome\\/(\\d+)/),K&&(J=+K[1]))),environmentV8Version=J,environmentV8Version}var symbolConstructorDetection,hasRequiredSymbolConstructorDetection;function requireSymbolConstructorDetection(){if(hasRequiredSymbolConstructorDetection)return symbolConstructorDetection;hasRequiredSymbolConstructorDetection=1;var B=requireEnvironmentV8Version(),$=requireFails(),q=requireGlobalThis$3(),U=q.String;return symbolConstructorDetection=!!Object.getOwnPropertySymbols&&!$(function(){var V=Symbol("symbol detection");return!U(V)||!(Object(V)instanceof Symbol)||!Symbol.sham&&B&&B<41}),symbolConstructorDetection}var useSymbolAsUid,hasRequiredUseSymbolAsUid;function requireUseSymbolAsUid(){if(hasRequiredUseSymbolAsUid)return useSymbolAsUid;hasRequiredUseSymbolAsUid=1;var B=requireSymbolConstructorDetection();return useSymbolAsUid=B&&!Symbol.sham&&typeof Symbol.iterator=="symbol",useSymbolAsUid}var isSymbol,hasRequiredIsSymbol;function requireIsSymbol(){if(hasRequiredIsSymbol)return isSymbol;hasRequiredIsSymbol=1;var B=requireGetBuiltIn(),$=requireIsCallable(),q=requireObjectIsPrototypeOf(),U=requireUseSymbolAsUid(),V=Object;return isSymbol=U?function(G){return typeof G=="symbol"}:function(G){var K=B("Symbol");return $(K)&&q(K.prototype,V(G))},isSymbol}var tryToString,hasRequiredTryToString;function requireTryToString(){if(hasRequiredTryToString)return tryToString;hasRequiredTryToString=1;var B=String;return tryToString=function($){try{return B($)}catch(q){return"Object"}},tryToString}var aCallable,hasRequiredACallable;function requireACallable(){if(hasRequiredACallable)return aCallable;hasRequiredACallable=1;var B=requireIsCallable(),$=requireTryToString(),q=TypeError;return aCallable=function(U){if(B(U))return U;throw new q($(U)+" is not a function")},aCallable}var getMethod$1,hasRequiredGetMethod;function requireGetMethod(){if(hasRequiredGetMethod)return getMethod$1;hasRequiredGetMethod=1;var B=requireACallable(),$=requireIsNullOrUndefined();return getMethod$1=function(q,U){var V=q[U];return $(V)?void 0:B(V)},getMethod$1}var ordinaryToPrimitive,hasRequiredOrdinaryToPrimitive;function requireOrdinaryToPrimitive(){if(hasRequiredOrdinaryToPrimitive)return ordinaryToPrimitive;hasRequiredOrdinaryToPrimitive=1;var B=requireFunctionCall(),$=requireIsCallable(),q=requireIsObject(),U=TypeError;return ordinaryToPrimitive=function(V,G){var K,J;if(G==="string"&&$(K=V.toString)&&!q(J=B(K,V))||$(K=V.valueOf)&&!q(J=B(K,V))||G!=="string"&&$(K=V.toString)&&!q(J=B(K,V)))return J;throw new U("Can\'t convert object to primitive value")},ordinaryToPrimitive}var sharedStore={exports:{}},isPure,hasRequiredIsPure;function requireIsPure(){return hasRequiredIsPure||(hasRequiredIsPure=1,isPure=!1),isPure}var defineGlobalProperty,hasRequiredDefineGlobalProperty;function requireDefineGlobalProperty(){if(hasRequiredDefineGlobalProperty)return defineGlobalProperty;hasRequiredDefineGlobalProperty=1;var B=requireGlobalThis$3(),$=Object.defineProperty;return defineGlobalProperty=function(q,U){try{$(B,q,{value:U,configurable:!0,writable:!0})}catch(V){B[q]=U}return U},defineGlobalProperty}var hasRequiredSharedStore;function requireSharedStore(){if(hasRequiredSharedStore)return sharedStore.exports;hasRequiredSharedStore=1;var B=requireIsPure(),$=requireGlobalThis$3(),q=requireDefineGlobalProperty(),U="__core-js_shared__",V=sharedStore.exports=$[U]||q(U,{});return(V.versions||(V.versions=[])).push({version:"3.39.0",mode:B?"pure":"global",copyright:"\xA9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"}),sharedStore.exports}var shared,hasRequiredShared;function requireShared(){if(hasRequiredShared)return shared;hasRequiredShared=1;var B=requireSharedStore();return shared=function($,q){return B[$]||(B[$]=q||{})},shared}var toObject,hasRequiredToObject;function requireToObject(){if(hasRequiredToObject)return toObject;hasRequiredToObject=1;var B=requireRequireObjectCoercible(),$=Object;return toObject=function(q){return $(B(q))},toObject}var hasOwnProperty_1,hasRequiredHasOwnProperty;function requireHasOwnProperty(){if(hasRequiredHasOwnProperty)return hasOwnProperty_1;hasRequiredHasOwnProperty=1;var B=requireFunctionUncurryThis(),$=requireToObject(),q=B({}.hasOwnProperty);return hasOwnProperty_1=Object.hasOwn||function(V,G){return q($(V),G)},hasOwnProperty_1}var uid,hasRequiredUid;function requireUid(){if(hasRequiredUid)return uid;hasRequiredUid=1;var B=requireFunctionUncurryThis(),$=0,q=Math.random(),U=B(1 .toString);return uid=function(V){return"Symbol("+(V===void 0?"":V)+")_"+U(++$+q,36)},uid}var wellKnownSymbol,hasRequiredWellKnownSymbol;function requireWellKnownSymbol(){if(hasRequiredWellKnownSymbol)return wellKnownSymbol;hasRequiredWellKnownSymbol=1;var B=requireGlobalThis$3(),$=requireShared(),q=requireHasOwnProperty(),U=requireUid(),V=requireSymbolConstructorDetection(),G=requireUseSymbolAsUid(),K=B.Symbol,J=$("wks"),W=G?K.for||K:K&&K.withoutSetter||U;return wellKnownSymbol=function(Z){return q(J,Z)||(J[Z]=V&&q(K,Z)?K[Z]:W("Symbol."+Z)),J[Z]},wellKnownSymbol}var toPrimitive,hasRequiredToPrimitive;function requireToPrimitive(){if(hasRequiredToPrimitive)return toPrimitive;hasRequiredToPrimitive=1;var B=requireFunctionCall(),$=requireIsObject(),q=requireIsSymbol(),U=requireGetMethod(),V=requireOrdinaryToPrimitive(),G=requireWellKnownSymbol(),K=TypeError,J=G("toPrimitive");return toPrimitive=function(W,Z){if(!$(W)||q(W))return W;var Q=U(W,J),ee;if(Q){if(Z===void 0&&(Z="default"),ee=B(Q,W,Z),!$(ee)||q(ee))return ee;throw new K("Can\'t convert object to primitive value")}return Z===void 0&&(Z="number"),V(W,Z)},toPrimitive}var toPropertyKey,hasRequiredToPropertyKey;function requireToPropertyKey(){if(hasRequiredToPropertyKey)return toPropertyKey;hasRequiredToPropertyKey=1;var B=requireToPrimitive(),$=requireIsSymbol();return toPropertyKey=function(q){var U=B(q,"string");return $(U)?U:U+""},toPropertyKey}var documentCreateElement,hasRequiredDocumentCreateElement;function requireDocumentCreateElement(){if(hasRequiredDocumentCreateElement)return documentCreateElement;hasRequiredDocumentCreateElement=1;var B=requireGlobalThis$3(),$=requireIsObject(),q=B.document,U=$(q)&&$(q.createElement);return documentCreateElement=function(V){return U?q.createElement(V):{}},documentCreateElement}var ie8DomDefine,hasRequiredIe8DomDefine;function requireIe8DomDefine(){if(hasRequiredIe8DomDefine)return ie8DomDefine;hasRequiredIe8DomDefine=1;var B=requireDescriptors(),$=requireFails(),q=requireDocumentCreateElement();return ie8DomDefine=!B&&!$(function(){return Object.defineProperty(q("div"),"a",{get:function(){return 7}}).a!==7}),ie8DomDefine}var hasRequiredObjectGetOwnPropertyDescriptor;function requireObjectGetOwnPropertyDescriptor(){if(hasRequiredObjectGetOwnPropertyDescriptor)return objectGetOwnPropertyDescriptor;hasRequiredObjectGetOwnPropertyDescriptor=1;var B=requireDescriptors(),$=requireFunctionCall(),q=requireObjectPropertyIsEnumerable(),U=requireCreatePropertyDescriptor(),V=requireToIndexedObject(),G=requireToPropertyKey(),K=requireHasOwnProperty(),J=requireIe8DomDefine(),W=Object.getOwnPropertyDescriptor;return objectGetOwnPropertyDescriptor.f=B?W:function(Q,ee){if(Q=V(Q),ee=G(ee),J)try{return W(Q,ee)}catch(te){}if(K(Q,ee))return U(!$(q.f,Q,ee),Q[ee])},objectGetOwnPropertyDescriptor}var objectDefineProperty={},v8PrototypeDefineBug,hasRequiredV8PrototypeDefineBug;function requireV8PrototypeDefineBug(){if(hasRequiredV8PrototypeDefineBug)return v8PrototypeDefineBug;hasRequiredV8PrototypeDefineBug=1;var B=requireDescriptors(),$=requireFails();return v8PrototypeDefineBug=B&&$(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),v8PrototypeDefineBug}var anObject,hasRequiredAnObject;function requireAnObject(){if(hasRequiredAnObject)return anObject;hasRequiredAnObject=1;var B=requireIsObject(),$=String,q=TypeError;return anObject=function(U){if(B(U))return U;throw new q($(U)+" is not an object")},anObject}var hasRequiredObjectDefineProperty;function requireObjectDefineProperty(){if(hasRequiredObjectDefineProperty)return objectDefineProperty;hasRequiredObjectDefineProperty=1;var B=requireDescriptors(),$=requireIe8DomDefine(),q=requireV8PrototypeDefineBug(),U=requireAnObject(),V=requireToPropertyKey(),G=TypeError,K=Object.defineProperty,J=Object.getOwnPropertyDescriptor,W="enumerable",Z="configurable",Q="writable";return objectDefineProperty.f=B?q?function(te,ne,oe){if(U(te),ne=V(ne),U(oe),typeof te=="function"&&ne==="prototype"&&"value"in oe&&Q in oe&&!oe[Q]){var ce=J(te,ne);ce&&ce[Q]&&(te[ne]=oe.value,oe={configurable:Z in oe?oe[Z]:ce[Z],enumerable:W in oe?oe[W]:ce[W],writable:!1})}return K(te,ne,oe)}:K:function(te,ne,oe){if(U(te),ne=V(ne),U(oe),$)try{return K(te,ne,oe)}catch(ce){}if("get"in oe||"set"in oe)throw new G("Accessors not supported");return"value"in oe&&(te[ne]=oe.value),te},objectDefineProperty}var createNonEnumerableProperty,hasRequiredCreateNonEnumerableProperty;function requireCreateNonEnumerableProperty(){if(hasRequiredCreateNonEnumerableProperty)return createNonEnumerableProperty;hasRequiredCreateNonEnumerableProperty=1;var B=requireDescriptors(),$=requireObjectDefineProperty(),q=requireCreatePropertyDescriptor();return createNonEnumerableProperty=B?function(U,V,G){return $.f(U,V,q(1,G))}:function(U,V,G){return U[V]=G,U},createNonEnumerableProperty}var makeBuiltIn={exports:{}},functionName,hasRequiredFunctionName;function requireFunctionName(){if(hasRequiredFunctionName)return functionName;hasRequiredFunctionName=1;var B=requireDescriptors(),$=requireHasOwnProperty(),q=Function.prototype,U=B&&Object.getOwnPropertyDescriptor,V=$(q,"name"),G=V&&function(){}.name==="something",K=V&&(!B||B&&U(q,"name").configurable);return functionName={EXISTS:V,PROPER:G,CONFIGURABLE:K},functionName}var inspectSource,hasRequiredInspectSource;function requireInspectSource(){if(hasRequiredInspectSource)return inspectSource;hasRequiredInspectSource=1;var B=requireFunctionUncurryThis(),$=requireIsCallable(),q=requireSharedStore(),U=B(Function.toString);return $(q.inspectSource)||(q.inspectSource=function(V){return U(V)}),inspectSource=q.inspectSource,inspectSource}var weakMapBasicDetection,hasRequiredWeakMapBasicDetection;function requireWeakMapBasicDetection(){if(hasRequiredWeakMapBasicDetection)return weakMapBasicDetection;hasRequiredWeakMapBasicDetection=1;var B=requireGlobalThis$3(),$=requireIsCallable(),q=B.WeakMap;return weakMapBasicDetection=$(q)&&/native code/.test(String(q)),weakMapBasicDetection}var sharedKey,hasRequiredSharedKey;function requireSharedKey(){if(hasRequiredSharedKey)return sharedKey;hasRequiredSharedKey=1;var B=requireShared(),$=requireUid(),q=B("keys");return sharedKey=function(U){return q[U]||(q[U]=$(U))},sharedKey}var hiddenKeys,hasRequiredHiddenKeys;function requireHiddenKeys(){return hasRequiredHiddenKeys||(hasRequiredHiddenKeys=1,hiddenKeys={}),hiddenKeys}var internalState,hasRequiredInternalState;function requireInternalState(){if(hasRequiredInternalState)return internalState;hasRequiredInternalState=1;var B=requireWeakMapBasicDetection(),$=requireGlobalThis$3(),q=requireIsObject(),U=requireCreateNonEnumerableProperty(),V=requireHasOwnProperty(),G=requireSharedStore(),K=requireSharedKey(),J=requireHiddenKeys(),W="Object already initialized",Z=$.TypeError,Q=$.WeakMap,ee,te,ne,oe=function(he){return ne(he)?te(he):ee(he,{})},ce=function(he){return function(fe){var ye;if(!q(fe)||(ye=te(fe)).type!==he)throw new Z("Incompatible receiver, "+he+" required");return ye}};if(B||G.state){var le=G.state||(G.state=new Q);le.get=le.get,le.has=le.has,le.set=le.set,ee=function(he,fe){if(le.has(he))throw new Z(W);return fe.facade=he,le.set(he,fe),fe},te=function(he){return le.get(he)||{}},ne=function(he){return le.has(he)}}else{var pe=K("state");J[pe]=!0,ee=function(he,fe){if(V(he,pe))throw new Z(W);return fe.facade=he,U(he,pe,fe),fe},te=function(he){return V(he,pe)?he[pe]:{}},ne=function(he){return V(he,pe)}}return internalState={set:ee,get:te,has:ne,enforce:oe,getterFor:ce},internalState}var hasRequiredMakeBuiltIn;function requireMakeBuiltIn(){if(hasRequiredMakeBuiltIn)return makeBuiltIn.exports;hasRequiredMakeBuiltIn=1;var B=requireFunctionUncurryThis(),$=requireFails(),q=requireIsCallable(),U=requireHasOwnProperty(),V=requireDescriptors(),G=requireFunctionName().CONFIGURABLE,K=requireInspectSource(),J=requireInternalState(),W=J.enforce,Z=J.get,Q=String,ee=Object.defineProperty,te=B("".slice),ne=B("".replace),oe=B([].join),ce=V&&!$(function(){return ee(function(){},"length",{value:8}).length!==8}),le=String(String).split("String"),pe=makeBuiltIn.exports=function(he,fe,ye){te(Q(fe),0,7)==="Symbol("&&(fe="["+ne(Q(fe),/^Symbol\\(([^)]*)\\).*$/,"$1")+"]"),ye&&ye.getter&&(fe="get "+fe),ye&&ye.setter&&(fe="set "+fe),(!U(he,"name")||G&&he.name!==fe)&&(V?ee(he,"name",{value:fe,configurable:!0}):he.name=fe),ce&&ye&&U(ye,"arity")&&he.length!==ye.arity&&ee(he,"length",{value:ye.arity});try{ye&&U(ye,"constructor")&&ye.constructor?V&&ee(he,"prototype",{writable:!1}):he.prototype&&(he.prototype=void 0)}catch(Re){}var ge=W(he);return U(ge,"source")||(ge.source=oe(le,typeof fe=="string"?fe:"")),he};return Function.prototype.toString=pe(function(){return q(this)&&Z(this).source||K(this)},"toString"),makeBuiltIn.exports}var defineBuiltIn,hasRequiredDefineBuiltIn;function requireDefineBuiltIn(){if(hasRequiredDefineBuiltIn)return defineBuiltIn;hasRequiredDefineBuiltIn=1;var B=requireIsCallable(),$=requireObjectDefineProperty(),q=requireMakeBuiltIn(),U=requireDefineGlobalProperty();return defineBuiltIn=function(V,G,K,J){J||(J={});var W=J.enumerable,Z=J.name!==void 0?J.name:G;if(B(K)&&q(K,Z,J),J.global)W?V[G]=K:U(G,K);else{try{J.unsafe?V[G]&&(W=!0):delete V[G]}catch(Q){}W?V[G]=K:$.f(V,G,{value:K,enumerable:!1,configurable:!J.nonConfigurable,writable:!J.nonWritable})}return V},defineBuiltIn}var objectGetOwnPropertyNames={},mathTrunc,hasRequiredMathTrunc;function requireMathTrunc(){if(hasRequiredMathTrunc)return mathTrunc;hasRequiredMathTrunc=1;var B=Math.ceil,$=Math.floor;return mathTrunc=Math.trunc||function(U){var V=+U;return(V>0?$:B)(V)},mathTrunc}var toIntegerOrInfinity,hasRequiredToIntegerOrInfinity;function requireToIntegerOrInfinity(){if(hasRequiredToIntegerOrInfinity)return toIntegerOrInfinity;hasRequiredToIntegerOrInfinity=1;var B=requireMathTrunc();return toIntegerOrInfinity=function($){var q=+$;return q!==q||q===0?0:B(q)},toIntegerOrInfinity}var toAbsoluteIndex,hasRequiredToAbsoluteIndex;function requireToAbsoluteIndex(){if(hasRequiredToAbsoluteIndex)return toAbsoluteIndex;hasRequiredToAbsoluteIndex=1;var B=requireToIntegerOrInfinity(),$=Math.max,q=Math.min;return toAbsoluteIndex=function(U,V){var G=B(U);return G<0?$(G+V,0):q(G,V)},toAbsoluteIndex}var toLength,hasRequiredToLength;function requireToLength(){if(hasRequiredToLength)return toLength;hasRequiredToLength=1;var B=requireToIntegerOrInfinity(),$=Math.min;return toLength=function(q){var U=B(q);return U>0?$(U,9007199254740991):0},toLength}var lengthOfArrayLike,hasRequiredLengthOfArrayLike;function requireLengthOfArrayLike(){if(hasRequiredLengthOfArrayLike)return lengthOfArrayLike;hasRequiredLengthOfArrayLike=1;var B=requireToLength();return lengthOfArrayLike=function($){return B($.length)},lengthOfArrayLike}var arrayIncludes,hasRequiredArrayIncludes;function requireArrayIncludes(){if(hasRequiredArrayIncludes)return arrayIncludes;hasRequiredArrayIncludes=1;var B=requireToIndexedObject(),$=requireToAbsoluteIndex(),q=requireLengthOfArrayLike(),U=function(V){return function(G,K,J){var W=B(G),Z=q(W);if(Z===0)return!V&&-1;var Q=$(J,Z),ee;if(V&&K!==K){for(;Z>Q;)if(ee=W[Q++],ee!==ee)return!0}else for(;Z>Q;Q++)if((V||Q in W)&&W[Q]===K)return V||Q||0;return!V&&-1}};return arrayIncludes={includes:U(!0),indexOf:U(!1)},arrayIncludes}var objectKeysInternal,hasRequiredObjectKeysInternal;function requireObjectKeysInternal(){if(hasRequiredObjectKeysInternal)return objectKeysInternal;hasRequiredObjectKeysInternal=1;var B=requireFunctionUncurryThis(),$=requireHasOwnProperty(),q=requireToIndexedObject(),U=requireArrayIncludes().indexOf,V=requireHiddenKeys(),G=B([].push);return objectKeysInternal=function(K,J){var W=q(K),Z=0,Q=[],ee;for(ee in W)!$(V,ee)&&$(W,ee)&&G(Q,ee);for(;J.length>Z;)$(W,ee=J[Z++])&&(~U(Q,ee)||G(Q,ee));return Q},objectKeysInternal}var enumBugKeys,hasRequiredEnumBugKeys;function requireEnumBugKeys(){return hasRequiredEnumBugKeys||(hasRequiredEnumBugKeys=1,enumBugKeys=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),enumBugKeys}var hasRequiredObjectGetOwnPropertyNames;function requireObjectGetOwnPropertyNames(){if(hasRequiredObjectGetOwnPropertyNames)return objectGetOwnPropertyNames;hasRequiredObjectGetOwnPropertyNames=1;var B=requireObjectKeysInternal(),$=requireEnumBugKeys(),q=$.concat("length","prototype");return objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(V){return B(V,q)},objectGetOwnPropertyNames}var objectGetOwnPropertySymbols={},hasRequiredObjectGetOwnPropertySymbols;function requireObjectGetOwnPropertySymbols(){return hasRequiredObjectGetOwnPropertySymbols||(hasRequiredObjectGetOwnPropertySymbols=1,objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols),objectGetOwnPropertySymbols}var ownKeys,hasRequiredOwnKeys;function requireOwnKeys(){if(hasRequiredOwnKeys)return ownKeys;hasRequiredOwnKeys=1;var B=requireGetBuiltIn(),$=requireFunctionUncurryThis(),q=requireObjectGetOwnPropertyNames(),U=requireObjectGetOwnPropertySymbols(),V=requireAnObject(),G=$([].concat);return ownKeys=B("Reflect","ownKeys")||function(J){var W=q.f(V(J)),Z=U.f;return Z?G(W,Z(J)):W},ownKeys}var copyConstructorProperties,hasRequiredCopyConstructorProperties;function requireCopyConstructorProperties(){if(hasRequiredCopyConstructorProperties)return copyConstructorProperties;hasRequiredCopyConstructorProperties=1;var B=requireHasOwnProperty(),$=requireOwnKeys(),q=requireObjectGetOwnPropertyDescriptor(),U=requireObjectDefineProperty();return copyConstructorProperties=function(V,G,K){for(var J=$(G),W=U.f,Z=q.f,Q=0;Q<J.length;Q++){var ee=J[Q];!B(V,ee)&&!(K&&B(K,ee))&&W(V,ee,Z(G,ee))}},copyConstructorProperties}var isForced_1,hasRequiredIsForced;function requireIsForced(){if(hasRequiredIsForced)return isForced_1;hasRequiredIsForced=1;var B=requireFails(),$=requireIsCallable(),q=/#|\\.prototype\\./,U=function(W,Z){var Q=G[V(W)];return Q===J?!0:Q===K?!1:$(Z)?B(Z):!!Z},V=U.normalize=function(W){return String(W).replace(q,".").toLowerCase()},G=U.data={},K=U.NATIVE="N",J=U.POLYFILL="P";return isForced_1=U,isForced_1}var _export,hasRequired_export;function require_export(){if(hasRequired_export)return _export;hasRequired_export=1;var B=requireGlobalThis$3(),$=requireObjectGetOwnPropertyDescriptor().f,q=requireCreateNonEnumerableProperty(),U=requireDefineBuiltIn(),V=requireDefineGlobalProperty(),G=requireCopyConstructorProperties(),K=requireIsForced();return _export=function(J,W){var Z=J.target,Q=J.global,ee=J.stat,te,ne,oe,ce,le,pe;if(Q?ne=B:ee?ne=B[Z]||V(Z,{}):ne=B[Z]&&B[Z].prototype,ne)for(oe in W){if(le=W[oe],J.dontCallGetSet?(pe=$(ne,oe),ce=pe&&pe.value):ce=ne[oe],te=K(Q?oe:Z+(ee?".":"#")+oe,J.forced),!te&&ce!==void 0){if(typeof le==typeof ce)continue;G(le,ce)}(J.sham||ce&&ce.sham)&&q(le,"sham",!0),U(ne,oe,le,J)}},_export}var hasRequiredEs_globalThis;function requireEs_globalThis(){if(hasRequiredEs_globalThis)return es_globalThis;hasRequiredEs_globalThis=1;var B=require_export(),$=requireGlobalThis$3();return B({global:!0,forced:$.globalThis!==$},{globalThis:$}),es_globalThis}var globalThis$3,hasRequiredGlobalThis$2;function requireGlobalThis$2(){return hasRequiredGlobalThis$2||(hasRequiredGlobalThis$2=1,requireEs_globalThis(),globalThis$3=requireGlobalThis$3()),globalThis$3}var globalThis$2,hasRequiredGlobalThis$1;function requireGlobalThis$1(){if(hasRequiredGlobalThis$1)return globalThis$2;hasRequiredGlobalThis$1=1;var B=requireGlobalThis$2();return globalThis$2=B,globalThis$2}var globalThis$1,hasRequiredGlobalThis;function requireGlobalThis(){if(hasRequiredGlobalThis)return globalThis$1;hasRequiredGlobalThis=1;var B=requireGlobalThis$1();return globalThis$1=B,globalThis$1}requireGlobalThis();/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */const proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),finalizer=Symbol("Comlink.finalizer"),throwMarker=Symbol("Comlink.thrown"),isObject=B=>typeof B=="object"&&B!==null||typeof B=="function",proxyTransferHandler={canHandle:B=>isObject(B)&&B[proxyMarker],serialize(B){const{port1:$,port2:q}=new MessageChannel;return expose(B,$),[q,[q]]},deserialize(B){return B.start(),wrap$1(B)}},throwTransferHandler={canHandle:B=>isObject(B)&&throwMarker in B,serialize({value:B}){let $;return B instanceof Error?$={isError:!0,value:{message:B.message,name:B.name,stack:B.stack}}:$={isError:!1,value:B},[$,[]]},deserialize(B){throw B.isError?Object.assign(new Error(B.value.message),B.value):B.value}},transferHandlers=new Map([["proxy",proxyTransferHandler],["throw",throwTransferHandler]]);function isAllowedOrigin(B,$){for(const q of B)if($===q||q==="*"||q instanceof RegExp&&q.test($))return!0;return!1}function expose(B,$=globalThis,q=["*"]){$.addEventListener("message",function U(V){if(!V||!V.data)return;if(!isAllowedOrigin(q,V.origin)){console.warn(`Invalid origin \'${V.origin}\' for comlink proxy`);return}const{id:G,type:K,path:J}=Object.assign({path:[]},V.data),W=(V.data.argumentList||[]).map(fromWireValue);let Z;try{const Q=J.slice(0,-1).reduce((te,ne)=>te[ne],B),ee=J.reduce((te,ne)=>te[ne],B);switch(K){case"GET":Z=ee;break;case"SET":Q[J.slice(-1)[0]]=fromWireValue(V.data.value),Z=!0;break;case"APPLY":Z=ee.apply(Q,W);break;case"CONSTRUCT":{const te=new ee(...W);Z=proxy(te)}break;case"ENDPOINT":{const{port1:te,port2:ne}=new MessageChannel;expose(B,ne),Z=transfer(te,[te])}break;case"RELEASE":Z=void 0;break;default:return}}catch(Q){Z={value:Q,[throwMarker]:0}}Promise.resolve(Z).catch(Q=>({value:Q,[throwMarker]:0})).then(Q=>{const[ee,te]=toWireValue(Q);$.postMessage(Object.assign(Object.assign({},ee),{id:G}),te),K==="RELEASE"&&($.removeEventListener("message",U),closeEndPoint($),finalizer in B&&typeof B[finalizer]=="function"&&B[finalizer]())}).catch(Q=>{const[ee,te]=toWireValue({value:new TypeError("Unserializable return value"),[throwMarker]:0});$.postMessage(Object.assign(Object.assign({},ee),{id:G}),te)})}),$.start&&$.start()}function isMessagePort(B){return B.constructor.name==="MessagePort"}function closeEndPoint(B){isMessagePort(B)&&B.close()}function wrap$1(B,$){const q=new Map;return B.addEventListener("message",function(V){const{data:G}=V;if(!G||!G.id)return;const K=q.get(G.id);if(K)try{K(G)}finally{q.delete(G.id)}}),createProxy(B,q,[],$)}function throwIfProxyReleased(B){if(B)throw new Error("Proxy has been released and is not useable")}function releaseEndpoint(B){return requestResponseMessage(B,new Map,{type:"RELEASE"}).then(()=>{closeEndPoint(B)})}const proxyCounter=new WeakMap,proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry(B=>{const $=(proxyCounter.get(B)||0)-1;proxyCounter.set(B,$),$===0&&releaseEndpoint(B)});function registerProxy(B,$){const q=(proxyCounter.get($)||0)+1;proxyCounter.set($,q),proxyFinalizers&&proxyFinalizers.register(B,$,B)}function unregisterProxy(B){proxyFinalizers&&proxyFinalizers.unregister(B)}function createProxy(B,$,q=[],U=function(){}){let V=!1;const G=new Proxy(U,{get(K,J){if(throwIfProxyReleased(V),J===releaseProxy)return()=>{unregisterProxy(G),releaseEndpoint(B),$.clear(),V=!0};if(J==="then"){if(q.length===0)return{then:()=>G};const W=requestResponseMessage(B,$,{type:"GET",path:q.map(Z=>Z.toString())}).then(fromWireValue);return W.then.bind(W)}return createProxy(B,$,[...q,J])},set(K,J,W){throwIfProxyReleased(V);const[Z,Q]=toWireValue(W);return requestResponseMessage(B,$,{type:"SET",path:[...q,J].map(ee=>ee.toString()),value:Z},Q).then(fromWireValue)},apply(K,J,W){throwIfProxyReleased(V);const Z=q[q.length-1];if(Z===createEndpoint)return requestResponseMessage(B,$,{type:"ENDPOINT"}).then(fromWireValue);if(Z==="bind")return createProxy(B,$,q.slice(0,-1));const[Q,ee]=processArguments(W);return requestResponseMessage(B,$,{type:"APPLY",path:q.map(te=>te.toString()),argumentList:Q},ee).then(fromWireValue)},construct(K,J){throwIfProxyReleased(V);const[W,Z]=processArguments(J);return requestResponseMessage(B,$,{type:"CONSTRUCT",path:q.map(Q=>Q.toString()),argumentList:W},Z).then(fromWireValue)}});return registerProxy(G,B),G}function myFlat(B){return Array.prototype.concat.apply([],B)}function processArguments(B){const $=B.map(toWireValue);return[$.map(q=>q[0]),myFlat($.map(q=>q[1]))]}const transferCache=new WeakMap;function transfer(B,$){return transferCache.set(B,$),B}function proxy(B){return Object.assign(B,{[proxyMarker]:!0})}function toWireValue(B){for(const[$,q]of transferHandlers)if(q.canHandle(B)){const[U,V]=q.serialize(B);return[{type:"HANDLER",name:$,value:U},V]}return[{type:"RAW",value:B},transferCache.get(B)||[]]}function fromWireValue(B){switch(B.type){case"HANDLER":return transferHandlers.get(B.name).deserialize(B.value);case"RAW":return B.value}}function requestResponseMessage(B,$,q,U){return new Promise(V=>{const G=generateUUID();$.set(G,V),B.start&&B.start(),B.postMessage(Object.assign({id:G},q),U)})}function generateUUID(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var extendStatics=function(B,$){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,U){q.__proto__=U}||function(q,U){for(var V in U)Object.prototype.hasOwnProperty.call(U,V)&&(q[V]=U[V])},extendStatics(B,$)};function __extends(B,$){if(typeof $!="function"&&$!==null)throw new TypeError("Class extends value "+String($)+" is not a constructor or null");extendStatics(B,$);function q(){this.constructor=B}B.prototype=$===null?Object.create($):(q.prototype=$.prototype,new q)}function __awaiter(B,$,q,U){function V(G){return G instanceof q?G:new q(function(K){K(G)})}return new(q||(q=Promise))(function(G,K){function J(Q){try{Z(U.next(Q))}catch(ee){K(ee)}}function W(Q){try{Z(U.throw(Q))}catch(ee){K(ee)}}function Z(Q){Q.done?G(Q.value):V(Q.value).then(J,W)}Z((U=U.apply(B,$||[])).next())})}function __generator(B,$){var q={label:0,sent:function(){if(G[0]&1)throw G[1];return G[1]},trys:[],ops:[]},U,V,G,K;return K={next:J(0),throw:J(1),return:J(2)},typeof Symbol=="function"&&(K[Symbol.iterator]=function(){return this}),K;function J(Z){return function(Q){return W([Z,Q])}}function W(Z){if(U)throw new TypeError("Generator is already executing.");for(;K&&(K=0,Z[0]&&(q=0)),q;)try{if(U=1,V&&(G=Z[0]&2?V.return:Z[0]?V.throw||((G=V.return)&&G.call(V),0):V.next)&&!(G=G.call(V,Z[1])).done)return G;switch(V=0,G&&(Z=[Z[0]&2,G.value]),Z[0]){case 0:case 1:G=Z;break;case 4:return q.label++,{value:Z[1],done:!1};case 5:q.label++,V=Z[1],Z=[0];continue;case 7:Z=q.ops.pop(),q.trys.pop();continue;default:if(G=q.trys,!(G=G.length>0&&G[G.length-1])&&(Z[0]===6||Z[0]===2)){q=0;continue}if(Z[0]===3&&(!G||Z[1]>G[0]&&Z[1]<G[3])){q.label=Z[1];break}if(Z[0]===6&&q.label<G[1]){q.label=G[1],G=Z;break}if(G&&q.label<G[2]){q.label=G[2],q.ops.push(Z);break}G[2]&&q.ops.pop(),q.trys.pop();continue}Z=$.call(B,q)}catch(Q){Z=[6,Q],V=0}finally{U=G=0}if(Z[0]&5)throw Z[1];return{value:Z[0]?Z[1]:void 0,done:!0}}}function __values(B){var $=typeof Symbol=="function"&&Symbol.iterator,q=$&&B[$],U=0;if(q)return q.call(B);if(B&&typeof B.length=="number")return{next:function(){return B&&U>=B.length&&(B=void 0),{value:B&&B[U++],done:!B}}};throw new TypeError($?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(B,$){var q=typeof Symbol=="function"&&B[Symbol.iterator];if(!q)return B;var U=q.call(B),V,G=[],K;try{for(;($===void 0||$-- >0)&&!(V=U.next()).done;)G.push(V.value)}catch(J){K={error:J}}finally{try{V&&!V.done&&(q=U.return)&&q.call(U)}finally{if(K)throw K.error}}return G}function __spreadArray(B,$,q){if(q||arguments.length===2)for(var U=0,V=$.length,G;U<V;U++)(G||!(U in $))&&(G||(G=Array.prototype.slice.call($,0,U)),G[U]=$[U]);return B.concat(G||Array.prototype.slice.call($))}function __await(B){return this instanceof __await?(this.v=B,this):new __await(B)}function __asyncGenerator(B,$,q){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var U=q.apply(B,$||[]),V,G=[];return V={},K("next"),K("throw"),K("return"),V[Symbol.asyncIterator]=function(){return this},V;function K(te){U[te]&&(V[te]=function(ne){return new Promise(function(oe,ce){G.push([te,ne,oe,ce])>1||J(te,ne)})})}function J(te,ne){try{W(U[te](ne))}catch(oe){ee(G[0][3],oe)}}function W(te){te.value instanceof __await?Promise.resolve(te.value.v).then(Z,Q):ee(G[0][2],te)}function Z(te){J("next",te)}function Q(te){J("throw",te)}function ee(te,ne){te(ne),G.shift(),G.length&&J(G[0][0],G[0][1])}}function __asyncValues(B){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=B[Symbol.asyncIterator],q;return $?$.call(B):(B=typeof __values=="function"?__values(B):B[Symbol.iterator](),q={},U("next"),U("throw"),U("return"),q[Symbol.asyncIterator]=function(){return this},q);function U(G){q[G]=B[G]&&function(K){return new Promise(function(J,W){K=B[G](K),V(J,W,K.done,K.value)})}}function V(G,K,J,W){Promise.resolve(W).then(function(Z){G({value:Z,done:J})},K)}}typeof SuppressedError=="function"&&SuppressedError;function isFunction(B){return typeof B=="function"}function createErrorClass(B){var $=function(U){Error.call(U),U.stack=new Error().stack},q=B($);return q.prototype=Object.create(Error.prototype),q.prototype.constructor=q,q}var UnsubscriptionError=createErrorClass(function(B){return function(q){B(this),this.message=q?q.length+` errors occurred during unsubscription:\n`+q.map(function(U,V){return V+1+") "+U.toString()}).join(`\n  `):"",this.name="UnsubscriptionError",this.errors=q}});function arrRemove(B,$){if(B){var q=B.indexOf($);0<=q&&B.splice(q,1)}}var Subscription=function(){function B($){this.initialTeardown=$,this.closed=!1,this._parentage=null,this._finalizers=null}return B.prototype.unsubscribe=function(){var $,q,U,V,G;if(!this.closed){this.closed=!0;var K=this._parentage;if(K)if(this._parentage=null,Array.isArray(K))try{for(var J=__values(K),W=J.next();!W.done;W=J.next()){var Z=W.value;Z.remove(this)}}catch(ce){$={error:ce}}finally{try{W&&!W.done&&(q=J.return)&&q.call(J)}finally{if($)throw $.error}}else K.remove(this);var Q=this.initialTeardown;if(isFunction(Q))try{Q()}catch(ce){G=ce instanceof UnsubscriptionError?ce.errors:[ce]}var ee=this._finalizers;if(ee){this._finalizers=null;try{for(var te=__values(ee),ne=te.next();!ne.done;ne=te.next()){var oe=ne.value;try{execFinalizer(oe)}catch(ce){G=G!=null?G:[],ce instanceof UnsubscriptionError?G=__spreadArray(__spreadArray([],__read(G)),__read(ce.errors)):G.push(ce)}}}catch(ce){U={error:ce}}finally{try{ne&&!ne.done&&(V=te.return)&&V.call(te)}finally{if(U)throw U.error}}}if(G)throw new UnsubscriptionError(G)}},B.prototype.add=function($){var q;if($&&$!==this)if(this.closed)execFinalizer($);else{if($ instanceof B){if($.closed||$._hasParent(this))return;$._addParent(this)}(this._finalizers=(q=this._finalizers)!==null&&q!==void 0?q:[]).push($)}},B.prototype._hasParent=function($){var q=this._parentage;return q===$||Array.isArray(q)&&q.includes($)},B.prototype._addParent=function($){var q=this._parentage;this._parentage=Array.isArray(q)?(q.push($),q):q?[q,$]:$},B.prototype._removeParent=function($){var q=this._parentage;q===$?this._parentage=null:Array.isArray(q)&&arrRemove(q,$)},B.prototype.remove=function($){var q=this._finalizers;q&&arrRemove(q,$),$ instanceof B&&$._removeParent(this)},B.EMPTY=function(){var $=new B;return $.closed=!0,$}(),B}(),EMPTY_SUBSCRIPTION=Subscription.EMPTY;function isSubscription(B){return B instanceof Subscription||B&&"closed"in B&&isFunction(B.remove)&&isFunction(B.add)&&isFunction(B.unsubscribe)}function execFinalizer(B){isFunction(B)?B():B.unsubscribe()}var config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},timeoutProvider={setTimeout:function(B,$){for(var q=[],U=2;U<arguments.length;U++)q[U-2]=arguments[U];return setTimeout.apply(void 0,__spreadArray([B,$],__read(q)))},clearTimeout:function(B){var $=timeoutProvider.delegate;return(($==null?void 0:$.clearTimeout)||clearTimeout)(B)},delegate:void 0};function reportUnhandledError(B){timeoutProvider.setTimeout(function(){throw B})}function noop$1(){}function errorContext(B){B()}var Subscriber=function(B){__extends($,B);function $(q){var U=B.call(this)||this;return U.isStopped=!1,q?(U.destination=q,isSubscription(q)&&q.add(U)):U.destination=EMPTY_OBSERVER,U}return $.create=function(q,U,V){return new SafeSubscriber(q,U,V)},$.prototype.next=function(q){this.isStopped||this._next(q)},$.prototype.error=function(q){this.isStopped||(this.isStopped=!0,this._error(q))},$.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},$.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,B.prototype.unsubscribe.call(this),this.destination=null)},$.prototype._next=function(q){this.destination.next(q)},$.prototype._error=function(q){try{this.destination.error(q)}finally{this.unsubscribe()}},$.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},$}(Subscription),ConsumerObserver=function(){function B($){this.partialObserver=$}return B.prototype.next=function($){var q=this.partialObserver;if(q.next)try{q.next($)}catch(U){handleUnhandledError(U)}},B.prototype.error=function($){var q=this.partialObserver;if(q.error)try{q.error($)}catch(U){handleUnhandledError(U)}else handleUnhandledError($)},B.prototype.complete=function(){var $=this.partialObserver;if($.complete)try{$.complete()}catch(q){handleUnhandledError(q)}},B}(),SafeSubscriber=function(B){__extends($,B);function $(q,U,V){var G=B.call(this)||this,K;return isFunction(q)||!q?K={next:q!=null?q:void 0,error:U!=null?U:void 0,complete:V!=null?V:void 0}:K=q,G.destination=new ConsumerObserver(K),G}return $}(Subscriber);function handleUnhandledError(B){reportUnhandledError(B)}function defaultErrorHandler(B){throw B}var EMPTY_OBSERVER={closed:!0,next:noop$1,error:defaultErrorHandler,complete:noop$1},observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function identity$1(B){return B}function pipeFromArray(B){return B.length===0?identity$1:B.length===1?B[0]:function(q){return B.reduce(function(U,V){return V(U)},q)}}var Observable=function(){function B($){$&&(this._subscribe=$)}return B.prototype.lift=function($){var q=new B;return q.source=this,q.operator=$,q},B.prototype.subscribe=function($,q,U){var V=this,G=isSubscriber($)?$:new SafeSubscriber($,q,U);return errorContext(function(){var K=V,J=K.operator,W=K.source;G.add(J?J.call(G,W):W?V._subscribe(G):V._trySubscribe(G))}),G},B.prototype._trySubscribe=function($){try{return this._subscribe($)}catch(q){$.error(q)}},B.prototype.forEach=function($,q){var U=this;return q=getPromiseCtor(q),new q(function(V,G){var K=new SafeSubscriber({next:function(J){try{$(J)}catch(W){G(W),K.unsubscribe()}},error:G,complete:V});U.subscribe(K)})},B.prototype._subscribe=function($){var q;return(q=this.source)===null||q===void 0?void 0:q.subscribe($)},B.prototype[observable]=function(){return this},B.prototype.pipe=function(){for(var $=[],q=0;q<arguments.length;q++)$[q]=arguments[q];return pipeFromArray($)(this)},B.prototype.toPromise=function($){var q=this;return $=getPromiseCtor($),new $(function(U,V){var G;q.subscribe(function(K){return G=K},function(K){return V(K)},function(){return U(G)})})},B.create=function($){return new B($)},B}();function getPromiseCtor(B){var $;return($=B!=null?B:config.Promise)!==null&&$!==void 0?$:Promise}function isObserver(B){return B&&isFunction(B.next)&&isFunction(B.error)&&isFunction(B.complete)}function isSubscriber(B){return B&&B instanceof Subscriber||isObserver(B)&&isSubscription(B)}function hasLift(B){return isFunction(B==null?void 0:B.lift)}function operate(B){return function($){if(hasLift($))return $.lift(function(q){try{return B(q,this)}catch(U){this.error(U)}});throw new TypeError("Unable to lift unknown Observable type")}}function createOperatorSubscriber(B,$,q,U,V){return new OperatorSubscriber(B,$,q,U,V)}var OperatorSubscriber=function(B){__extends($,B);function $(q,U,V,G,K,J){var W=B.call(this,q)||this;return W.onFinalize=K,W.shouldUnsubscribe=J,W._next=U?function(Z){try{U(Z)}catch(Q){q.error(Q)}}:B.prototype._next,W._error=G?function(Z){try{G(Z)}catch(Q){q.error(Q)}finally{this.unsubscribe()}}:B.prototype._error,W._complete=V?function(){try{V()}catch(Z){q.error(Z)}finally{this.unsubscribe()}}:B.prototype._complete,W}return $.prototype.unsubscribe=function(){var q;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var U=this.closed;B.prototype.unsubscribe.call(this),!U&&((q=this.onFinalize)===null||q===void 0||q.call(this))}},$}(Subscriber),ObjectUnsubscribedError=createErrorClass(function(B){return function(){B(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Subject=function(B){__extends($,B);function $(){var q=B.call(this)||this;return q.closed=!1,q.currentObservers=null,q.observers=[],q.isStopped=!1,q.hasError=!1,q.thrownError=null,q}return $.prototype.lift=function(q){var U=new AnonymousSubject(this,this);return U.operator=q,U},$.prototype._throwIfClosed=function(){if(this.closed)throw new ObjectUnsubscribedError},$.prototype.next=function(q){var U=this;errorContext(function(){var V,G;if(U._throwIfClosed(),!U.isStopped){U.currentObservers||(U.currentObservers=Array.from(U.observers));try{for(var K=__values(U.currentObservers),J=K.next();!J.done;J=K.next()){var W=J.value;W.next(q)}}catch(Z){V={error:Z}}finally{try{J&&!J.done&&(G=K.return)&&G.call(K)}finally{if(V)throw V.error}}}})},$.prototype.error=function(q){var U=this;errorContext(function(){if(U._throwIfClosed(),!U.isStopped){U.hasError=U.isStopped=!0,U.thrownError=q;for(var V=U.observers;V.length;)V.shift().error(q)}})},$.prototype.complete=function(){var q=this;errorContext(function(){if(q._throwIfClosed(),!q.isStopped){q.isStopped=!0;for(var U=q.observers;U.length;)U.shift().complete()}})},$.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty($.prototype,"observed",{get:function(){var q;return((q=this.observers)===null||q===void 0?void 0:q.length)>0},enumerable:!1,configurable:!0}),$.prototype._trySubscribe=function(q){return this._throwIfClosed(),B.prototype._trySubscribe.call(this,q)},$.prototype._subscribe=function(q){return this._throwIfClosed(),this._checkFinalizedStatuses(q),this._innerSubscribe(q)},$.prototype._innerSubscribe=function(q){var U=this,V=this,G=V.hasError,K=V.isStopped,J=V.observers;return G||K?EMPTY_SUBSCRIPTION:(this.currentObservers=null,J.push(q),new Subscription(function(){U.currentObservers=null,arrRemove(J,q)}))},$.prototype._checkFinalizedStatuses=function(q){var U=this,V=U.hasError,G=U.thrownError,K=U.isStopped;V?q.error(G):K&&q.complete()},$.prototype.asObservable=function(){var q=new Observable;return q.source=this,q},$.create=function(q,U){return new AnonymousSubject(q,U)},$}(Observable),AnonymousSubject=function(B){__extends($,B);function $(q,U){var V=B.call(this)||this;return V.destination=q,V.source=U,V}return $.prototype.next=function(q){var U,V;(V=(U=this.destination)===null||U===void 0?void 0:U.next)===null||V===void 0||V.call(U,q)},$.prototype.error=function(q){var U,V;(V=(U=this.destination)===null||U===void 0?void 0:U.error)===null||V===void 0||V.call(U,q)},$.prototype.complete=function(){var q,U;(U=(q=this.destination)===null||q===void 0?void 0:q.complete)===null||U===void 0||U.call(q)},$.prototype._subscribe=function(q){var U,V;return(V=(U=this.source)===null||U===void 0?void 0:U.subscribe(q))!==null&&V!==void 0?V:EMPTY_SUBSCRIPTION},$}(Subject),isArrayLike=function(B){return B&&typeof B.length=="number"&&typeof B!="function"};function isPromise(B){return isFunction(B==null?void 0:B.then)}function isInteropObservable(B){return isFunction(B[observable])}function isAsyncIterable(B){return Symbol.asyncIterator&&isFunction(B==null?void 0:B[Symbol.asyncIterator])}function createInvalidObservableTypeError(B){return new TypeError("You provided "+(B!==null&&typeof B=="object"?"an invalid object":"\'"+B+"\'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function getSymbolIterator(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var iterator=getSymbolIterator();function isIterable(B){return isFunction(B==null?void 0:B[iterator])}function readableStreamLikeToAsyncGenerator(B){return __asyncGenerator(this,arguments,function(){var q,U,V,G;return __generator(this,function(K){switch(K.label){case 0:q=B.getReader(),K.label=1;case 1:K.trys.push([1,,9,10]),K.label=2;case 2:return[4,__await(q.read())];case 3:return U=K.sent(),V=U.value,G=U.done,G?[4,__await(void 0)]:[3,5];case 4:return[2,K.sent()];case 5:return[4,__await(V)];case 6:return[4,K.sent()];case 7:return K.sent(),[3,2];case 8:return[3,10];case 9:return q.releaseLock(),[7];case 10:return[2]}})})}function isReadableStreamLike(B){return isFunction(B==null?void 0:B.getReader)}function innerFrom(B){if(B instanceof Observable)return B;if(B!=null){if(isInteropObservable(B))return fromInteropObservable(B);if(isArrayLike(B))return fromArrayLike(B);if(isPromise(B))return fromPromise(B);if(isAsyncIterable(B))return fromAsyncIterable(B);if(isIterable(B))return fromIterable(B);if(isReadableStreamLike(B))return fromReadableStreamLike(B)}throw createInvalidObservableTypeError(B)}function fromInteropObservable(B){return new Observable(function($){var q=B[observable]();if(isFunction(q.subscribe))return q.subscribe($);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function fromArrayLike(B){return new Observable(function($){for(var q=0;q<B.length&&!$.closed;q++)$.next(B[q]);$.complete()})}function fromPromise(B){return new Observable(function($){B.then(function(q){$.closed||($.next(q),$.complete())},function(q){return $.error(q)}).then(null,reportUnhandledError)})}function fromIterable(B){return new Observable(function($){var q,U;try{for(var V=__values(B),G=V.next();!G.done;G=V.next()){var K=G.value;if($.next(K),$.closed)return}}catch(J){q={error:J}}finally{try{G&&!G.done&&(U=V.return)&&U.call(V)}finally{if(q)throw q.error}}$.complete()})}function fromAsyncIterable(B){return new Observable(function($){process(B,$).catch(function(q){return $.error(q)})})}function fromReadableStreamLike(B){return fromAsyncIterable(readableStreamLikeToAsyncGenerator(B))}function process(B,$){var q,U,V,G;return __awaiter(this,void 0,void 0,function(){var K,J;return __generator(this,function(W){switch(W.label){case 0:W.trys.push([0,5,6,11]),q=__asyncValues(B),W.label=1;case 1:return[4,q.next()];case 2:if(U=W.sent(),!!U.done)return[3,4];if(K=U.value,$.next(K),$.closed)return[2];W.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return J=W.sent(),V={error:J},[3,11];case 6:return W.trys.push([6,,9,10]),U&&!U.done&&(G=q.return)?[4,G.call(q)]:[3,8];case 7:W.sent(),W.label=8;case 8:return[3,10];case 9:if(V)throw V.error;return[7];case 10:return[7];case 11:return $.complete(),[2]}})})}function executeSchedule(B,$,q,U,V){U===void 0&&(U=0),V===void 0&&(V=!1);var G=$.schedule(function(){q(),V?B.add(this.schedule(null,U)):this.unsubscribe()},U);if(B.add(G),!V)return G}function map(B,$){return operate(function(q,U){var V=0;q.subscribe(createOperatorSubscriber(U,function(G){U.next(B.call($,G,V++))}))})}var isArray=Array.isArray;function callOrApply(B,$){return isArray($)?B.apply(void 0,__spreadArray([],__read($))):B($)}function mapOneOrManyArgs(B){return map(function($){return callOrApply(B,$)})}function mergeInternals(B,$,q,U,V,G,K,J){var W=[],Z=0,Q=0,ee=!1,te=function(){ee&&!W.length&&!Z&&$.complete()},ne=function(ce){return Z<U?oe(ce):W.push(ce)},oe=function(ce){Z++;var le=!1;innerFrom(q(ce,Q++)).subscribe(createOperatorSubscriber($,function(pe){$.next(pe)},function(){le=!0},void 0,function(){if(le)try{Z--;for(var pe=function(){var he=W.shift();K||oe(he)};W.length&&Z<U;)pe();te()}catch(he){$.error(he)}}))};return B.subscribe(createOperatorSubscriber($,ne,function(){ee=!0,te()})),function(){}}function mergeMap(B,$,q){return q===void 0&&(q=1/0),isFunction($)?mergeMap(function(U,V){return map(function(G,K){return $(U,G,V,K)})(innerFrom(B(U,V)))},q):(typeof $=="number"&&(q=$),operate(function(U,V){return mergeInternals(U,V,B,q)}))}var nodeEventEmitterMethods=["addListener","removeListener"],eventTargetMethods=["addEventListener","removeEventListener"],jqueryMethods=["on","off"];function fromEvent(B,$,q,U){if(isFunction(q)&&(U=q,q=void 0),U)return fromEvent(B,$,q).pipe(mapOneOrManyArgs(U));var V=__read(isEventTarget(B)?eventTargetMethods.map(function(J){return function(W){return B[J]($,W,q)}}):isNodeStyleEventEmitter(B)?nodeEventEmitterMethods.map(toCommonHandlerRegistry(B,$)):isJQueryStyleEventEmitter(B)?jqueryMethods.map(toCommonHandlerRegistry(B,$)):[],2),G=V[0],K=V[1];if(!G&&isArrayLike(B))return mergeMap(function(J){return fromEvent(J,$,q)})(innerFrom(B));if(!G)throw new TypeError("Invalid event target");return new Observable(function(J){var W=function(){for(var Z=[],Q=0;Q<arguments.length;Q++)Z[Q]=arguments[Q];return J.next(1<Z.length?Z:Z[0])};return G(W),function(){return K(W)}})}function toCommonHandlerRegistry(B,$){return function(q){return function(U){return B[q]($,U)}}}function isNodeStyleEventEmitter(B){return isFunction(B.addListener)&&isFunction(B.removeListener)}function isJQueryStyleEventEmitter(B){return isFunction(B.on)&&isFunction(B.off)}function isEventTarget(B){return isFunction(B.addEventListener)&&isFunction(B.removeEventListener)}function filter$1(B,$){return operate(function(q,U){var V=0;q.subscribe(createOperatorSubscriber(U,function(G){return B.call($,G,V++)&&U.next(G)}))})}function share(B){B===void 0&&(B={});var $=B.connector,q=$===void 0?function(){return new Subject}:$,U=B.resetOnError,V=U===void 0?!0:U,G=B.resetOnComplete,K=G===void 0?!0:G,J=B.resetOnRefCountZero,W=J===void 0?!0:J;return function(Z){var Q,ee,te,ne=0,oe=!1,ce=!1,le=function(){ee==null||ee.unsubscribe(),ee=void 0},pe=function(){le(),Q=te=void 0,oe=ce=!1},he=function(){var fe=Q;pe(),fe==null||fe.unsubscribe()};return operate(function(fe,ye){ne++,!ce&&!oe&&le();var ge=te=te!=null?te:q();ye.add(function(){ne--,ne===0&&!ce&&!oe&&(ee=handleReset(he,W))}),ge.subscribe(ye),!Q&&ne>0&&(Q=new SafeSubscriber({next:function(Re){return ge.next(Re)},error:function(Re){ce=!0,le(),ee=handleReset(pe,V,Re),ge.error(Re)},complete:function(){oe=!0,le(),ee=handleReset(pe,K),ge.complete()}}),innerFrom(fe).subscribe(Q))})(Z)}}function handleReset(B,$){for(var q=[],U=2;U<arguments.length;U++)q[U-2]=arguments[U];if($===!0){B();return}if($!==!1){var V=new SafeSubscriber({next:function(){V.unsubscribe(),B()}});return innerFrom($.apply(void 0,__spreadArray([],__read(q)))).subscribe(V)}}function tap(B,$,q){var U=isFunction(B)||$||q?{next:B,error:$,complete:q}:B;return U?operate(function(V,G){var K;(K=U.subscribe)===null||K===void 0||K.call(U);var J=!0;V.subscribe(createOperatorSubscriber(G,function(W){var Z;(Z=U.next)===null||Z===void 0||Z.call(U,W),G.next(W)},function(){var W;J=!1,(W=U.complete)===null||W===void 0||W.call(U),G.complete()},function(W){var Z;J=!1,(Z=U.error)===null||Z===void 0||Z.call(U,W),G.error(W)},function(){var W,Z;J&&((W=U.unsubscribe)===null||W===void 0||W.call(U)),(Z=U.finalize)===null||Z===void 0||Z.call(U)}))}):identity$1}const BRIDGING_TOPIC="bytereplay.bridging";function workerBridge(){return fromEvent(globalThis,"message").pipe(map(B=>{const{data:$}=B;if(typeof $=="object"&&$.topic===BRIDGING_TOPIC){const q=$;if(q.contentType==="bytereplay.core.Frame")return q.content}return null}),filter$1(B=>B!=null))}var d$9=Object.defineProperty,t$b=(B,$,q)=>$ in B?d$9(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,s$c=(B,$,q)=>t$b(B,$+"",q);let z$3=class extends Error{constructor($,q){var U;super($,q),s$c(this,"localizedMessage"),this.name="bytereplay.core.RuntimeError",this.localizedMessage=(U=q==null?void 0:q.localizedMessage)!=null?U:$}};var m$j=Object.defineProperty,o$g=(B,$,q)=>$ in B?m$j(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,d$8=(B,$,q)=>o$g(B,$+"",q);let s$b=class extends z$3{constructor($,q){super($,q),d$8(this,"_code"),this.name="bytereplay.core.ServerError",this._code=q==null?void 0:q.code}get code(){return this._code}};var formdata_min={};/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */var hasRequiredFormdata_min;function requireFormdata_min(){return hasRequiredFormdata_min||(hasRequiredFormdata_min=1,function(){var B;function $(re){var ie=0;return function(){return ie<re.length?{done:!1,value:re[ie++]}:{done:!0}}}var q=typeof Object.defineProperties=="function"?Object.defineProperty:function(re,ie,ae){return re==Array.prototype||re==Object.prototype||(re[ie]=ae.value),re};function U(re){re=[typeof globalThis=="object"&&globalThis,re,typeof window=="object"&&window,typeof self=="object"&&self,typeof commonjsGlobal=="object"&&commonjsGlobal];for(var ie=0;ie<re.length;++ie){var ae=re[ie];if(ae&&ae.Math==Math)return ae}throw Error("Cannot find global object")}var V=U(this);function G(re,ie){if(ie)e:{var ae=V;re=re.split(".");for(var ue=0;ue<re.length-1;ue++){var de=re[ue];if(!(de in ae))break e;ae=ae[de]}re=re[re.length-1],ue=ae[re],ie=ie(ue),ie!=ue&&ie!=null&&q(ae,re,{configurable:!0,writable:!0,value:ie})}}G("Symbol",function(re){function ie(we){if(this instanceof ie)throw new TypeError("Symbol is not a constructor");return new ae(ue+(we||"")+"_"+de++,we)}function ae(we,ke){this.A=we,q(this,"description",{configurable:!0,writable:!0,value:ke})}if(re)return re;ae.prototype.toString=function(){return this.A};var ue="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",de=0;return ie}),G("Symbol.iterator",function(re){if(re)return re;re=Symbol("Symbol.iterator");for(var ie="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ae=0;ae<ie.length;ae++){var ue=V[ie[ae]];typeof ue=="function"&&typeof ue.prototype[re]!="function"&&q(ue.prototype,re,{configurable:!0,writable:!0,value:function(){return K($(this))}})}return re});function K(re){return re={next:re},re[Symbol.iterator]=function(){return this},re}function J(re){var ie=typeof Symbol!="undefined"&&Symbol.iterator&&re[Symbol.iterator];return ie?ie.call(re):{next:$(re)}}var W;if(typeof Object.setPrototypeOf=="function")W=Object.setPrototypeOf;else{var Z;e:{var Q={a:!0},ee={};try{ee.__proto__=Q,Z=ee.a;break e}catch(re){}Z=!1}W=Z?function(re,ie){if(re.__proto__=ie,re.__proto__!==ie)throw new TypeError(re+" is not extensible");return re}:null}var te=W;function ne(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function oe(re){if(re.m)throw new TypeError("Generator is already running");re.m=!0}ne.prototype.o=function(re){this.v=re},ne.prototype.s=function(re){this.l={D:re,F:!0},this.h=this.C||this.u},ne.prototype.return=function(re){this.l={return:re},this.h=this.u};function ce(re,ie){return re.h=3,{value:ie}}function le(re){this.g=new ne,this.G=re}le.prototype.o=function(re){return oe(this.g),this.g.j?he(this,this.g.j.next,re,this.g.o):(this.g.o(re),fe(this))};function pe(re,ie){oe(re.g);var ae=re.g.j;return ae?he(re,"return"in ae?ae.return:function(ue){return{value:ue,done:!0}},ie,re.g.return):(re.g.return(ie),fe(re))}le.prototype.s=function(re){return oe(this.g),this.g.j?he(this,this.g.j.throw,re,this.g.o):(this.g.s(re),fe(this))};function he(re,ie,ae,ue){try{var de=ie.call(re.g.j,ae);if(!(de instanceof Object))throw new TypeError("Iterator result "+de+" is not an object");if(!de.done)return re.g.m=!1,de;var we=de.value}catch(ke){return re.g.j=null,re.g.s(ke),fe(re)}return re.g.j=null,ue.call(re.g,we),fe(re)}function fe(re){for(;re.g.h;)try{var ie=re.G(re.g);if(ie)return re.g.m=!1,{value:ie.value,done:!1}}catch(ae){re.g.v=void 0,re.g.s(ae)}if(re.g.m=!1,re.g.l){if(ie=re.g.l,re.g.l=null,ie.F)throw ie.D;return{value:ie.return,done:!0}}return{value:void 0,done:!0}}function ye(re){this.next=function(ie){return re.o(ie)},this.throw=function(ie){return re.s(ie)},this.return=function(ie){return pe(re,ie)},this[Symbol.iterator]=function(){return this}}function ge(re,ie){return ie=new ye(new le(ie)),te&&re.prototype&&te(ie,re.prototype),ie}function Re(re,ie){re instanceof String&&(re+="");var ae=0,ue=!1,de={next:function(){if(!ue&&ae<re.length){var we=ae++;return{value:ie(we,re[we]),done:!1}}return ue=!0,{done:!0,value:void 0}}};return de[Symbol.iterator]=function(){return de},de}if(G("Array.prototype.entries",function(re){return re||function(){return Re(this,function(ie,ae){return[ie,ae]})}}),typeof Blob!="undefined"&&(typeof FormData=="undefined"||!FormData.prototype.keys)){var xe=function(re,ie){for(var ae=0;ae<re.length;ae++)ie(re[ae])},_e=function(re){return re.replace(/\\r?\\n|\\r/g,`\\r\n`)},ve=function(re,ie,ae){return ie instanceof Blob?(ae=ae!==void 0?ae+"":typeof ie.name=="string"?ie.name:"blob",(ie.name!==ae||Object.prototype.toString.call(ie)==="[object Blob]")&&(ie=new File([ie],ae)),[String(re),ie]):[String(re),String(ie)]},Te=function(re,ie){if(re.length<ie)throw new TypeError(ie+" argument required, but only "+re.length+" present.")},$e=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ie=$e.FormData,Ae=$e.XMLHttpRequest&&$e.XMLHttpRequest.prototype.send,Me=$e.Request&&$e.fetch,qe=$e.navigator&&$e.navigator.sendBeacon,Se=$e.Element&&$e.Element.prototype,be=$e.Symbol&&Symbol.toStringTag;be&&(Blob.prototype[be]||(Blob.prototype[be]="Blob"),"File"in $e&&!File.prototype[be]&&(File.prototype[be]="File"));try{new File([],"")}catch(re){$e.File=function(ie,ae,ue){return ie=new Blob(ie,ue||{}),Object.defineProperties(ie,{name:{value:ae},lastModified:{value:+(ue&&ue.lastModified!==void 0?new Date(ue.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),be&&Object.defineProperty(ie,be,{value:"File"}),ie}}var Pe=function(re){return re.replace(/\\n/g,"%0A").replace(/\\r/g,"%0D").replace(/"/g,"%22")},Ee=function(re){this.i=[];var ie=this;re&&xe(re.elements,function(ae){if(ae.name&&!ae.disabled&&ae.type!=="submit"&&ae.type!=="button"&&!ae.matches("form fieldset[disabled] *"))if(ae.type==="file"){var ue=ae.files&&ae.files.length?ae.files:[new File([],"",{type:"application/octet-stream"})];xe(ue,function(de){ie.append(ae.name,de)})}else ae.type==="select-multiple"||ae.type==="select-one"?xe(ae.options,function(de){!de.disabled&&de.selected&&ie.append(ae.name,de.value)}):ae.type==="checkbox"||ae.type==="radio"?ae.checked&&ie.append(ae.name,ae.value):(ue=ae.type==="textarea"?_e(ae.value):ae.value,ie.append(ae.name,ue))})};if(B=Ee.prototype,B.append=function(re,ie,ae){Te(arguments,2),this.i.push(ve(re,ie,ae))},B.delete=function(re){Te(arguments,1);var ie=[];re=String(re),xe(this.i,function(ae){ae[0]!==re&&ie.push(ae)}),this.i=ie},B.entries=function re(){var ie,ae=this;return ge(re,function(ue){if(ue.h==1&&(ie=0),ue.h!=3)return ie<ae.i.length?ue=ce(ue,ae.i[ie]):(ue.h=0,ue=void 0),ue;ie++,ue.h=2})},B.forEach=function(re,ie){Te(arguments,1);for(var ae=J(this),ue=ae.next();!ue.done;ue=ae.next()){var de=J(ue.value);ue=de.next().value,de=de.next().value,re.call(ie,de,ue,this)}},B.get=function(re){Te(arguments,1);var ie=this.i;re=String(re);for(var ae=0;ae<ie.length;ae++)if(ie[ae][0]===re)return ie[ae][1];return null},B.getAll=function(re){Te(arguments,1);var ie=[];return re=String(re),xe(this.i,function(ae){ae[0]===re&&ie.push(ae[1])}),ie},B.has=function(re){Te(arguments,1),re=String(re);for(var ie=0;ie<this.i.length;ie++)if(this.i[ie][0]===re)return!0;return!1},B.keys=function re(){var ie=this,ae,ue,de,we,ke;return ge(re,function(Ce){if(Ce.h==1&&(ae=J(ie),ue=ae.next()),Ce.h!=3){if(ue.done){Ce.h=0;return}return de=ue.value,we=J(de),ke=we.next().value,ce(Ce,ke)}ue=ae.next(),Ce.h=2})},B.set=function(re,ie,ae){Te(arguments,2),re=String(re);var ue=[],de=ve(re,ie,ae),we=!0;xe(this.i,function(ke){ke[0]===re?we&&(we=!ue.push(de)):ue.push(ke)}),we&&ue.push(de),this.i=ue},B.values=function re(){var ie=this,ae,ue,de,we,ke;return ge(re,function(Ce){if(Ce.h==1&&(ae=J(ie),ue=ae.next()),Ce.h!=3){if(ue.done){Ce.h=0;return}return de=ue.value,we=J(de),we.next(),ke=we.next().value,ce(Ce,ke)}ue=ae.next(),Ce.h=2})},Ee.prototype._asNative=function(){for(var re=new Ie,ie=J(this),ae=ie.next();!ae.done;ae=ie.next()){var ue=J(ae.value);ae=ue.next().value,ue=ue.next().value,re.append(ae,ue)}return re},Ee.prototype._blob=function(){var re="----formdata-polyfill-"+Math.random(),ie=[],ae="--"+re+`\\r\nContent-Disposition: form-data; name="`;return this.forEach(function(ue,de){return typeof ue=="string"?ie.push(ae+Pe(_e(de))+(`"\\r\n\\r\n`+_e(ue)+`\\r\n`)):ie.push(ae+Pe(_e(de))+(\'"; filename="\'+Pe(ue.name)+`"\\r\nContent-Type: `+(ue.type||"application/octet-stream")+`\\r\n\\r\n`),ue,`\\r\n`)}),ie.push("--"+re+"--"),new Blob(ie,{type:"multipart/form-data; boundary="+re})},Ee.prototype[Symbol.iterator]=function(){return this.entries()},Ee.prototype.toString=function(){return"[object FormData]"},Se&&!Se.matches&&(Se.matches=Se.matchesSelector||Se.mozMatchesSelector||Se.msMatchesSelector||Se.oMatchesSelector||Se.webkitMatchesSelector||function(re){re=(this.document||this.ownerDocument).querySelectorAll(re);for(var ie=re.length;0<=--ie&&re.item(ie)!==this;);return-1<ie}),be&&(Ee.prototype[be]="FormData"),Ae){var Fe=$e.XMLHttpRequest.prototype.setRequestHeader;$e.XMLHttpRequest.prototype.setRequestHeader=function(re,ie){Fe.call(this,re,ie),re.toLowerCase()==="content-type"&&(this.B=!0)},$e.XMLHttpRequest.prototype.send=function(re){re instanceof Ee?(re=re._blob(),this.B||this.setRequestHeader("Content-Type",re.type),Ae.call(this,re)):Ae.call(this,re)}}Me&&($e.fetch=function(re,ie){return ie&&ie.body&&ie.body instanceof Ee&&(ie.body=ie.body._blob()),Me.call(this,re,ie)}),qe&&($e.navigator.sendBeacon=function(re,ie){return ie instanceof Ee&&(ie=ie._asNative()),qe.call(this,re,ie)}),$e.FormData=Ee}}()),formdata_min}requireFormdata_min();function a$c(){return new FormData}function n$r(B){return B instanceof FormData}function n$q(B){return typeof B=="function"}function u$f(B){return typeof B=="string"||B instanceof String}function l$l(B){return B.trim()===""}function t$a(){return!!globalThis.PerformanceObserver}function i$c(){return!!globalThis.performance}function u$e(){var B;return n$q((B=globalThis.performance)==null?void 0:B.now)}function s$a(){return n$q(globalThis.CompressionStream)}function c$g(){return n$q(globalThis.structuredClone)}function l$k(){return!!globalThis.Worker}function f$b(){return!!globalThis.WebSocket}function a$b(B){var $;return n$q(($=B!=null?B:globalThis)==null?void 0:$.fetch)}var o$f=Object.freeze({__proto__:null,compressionStream:s$a,fetch:a$b,performance:i$c,performanceNow:u$e,performanceObserver:t$a,structuredClone:c$g,webSockets:f$b,webWorkers:l$k});const VOID=-1,PRIMITIVE=0,ARRAY=1,OBJECT=2,DATE=3,REGEXP=4,MAP=5,SET=6,ERROR=7,BIGINT=8,env=typeof self=="object"?self:globalThis,deserializer=(B,$)=>{const q=(V,G)=>(B.set(G,V),V),U=V=>{if(B.has(V))return B.get(V);const[G,K]=$[V];switch(G){case PRIMITIVE:case VOID:return q(K,V);case ARRAY:{const J=q([],V);for(const W of K)J.push(U(W));return J}case OBJECT:{const J=q({},V);for(const[W,Z]of K)J[U(W)]=U(Z);return J}case DATE:return q(new Date(K),V);case REGEXP:{const{source:J,flags:W}=K;return q(new RegExp(J,W),V)}case MAP:{const J=q(new Map,V);for(const[W,Z]of K)J.set(U(W),U(Z));return J}case SET:{const J=q(new Set,V);for(const W of K)J.add(U(W));return J}case ERROR:{const{name:J,message:W}=K;return q(new env[J](W),V)}case BIGINT:return q(BigInt(K),V);case"BigInt":return q(Object(BigInt(K)),V)}return q(new env[G](K),V)};return U},deserialize=B=>deserializer(new Map,B)(0),EMPTY="",{toString}={},{keys}=Object,typeOf=B=>{const $=typeof B;if($!=="object"||!B)return[PRIMITIVE,$];const q=toString.call(B).slice(8,-1);switch(q){case"Array":return[ARRAY,EMPTY];case"Object":return[OBJECT,EMPTY];case"Date":return[DATE,EMPTY];case"RegExp":return[REGEXP,EMPTY];case"Map":return[MAP,EMPTY];case"Set":return[SET,EMPTY]}return q.includes("Array")?[ARRAY,q]:q.includes("Error")?[ERROR,q]:[OBJECT,q]},shouldSkip=([B,$])=>B===PRIMITIVE&&($==="function"||$==="symbol"),serializer=(B,$,q,U)=>{const V=(K,J)=>{const W=U.push(K)-1;return q.set(J,W),W},G=K=>{if(q.has(K))return q.get(K);let[J,W]=typeOf(K);switch(J){case PRIMITIVE:{let Q=K;switch(W){case"bigint":J=BIGINT,Q=K.toString();break;case"function":case"symbol":if(B)throw new TypeError("unable to serialize "+W);Q=null;break;case"undefined":return V([VOID],K)}return V([J,Q],K)}case ARRAY:{if(W)return V([W,[...K]],K);const Q=[],ee=V([J,Q],K);for(const te of K)Q.push(G(te));return ee}case OBJECT:{if(W)switch(W){case"BigInt":return V([W,K.toString()],K);case"Boolean":case"Number":case"String":return V([W,K.valueOf()],K)}if($&&"toJSON"in K)return G(K.toJSON());const Q=[],ee=V([J,Q],K);for(const te of keys(K))(B||!shouldSkip(typeOf(K[te])))&&Q.push([G(te),G(K[te])]);return ee}case DATE:return V([J,K.toISOString()],K);case REGEXP:{const{source:Q,flags:ee}=K;return V([J,{source:Q,flags:ee}],K)}case MAP:{const Q=[],ee=V([J,Q],K);for(const[te,ne]of K)(B||!(shouldSkip(typeOf(te))||shouldSkip(typeOf(ne))))&&Q.push([G(te),G(ne)]);return ee}case SET:{const Q=[],ee=V([J,Q],K);for(const te of K)(B||!shouldSkip(typeOf(te)))&&Q.push(G(te));return ee}}const{message:Z}=K;return V([J,{name:W,message:Z}],K)};return G},serialize=(B,{json:$,lossy:q}={})=>{const U=[];return serializer(!($||q),!!$,new Map,U)(B),U};var r$g=typeof structuredClone=="function"?(B,$)=>$&&("json"in $||"lossy"in $)?deserialize(serialize(B,$)):structuredClone(B):(B,$)=>deserialize(serialize(B,$));const p$c=o$f;function n$p(){return p$c.performanceNow()?globalThis.performance.now():Date.now()}const o$e={offset:0,now(){return n$p()+o$e.offset},sync(B){o$e.offset=B-n$p()}};var a$a=Object.defineProperty,i$b=Object.defineProperties,A$5=Object.getOwnPropertyDescriptors,o$d=Object.getOwnPropertySymbols,I$3=Object.prototype.hasOwnProperty,P$3=Object.prototype.propertyIsEnumerable,t$9=(B,$,q)=>$ in B?a$a(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,s$9=(B,$)=>{for(var q in $||($={}))I$3.call($,q)&&t$9(B,q,$[q]);if(o$d)for(var q of o$d($))P$3.call($,q)&&t$9(B,q,$[q]);return B},u$d=(B,$)=>i$b(B,A$5($));let h$d=class extends s$b{constructor($,q,U,V){super(`Error occurs when invoking API "${$}": ${U}`,u$d(s$9({},V!=null?V:{}),{code:q})),this.path=$,this.name="bytereplay.core.APIError"}};function v$3(B){return B instanceof h$d}const E$4="bytereplay";var P$2=Object.defineProperty,R$5=Object.getOwnPropertySymbols,S$1=Object.prototype.hasOwnProperty,E$3=Object.prototype.propertyIsEnumerable,m$i=(B,$,q)=>$ in B?P$2(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,l$j=(B,$)=>{for(var q in $||($={}))S$1.call($,q)&&m$i(B,q,$[q]);if(R$5)for(var q of R$5($))E$3.call($,q)&&m$i(B,q,$[q]);return B},f$a=(B,$,q)=>m$i(B,typeof $!="symbol"?$+"":$,q),a$9=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});class APIClient{constructor(B){f$a(this,"_env"),f$a(this,"_interceptors"),f$a(this,"_requestInterceptor"),this._env=B}get apiURL(){return`${this._env.baseURL}${this._env.apiPrefix}`}get env(){return this._env}set interceptors(B){this._interceptors=B}set requestInterceptor(value){u$f(value)?this._requestInterceptor=eval(value):this._requestInterceptor=value}get(B,$,q){return a$9(this,null,function*(){return this._request("GET",B,$,q)})}post(B,$,q){return a$9(this,null,function*(){return this._request("POST",B,$,q)})}sendBeacon(B,$){try{navigator.sendBeacon(this._makeURL(B).href,$)}catch(q){}}_request(B,$,q,U){return a$9(this,null,function*(){var V,G,K,J;let W={path:$,headers:U};const Z=(G=(V=this._interceptors)==null?void 0:V.rewrite)!=null?G:this._requestInterceptor;if(Z!=null)try{W=Z($,U)}catch(ce){}const Q=this._makeURL(W.path),ee=B==="POST";if(B==="GET"&&q!=null){for(const[ce,le]of Object.entries(q))if(le!=null){let pe;le instanceof Date?pe=le.toISOString():pe=le.toString(),Q.searchParams.set(ce,pe)}}const te={};let ne;ee&&(n$r(q)?ne=q:(ne=JSON.stringify(q),te["Content-Type"]="application/json"));const oe=((J=(K=this._interceptors)==null?void 0:K.request)!=null?J:fetch)(Q.href,{method:B,mode:"cors",body:ne,headers:l$j(l$j(l$j({},te),this._env.headers||{}),W.headers||{}),[E$4]:!0});return this._dealWithResponse(W.path,oe)})}_dealWithResponse(B,$){return a$9(this,null,function*(){let q;try{q=yield $}catch(V){throw new s$b(`Error occurs when invoking API "${B}": ${V.message}`,{cause:V})}let U;if(q instanceof Response)try{U=yield q.json()}catch(V){throw new s$b(`Response of API "${B}" is not a valid fetch response.`,{cause:V})}else U=q;if(U.success)return U.data;throw new h$d(B,U.code,U.message)})}_makeURL(B){return new URL(B,this.apiURL)}}let t$8=class{};const instanceOfAny=(B,$)=>$.some(q=>B instanceof q);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const transactionDoneMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(B){const $=new Promise((q,U)=>{const V=()=>{B.removeEventListener("success",G),B.removeEventListener("error",K)},G=()=>{q(wrap(B.result)),V()},K=()=>{U(B.error),V()};B.addEventListener("success",G),B.addEventListener("error",K)});return reverseTransformCache.set($,B),$}function cacheDonePromiseForTransaction(B){if(transactionDoneMap.has(B))return;const $=new Promise((q,U)=>{const V=()=>{B.removeEventListener("complete",G),B.removeEventListener("error",K),B.removeEventListener("abort",K)},G=()=>{q(),V()},K=()=>{U(B.error||new DOMException("AbortError","AbortError")),V()};B.addEventListener("complete",G),B.addEventListener("error",K),B.addEventListener("abort",K)});transactionDoneMap.set(B,$)}let idbProxyTraps={get(B,$,q){if(B instanceof IDBTransaction){if($==="done")return transactionDoneMap.get(B);if($==="store")return q.objectStoreNames[1]?void 0:q.objectStore(q.objectStoreNames[0])}return wrap(B[$])},set(B,$,q){return B[$]=q,!0},has(B,$){return B instanceof IDBTransaction&&($==="done"||$==="store")?!0:$ in B}};function replaceTraps(B){idbProxyTraps=B(idbProxyTraps)}function wrapFunction(B){return getCursorAdvanceMethods().includes(B)?function(...$){return B.apply(unwrap(this),$),wrap(this.request)}:function(...$){return wrap(B.apply(unwrap(this),$))}}function transformCachableValue(B){return typeof B=="function"?wrapFunction(B):(B instanceof IDBTransaction&&cacheDonePromiseForTransaction(B),instanceOfAny(B,getIdbProxyableTypes())?new Proxy(B,idbProxyTraps):B)}function wrap(B){if(B instanceof IDBRequest)return promisifyRequest(B);if(transformCache.has(B))return transformCache.get(B);const $=transformCachableValue(B);return $!==B&&(transformCache.set(B,$),reverseTransformCache.set($,B)),$}const unwrap=B=>reverseTransformCache.get(B);function openDB(B,$,{blocked:q,upgrade:U,blocking:V,terminated:G}={}){const K=indexedDB.open(B,$),J=wrap(K);return U&&K.addEventListener("upgradeneeded",W=>{U(wrap(K.result),W.oldVersion,W.newVersion,wrap(K.transaction),W)}),q&&K.addEventListener("blocked",W=>q(W.oldVersion,W.newVersion,W)),J.then(W=>{G&&W.addEventListener("close",()=>G()),V&&W.addEventListener("versionchange",Z=>V(Z.oldVersion,Z.newVersion,Z))}).catch(()=>{}),J}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(B,$){if(!(B instanceof IDBDatabase&&!($ in B)&&typeof $=="string"))return;if(cachedMethods.get($))return cachedMethods.get($);const q=$.replace(/FromIndex$/,""),U=$!==q,V=writeMethods.includes(q);if(!(q in(U?IDBIndex:IDBObjectStore).prototype)||!(V||readMethods.includes(q)))return;const G=function(K,...J){return me(this,null,function*(){const W=this.transaction(K,V?"readwrite":"readonly");let Z=W.store;return U&&(Z=Z.index(J.shift())),(yield Promise.all([Z[q](...J),V&&W.done]))[0]})};return cachedMethods.set($,G),G}replaceTraps(B=>Ne(Oe({},B),{get:($,q,U)=>getMethod($,q)||B.get($,q,U),has:($,q)=>!!getMethod($,q)||B.has($,q)}));const advanceMethodProps=["continue","continuePrimaryKey","advance"],methodMap={},advanceResults=new WeakMap,ittrProxiedCursorToOriginalProxy=new WeakMap,cursorIteratorTraps={get(B,$){if(!advanceMethodProps.includes($))return B[$];let q=methodMap[$];return q||(q=methodMap[$]=function(...U){advanceResults.set(this,ittrProxiedCursorToOriginalProxy.get(this)[$](...U))}),q}};function iterate(...B){return Qe(this,null,function*(){let $=this;if($ instanceof IDBCursor||($=yield new Be($.openCursor(...B))),!$)return;$=$;const q=new Proxy($,cursorIteratorTraps);for(ittrProxiedCursorToOriginalProxy.set(q,$),reverseTransformCache.set(q,unwrap($));$;)yield q,$=yield new Be(advanceResults.get(q)||$.continue()),advanceResults.delete(q)})}function isIteratorProp(B,$){return $===Symbol.asyncIterator&&instanceOfAny(B,[IDBIndex,IDBObjectStore,IDBCursor])||$==="iterate"&&instanceOfAny(B,[IDBIndex,IDBObjectStore])}replaceTraps(B=>Ne(Oe({},B),{get($,q,U){return isIteratorProp($,q)?iterate:B.get($,q,U)},has($,q){return isIteratorProp($,q)||B.has($,q)}}));const A$4="bytereplay-database",e$6="recordings";var h$c=Object.defineProperty,p$b=(B,$,q)=>$ in B?h$c(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,u$c=(B,$,q)=>p$b(B,typeof $!="symbol"?$+"":$,q),c$f=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let x$4=class extends t$8{constructor(){super(...arguments),u$c(this,"_db"),u$c(this,"_openLock")}getRecordings(){return c$f(this,null,function*(){return(yield this._getDatabase()).getAll(e$6)})}putRecordings($,q){return c$f(this,null,function*(){if($.length>0){const U=(yield this._getDatabase()).transaction(e$6,"readwrite");if(yield Promise.all($.map(V=>U.store.put(V))),q!=null){let V=(yield U.store.count())-q;if(V>0){let G=yield U.store.openCursor();for(;V>0&&G;)V--,yield G.delete(),G=yield G.continue()}}yield U.done}})}deleteRecordings(...$){return c$f(this,null,function*(){if($.length>0){const q=$.map(V=>V.id);let U=yield(yield this._getDatabase()).transaction(e$6,"readwrite").store.openCursor();for(;U;)q.some(V=>(U==null?void 0:U.value.id)===V)&&(yield U.delete(),U=yield U.continue())}})}_getDatabase(){return c$f(this,null,function*(){return this._db!=null?this._db:(this._openLock==null&&(this._openLock=openDB(A$4,1,{upgrade($){$.createObjectStore("recordings",{autoIncrement:!0})}}).then($=>(this._db=$,$))),this._openLock)})}};var g$a=Object.defineProperty,s$8=(B,$,q)=>$ in B?g$a(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,o$c=(B,$,q)=>s$8(B,$+"",q);let n$o=class{constructor(){o$c(this,"_storage")}getStorage(){return this._storage||(this._storage=new x$4),this._storage}};var i$a=Object.defineProperty,a$8=(B,$,q)=>$ in B?i$a(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,n$n=(B,$,q)=>a$8(B,$+"",q);let p$a=class{constructor(){n$n(this,"_textDecoder",new TextDecoder)}decode($){const q=this._textDecoder.decode($);return this.decodeString(q)}decodeString($){const q=$.split(`\n`),U=[];for(const V of q)if(V)try{const G=JSON.parse(V),K={time:G[0],trackType:G[1],event:{eventType:G[2],data:G[3]}};U.push(K)}catch(G){}return U}};var i$9=Object.defineProperty,h$b=(B,$,q)=>$ in B?i$9(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,r$f=(B,$,q)=>h$b(B,$+"",q);let n$m=class{constructor(){r$f(this,"_queue",[])}get length(){return this._queue.length}clear(){this._queue.length>0&&this._queue.splice(0,this._queue.length)}dequeue(){return this._queue.shift()}enqueue(...$){return this._queue.push(...$)}find($,q){return this._queue.find($,q)}findIndex($,q){return this._queue.findIndex($,q)}forEach($,q){this._queue.forEach($,q||this)}map($,q){return this._queue.map($,q||this)}peek(){return this._queue[0]}remove($){return this._queue.splice($,1)[0]}slice($,q){return this._queue.slice($,q)}toArray(){return[...this._queue]}};var z$2=Object.defineProperty,c$e=Object.getOwnPropertySymbols,w$5=Object.prototype.hasOwnProperty,x$3=Object.prototype.propertyIsEnumerable,d$7=Math.pow,h$a=(B,$,q)=>$ in B?z$2(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,_$4=(B,$)=>{for(var q in $||($={}))w$5.call($,q)&&h$a(B,q,$[q]);if(c$e)for(var q of c$e($))x$3.call($,q)&&h$a(B,q,$[q]);return B},f$9=(B,$,q)=>h$a(B,typeof $!="symbol"?$+"":$,q),T$2=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});const o$b=class tt{constructor($){f$9(this,"_options"),this._options=this._normalize($)}attempt($,q){return T$2(this,null,function*(){return typeof $!="function"?Promise.reject(new Error("executor is not function")):this._attempt($,this._normalize(q,this._options))})}_attempt($,q,U=1){return T$2(this,null,function*(){return $().catch(V=>{if(q.shouldRetry&&!q.shouldRetry(V))throw V;if(U<q.retries)return this._delay(this._randomTimeout(U,q)).then(()=>this._attempt($,q,U+1));throw V})})}_normalize($,q=tt.DEFAULT_OPTIONS){const U=_$4({},q);if($){const{retries:V,initialTimeout:G,maxTimeout:K,randomize:J}=$;V!=null&&V>=0&&(U.retries=V),G!=null&&G>=0&&(U.initialTimeout=G),K!=null&&K>=U.initialTimeout&&(U.maxTimeout=K),J!=null&&J>=1&&J<=2&&(J<1?U.randomize=1:J>2?U.randomize=2:U.randomize=J),$!=null&&$.shouldRetry&&(U.shouldRetry=$.shouldRetry)}return U}_delay($){return new Promise(q=>{setTimeout(()=>{q()},$)})}_randomTimeout($,q){const{randomize:U,initialTimeout:V,maxTimeout:G,factor:K}=q;return Math.min(U*V*d$7(K,$),G)}};f$9(o$b,"DEFAULT_OPTIONS",{retries:3,initialTimeout:1e3,maxTimeout:1/0,randomize:1.5,factor:1.5,shouldRetry:()=>!0});let y$4=o$b;var eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,function(B){var $=Object.prototype.hasOwnProperty,q="~";function U(){}Object.create&&(U.prototype=Object.create(null),new U().__proto__||(q=!1));function V(W,Z,Q){this.fn=W,this.context=Z,this.once=Q||!1}function G(W,Z,Q,ee,te){if(typeof Q!="function")throw new TypeError("The listener must be a function");var ne=new V(Q,ee||W,te),oe=q?q+Z:Z;return W._events[oe]?W._events[oe].fn?W._events[oe]=[W._events[oe],ne]:W._events[oe].push(ne):(W._events[oe]=ne,W._eventsCount++),W}function K(W,Z){--W._eventsCount===0?W._events=new U:delete W._events[Z]}function J(){this._events=new U,this._eventsCount=0}J.prototype.eventNames=function(){var Z=[],Q,ee;if(this._eventsCount===0)return Z;for(ee in Q=this._events)$.call(Q,ee)&&Z.push(q?ee.slice(1):ee);return Object.getOwnPropertySymbols?Z.concat(Object.getOwnPropertySymbols(Q)):Z},J.prototype.listeners=function(Z){var Q=q?q+Z:Z,ee=this._events[Q];if(!ee)return[];if(ee.fn)return[ee.fn];for(var te=0,ne=ee.length,oe=new Array(ne);te<ne;te++)oe[te]=ee[te].fn;return oe},J.prototype.listenerCount=function(Z){var Q=q?q+Z:Z,ee=this._events[Q];return ee?ee.fn?1:ee.length:0},J.prototype.emit=function(Z,Q,ee,te,ne,oe){var ce=q?q+Z:Z;if(!this._events[ce])return!1;var le=this._events[ce],pe=arguments.length,he,fe;if(le.fn){switch(le.once&&this.removeListener(Z,le.fn,void 0,!0),pe){case 1:return le.fn.call(le.context),!0;case 2:return le.fn.call(le.context,Q),!0;case 3:return le.fn.call(le.context,Q,ee),!0;case 4:return le.fn.call(le.context,Q,ee,te),!0;case 5:return le.fn.call(le.context,Q,ee,te,ne),!0;case 6:return le.fn.call(le.context,Q,ee,te,ne,oe),!0}for(fe=1,he=new Array(pe-1);fe<pe;fe++)he[fe-1]=arguments[fe];le.fn.apply(le.context,he)}else{var ye=le.length,ge;for(fe=0;fe<ye;fe++)switch(le[fe].once&&this.removeListener(Z,le[fe].fn,void 0,!0),pe){case 1:le[fe].fn.call(le[fe].context);break;case 2:le[fe].fn.call(le[fe].context,Q);break;case 3:le[fe].fn.call(le[fe].context,Q,ee);break;case 4:le[fe].fn.call(le[fe].context,Q,ee,te);break;default:if(!he)for(ge=1,he=new Array(pe-1);ge<pe;ge++)he[ge-1]=arguments[ge];le[fe].fn.apply(le[fe].context,he)}}return!0},J.prototype.on=function(Z,Q,ee){return G(this,Z,Q,ee,!1)},J.prototype.once=function(Z,Q,ee){return G(this,Z,Q,ee,!0)},J.prototype.removeListener=function(Z,Q,ee,te){var ne=q?q+Z:Z;if(!this._events[ne])return this;if(!Q)return K(this,ne),this;var oe=this._events[ne];if(oe.fn)oe.fn===Q&&(!te||oe.once)&&(!ee||oe.context===ee)&&K(this,ne);else{for(var ce=0,le=[],pe=oe.length;ce<pe;ce++)(oe[ce].fn!==Q||te&&!oe[ce].once||ee&&oe[ce].context!==ee)&&le.push(oe[ce]);le.length?this._events[ne]=le.length===1?le[0]:le:K(this,ne)}return this},J.prototype.removeAllListeners=function(Z){var Q;return Z?(Q=q?q+Z:Z,this._events[Q]&&K(this,Q)):(this._events=new U,this._eventsCount=0),this},J.prototype.off=J.prototype.removeListener,J.prototype.addListener=J.prototype.on,J.prefixed=q,J.EventEmitter=J,B.exports=J}(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3(),EventEmitter=getDefaultExportFromCjs(eventemitter3Exports),l$i=Object.defineProperty,m$h=(B,$,q)=>$ in B?l$i(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,u$b=(B,$,q)=>m$h(B,typeof $!="symbol"?$+"":$,q);let g$9=class extends n$m{constructor($){super(),u$b(this,"_size"),u$b(this,"_emitter"),this._size=Math.max($,1),this._emitter=new EventEmitter}get isFull(){return this._size===this.length}enqueue(...$){let q=0,U=!1;const V=$.length,G=this.length+V-this._size;G>0&&(U=!0,this._queue.splice(0,G));const K=V-this._size;return K>0?(U=!0,q=super.enqueue(...$.slice(K))):q=super.enqueue(...$),U&&this._emitter.emit("rotated"),q}on($,q){return this._emitter.on($,q),this}off($,q){return this._emitter.off($,q),this}};function l$h(B,$){return B==null?!1:B.indexOf($)!==-1}var n$l=(B=>(B[B.ElementNode=1]="ElementNode",B[B.TextNode=3]="TextNode",B[B.CommentNode=8]="CommentNode",B[B.DocumentNode=9]="DocumentNode",B[B.HTMLNode=10]="HTMLNode",B[B.DocumentFragmentNode=11]="DocumentFragmentNode",B[B.AndroidNode=12]="AndroidNode",B))(n$l||{});function M$1(B){return(B==null?void 0:B.tagName)==="STYLE"}function P$1(B){return(B==null?void 0:B.nodeType)===Node.ELEMENT_NODE}function D$3(B){return"children"in B}function n$k(B){return B.type===n$l.ElementNode}function k$5(B){return n$k(B)&&B.tag==="A"}function j$1(B){return n$k(B)&&B.tag==="IMG"}function p$9(B){return n$k(B)&&B.tag==="AUDIO"}function X(B){return n$k(B)&&B.tag==="VIDEO"}function Y(B){return n$k(B)&&B.tag==="SOURCE"}function v$2(B){return B.type===n$l.TextNode}var i$8=Object.defineProperty,n$j=(B,$,q)=>$ in B?i$8(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,r$e=(B,$,q)=>n$j(B,typeof $!="symbol"?$+"":$,q);let h$9=class{constructor($,q="*"){r$e(this,"_searchCondition"),r$e(this,"_maskingCharacter"),this._searchCondition=$,this._maskingCharacter=q}mask($){return $.replace(this._searchCondition,q=>this.maskSubstring(q,this._maskingCharacter))}},n$i="data-bytereplay-mask";function M(){return n$i}const r$d=["","true"],a$7={ignore:"ignore",name:"name",strict:"strict",balance:"balance"};function A$3(B){return l$h(r$d,B)}function D$2(B){return B===a$7.name}function k$4(B){return B===a$7.balance}function l$g(B){return B===a$7.strict}const SKIPED_TAG_LIST={STYLE:!0,SCRIPT:!0,svg:!0},MASKED_ATTRIBUTE_LIST={alt:!0,"aria-label":!0,"aria-valuetext":!0,placeholder:!0,title:!0,value:!0};function shouldMask(B){return B.type===n$l.CommentNode?!1:B.type===n$l.ElementNode?!SKIPED_TAG_LIST[B.tag]:!0}function shouldMaskAttribute(B){var $;return($=MASKED_ATTRIBUTE_LIST[B])!=null?$:!1}function deserializeDataMasks(dataMasks){return dataMasks==null?dataMasks:dataMasks.map(dataMask=>{if(dataMask instanceof h$9)return dataMask;if(u$f(dataMask)){let mask;return dataMask.startsWith("function")||dataMask.startsWith("(")?mask={mask:eval(`(${dataMask})`)}:mask={mask:eval(`(function ${dataMask})`)},mask}return dataMask})}const P=["BOE","DEV","PROD-INTERNAL","PROD-PUBLIC","PROD-SG","PROD-PUBLIC-SG","PROD-PUBLIC-SG-TT","PROD-VA","PROD-PUBLIC-VA","PROD-PUBLIC-VA-TT","PROD-US-TTP","PROD-PUBLIC-US-TTP"],m$g="PROD-INTERNAL";let n$h=m$g;function w$4(){return n$h}let s$7=class extends z$3{constructor($,q){super($,q),this.name="bytereplay.core.UnsupportedError"}},c$d=class extends z$3{constructor($,q){super($,q),this.name="bytereplay.core.IOError"}};function a$6(B){return new ReadableStream({start($){return $.enqueue(B),$.close(),Promise.resolve()}})}function f$8(B,$){const q=B.reduce((G,K)=>G+K.length,0),U=new Uint8Array(q);let V=0;for(const G of B)U.set(G,V),V+=G.length;return U}var l$f=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});function f$7(B){return l$f(this,null,function*(){const $=B.getReader();return m$f($)})}function m$f(B){return l$f(this,null,function*(){let $;const q=[];for(;!($=yield B.read()).done;)q.push($.value);return f$8(q)})}var r$c=(B=>(B.Ping="ping",B.Pong="pong",B))(r$c||{});function g$8(B){return B==="pong"||B==="ping"}var u$a=Object.defineProperty,h$8=Object.getOwnPropertySymbols,c$c=Object.prototype.hasOwnProperty,T$1=Object.prototype.propertyIsEnumerable,n$g=(B,$,q)=>$ in B?u$a(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,m$e=(B,$)=>{for(var q in $||($={}))c$c.call($,q)&&n$g(B,q,$[q]);if(h$8)for(var q of h$8($))T$1.call($,q)&&n$g(B,q,$[q]);return B},s$6=(B,$,q)=>n$g(B,typeof $!="symbol"?$+"":$,q);const o$a=class rt extends EventEmitter{constructor($,q){super(),s$6(this,"_options"),s$6(this,"_timer"),s$6(this,"_handleMessage",U=>{U!=null&&(U===r$c.Ping&&this._pong(),this._resetTimeout())}),s$6(this,"_handleTimeout",()=>{this.stop(),this.emit("timeout")}),this.connection=$,this._options=m$e(m$e({},rt.DEFAULT_OPTIONS),q)}start(){this.connection.on("message",this._handleMessage),this._startTimeout()}stop(){this._clearTimeout(),this.connection.off("message",this._handleMessage)}_pong(){this.connection.send(r$c.Pong,!1)}_startTimeout(){this._resetTimeout()}_resetTimeout(){this._clearTimeout(),this._timer=setTimeout(this._handleTimeout,this._options.timeout)}_clearTimeout(){clearTimeout(this._timer),this._timer=void 0}};s$6(o$a,"DEFAULT_OPTIONS",{timeout:12e3});let _$3=o$a;var c$b=Object.defineProperty,f$6=(B,$,q)=>$ in B?c$b(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,n$f=(B,$,q)=>f$6(B,typeof $!="symbol"?$+"":$,q),m$d=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let A$2=class extends EventEmitter{constructor($,q){var U;super(),n$f(this,"_client"),n$f(this,"_isOpen",!1),n$f(this,"_retry"),n$f(this,"_mailbox"),n$f(this,"_isSending",!1),n$f(this,"_handleRotated",()=>{this._requestCompensation()}),this._client=$,this._retry=new y$4(q==null?void 0:q.retry),this._mailbox=new g$9((U=q==null?void 0:q.bufferSize)!=null?U:20),this._mailbox.on("rotated",this._handleRotated)}open(){this._isOpen||(this._isOpen=!0,this._sendNext())}send($){this._isOpen&&(this._mailbox.enqueue($),this._sendNext())}close(){this._close(!0)}_close($){this._isOpen&&(this._isOpen=!1,this.removeAllListeners(),$&&this._flush(),this._mailbox.clear())}_sendNext(){return m$d(this,null,function*(){var $;if(!this._isSending){this._isSending=!0;const q=this._mailbox.dequeue();if(q==null)this._isSending=!1;else try{const{path:U,data:V,headers:G}=q;yield this._retry.attempt(()=>this._client.post(U,V,G)),this._isSending=!1,this._sendNext()}catch(U){this._isSending=!1,v$3(U)&&($=U.code)!=null&&$.startsWith("BR_AUTH_TOKEN_")?(this.emit("error",U),this._close(!1)):this._requestCompensation()}}})}_flush(){return m$d(this,null,function*(){const $=this._mailbox.toArray();try{for(const q of $)yield this._retry.attempt(()=>this._client.post(q.path,q.data,q.headers))}catch(q){}})}_requestCompensation(){this._mailbox.clear(),this.emit("compensate")}},c$a=class extends z$3{constructor($,q){super($,q),this.name="bytereplay.core.NetworkError"}};var n$e=(B=>(B[B.ACK=0]="ACK",B[B.Chunk=1]="Chunk",B[B.Command=10]="Command",B))(n$e||{}),r$b=(B=>(B.ClosedByClient="ClosedByClient",B.ClosedByServer="ClosedByServer",B.HeartbeatTimeout="HeartbeatTimeout",B))(r$b||{});function t$7(B){if(B.code===1e3)return"ClosedByClient";if(B.code===3001)return"HeartbeatTimeout";if(B.code>=3e3)return"ClosedByServer"}var b$4=Object.defineProperty,u$9=(B,$,q)=>$ in B?b$4(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,i$7=(B,$,q)=>u$9(B,typeof $!="symbol"?$+"":$,q),m$c=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let F$1=class{constructor($,q){i$7(this,"_url"),i$7(this,"_emitter"),i$7(this,"_heartbeat"),i$7(this,"_retry"),i$7(this,"_ws"),i$7(this,"_opening"),i$7(this,"_closing"),i$7(this,"_closeReason"),i$7(this,"_handleClose",U=>{this._unsubscribe(U.target),this._closeReason==null&&(this._closeReason=t$7(U)),this._heartbeat.stop(),this._reopen()}),i$7(this,"_handleMessage",U=>{const{data:V}=U;if(u$f(V)&&!g$8(V))try{this._emitter.emit("message",JSON.parse(V))}catch(G){}else this._emitter.emit("message",V)}),i$7(this,"_handleHeartbeatTimeout",()=>{this._closeReason==null&&(this._close(r$b.HeartbeatTimeout),this._reopen())}),this._url=$,this._emitter=new EventEmitter,this._heartbeat=new _$3(this,q==null?void 0:q.heartbeat),this._heartbeat.on("timeout",this._handleHeartbeatTimeout),this._retry=new y$4(q==null?void 0:q.retry)}get isReady(){var $;return(($=this._ws)==null?void 0:$.readyState)===WebSocket.OPEN}on($,q,U){return this._emitter.on($,q,U),this}off($,q,U){return this._emitter.off($,q,U),this}open(){return m$c(this,null,function*(){return this._opening||(this._opening=new Promise(($,q)=>{this._unsubscribe(this._ws),this._ws=new WebSocket(this._url);const U=G=>{const K=G.target;K.removeEventListener("open",U),K.removeEventListener("close",V),this._subscribe(K),this._emitter.emit("open"),this._heartbeat.start(),this._opening=void 0,$()},V=G=>{const K=G.target;K.removeEventListener("open",U),K.removeEventListener("close",V),this._opening=void 0,q(new c$a(`Failed to create websocket connection to "${this._url}"`))};this._ws.addEventListener("open",U),this._ws.addEventListener("close",V)})),this._closeReason=void 0,this._opening})}send($,q=!0){g$8($)?this._send($):$.type===n$e.Command?this._send(JSON.stringify($)):this._send($.data),q&&this._emitter.emit("send",$)}close(){return this._close(r$b.ClosedByClient)}_send($){var q;this.isReady&&((q=this._ws)==null||q.send($))}_subscribe($){$==null||$.addEventListener("close",this._handleClose),$==null||$.addEventListener("message",this._handleMessage)}_unsubscribe($){$==null||$.removeEventListener("close",this._handleClose),$==null||$.removeEventListener("message",this._handleMessage)}_close($){return m$c(this,null,function*(){if(this._closeReason=$,this._ws)return this._ws.readyState===WebSocket.CLOSED||this._ws.readyState===WebSocket.CLOSING?void 0:(this._closing||(this._closing=new Promise(q=>{var U,V;const G=K=>{const J=K.target;J.removeEventListener("close",G),this._unsubscribe(J),this._closing=void 0,q()};(U=this._ws)==null||U.addEventListener("close",G),(V=this._ws)==null||V.close(1e3)})),this._closing)})}_reopen(){this._closeReason===r$b.ClosedByClient||this._closeReason===r$b.ClosedByServer?this._emitter.emit("closed"):this._retry.attempt(()=>this.open()).catch($=>{this._emitter.emit("closed",$)})}};var a$5=(B=>(B.Blackbox="blackbox",B.Blocking="blocking",B.InMemory="in-memory",B.LiveStreaming="live-streaming",B.Streaming="streaming",B.StreamingHttp="streaming-http",B))(a$5||{});function o$9(B,$){for(let q=B.length-1;q>=0;q--){const U=B[q];if($(U,q,B))return U}}var f$5=Object.defineProperty,c$9=(B,$,q)=>$ in B?f$5(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,o$8=(B,$,q)=>c$9(B,typeof $!="symbol"?$+"":$,q),h$7=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let I$2=class{constructor($,q=[]){o$8(this,"_lastReadTime",0),o$8(this,"_frames"),o$8(this,"_snapshotIndexes"),o$8(this,"_currentPosition",0),this._frames=$,this._snapshotIndexes=q}get size(){return this._frames.length}get frames(){return this._frames}getFirstFrameTime(){var $,q;return(q=($=this._frames[0])==null?void 0:$.time)!=null?q:0}getLastFrameTime(){var $,q;return(q=($=this._frames[this._frames.length-1])==null?void 0:$.time)!=null?q:1/0}getNextFrameTime(){var $,q;return(q=($=this._frames[this._currentPosition+1])==null?void 0:$.time)!=null?q:null}get currentPosition(){return this._currentPosition}peek(){return this._frames[this._currentPosition]}get($){return this._frames[$]}read(){return h$7(this,null,function*(){const $=this.peek();return this.moveNext(),$})}readToTime($){return h$7(this,null,function*(){const q=[];let U;for(;(U=yield this.peek())!=null&&U.time<=$;)q.push(U),this._lastReadTime=U.time,this.moveNext();return q})}seek($){return h$7(this,null,function*(){if($>this._lastReadTime){if(this._snapshotIndexes.length===0)return;const q=this._snapshotIndexes.find(U=>U>this._currentPosition&&this._frames[U].time<=$)||0;q>0&&this.setCurrentPosition(q)}else{const q=o$9(this._snapshotIndexes,U=>U<this._currentPosition)||0;q>0?this.setCurrentPosition(q):this.setCurrentPosition(0)}})}setCurrentPosition($){var q;let U=$;U<0&&(U=0),U>this._frames.length-1&&(U=this._frames.length),this._currentPosition=U,this._lastReadTime=(q=this._frames[U])==null?void 0:q.time}moveNext(){this.setCurrentPosition(this._currentPosition+1)}hasNext(){return this._currentPosition<=this._frames.length-1}reset(){this._currentPosition=0,this._lastReadTime=0}close(){this.reset(),this._frames=[],this._snapshotIndexes=[]}};var k$3=Object.defineProperty,v$1=(B,$,q)=>$ in B?k$3(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,r$a=(B,$,q)=>v$1(B,typeof $!="symbol"?$+"":$,q),f$4=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let s$5=class Ue{constructor($,q,U){r$a(this,"_id"),r$a(this,"_frames"),r$a(this,"_createTime"),r$a(this,"_duration"),r$a(this,"_environment"),r$a(this,"_meta"),r$a(this,"_trackers",[]),r$a(this,"_reader");var V,G,K,J;this._id=$,this._duration=(G=(V=q[q.length-1])==null?void 0:V.time)!=null?G:0,this._frames=q,this._reader=new I$2(q),this._createTime=(K=U==null?void 0:U.createTime)!=null?K:Date.now(),this._environment=U==null?void 0:U.environment,this._meta=U==null?void 0:U.meta,this._trackers=(J=U==null?void 0:U.trackers)!=null?J:[]}static from($,q,U){return q instanceof Uint8Array?new Ue($,new p$a().decode(q),U):new Ue($,q,U)}static clone($){return new Ue($.id,$.frames,{createTime:$.createTime,environment:$.environment,meta:$.meta,trackers:$.trackers})}get id(){return this._id}get frames(){return this._frames}get createTime(){return this._createTime}get duration(){return this._duration}get mode(){return a$5.InMemory}get environment(){return this._environment}get meta(){return this._meta}get trackers(){return this._trackers}getReader(){return f$4(this,null,function*(){return this._reader})}};var n$d=Object.defineProperty,i$6=(B,$,q)=>$ in B?n$d(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,r$9=(B,$,q)=>i$6(B,typeof $!="symbol"?$+"":$,q);let d$6=class{constructor(){r$9(this,"_downstream",new Subject),r$9(this,"pipe",this._downstream.pipe.bind(this._downstream))}output($){this._downstream.next($)}asPipeable(){return $=>($.subscribe(q=>{this.handleInput(q)}),this._downstream)}};var R$4=(B=>(B[B.EOF=0]="EOF",B[B.HTMLSnapshot=101]="HTMLSnapshot",B[B.HTMLMutations=102]="HTMLMutations",B[B.HTMLScroll=103]="HTMLScroll",B[B.HTMLFocus=104]="HTMLFocus",B[B.HTMLBlur=105]="HTMLBlur",B[B.HTMLValueChange=106]="HTMLValueChange",B[B.HTMLSelectionChange=107]="HTMLSelectionChange",B[B.HTMLResize=110]="HTMLResize",B[B.HTMLIncrementalSnapshot=111]="HTMLIncrementalSnapshot",B[B.HTMLNavigation=115]="HTMLNavigation",B[B.HTMLCanvas=120]="HTMLCanvas",B[B.HTMLImage=122]="HTMLImage",B[B.HTMLVideo=123]="HTMLVideo",B[B.HTMLIFrame=130]="HTMLIFrame",B[B.MouseMove=201]="MouseMove",B[B.MouseDown=202]="MouseDown",B[B.MouseUp=203]="MouseUp",B[B.MouseClick=204]="MouseClick",B[B.MouseEnter=290]="MouseEnter",B[B.MouseLeave=291]="MouseLeave",B[B.TouchStart=205]="TouchStart",B[B.TouchMove=206]="TouchMove",B[B.TouchEnd=207]="TouchEnd",B[B.TouchCancel=208]="TouchCancel",B[B.KeyDown=301]="KeyDown",B[B.ConsoleAssert=401]="ConsoleAssert",B[B.ConsoleDebug=402]="ConsoleDebug",B[B.ConsoleDir=403]="ConsoleDir",B[B.ConsoleDirxml=404]="ConsoleDirxml",B[B.ConsoleError=405]="ConsoleError",B[B.ConsoleInfo=406]="ConsoleInfo",B[B.ConsoleLog=407]="ConsoleLog",B[B.ConsoleTable=408]="ConsoleTable",B[B.ConsoleTrace=409]="ConsoleTrace",B[B.ConsoleWarn=410]="ConsoleWarn",B[B.ERROR_SCRIPT=501]="ERROR_SCRIPT",B[B.ERROR_RUNTIME=502]="ERROR_RUNTIME",B[B.ERROR_NOTFOUND=503]="ERROR_NOTFOUND",B[B.ERROR_PROMISEREJECTION=504]="ERROR_PROMISEREJECTION",B[B.NETWORK_SEND=601]="NETWORK_SEND",B[B.NETWORK_DONE=602]="NETWORK_DONE",B[B.NETWORK_ABORT=603]="NETWORK_ABORT",B[B.NETWORK_ERROR=604]="NETWORK_ERROR",B[B.NETWORK_TIMEOUT=605]="NETWORK_TIMEOUT",B[B.INSIGHT_RAGE_CLICK=701]="INSIGHT_RAGE_CLICK",B[B.INSIGHT_DEAD_CLICK=702]="INSIGHT_DEAD_CLICK",B[B.INSIGHT_LONG_HOVER=703]="INSIGHT_LONG_HOVER",B[B.INSIGHT_EXCESSIVE_SCROLLING=704]="INSIGHT_EXCESSIVE_SCROLLING",B[B.PERFORMANCE_LONG_TASK=801]="PERFORMANCE_LONG_TASK",B[B.PERFORMANCE_RESOURCE=802]="PERFORMANCE_RESOURCE",B[B.PERFORMANCE_NAVIGATION=803]="PERFORMANCE_NAVIGATION",B))(R$4||{}),n$c=(B=>(B[B.EOF=0]="EOF",B[B.HTML=100]="HTML",B[B.Mouse=200]="Mouse",B[B.Keyboard=300]="Keyboard",B[B.Console=400]="Console",B[B.Error=500]="Error",B[B.Network=600]="Network",B[B.Insight=700]="Insight",B[B.Performance=800]="Performance",B))(n$c||{});function s$4(B){return B>=1001&&B<=1999}function a$4(B,$,q){return{time:q,trackType:B,event:$}}function c$8(B){return a$4(n$c.EOF,{eventType:R$4.EOF,data:0},B)}var o$7=(B=>(B.StartRecording="startRecording",B.StopRecording="stopRecording",B.Unload="unload",B.Load="load",B))(o$7||{});const t$6="ReplayIFrameEvent";function n$b(B){return new CustomEvent(t$6,{detail:B})}var o$6=(B=>(B.Loading="loading",B.Loaded="loaded",B.Recording="recording",B))(o$6||{}),e$5=(B=>(B.RecorderStopped="RecorderStopped",B.ReceiverStopped="ReceiverStopped",B.RecorderDisconnected="RecorderDisconnected",B.SyncBlock="SyncBlock",B.SyncPacket="SyncPacket",B))(e$5||{}),d$5=(B=>(B[B.AddNode=1]="AddNode",B[B.RemoveNode=2]="RemoveNode",B[B.ChangeAttributes=3]="ChangeAttributes",B[B.CharacterData=4]="CharacterData",B[B.Document=10]="Document",B[B.StyleSheetRule=20]="StyleSheetRule",B[B.StyleSheetAdopted=21]="StyleSheetAdopted",B[B.AndroidUpdateNode=22]="AndroidUpdateNode",B))(d$5||{}),r$8=Object.defineProperty,e$4=(B,$,q)=>$ in B?r$8(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,k$2=(B,$,q)=>e$4(B,$+"",q);let o$5=class{constructor(...$){k$2(this,"_masks"),this._masks=$}mask($){return this._masks.reduce((q,U)=>U.mask(q),$)}};var A$1=(B=>(B.BALANCE="BALANCE",B.STRICT="STRICT",B))(A$1||{});let e$3=class extends h$9{constructor(){super(/\\b[1-9](?:\\d{18}|\\d{17}|\\d{16}|\\d{15}|\\d{11})\\b/gm)}maskSubstring($,q){return`${$.slice(0,-4).replace(/\\S/g,q)}${$.slice(-4)}`}},n$a=class extends h$9{constructor(){super(/[\\u4e00-\\u9fa5]+(\xB7[\\u4e00-\\u9fa5]+)*/gm)}maskSubstring($,q){const U=$.length<=3?1:2;return`${$.slice(0,U).replace(/\\S/g,q)}${$.slice(U)}`}},n$9=class extends h$9{constructor(){super(/[A-Za-z0-9.\\u4e00-\\u9fa5]+@[a-zA-Z0-9_-]+(?:\\.[a-zA-Z0-9_-]+)+/gim)}maskSubstring($,q){const U=$.indexOf("@");return`${$.slice(0,U).slice(0,3)}${q.repeat(3)}${$.slice(U)}`}},l$e=class extends h$9{constructor(){super(/(?:[a-zA-Z\']{2,} ?)+/gm)}maskSubstring($,q){const U=$.indexOf(" ");return U===-1?`${$.slice(0,1)}${$.slice(1).replace(/\\S/g,q)}`:`${$.slice(0,U).replace(/\\S/g,q)}${$.slice(U)}`}},e$2=class extends h$9{constructor(){super(/([1-9]\\d{5}(18|19|([23]\\d))\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx])|([1-9]\\d{5}\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{2}[0-9Xx])/gm)}maskSubstring($,q){return`${$.slice(0,1)}${$.slice(1,-1).replace(/\\S/g,q)}${$.slice(-1)}`}},n$8=class extends h$9{constructor(){super(/((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/gm)}maskSubstring($,q){const U=$.indexOf(".")+1;return`${$.slice(0,U)}${$.slice(U).replace(/[^.]/g,q)}`}},t$5=class extends h$9{constructor(){super(/([\u4EAC\u6D25\u6CAA\u6E1D\u5180\u8C6B\u4E91\u8FBD\u9ED1\u6E58\u7696\u9C81\u65B0\u82CF\u6D59\u8D63\u9102\u6842\u7518\u664B\u8499\u9655\u5409\u95FD\u8D35\u7CA4\u9752\u85CF\u5DDD\u5B81\u743C\u4F7F\u9886][A-Z](([0-9]{5}[DF])|([DF]([A-HJ-NP-Z0-9])[0-9]{4})))|([\u4EAC\u6D25\u6CAA\u6E1D\u5180\u8C6B\u4E91\u8FBD\u9ED1\u6E58\u7696\u9C81\u65B0\u82CF\u6D59\u8D63\u9102\u6842\u7518\u664B\u8499\u9655\u5409\u95FD\u8D35\u7CA4\u9752\u85CF\u5DDD\u5B81\u743C\u4F7F\u9886][A-Z][A-HJ-NP-Z0-9]{4}[A-HJ-NP-Z0-9\u6302\u5B66\u8B66\u6E2F\u6FB3\u4F7F\u9886])/gm)}maskSubstring($,q){return`${$.slice(0,2)}${$.slice(2,-3).replace(/\\S/g,q)}${$.slice(-3)}`}},d$4=class extends h$9{constructor(){super(/(([0-9A-Fa-f]{2}:){5}([0-9A-Fa-f]{2}))|(([0-9A-Fa-f]{2}-){5}([0-9A-Fa-f]{2}))/gm)}maskSubstring($,q){const U=$.indexOf(":")+1,V=$.indexOf("-")+1,G=U===0?V:U;return`${$.slice(0,G)}${$.slice(G).replace(/[^:]/g,q)}`}};var l$d=Object.defineProperty,n$7=(B,$,q)=>$ in B?l$d(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,c$7=(B,$,q)=>n$7(B,$+"",q);let b$3=class extends h$9{constructor(){super(/\\b(?:(?:\\+?86)?1(?:3\\d{3}|5[^4\\D]\\d{2}|8\\d{3}|7(?:[0-35-9]\\d{2}|4(?:0\\d|1[0-2]|9\\d))|9[0-35-9]\\d{2}|6[2567]\\d{2}|4(?:(?:10|4[01])\\d{3}|[68]\\d{4}|[579]\\d{2}))\\d{6})|(0?(?:10|(?:2|3[1,5,7]|4[1,5,7]|5[1,3,5,7]|7[1,3,5,7,9]|8[1,3,7,9])[0-9]|91[0-7,9]|(?:43|59|85)[1-9]|39[1-8]|54[3,6]|(?:701|580|349|335)|54[3,6]|69[1-2]|44[0,8]|48[2,3]|46[4,7,8,9]|52[0,3,7]|42[1,7,9]|56[1-6]|63[1-5]|66[0-3,8]|72[2,4,8]|74[3-6]|76[0,2,3,5,6,8,9]|82[5-7]|88[1,3,6-8]|90[1-3,6,8,9])\\-?\\d{7,8})\\b/gm),c$7(this,"_regexCountryCode",/^\\+?86/)}maskSubstring($,q){let U="",V=$;const G=this._regexCountryCode.exec($);return G&&(U=G[0],V=$.slice(U.length)),`${U}${V.slice(0,3)}${V.slice(3,-2).replace(/\\S/g,q)}${V.slice(-2)}`}},n$6=class extends h$9{constructor(){super(/\\S+/gm)}maskSubstring($,q){return q.repeat($.length)}},t$4=class extends h$9{constructor(){super(/\\b[A-HJ-NPR-Z\\d]{17}\\b/gm)}maskSubstring($,q){return`${$.slice(0,3)}${$.slice(3,-3).replace(/\\S/g,q)}${$.slice(-3)}`}};var o$4=Object.defineProperty,p$8=(B,$,q)=>$ in B?o$4(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,i$5=(B,$,q)=>p$8(B,typeof $!="symbol"?$+"":$,q);let E$2=class{constructor($){i$5(this,"_domains",["bytedance","zijieapi","tiktok-row","byteintl","tiktok-usts","tiktokw","tiktok"]),i$5(this,"DEFAULT_ENV_TYPE","PROD-INTERNAL"),i$5(this,"_type",this.DEFAULT_ENV_TYPE),i$5(this,"_baseURL"),i$5(this,"_apiPrefix"),i$5(this,"_headers");var q;this.baseURL=$==null?void 0:$.baseURL,this.type=(q=$==null?void 0:$.type)!=null?q:w$4(),this.apiPrefix=$==null?void 0:$.apiPrefix,this.headers=$==null?void 0:$.headers}set type($){if($!=null){const q=this.parse($);if(q){this._type=q;return}throw new Error(`Invalid environment type, it must be one of the following: ${P.join(", ")}.`)}}get type(){return this._type}set baseURL($){if($==null||l$l($))this._baseURL=void 0;else try{this._baseURL=new URL($).href}catch(q){throw new z$3("Invalid base URL: "+$)}}set apiPrefix($){$&&($.startsWith("/")&&($=$.slice(1)),$.endsWith("/")||($+="/")),this._apiPrefix=$!=null?$:"api/"}get apiPrefix(){return this._apiPrefix}set headers($){this._headers=$}get headers(){return this._headers}get baseURL(){return this._baseURL!=null?this._baseURL.startsWith("//")?location.protocol+":"+this._baseURL:this._baseURL:this.isBOE()?`https://bytereplay-boe.${this._domains[0]}.net/`:this.isDev()?"http://localhost:6789/":this.isProdPublic()?"https://bytereplay."+this._domains[1]+".com/":this.isProdSG()?"https://bytereplay-sg."+this._domains[2]+".net/":this.isProdPublicSG()?"https://bytereplay-sg."+this._domains[3]+"api.com/":this.isProdVA()?"https://bytereplay-va."+this._domains[2]+".net/":this.isProdPublicVA()?"https://bytereplay-va."+this._domains[3]+"api.com/":this.isProdUS_TTP()?"https://bytereplay."+this._domains[4]+".net/":this.isProdPublicUS_TTP()?"https://bytereplay."+this._domains[5]+".us/":this.isProdPublicSGForTT()?"https://tsr16-normal-alisg."+this._domains[6]+".com/":this.isProdPublicVATForTT()?"https://tsr16-normal-useast1a."+this._domains[6]+".com/":`https://bytereplay.${this._domains[0]}.net/`}getFullUrl($,q=!1){if(/^(wss?:\\/\\/|https?:\\/\\/|\\/\\/)/.test($))return $;const U=this.baseURL.replace(/^https?:\\/\\/|\\/+$/g,""),V=$.replace(/^\\/+/,"");return`${this._getProtocol(q)}://${U}/${this.apiPrefix}${V}`}parse($){if(u$f($)){const q=$.trim().toUpperCase();if(l$h(P,q))return q}}isBOE(){return this._type==="BOE"}isDev(){return this._type==="DEV"}isProdInternal(){return this._type==="PROD-INTERNAL"}isProdPublic(){return this._type==="PROD-PUBLIC"}isProdSG(){return this._type==="PROD-SG"}isProdPublicSG(){return this._type==="PROD-PUBLIC-SG"}isProdPublicSGForTT(){return this._type==="PROD-PUBLIC-SG-TT"}isProdVA(){return this._type==="PROD-VA"}isProdPublicVA(){return this._type==="PROD-PUBLIC-VA"}isProdPublicVATForTT(){return this._type==="PROD-PUBLIC-VA-TT"}isProdUS_TTP(){return this._type==="PROD-US-TTP"}isProdPublicUS_TTP(){return this.type==="PROD-PUBLIC-US-TTP"}toOptions(){return{type:this.type,baseURL:this.baseURL,apiPrefix:this.apiPrefix,headers:this.headers}}_getProtocol($=!1){return this.baseURL.startsWith("http:")?$?"ws":"http":$?"wss":"https"}};const t$3=c$g()?globalThis.structuredClone:r$g;function l$c(B){return t$3(B)}function r$7(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,B=>(B^crypto.getRandomValues(new Uint8Array(1))[0]&15>>B/4).toString(16))}function createRecording(B,$){const{id:q,token:U,mode:V,clientTime:G,meta:K,environment:J,parent:W,refType:Z,trackers:Q}=$;return B.post(`recording/${q!=null?q:r$7()}/create`,{mode:V,clientTime:G,meta:K,environment:J,parent:W,refType:Z,trackers:Q},U?{Authorization:U}:void 0)}function createBlock(B,$){return me(this,null,function*(){const{path:q,data:U,headers:V}=createBlockRequestMessage($);return B.post(q,U,V)})}function createBlockRequestMessage(B,$=!1){const{token:q,recordingId:U,blob:V,offset:G,count:K,firstFrameTime:J,lastFrameTime:W,isEOF:Z,hasSnapshot:Q}=B,ee=a$c();ee.append("offset",`${G}`),ee.append("count",`${K}`),ee.append("firstFrameTime",`${J}`),ee.append("lastFrameTime",`${W}`),ee.append("isEOF",`${Z}`),Q!=null&&ee.append("hasSnapshot",`${Q}`),ee.append("block",V);const te={};return q&&(te.Authorization=q),{path:$?`storage/${U}/block/append`:`storage/${U}/block`,data:ee,headers:te}}function encode(B,$){const q=B.map(G=>JSON.stringify([G.time-$,G.trackType,G.event.eventType,G.event.data]));q.push("");const U=q.join(`\n`);return new TextEncoder().encode(U)}class DefaultEncoder{constructor($){this.context=$}encode($){return encode($,this.context.startTime)}}var SignalType=(B=>(B.CompensateSnapshot="CompensateSnapshot",B.BlockCreated="BlockCreated",B.FrameIndex="FrameIndex",B))(SignalType||{}),u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(B,$){for(var q=new u16(31),U=0;U<31;++U)q[U]=$+=1<<B[U-1];for(var V=new i32(q[30]),U=1;U<30;++U)for(var G=q[U];G<q[U+1];++G)V[G]=G-q[U]<<5|U;return{b:q,r:V}},_a=freb(fleb,2),fl=_a.b,revfl=_a.r;fl[28]=258,revfl[258]=28;for(var _b=freb(fdeb,0),revfd=_b.r,rev=new u16(32768),i$4=0;i$4<32768;++i$4){var x$2=(i$4&43690)>>1|(i$4&21845)<<1;x$2=(x$2&52428)>>2|(x$2&13107)<<2,x$2=(x$2&61680)>>4|(x$2&3855)<<4,rev[i$4]=((x$2&65280)>>8|(x$2&255)<<8)>>1}for(var hMap=function(B,$,q){for(var U=B.length,V=0,G=new u16($);V<U;++V)B[V]&&++G[B[V]-1];var K=new u16($);for(V=1;V<$;++V)K[V]=K[V-1]+G[V-1]<<1;var J;if(q){J=new u16(1<<$);var W=15-$;for(V=0;V<U;++V)if(B[V])for(var Z=V<<4|B[V],Q=$-B[V],ee=K[B[V]-1]++<<Q,te=ee|(1<<Q)-1;ee<=te;++ee)J[rev[ee]>>W]=Z}else for(J=new u16(U),V=0;V<U;++V)B[V]&&(J[V]=rev[K[B[V]-1]++]>>15-B[V]);return J},flt=new u8(288),i$4=0;i$4<144;++i$4)flt[i$4]=8;for(var i$4=144;i$4<256;++i$4)flt[i$4]=9;for(var i$4=256;i$4<280;++i$4)flt[i$4]=7;for(var i$4=280;i$4<288;++i$4)flt[i$4]=8;for(var fdt=new u8(32),i$4=0;i$4<32;++i$4)fdt[i$4]=5;var flm=hMap(flt,9,0),fdm=hMap(fdt,5,0),shft=function(B){return(B+7)/8|0},slc=function(B,$,q){return(q==null||q>B.length)&&(q=B.length),new u8(B.subarray($,q))},wbits=function(B,$,q){q<<=$&7;var U=$/8|0;B[U]|=q,B[U+1]|=q>>8},wbits16=function(B,$,q){q<<=$&7;var U=$/8|0;B[U]|=q,B[U+1]|=q>>8,B[U+2]|=q>>16},hTree=function(B,$){for(var q=[],U=0;U<B.length;++U)B[U]&&q.push({s:U,f:B[U]});var V=q.length,G=q.slice();if(!V)return{t:et,l:0};if(V==1){var K=new u8(q[0].s+1);return K[q[0].s]=1,{t:K,l:1}}q.sort(function(ge,Re){return ge.f-Re.f}),q.push({s:-1,f:25001});var J=q[0],W=q[1],Z=0,Q=1,ee=2;for(q[0]={s:-1,f:J.f+W.f,l:J,r:W};Q!=V-1;)J=q[q[Z].f<q[ee].f?Z++:ee++],W=q[Z!=Q&&q[Z].f<q[ee].f?Z++:ee++],q[Q++]={s:-1,f:J.f+W.f,l:J,r:W};for(var te=G[0].s,U=1;U<V;++U)G[U].s>te&&(te=G[U].s);var ne=new u16(te+1),oe=ln(q[Q-1],ne,0);if(oe>$){var U=0,ce=0,le=oe-$,pe=1<<le;for(G.sort(function(Re,xe){return ne[xe.s]-ne[Re.s]||Re.f-xe.f});U<V;++U){var he=G[U].s;if(ne[he]>$)ce+=pe-(1<<oe-ne[he]),ne[he]=$;else break}for(ce>>=le;ce>0;){var fe=G[U].s;ne[fe]<$?ce-=1<<$-ne[fe]++-1:++U}for(;U>=0&&ce;--U){var ye=G[U].s;ne[ye]==$&&(--ne[ye],++ce)}oe=$}return{t:new u8(ne),l:oe}},ln=function(B,$,q){return B.s==-1?Math.max(ln(B.l,$,q+1),ln(B.r,$,q+1)):$[B.s]=q},lc=function(B){for(var $=B.length;$&&!B[--$];);for(var q=new u16(++$),U=0,V=B[0],G=1,K=function(W){q[U++]=W},J=1;J<=$;++J)if(B[J]==V&&J!=$)++G;else{if(!V&&G>2){for(;G>138;G-=138)K(32754);G>2&&(K(G>10?G-11<<5|28690:G-3<<5|12305),G=0)}else if(G>3){for(K(V),--G;G>6;G-=6)K(8304);G>2&&(K(G-3<<5|8208),G=0)}for(;G--;)K(V);G=1,V=B[J]}return{c:q.subarray(0,U),n:$}},clen=function(B,$){for(var q=0,U=0;U<$.length;++U)q+=B[U]*$[U];return q},wfblk=function(B,$,q){var U=q.length,V=shft($+2);B[V]=U&255,B[V+1]=U>>8,B[V+2]=B[V]^255,B[V+3]=B[V+1]^255;for(var G=0;G<U;++G)B[V+G+4]=q[G];return(V+4+U)*8},wblk=function(B,$,q,U,V,G,K,J,W,Z,Q){wbits($,Q++,q),++V[256];for(var ee=hTree(V,15),te=ee.t,ne=ee.l,oe=hTree(G,15),ce=oe.t,le=oe.l,pe=lc(te),he=pe.c,fe=pe.n,ye=lc(ce),ge=ye.c,Re=ye.n,xe=new u16(19),_e=0;_e<he.length;++_e)++xe[he[_e]&31];for(var _e=0;_e<ge.length;++_e)++xe[ge[_e]&31];for(var ve=hTree(xe,7),Te=ve.t,$e=ve.l,Ie=19;Ie>4&&!Te[clim[Ie-1]];--Ie);var Ae=Z+5<<3,Me=clen(V,flt)+clen(G,fdt)+K,qe=clen(V,te)+clen(G,ce)+K+14+3*Ie+clen(xe,Te)+2*xe[16]+3*xe[17]+7*xe[18];if(W>=0&&Ae<=Me&&Ae<=qe)return wfblk($,Q,B.subarray(W,W+Z));var Se,be,Pe,Ee;if(wbits($,Q,1+(qe<Me)),Q+=2,qe<Me){Se=hMap(te,ne,0),be=te,Pe=hMap(ce,le,0),Ee=ce;var Fe=hMap(Te,$e,0);wbits($,Q,fe-257),wbits($,Q+5,Re-1),wbits($,Q+10,Ie-4),Q+=14;for(var _e=0;_e<Ie;++_e)wbits($,Q+3*_e,Te[clim[_e]]);Q+=3*Ie;for(var re=[he,ge],ie=0;ie<2;++ie)for(var ae=re[ie],_e=0;_e<ae.length;++_e){var ue=ae[_e]&31;wbits($,Q,Fe[ue]),Q+=Te[ue],ue>15&&(wbits($,Q,ae[_e]>>5&127),Q+=ae[_e]>>12)}}else Se=flm,be=flt,Pe=fdm,Ee=fdt;for(var _e=0;_e<J;++_e){var de=U[_e];if(de>255){var ue=de>>18&31;wbits16($,Q,Se[ue+257]),Q+=be[ue+257],ue>7&&(wbits($,Q,de>>23&31),Q+=fleb[ue]);var we=de&31;wbits16($,Q,Pe[we]),Q+=Ee[we],we>3&&(wbits16($,Q,de>>5&8191),Q+=fdeb[we])}else wbits16($,Q,Se[de]),Q+=be[de]}return wbits16($,Q,Se[256]),Q+be[256]},deo=new i32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et=new u8(0),dflt=function(B,$,q,U,V,G){var K=G.z||B.length,J=new u8(U+K+5*(1+Math.ceil(K/7e3))+V),W=J.subarray(U,J.length-V),Z=G.l,Q=(G.r||0)&7;if($){Q&&(W[0]=G.r>>3);for(var ee=deo[$-1],te=ee>>13,ne=ee&8191,oe=(1<<q)-1,ce=G.p||new u16(32768),le=G.h||new u16(oe+1),pe=Math.ceil(q/3),he=2*pe,fe=function(ze){return(B[ze]^B[ze+1]<<pe^B[ze+2]<<he)&oe},ye=new i32(25e3),ge=new u16(288),Re=new u16(32),xe=0,_e=0,ve=G.i||0,Te=0,$e=G.w||0,Ie=0;ve+2<K;++ve){var Ae=fe(ve),Me=ve&32767,qe=le[Ae];if(ce[Me]=qe,le[Ae]=Me,$e<=ve){var Se=K-ve;if((xe>7e3||Te>24576)&&(Se>423||!Z)){Q=wblk(B,W,0,ye,ge,Re,_e,Te,Ie,ve-Ie,Q),Te=xe=_e=0,Ie=ve;for(var be=0;be<286;++be)ge[be]=0;for(var be=0;be<30;++be)Re[be]=0}var Pe=2,Ee=0,Fe=ne,re=Me-qe&32767;if(Se>2&&Ae==fe(ve-re))for(var ie=Math.min(te,Se)-1,ae=Math.min(32767,ve),ue=Math.min(258,Se);re<=ae&&--Fe&&Me!=qe;){if(B[ve+Pe]==B[ve+Pe-re]){for(var de=0;de<ue&&B[ve+de]==B[ve+de-re];++de);if(de>Pe){if(Pe=de,Ee=re,de>ie)break;for(var we=Math.min(re,de-2),ke=0,be=0;be<we;++be){var Ce=ve-re+be&32767,nt=ce[Ce],Ge=Ce-nt&32767;Ge>ke&&(ke=Ge,qe=Ce)}}}Me=qe,qe=ce[Me],re+=Me-qe&32767}if(Ee){ye[Te++]=268435456|revfl[Pe]<<18|revfd[Ee];var Ke=revfl[Pe]&31,We=revfd[Ee]&31;_e+=fleb[Ke]+fdeb[We],++ge[257+Ke],++Re[We],$e=ve+Pe,++xe}else ye[Te++]=B[ve],++ge[B[ve]]}}for(ve=Math.max(ve,$e);ve<K;++ve)ye[Te++]=B[ve],++ge[B[ve]];Q=wblk(B,W,Z,ye,ge,Re,_e,Te,Ie,ve-Ie,Q),Z||(G.r=Q&7|W[Q/8|0]<<3,Q-=7,G.h=le,G.p=ce,G.i=ve,G.w=$e)}else{for(var ve=G.w||0;ve<K+Z;ve+=65535){var He=ve+65535;He>=K&&(W[Q/8|0]=Z,He=K),Q=wfblk(W,Q+1,B.subarray(ve,He))}G.i=K}return slc(J,0,U+shft(Q)+V)},crct=function(){for(var B=new Int32Array(256),$=0;$<256;++$){for(var q=$,U=9;--U;)q=(q&1&&-306674912)^q>>>1;B[$]=q}return B}(),crc=function(){var B=-1;return{p:function($){for(var q=B,U=0;U<$.length;++U)q=crct[q&255^$[U]]^q>>>8;B=q},d:function(){return~B}}},dopt=function(B,$,q,U,V){if(!V&&(V={l:1},$.dictionary)){var G=$.dictionary.subarray(-32768),K=new u8(G.length+B.length);K.set(G),K.set(B,G.length),B=K,V.w=G.length}return dflt(B,$.level==null?6:$.level,$.mem==null?V.l?Math.ceil(Math.max(8,Math.min(13,Math.log(B.length)))*1.5):20:12+$.mem,q,U,V)},wbytes=function(B,$,q){for(;q;++$)B[$]=q,q>>>=8},gzh=function(B,$){var q=$.filename;if(B[0]=31,B[1]=139,B[2]=8,B[8]=$.level<2?4:$.level==9?2:0,B[9]=3,$.mtime!=0&&wbytes(B,4,Math.floor(new Date($.mtime||Date.now())/1e3)),q){B[3]=8;for(var U=0;U<=q.length;++U)B[U+10]=q.charCodeAt(U)}},gzhl=function(B){return 10+(B.filename?B.filename.length+1:0)};function gzipSync(B,$){$||($={});var q=crc(),U=B.length;q.p(B);var V=dopt(B,$,gzhl($),8),G=V.length;return gzh(V,$),wbytes(V,G-8,q.d()),wbytes(V,G-4,U),V}var td=typeof TextDecoder!="undefined"&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch(B){}function gzip(B){return me(this,null,function*(){if(p$c.compressionStream())try{const $=a$6(B),q=new globalThis.CompressionStream("gzip"),U=$.pipeThrough(q);return yield f$7(U)}catch($){}return gzipSync(B)})}const DefaultPackerConfig={compression:{mode:"gzip"}};class DefaultPacker extends d$6{constructor(q){super();se(this,"_packetId",0);se(this,"_frameOffset",0);se(this,"_encoder");this.context=q,this._encoder=new DefaultEncoder(q)}handleInput(q){return me(this,null,function*(){if(q.length>0){const U=this.encode(q),V=q.some(W=>W.trackType===n$c.HTML&&W.event.eventType===R$4.HTMLSnapshot);let G=!1;const K=q[q.length-1];K&&K.trackType===n$c.EOF&&(G=!0);const J=yield this.pack(U,q.length,q[0].time,q[q.length-1].time,G,V);this.output(J)}})}encode(q){return q.forEach((U,V)=>{if(U.trackType===n$c.HTML&&U.event.eventType===R$4.HTMLIncrementalSnapshot){const G={id:`frame/${this._frameOffset+V}`,time:U.time,type:"frame",recordingId:this.context.id,data:{trackType:U.trackType,eventType:U.event.eventType,offset:this._frameOffset+V}};this.context.emit("feedback",{type:SignalType.FrameIndex,index:G})}}),this._encoder.encode(q)}pack(q,U,V,G,K,J){return me(this,null,function*(){var te,ne;let W=q;(((ne=(te=this.context.transmitter)==null?void 0:te.strategy)==null?void 0:ne.packer)||DefaultPackerConfig).compression.mode==="gzip"&&(W=yield gzip(q));const ee={id:`${this.context.recording.id}/${this._nextPacketId()}`,frameRange:[this._frameOffset,U],data:W,firstFrameTime:V-this.context.startTime,lastFrameTime:G-this.context.startTime,isEOF:K,hasSnapshot:J};return this._frameOffset+=U,ee})}_nextPacketId(){return this._packetId++}}function pack(B,$,q,U,V,G,K){return me(this,null,function*(){const J=yield gzip(B);return{id:`${V}/0`,frameRange:[0,$],data:J,firstFrameTime:q-G,lastFrameTime:U-G,isEOF:K}})}class AbstractProcessor extends d$6{constructor(q,U){super();se(this,"_trackTypesToHandle");se(this,"_context");if(this._context=q,U!=null){const V={};Array.isArray(U)?U.forEach(G=>{V[G]=!0}):V[U]=!0,this._trackTypesToHandle=V}}handleInput(q){this._shouldHandle(q)?this.handleFrame(q):this.output(q)}_shouldHandle(q){return this._trackTypesToHandle==null||this._trackTypesToHandle[q.trackType]===!0}}const e$1={textRendering:0,fillStyle:1,strokeStyle:2,font:3,textAlign:4,wordSpacing:5,lineCap:6,lineDashOffset:7,lineJoin:8,letterSpacing:9,direction:10,filter:11,fontKerning:12,fontStretch:13,fontVariantCaps:14,lineWidth:15,globalCompositeOperation:16,imageSmoothingEnabled:17,imageSmoothingQuality:18,miterLimit:19,shadowBlur:20,shadowColor:21,shadowOffsetX:22,shadowOffsetY:23,textBaseline:24,globalAlpha:25},i$3=Object.fromEntries(Object.entries(e$1).map(([B,$])=>[$,B]));function r$6(B){return i$3[B]}const t$2={setTransform:0,lineTo:1,beginPath:2,fill:3,stroke:5,clip:6,save:7,restore:8,fillText:9,fillRect:10,arc:11,arcTo:12,bezierCurveTo:13,clearRect:14,closePath:15,createConicGradient:16,createImageData:17,createLinearGradient:18,createPattern:19,createRadialGradient:20,drawFocusIfNeeded:21,drawImage:22,ellipse:23,moveTo:32,putImageData:33,quadraticCurveTo:34,rect:35,reset:36,resetTransform:37,rotate:38,roundRect:39,scale:40,setLineDash:42,strokeRect:43,strokeText:44,transform:45,translate:46},c$6=Object.fromEntries(Object.entries(t$2).map(([B,$])=>[$,B]));function i$2(B){return B!=="createConicGradient"&&B!=="createImageData"&&B!=="createLinearGradient"&&B!=="createPattern"&&B!=="createRadialGradient"}const s$3={setAttr:4,snapshot:47},O=Object.fromEntries(Object.entries(s$3).map(([B,$])=>[$,B]));function n$5(B){var $;return($=c$6[B])!=null?$:O[B]}const o$3=function(B){return B&&B.Math===Math&&B},t$1=o$3(typeof globalThis=="object"&&globalThis)||o$3(typeof window=="object"&&window)||o$3(typeof self=="object"&&self)||o$3(!1)||function(){return this}()||Function("return this")();function n$4(){try{return typeof t$1.WorkerGlobalScope!="undefined"&&t$1 instanceof t$1.WorkerGlobalScope}catch(B){return!1}}class QuickLRU extends Map{constructor($={}){if(super(),!($.maxSize&&$.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof $.maxAge=="number"&&$.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=$.maxSize,this.maxAge=$.maxAge||Number.POSITIVE_INFINITY,this.onEviction=$.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions($){if(typeof this.onEviction=="function")for(const[q,U]of $)this.onEviction(q,U.value)}_deleteIfExpired($,q){return typeof q.expiry=="number"&&q.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction($,q.value),this.delete($)):!1}_getOrDeleteIfExpired($,q){if(this._deleteIfExpired($,q)===!1)return q.value}_getItemValue($,q){return q.expiry?this._getOrDeleteIfExpired($,q):q.value}_peek($,q){const U=q.get($);return this._getItemValue($,U)}_set($,q){this.cache.set($,q),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent($,q){this.oldCache.delete($),this._set($,q)}*_entriesAscending(){for(const $ of this.oldCache){const[q,U]=$;this.cache.has(q)||this._deleteIfExpired(q,U)===!1&&(yield $)}for(const $ of this.cache){const[q,U]=$;this._deleteIfExpired(q,U)===!1&&(yield $)}}get($){if(this.cache.has($)){const q=this.cache.get($);return this._getItemValue($,q)}if(this.oldCache.has($)){const q=this.oldCache.get($);if(this._deleteIfExpired($,q)===!1)return this._moveToRecent($,q),q.value}}set($,q,{maxAge:U=this.maxAge}={}){const V=typeof U=="number"&&U!==Number.POSITIVE_INFINITY?Date.now()+U:void 0;return this.cache.has($)?this.cache.set($,{value:q,expiry:V}):this._set($,{value:q,expiry:V}),this}has($){return this.cache.has($)?!this._deleteIfExpired($,this.cache.get($)):this.oldCache.has($)?!this._deleteIfExpired($,this.oldCache.get($)):!1}peek($){if(this.cache.has($))return this._peek($,this.cache);if(this.oldCache.has($))return this._peek($,this.oldCache)}delete($){const q=this.cache.delete($);return q&&this._size--,this.oldCache.delete($)||q}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize($){if(!($&&$>0))throw new TypeError("`maxSize` must be a number greater than 0");const q=[...this._entriesAscending()],U=q.length-$;U<0?(this.cache=new Map(q),this.oldCache=new Map,this._size=q.length):(U>0&&this._emitEvictions(q.slice(0,U)),this.oldCache=new Map(q.slice(U)),this.cache=new Map,this._size=0),this.maxSize=$}*keys(){for(const[$]of this)yield $}*values(){for(const[,$]of this)yield $}*[Symbol.iterator](){for(const $ of this.cache){const[q,U]=$;this._deleteIfExpired(q,U)===!1&&(yield[q,U.value])}for(const $ of this.oldCache){const[q,U]=$;this.cache.has(q)||this._deleteIfExpired(q,U)===!1&&(yield[q,U.value])}}*entriesDescending(){let $=[...this.cache];for(let q=$.length-1;q>=0;--q){const U=$[q],[V,G]=U;this._deleteIfExpired(V,G)===!1&&(yield[V,G.value])}$=[...this.oldCache];for(let q=$.length-1;q>=0;--q){const U=$[q],[V,G]=U;this.cache.has(V)||this._deleteIfExpired(V,G)===!1&&(yield[V,G.value])}}*entriesAscending(){for(const[$,q]of this._entriesAscending())yield[$,q.value]}get size(){if(!this._size)return this.oldCache.size;let $=0;for(const q of this.oldCache.keys())this.cache.has(q)||$++;return Math.min(this._size+$,this.maxSize)}entries(){return this.entriesAscending()}forEach($,q=this){for(const[U,V]of this.entriesAscending())$.call(q,V,U,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}var r$5=Object.defineProperty,m$b=(B,$,q)=>$ in B?r$5(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,a$3=(B,$,q)=>m$b(B,typeof $!="symbol"?$+"":$,q);let l$b=class{constructor(){a$3(this,"_serializeCache",new WeakMap),a$3(this,"_canvas",null)}serialize($){if($ instanceof HTMLCanvasElement)return{type:$.constructor.name,src:$.toDataURL()};if($ instanceof OffscreenCanvas){const q=$.transferToImageBitmap(),U=this._serializeCache.get(q);if(U)return U;const V=$.transferToImageBitmap(),G={type:$.constructor.name,src:this._convertImageBitmapIntoBase64(V)};return this._serializeCache.set(V,G),G}if(t$1.VideoFrame&&$ instanceof VideoFrame){const q={type:$.constructor.name,src:this._convertVideoFrameIntoBase64($)};return this._serializeCache.set($,q),q}else if($ instanceof HTMLImageElement||$ instanceof HTMLVideoElement||$ instanceof Image){const q={type:$.constructor.name,src:$.src};return this._serializeCache.set($,q),q}else if($ instanceof ImageBitmap){const q={type:$.constructor.name,src:this._convertImageBitmapIntoBase64($)};return this._serializeCache.set($,q),q}else if($ instanceof SVGImageElement){const q={type:$.constructor.name,src:$.href.baseVal};return this._serializeCache.set($,q),q}}isCanvasImageSource($){return $ instanceof HTMLImageElement||$ instanceof HTMLVideoElement||$ instanceof HTMLCanvasElement||$ instanceof Image||$ instanceof ImageBitmap||$ instanceof OffscreenCanvas||$ instanceof SVGImageElement||t$1.VideoFrame&&$ instanceof VideoFrame}_convertImageBitmapIntoBase64($){const q=this.canvas;return q.width=$.width,q.height=$.height,q.getContext("2d").drawImage($,0,0),q.toDataURL("image/png",1)}_convertVideoFrameIntoBase64($){const q=document.createElement("canvas");return q.width=$.displayWidth,q.height=$.displayHeight,q.getContext("2d").drawImage($,0,0),q.toDataURL("image/png",1)}get canvas(){return this._canvas||(this._canvas=document.createElement("canvas")),this._canvas}};new l$b;function s$2(B){return Array.isArray(B)}var noop={value:()=>{}};function dispatch(){for(var B=0,$=arguments.length,q={},U;B<$;++B){if(!(U=arguments[B]+"")||U in q||/[\\s.]/.test(U))throw new Error("illegal type: "+U);q[U]=[]}return new Dispatch(q)}function Dispatch(B){this._=B}function parseTypenames$1(B,$){return B.trim().split(/^|\\s+/).map(function(q){var U="",V=q.indexOf(".");if(V>=0&&(U=q.slice(V+1),q=q.slice(0,V)),q&&!$.hasOwnProperty(q))throw new Error("unknown type: "+q);return{type:q,name:U}})}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(B,$){var q=this._,U=parseTypenames$1(B+"",q),V,G=-1,K=U.length;if(arguments.length<2){for(;++G<K;)if((V=(B=U[G]).type)&&(V=get$1(q[V],B.name)))return V;return}if($!=null&&typeof $!="function")throw new Error("invalid callback: "+$);for(;++G<K;)if(V=(B=U[G]).type)q[V]=set$1(q[V],B.name,$);else if($==null)for(V in q)q[V]=set$1(q[V],B.name,null);return this},copy:function(){var B={},$=this._;for(var q in $)B[q]=$[q].slice();return new Dispatch(B)},call:function(B,$){if((V=arguments.length-2)>0)for(var q=new Array(V),U=0,V,G;U<V;++U)q[U]=arguments[U+2];if(!this._.hasOwnProperty(B))throw new Error("unknown type: "+B);for(G=this._[B],U=0,V=G.length;U<V;++U)G[U].value.apply($,q)},apply:function(B,$,q){if(!this._.hasOwnProperty(B))throw new Error("unknown type: "+B);for(var U=this._[B],V=0,G=U.length;V<G;++V)U[V].value.apply($,q)}};function get$1(B,$){for(var q=0,U=B.length,V;q<U;++q)if((V=B[q]).name===$)return V.value}function set$1(B,$,q){for(var U=0,V=B.length;U<V;++U)if(B[U].name===$){B[U]=noop,B=B.slice(0,U).concat(B.slice(U+1));break}return q!=null&&B.push({name:$,value:q}),B}var xhtml="http://www.w3.org/1999/xhtml",namespaces={svg:"http://www.w3.org/2000/svg",xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(B){var $=B+="",q=$.indexOf(":");return q>=0&&($=B.slice(0,q))!=="xmlns"&&(B=B.slice(q+1)),namespaces.hasOwnProperty($)?{space:namespaces[$],local:B}:B}function creatorInherit(B){return function(){var $=this.ownerDocument,q=this.namespaceURI;return q===xhtml&&$.documentElement.namespaceURI===xhtml?$.createElement(B):$.createElementNS(q,B)}}function creatorFixed(B){return function(){return this.ownerDocument.createElementNS(B.space,B.local)}}function creator(B){var $=namespace(B);return($.local?creatorFixed:creatorInherit)($)}function none(){}function selector(B){return B==null?none:function(){return this.querySelector(B)}}function selection_select(B){typeof B!="function"&&(B=selector(B));for(var $=this._groups,q=$.length,U=new Array(q),V=0;V<q;++V)for(var G=$[V],K=G.length,J=U[V]=new Array(K),W,Z,Q=0;Q<K;++Q)(W=G[Q])&&(Z=B.call(W,W.__data__,Q,G))&&("__data__"in W&&(Z.__data__=W.__data__),J[Q]=Z);return new Selection$1(U,this._parents)}function array(B){return B==null?[]:Array.isArray(B)?B:Array.from(B)}function empty(){return[]}function selectorAll(B){return B==null?empty:function(){return this.querySelectorAll(B)}}function arrayAll(B){return function(){return array(B.apply(this,arguments))}}function selection_selectAll(B){typeof B=="function"?B=arrayAll(B):B=selectorAll(B);for(var $=this._groups,q=$.length,U=[],V=[],G=0;G<q;++G)for(var K=$[G],J=K.length,W,Z=0;Z<J;++Z)(W=K[Z])&&(U.push(B.call(W,W.__data__,Z,K)),V.push(W));return new Selection$1(U,V)}function matcher(B){return function(){return this.matches(B)}}function childMatcher(B){return function($){return $.matches(B)}}var find=Array.prototype.find;function childFind(B){return function(){return find.call(this.children,B)}}function childFirst(){return this.firstElementChild}function selection_selectChild(B){return this.select(B==null?childFirst:childFind(typeof B=="function"?B:childMatcher(B)))}var filter=Array.prototype.filter;function children(){return Array.from(this.children)}function childrenFilter(B){return function(){return filter.call(this.children,B)}}function selection_selectChildren(B){return this.selectAll(B==null?children:childrenFilter(typeof B=="function"?B:childMatcher(B)))}function selection_filter(B){typeof B!="function"&&(B=matcher(B));for(var $=this._groups,q=$.length,U=new Array(q),V=0;V<q;++V)for(var G=$[V],K=G.length,J=U[V]=[],W,Z=0;Z<K;++Z)(W=G[Z])&&B.call(W,W.__data__,Z,G)&&J.push(W);return new Selection$1(U,this._parents)}function sparse(B){return new Array(B.length)}function selection_enter(){return new Selection$1(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(B,$){this.ownerDocument=B.ownerDocument,this.namespaceURI=B.namespaceURI,this._next=null,this._parent=B,this.__data__=$}EnterNode.prototype={constructor:EnterNode,appendChild:function(B){return this._parent.insertBefore(B,this._next)},insertBefore:function(B,$){return this._parent.insertBefore(B,$)},querySelector:function(B){return this._parent.querySelector(B)},querySelectorAll:function(B){return this._parent.querySelectorAll(B)}};function constant$1(B){return function(){return B}}function bindIndex(B,$,q,U,V,G){for(var K=0,J,W=$.length,Z=G.length;K<Z;++K)(J=$[K])?(J.__data__=G[K],U[K]=J):q[K]=new EnterNode(B,G[K]);for(;K<W;++K)(J=$[K])&&(V[K]=J)}function bindKey(B,$,q,U,V,G,K){var J,W,Z=new Map,Q=$.length,ee=G.length,te=new Array(Q),ne;for(J=0;J<Q;++J)(W=$[J])&&(te[J]=ne=K.call(W,W.__data__,J,$)+"",Z.has(ne)?V[J]=W:Z.set(ne,W));for(J=0;J<ee;++J)ne=K.call(B,G[J],J,G)+"",(W=Z.get(ne))?(U[J]=W,W.__data__=G[J],Z.delete(ne)):q[J]=new EnterNode(B,G[J]);for(J=0;J<Q;++J)(W=$[J])&&Z.get(te[J])===W&&(V[J]=W)}function datum(B){return B.__data__}function selection_data(B,$){if(!arguments.length)return Array.from(this,datum);var q=$?bindKey:bindIndex,U=this._parents,V=this._groups;typeof B!="function"&&(B=constant$1(B));for(var G=V.length,K=new Array(G),J=new Array(G),W=new Array(G),Z=0;Z<G;++Z){var Q=U[Z],ee=V[Z],te=ee.length,ne=arraylike(B.call(Q,Q&&Q.__data__,Z,U)),oe=ne.length,ce=J[Z]=new Array(oe),le=K[Z]=new Array(oe),pe=W[Z]=new Array(te);q(Q,ee,ce,le,pe,ne,$);for(var he=0,fe=0,ye,ge;he<oe;++he)if(ye=ce[he]){for(he>=fe&&(fe=he+1);!(ge=le[fe])&&++fe<oe;);ye._next=ge||null}}return K=new Selection$1(K,U),K._enter=J,K._exit=W,K}function arraylike(B){return typeof B=="object"&&"length"in B?B:Array.from(B)}function selection_exit(){return new Selection$1(this._exit||this._groups.map(sparse),this._parents)}function selection_join(B,$,q){var U=this.enter(),V=this,G=this.exit();return typeof B=="function"?(U=B(U),U&&(U=U.selection())):U=U.append(B+""),$!=null&&(V=$(V),V&&(V=V.selection())),q==null?G.remove():q(G),U&&V?U.merge(V).order():V}function selection_merge(B){for(var $=B.selection?B.selection():B,q=this._groups,U=$._groups,V=q.length,G=U.length,K=Math.min(V,G),J=new Array(V),W=0;W<K;++W)for(var Z=q[W],Q=U[W],ee=Z.length,te=J[W]=new Array(ee),ne,oe=0;oe<ee;++oe)(ne=Z[oe]||Q[oe])&&(te[oe]=ne);for(;W<V;++W)J[W]=q[W];return new Selection$1(J,this._parents)}function selection_order(){for(var B=this._groups,$=-1,q=B.length;++$<q;)for(var U=B[$],V=U.length-1,G=U[V],K;--V>=0;)(K=U[V])&&(G&&K.compareDocumentPosition(G)^4&&G.parentNode.insertBefore(K,G),G=K);return this}function selection_sort(B){B||(B=ascending);function $(ee,te){return ee&&te?B(ee.__data__,te.__data__):!ee-!te}for(var q=this._groups,U=q.length,V=new Array(U),G=0;G<U;++G){for(var K=q[G],J=K.length,W=V[G]=new Array(J),Z,Q=0;Q<J;++Q)(Z=K[Q])&&(W[Q]=Z);W.sort($)}return new Selection$1(V,this._parents).order()}function ascending(B,$){return B<$?-1:B>$?1:B>=$?0:NaN}function selection_call(){var B=arguments[0];return arguments[0]=this,B.apply(null,arguments),this}function selection_nodes(){return Array.from(this)}function selection_node(){for(var B=this._groups,$=0,q=B.length;$<q;++$)for(var U=B[$],V=0,G=U.length;V<G;++V){var K=U[V];if(K)return K}return null}function selection_size(){let B=0;for(const $ of this)++B;return B}function selection_empty(){return!this.node()}function selection_each(B){for(var $=this._groups,q=0,U=$.length;q<U;++q)for(var V=$[q],G=0,K=V.length,J;G<K;++G)(J=V[G])&&B.call(J,J.__data__,G,V);return this}function attrRemove$1(B){return function(){this.removeAttribute(B)}}function attrRemoveNS$1(B){return function(){this.removeAttributeNS(B.space,B.local)}}function attrConstant$1(B,$){return function(){this.setAttribute(B,$)}}function attrConstantNS$1(B,$){return function(){this.setAttributeNS(B.space,B.local,$)}}function attrFunction$1(B,$){return function(){var q=$.apply(this,arguments);q==null?this.removeAttribute(B):this.setAttribute(B,q)}}function attrFunctionNS$1(B,$){return function(){var q=$.apply(this,arguments);q==null?this.removeAttributeNS(B.space,B.local):this.setAttributeNS(B.space,B.local,q)}}function selection_attr(B,$){var q=namespace(B);if(arguments.length<2){var U=this.node();return q.local?U.getAttributeNS(q.space,q.local):U.getAttribute(q)}return this.each(($==null?q.local?attrRemoveNS$1:attrRemove$1:typeof $=="function"?q.local?attrFunctionNS$1:attrFunction$1:q.local?attrConstantNS$1:attrConstant$1)(q,$))}function defaultView(B){return B.ownerDocument&&B.ownerDocument.defaultView||B.document&&B||B.defaultView}function styleRemove$1(B){return function(){this.style.removeProperty(B)}}function styleConstant$1(B,$,q){return function(){this.style.setProperty(B,$,q)}}function styleFunction$1(B,$,q){return function(){var U=$.apply(this,arguments);U==null?this.style.removeProperty(B):this.style.setProperty(B,U,q)}}function selection_style(B,$,q){return arguments.length>1?this.each(($==null?styleRemove$1:typeof $=="function"?styleFunction$1:styleConstant$1)(B,$,q==null?"":q)):styleValue(this.node(),B)}function styleValue(B,$){return B.style.getPropertyValue($)||defaultView(B).getComputedStyle(B,null).getPropertyValue($)}function propertyRemove(B){return function(){delete this[B]}}function propertyConstant(B,$){return function(){this[B]=$}}function propertyFunction(B,$){return function(){var q=$.apply(this,arguments);q==null?delete this[B]:this[B]=q}}function selection_property(B,$){return arguments.length>1?this.each(($==null?propertyRemove:typeof $=="function"?propertyFunction:propertyConstant)(B,$)):this.node()[B]}function classArray(B){return B.trim().split(/^|\\s+/)}function classList(B){return B.classList||new ClassList(B)}function ClassList(B){this._node=B,this._names=classArray(B.getAttribute("class")||"")}ClassList.prototype={add:function(B){var $=this._names.indexOf(B);$<0&&(this._names.push(B),this._node.setAttribute("class",this._names.join(" ")))},remove:function(B){var $=this._names.indexOf(B);$>=0&&(this._names.splice($,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(B){return this._names.indexOf(B)>=0}};function classedAdd(B,$){for(var q=classList(B),U=-1,V=$.length;++U<V;)q.add($[U])}function classedRemove(B,$){for(var q=classList(B),U=-1,V=$.length;++U<V;)q.remove($[U])}function classedTrue(B){return function(){classedAdd(this,B)}}function classedFalse(B){return function(){classedRemove(this,B)}}function classedFunction(B,$){return function(){($.apply(this,arguments)?classedAdd:classedRemove)(this,B)}}function selection_classed(B,$){var q=classArray(B+"");if(arguments.length<2){for(var U=classList(this.node()),V=-1,G=q.length;++V<G;)if(!U.contains(q[V]))return!1;return!0}return this.each((typeof $=="function"?classedFunction:$?classedTrue:classedFalse)(q,$))}function textRemove(){this.textContent=""}function textConstant$1(B){return function(){this.textContent=B}}function textFunction$1(B){return function(){var $=B.apply(this,arguments);this.textContent=$==null?"":$}}function selection_text(B){return arguments.length?this.each(B==null?textRemove:(typeof B=="function"?textFunction$1:textConstant$1)(B)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(B){return function(){this.innerHTML=B}}function htmlFunction(B){return function(){var $=B.apply(this,arguments);this.innerHTML=$==null?"":$}}function selection_html(B){return arguments.length?this.each(B==null?htmlRemove:(typeof B=="function"?htmlFunction:htmlConstant)(B)):this.node().innerHTML}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function selection_append(B){var $=typeof B=="function"?B:creator(B);return this.select(function(){return this.appendChild($.apply(this,arguments))})}function constantNull(){return null}function selection_insert(B,$){var q=typeof B=="function"?B:creator(B),U=$==null?constantNull:typeof $=="function"?$:selector($);return this.select(function(){return this.insertBefore(q.apply(this,arguments),U.apply(this,arguments)||null)})}function remove(){var B=this.parentNode;B&&B.removeChild(this)}function selection_remove(){return this.each(remove)}function selection_cloneShallow(){var B=this.cloneNode(!1),$=this.parentNode;return $?$.insertBefore(B,this.nextSibling):B}function selection_cloneDeep(){var B=this.cloneNode(!0),$=this.parentNode;return $?$.insertBefore(B,this.nextSibling):B}function selection_clone(B){return this.select(B?selection_cloneDeep:selection_cloneShallow)}function selection_datum(B){return arguments.length?this.property("__data__",B):this.node().__data__}function contextListener(B){return function($){B.call(this,$,this.__data__)}}function parseTypenames(B){return B.trim().split(/^|\\s+/).map(function($){var q="",U=$.indexOf(".");return U>=0&&(q=$.slice(U+1),$=$.slice(0,U)),{type:$,name:q}})}function onRemove(B){return function(){var $=this.__on;if($){for(var q=0,U=-1,V=$.length,G;q<V;++q)G=$[q],(!B.type||G.type===B.type)&&G.name===B.name?this.removeEventListener(G.type,G.listener,G.options):$[++U]=G;++U?$.length=U:delete this.__on}}}function onAdd(B,$,q){return function(){var U=this.__on,V,G=contextListener($);if(U){for(var K=0,J=U.length;K<J;++K)if((V=U[K]).type===B.type&&V.name===B.name){this.removeEventListener(V.type,V.listener,V.options),this.addEventListener(V.type,V.listener=G,V.options=q),V.value=$;return}}this.addEventListener(B.type,G,q),V={type:B.type,name:B.name,value:$,listener:G,options:q},U?U.push(V):this.__on=[V]}}function selection_on(B,$,q){var U=parseTypenames(B+""),V,G=U.length,K;if(arguments.length<2){var J=this.node().__on;if(J){for(var W=0,Z=J.length,Q;W<Z;++W)for(V=0,Q=J[W];V<G;++V)if((K=U[V]).type===Q.type&&K.name===Q.name)return Q.value}return}for(J=$?onAdd:onRemove,V=0;V<G;++V)this.each(J(U[V],$,q));return this}function dispatchEvent(B,$,q){var U=defaultView(B),V=U.CustomEvent;typeof V=="function"?V=new V($,q):(V=U.document.createEvent("Event"),q?(V.initEvent($,q.bubbles,q.cancelable),V.detail=q.detail):V.initEvent($,!1,!1)),B.dispatchEvent(V)}function dispatchConstant(B,$){return function(){return dispatchEvent(this,B,$)}}function dispatchFunction(B,$){return function(){return dispatchEvent(this,B,$.apply(this,arguments))}}function selection_dispatch(B,$){return this.each((typeof $=="function"?dispatchFunction:dispatchConstant)(B,$))}function*selection_iterator(){for(var B=this._groups,$=0,q=B.length;$<q;++$)for(var U=B[$],V=0,G=U.length,K;V<G;++V)(K=U[V])&&(yield K)}var root=[null];function Selection$1(B,$){this._groups=B,this._parents=$}function selection(){return new Selection$1([[document.documentElement]],root)}function selection_selection(){return this}Selection$1.prototype=selection.prototype={constructor:Selection$1,select:selection_select,selectAll:selection_selectAll,selectChild:selection_selectChild,selectChildren:selection_selectChildren,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,join:selection_join,merge:selection_merge,selection:selection_selection,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on:selection_on,dispatch:selection_dispatch,[Symbol.iterator]:selection_iterator};function define(B,$,q){B.prototype=$.prototype=q,q.constructor=B}function extend(B,$){var q=Object.create(B.prototype);for(var U in $)q[U]=$[U];return q}function Color(){}var darker=.7,brighter=1/darker,reI="\\\\s*([+-]?\\\\d+)\\\\s*",reN="\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*",reP="\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp(`^rgb\\\\(${reI},${reI},${reI}\\\\)$`),reRgbPercent=new RegExp(`^rgb\\\\(${reP},${reP},${reP}\\\\)$`),reRgbaInteger=new RegExp(`^rgba\\\\(${reI},${reI},${reI},${reN}\\\\)$`),reRgbaPercent=new RegExp(`^rgba\\\\(${reP},${reP},${reP},${reN}\\\\)$`),reHslPercent=new RegExp(`^hsl\\\\(${reN},${reP},${reP}\\\\)$`),reHslaPercent=new RegExp(`^hsla\\\\(${reN},${reP},${reP},${reN}\\\\)$`),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color,{copy(B){return Object.assign(new this.constructor,this,B)},displayable(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHex8:color_formatHex8,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb});function color_formatHex(){return this.rgb().formatHex()}function color_formatHex8(){return this.rgb().formatHex8()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color(B){var $,q;return B=(B+"").trim().toLowerCase(),($=reHex.exec(B))?(q=$[1].length,$=parseInt($[1],16),q===6?rgbn($):q===3?new Rgb($>>8&15|$>>4&240,$>>4&15|$&240,($&15)<<4|$&15,1):q===8?rgba($>>24&255,$>>16&255,$>>8&255,($&255)/255):q===4?rgba($>>12&15|$>>8&240,$>>8&15|$>>4&240,$>>4&15|$&240,(($&15)<<4|$&15)/255):null):($=reRgbInteger.exec(B))?new Rgb($[1],$[2],$[3],1):($=reRgbPercent.exec(B))?new Rgb($[1]*255/100,$[2]*255/100,$[3]*255/100,1):($=reRgbaInteger.exec(B))?rgba($[1],$[2],$[3],$[4]):($=reRgbaPercent.exec(B))?rgba($[1]*255/100,$[2]*255/100,$[3]*255/100,$[4]):($=reHslPercent.exec(B))?hsla($[1],$[2]/100,$[3]/100,1):($=reHslaPercent.exec(B))?hsla($[1],$[2]/100,$[3]/100,$[4]):named.hasOwnProperty(B)?rgbn(named[B]):B==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(B){return new Rgb(B>>16&255,B>>8&255,B&255,1)}function rgba(B,$,q,U){return U<=0&&(B=$=q=NaN),new Rgb(B,$,q,U)}function rgbConvert(B){return B instanceof Color||(B=color(B)),B?(B=B.rgb(),new Rgb(B.r,B.g,B.b,B.opacity)):new Rgb}function rgb(B,$,q,U){return arguments.length===1?rgbConvert(B):new Rgb(B,$,q,U==null?1:U)}function Rgb(B,$,q,U){this.r=+B,this.g=+$,this.b=+q,this.opacity=+U}define(Rgb,rgb,extend(Color,{brighter(B){return B=B==null?brighter:Math.pow(brighter,B),new Rgb(this.r*B,this.g*B,this.b*B,this.opacity)},darker(B){return B=B==null?darker:Math.pow(darker,B),new Rgb(this.r*B,this.g*B,this.b*B,this.opacity)},rgb(){return this},clamp(){return new Rgb(clampi(this.r),clampi(this.g),clampi(this.b),clampa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatHex8:rgb_formatHex8,formatRgb:rgb_formatRgb,toString:rgb_formatRgb}));function rgb_formatHex(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}`}function rgb_formatHex8(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity)?1:this.opacity)*255)}`}function rgb_formatRgb(){const B=clampa(this.opacity);return`${B===1?"rgb(":"rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${B===1?")":`, ${B})`}`}function clampa(B){return isNaN(B)?1:Math.max(0,Math.min(1,B))}function clampi(B){return Math.max(0,Math.min(255,Math.round(B)||0))}function hex(B){return B=clampi(B),(B<16?"0":"")+B.toString(16)}function hsla(B,$,q,U){return U<=0?B=$=q=NaN:q<=0||q>=1?B=$=NaN:$<=0&&(B=NaN),new Hsl(B,$,q,U)}function hslConvert(B){if(B instanceof Hsl)return new Hsl(B.h,B.s,B.l,B.opacity);if(B instanceof Color||(B=color(B)),!B)return new Hsl;if(B instanceof Hsl)return B;B=B.rgb();var $=B.r/255,q=B.g/255,U=B.b/255,V=Math.min($,q,U),G=Math.max($,q,U),K=NaN,J=G-V,W=(G+V)/2;return J?($===G?K=(q-U)/J+(q<U)*6:q===G?K=(U-$)/J+2:K=($-q)/J+4,J/=W<.5?G+V:2-G-V,K*=60):J=W>0&&W<1?0:K,new Hsl(K,J,W,B.opacity)}function hsl(B,$,q,U){return arguments.length===1?hslConvert(B):new Hsl(B,$,q,U==null?1:U)}function Hsl(B,$,q,U){this.h=+B,this.s=+$,this.l=+q,this.opacity=+U}define(Hsl,hsl,extend(Color,{brighter(B){return B=B==null?brighter:Math.pow(brighter,B),new Hsl(this.h,this.s,this.l*B,this.opacity)},darker(B){return B=B==null?darker:Math.pow(darker,B),new Hsl(this.h,this.s,this.l*B,this.opacity)},rgb(){var B=this.h%360+(this.h<0)*360,$=isNaN(B)||isNaN(this.s)?0:this.s,q=this.l,U=q+(q<.5?q:1-q)*$,V=2*q-U;return new Rgb(hsl2rgb(B>=240?B-240:B+120,V,U),hsl2rgb(B,V,U),hsl2rgb(B<120?B+240:B-120,V,U),this.opacity)},clamp(){return new Hsl(clamph(this.h),clampt(this.s),clampt(this.l),clampa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const B=clampa(this.opacity);return`${B===1?"hsl(":"hsla("}${clamph(this.h)}, ${clampt(this.s)*100}%, ${clampt(this.l)*100}%${B===1?")":`, ${B})`}`}}));function clamph(B){return B=(B||0)%360,B<0?B+360:B}function clampt(B){return Math.max(0,Math.min(1,B||0))}function hsl2rgb(B,$,q){return(B<60?$+(q-$)*B/60:B<180?q:B<240?$+(q-$)*(240-B)/60:$)*255}var constant=B=>()=>B;function linear(B,$){return function(q){return B+q*$}}function exponential(B,$,q){return B=Math.pow(B,q),$=Math.pow($,q)-B,q=1/q,function(U){return Math.pow(B+U*$,q)}}function gamma(B){return(B=+B)==1?nogamma:function($,q){return q-$?exponential($,q,B):constant(isNaN($)?q:$)}}function nogamma(B,$){var q=$-B;return q?linear(B,q):constant(isNaN(B)?$:B)}var interpolateRgb=function B($){var q=gamma($);function U(V,G){var K=q((V=rgb(V)).r,(G=rgb(G)).r),J=q(V.g,G.g),W=q(V.b,G.b),Z=nogamma(V.opacity,G.opacity);return function(Q){return V.r=K(Q),V.g=J(Q),V.b=W(Q),V.opacity=Z(Q),V+""}}return U.gamma=B,U}(1);function interpolateNumber(B,$){return B=+B,$=+$,function(q){return B*(1-q)+$*q}}var reA=/[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,reB=new RegExp(reA.source,"g");function zero(B){return function(){return B}}function one(B){return function($){return B($)+""}}function interpolateString(B,$){var q=reA.lastIndex=reB.lastIndex=0,U,V,G,K=-1,J=[],W=[];for(B=B+"",$=$+"";(U=reA.exec(B))&&(V=reB.exec($));)(G=V.index)>q&&(G=$.slice(q,G),J[K]?J[K]+=G:J[++K]=G),(U=U[0])===(V=V[0])?J[K]?J[K]+=V:J[++K]=V:(J[++K]=null,W.push({i:K,x:interpolateNumber(U,V)})),q=reB.lastIndex;return q<$.length&&(G=$.slice(q),J[K]?J[K]+=G:J[++K]=G),J.length<2?W[0]?one(W[0].x):zero($):($=W.length,function(Z){for(var Q=0,ee;Q<$;++Q)J[(ee=W[Q]).i]=ee.x(Z);return J.join("")})}var degrees=180/Math.PI,identity={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(B,$,q,U,V,G){var K,J,W;return(K=Math.sqrt(B*B+$*$))&&(B/=K,$/=K),(W=B*q+$*U)&&(q-=B*W,U-=$*W),(J=Math.sqrt(q*q+U*U))&&(q/=J,U/=J,W/=J),B*U<$*q&&(B=-B,$=-$,W=-W,K=-K),{translateX:V,translateY:G,rotate:Math.atan2($,B)*degrees,skewX:Math.atan(W)*degrees,scaleX:K,scaleY:J}}var svgNode;function parseCss(B){const $=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(B+"");return $.isIdentity?identity:decompose($.a,$.b,$.c,$.d,$.e,$.f)}function parseSvg(B){return B==null||(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",B),!(B=svgNode.transform.baseVal.consolidate()))?identity:(B=B.matrix,decompose(B.a,B.b,B.c,B.d,B.e,B.f))}function interpolateTransform(B,$,q,U){function V(Z){return Z.length?Z.pop()+" ":""}function G(Z,Q,ee,te,ne,oe){if(Z!==ee||Q!==te){var ce=ne.push("translate(",null,$,null,q);oe.push({i:ce-4,x:interpolateNumber(Z,ee)},{i:ce-2,x:interpolateNumber(Q,te)})}else(ee||te)&&ne.push("translate("+ee+$+te+q)}function K(Z,Q,ee,te){Z!==Q?(Z-Q>180?Q+=360:Q-Z>180&&(Z+=360),te.push({i:ee.push(V(ee)+"rotate(",null,U)-2,x:interpolateNumber(Z,Q)})):Q&&ee.push(V(ee)+"rotate("+Q+U)}function J(Z,Q,ee,te){Z!==Q?te.push({i:ee.push(V(ee)+"skewX(",null,U)-2,x:interpolateNumber(Z,Q)}):Q&&ee.push(V(ee)+"skewX("+Q+U)}function W(Z,Q,ee,te,ne,oe){if(Z!==ee||Q!==te){var ce=ne.push(V(ne)+"scale(",null,",",null,")");oe.push({i:ce-4,x:interpolateNumber(Z,ee)},{i:ce-2,x:interpolateNumber(Q,te)})}else(ee!==1||te!==1)&&ne.push(V(ne)+"scale("+ee+","+te+")")}return function(Z,Q){var ee=[],te=[];return Z=B(Z),Q=B(Q),G(Z.translateX,Z.translateY,Q.translateX,Q.translateY,ee,te),K(Z.rotate,Q.rotate,ee,te),J(Z.skewX,Q.skewX,ee,te),W(Z.scaleX,Z.scaleY,Q.scaleX,Q.scaleY,ee,te),Z=Q=null,function(ne){for(var oe=-1,ce=te.length,le;++oe<ce;)ee[(le=te[oe]).i]=le.x(ne);return ee.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")"),frame=0,timeout$1=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=typeof performance=="object"&&performance.now?performance:Date,setFrame=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(B){setTimeout(B,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}Timer.prototype=timer.prototype={constructor:Timer,restart:function(B,$,q){if(typeof B!="function")throw new TypeError("callback is not a function");q=(q==null?now():+q)+($==null?0:+$),!this._next&&taskTail!==this&&(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=B,this._time=q,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};function timer(B,$,q){var U=new Timer;return U.restart(B,$,q),U}function timerFlush(){now(),++frame;for(var B=taskHead,$;B;)($=clockNow-B._time)>=0&&B._call.call(void 0,$),B=B._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout$1=0;try{timerFlush()}finally{frame=0,nap(),clockNow=0}}function poke(){var B=clock.now(),$=B-clockLast;$>pokeDelay&&(clockSkew-=$,clockLast=B)}function nap(){for(var B,$=taskHead,q,U=1/0;$;)$._call?(U>$._time&&(U=$._time),B=$,$=$._next):(q=$._next,$._next=null,$=B?B._next=q:taskHead=q);taskTail=B,sleep(U)}function sleep(B){if(!frame){timeout$1&&(timeout$1=clearTimeout(timeout$1));var $=B-clockNow;$>24?(B<1/0&&(timeout$1=setTimeout(wake,B-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),frame=1,setFrame(wake))}}function timeout(B,$,q){var U=new Timer;return $=$==null?0:+$,U.restart(V=>{U.stop(),B(V+$)},$,q),U}var emptyOn=dispatch("start","end","cancel","interrupt"),emptyTween=[],CREATED=0,SCHEDULED=1,STARTING=2,STARTED=3,RUNNING=4,ENDING=5,ENDED=6;function schedule(B,$,q,U,V,G){var K=B.__transition;if(!K)B.__transition={};else if(q in K)return;create(B,q,{name:$,index:U,group:V,on:emptyOn,tween:emptyTween,time:G.time,delay:G.delay,duration:G.duration,ease:G.ease,timer:null,state:CREATED})}function init(B,$){var q=get(B,$);if(q.state>CREATED)throw new Error("too late; already scheduled");return q}function set(B,$){var q=get(B,$);if(q.state>STARTED)throw new Error("too late; already running");return q}function get(B,$){var q=B.__transition;if(!q||!(q=q[$]))throw new Error("transition not found");return q}function create(B,$,q){var U=B.__transition,V;U[$]=q,q.timer=timer(G,0,q.time);function G(Z){q.state=SCHEDULED,q.timer.restart(K,q.delay,q.time),q.delay<=Z&&K(Z-q.delay)}function K(Z){var Q,ee,te,ne;if(q.state!==SCHEDULED)return W();for(Q in U)if(ne=U[Q],ne.name===q.name){if(ne.state===STARTED)return timeout(K);ne.state===RUNNING?(ne.state=ENDED,ne.timer.stop(),ne.on.call("interrupt",B,B.__data__,ne.index,ne.group),delete U[Q]):+Q<$&&(ne.state=ENDED,ne.timer.stop(),ne.on.call("cancel",B,B.__data__,ne.index,ne.group),delete U[Q])}if(timeout(function(){q.state===STARTED&&(q.state=RUNNING,q.timer.restart(J,q.delay,q.time),J(Z))}),q.state=STARTING,q.on.call("start",B,B.__data__,q.index,q.group),q.state===STARTING){for(q.state=STARTED,V=new Array(te=q.tween.length),Q=0,ee=-1;Q<te;++Q)(ne=q.tween[Q].value.call(B,B.__data__,q.index,q.group))&&(V[++ee]=ne);V.length=ee+1}}function J(Z){for(var Q=Z<q.duration?q.ease.call(null,Z/q.duration):(q.timer.restart(W),q.state=ENDING,1),ee=-1,te=V.length;++ee<te;)V[ee].call(B,Q);q.state===ENDING&&(q.on.call("end",B,B.__data__,q.index,q.group),W())}function W(){q.state=ENDED,q.timer.stop(),delete U[$];for(var Z in U)return;delete B.__transition}}function interrupt(B,$){var q=B.__transition,U,V,G=!0,K;if(q){$=$==null?null:$+"";for(K in q){if((U=q[K]).name!==$){G=!1;continue}V=U.state>STARTING&&U.state<ENDING,U.state=ENDED,U.timer.stop(),U.on.call(V?"interrupt":"cancel",B,B.__data__,U.index,U.group),delete q[K]}G&&delete B.__transition}}function selection_interrupt(B){return this.each(function(){interrupt(this,B)})}function tweenRemove(B,$){var q,U;return function(){var V=set(this,B),G=V.tween;if(G!==q){U=q=G;for(var K=0,J=U.length;K<J;++K)if(U[K].name===$){U=U.slice(),U.splice(K,1);break}}V.tween=U}}function tweenFunction(B,$,q){var U,V;if(typeof q!="function")throw new Error;return function(){var G=set(this,B),K=G.tween;if(K!==U){V=(U=K).slice();for(var J={name:$,value:q},W=0,Z=V.length;W<Z;++W)if(V[W].name===$){V[W]=J;break}W===Z&&V.push(J)}G.tween=V}}function transition_tween(B,$){var q=this._id;if(B+="",arguments.length<2){for(var U=get(this.node(),q).tween,V=0,G=U.length,K;V<G;++V)if((K=U[V]).name===B)return K.value;return null}return this.each(($==null?tweenRemove:tweenFunction)(q,B,$))}function tweenValue(B,$,q){var U=B._id;return B.each(function(){var V=set(this,U);(V.value||(V.value={}))[$]=q.apply(this,arguments)}),function(V){return get(V,U).value[$]}}function interpolate(B,$){var q;return(typeof $=="number"?interpolateNumber:$ instanceof color?interpolateRgb:(q=color($))?($=q,interpolateRgb):interpolateString)(B,$)}function attrRemove(B){return function(){this.removeAttribute(B)}}function attrRemoveNS(B){return function(){this.removeAttributeNS(B.space,B.local)}}function attrConstant(B,$,q){var U,V=q+"",G;return function(){var K=this.getAttribute(B);return K===V?null:K===U?G:G=$(U=K,q)}}function attrConstantNS(B,$,q){var U,V=q+"",G;return function(){var K=this.getAttributeNS(B.space,B.local);return K===V?null:K===U?G:G=$(U=K,q)}}function attrFunction(B,$,q){var U,V,G;return function(){var K,J=q(this),W;return J==null?void this.removeAttribute(B):(K=this.getAttribute(B),W=J+"",K===W?null:K===U&&W===V?G:(V=W,G=$(U=K,J)))}}function attrFunctionNS(B,$,q){var U,V,G;return function(){var K,J=q(this),W;return J==null?void this.removeAttributeNS(B.space,B.local):(K=this.getAttributeNS(B.space,B.local),W=J+"",K===W?null:K===U&&W===V?G:(V=W,G=$(U=K,J)))}}function transition_attr(B,$){var q=namespace(B),U=q==="transform"?interpolateTransformSvg:interpolate;return this.attrTween(B,typeof $=="function"?(q.local?attrFunctionNS:attrFunction)(q,U,tweenValue(this,"attr."+B,$)):$==null?(q.local?attrRemoveNS:attrRemove)(q):(q.local?attrConstantNS:attrConstant)(q,U,$))}function attrInterpolate(B,$){return function(q){this.setAttribute(B,$.call(this,q))}}function attrInterpolateNS(B,$){return function(q){this.setAttributeNS(B.space,B.local,$.call(this,q))}}function attrTweenNS(B,$){var q,U;function V(){var G=$.apply(this,arguments);return G!==U&&(q=(U=G)&&attrInterpolateNS(B,G)),q}return V._value=$,V}function attrTween(B,$){var q,U;function V(){var G=$.apply(this,arguments);return G!==U&&(q=(U=G)&&attrInterpolate(B,G)),q}return V._value=$,V}function transition_attrTween(B,$){var q="attr."+B;if(arguments.length<2)return(q=this.tween(q))&&q._value;if($==null)return this.tween(q,null);if(typeof $!="function")throw new Error;var U=namespace(B);return this.tween(q,(U.local?attrTweenNS:attrTween)(U,$))}function delayFunction(B,$){return function(){init(this,B).delay=+$.apply(this,arguments)}}function delayConstant(B,$){return $=+$,function(){init(this,B).delay=$}}function transition_delay(B){var $=this._id;return arguments.length?this.each((typeof B=="function"?delayFunction:delayConstant)($,B)):get(this.node(),$).delay}function durationFunction(B,$){return function(){set(this,B).duration=+$.apply(this,arguments)}}function durationConstant(B,$){return $=+$,function(){set(this,B).duration=$}}function transition_duration(B){var $=this._id;return arguments.length?this.each((typeof B=="function"?durationFunction:durationConstant)($,B)):get(this.node(),$).duration}function easeConstant(B,$){if(typeof $!="function")throw new Error;return function(){set(this,B).ease=$}}function transition_ease(B){var $=this._id;return arguments.length?this.each(easeConstant($,B)):get(this.node(),$).ease}function easeVarying(B,$){return function(){var q=$.apply(this,arguments);if(typeof q!="function")throw new Error;set(this,B).ease=q}}function transition_easeVarying(B){if(typeof B!="function")throw new Error;return this.each(easeVarying(this._id,B))}function transition_filter(B){typeof B!="function"&&(B=matcher(B));for(var $=this._groups,q=$.length,U=new Array(q),V=0;V<q;++V)for(var G=$[V],K=G.length,J=U[V]=[],W,Z=0;Z<K;++Z)(W=G[Z])&&B.call(W,W.__data__,Z,G)&&J.push(W);return new Transition(U,this._parents,this._name,this._id)}function transition_merge(B){if(B._id!==this._id)throw new Error;for(var $=this._groups,q=B._groups,U=$.length,V=q.length,G=Math.min(U,V),K=new Array(U),J=0;J<G;++J)for(var W=$[J],Z=q[J],Q=W.length,ee=K[J]=new Array(Q),te,ne=0;ne<Q;++ne)(te=W[ne]||Z[ne])&&(ee[ne]=te);for(;J<U;++J)K[J]=$[J];return new Transition(K,this._parents,this._name,this._id)}function start(B){return(B+"").trim().split(/^|\\s+/).every(function($){var q=$.indexOf(".");return q>=0&&($=$.slice(0,q)),!$||$==="start"})}function onFunction(B,$,q){var U,V,G=start($)?init:set;return function(){var K=G(this,B),J=K.on;J!==U&&(V=(U=J).copy()).on($,q),K.on=V}}function transition_on(B,$){var q=this._id;return arguments.length<2?get(this.node(),q).on.on(B):this.each(onFunction(q,B,$))}function removeFunction(B){return function(){var $=this.parentNode;for(var q in this.__transition)if(+q!==B)return;$&&$.removeChild(this)}}function transition_remove(){return this.on("end.remove",removeFunction(this._id))}function transition_select(B){var $=this._name,q=this._id;typeof B!="function"&&(B=selector(B));for(var U=this._groups,V=U.length,G=new Array(V),K=0;K<V;++K)for(var J=U[K],W=J.length,Z=G[K]=new Array(W),Q,ee,te=0;te<W;++te)(Q=J[te])&&(ee=B.call(Q,Q.__data__,te,J))&&("__data__"in Q&&(ee.__data__=Q.__data__),Z[te]=ee,schedule(Z[te],$,q,te,Z,get(Q,q)));return new Transition(G,this._parents,$,q)}function transition_selectAll(B){var $=this._name,q=this._id;typeof B!="function"&&(B=selectorAll(B));for(var U=this._groups,V=U.length,G=[],K=[],J=0;J<V;++J)for(var W=U[J],Z=W.length,Q,ee=0;ee<Z;++ee)if(Q=W[ee]){for(var te=B.call(Q,Q.__data__,ee,W),ne,oe=get(Q,q),ce=0,le=te.length;ce<le;++ce)(ne=te[ce])&&schedule(ne,$,q,ce,te,oe);G.push(te),K.push(Q)}return new Transition(G,K,$,q)}var Selection=selection.prototype.constructor;function transition_selection(){return new Selection(this._groups,this._parents)}function styleNull(B,$){var q,U,V;return function(){var G=styleValue(this,B),K=(this.style.removeProperty(B),styleValue(this,B));return G===K?null:G===q&&K===U?V:V=$(q=G,U=K)}}function styleRemove(B){return function(){this.style.removeProperty(B)}}function styleConstant(B,$,q){var U,V=q+"",G;return function(){var K=styleValue(this,B);return K===V?null:K===U?G:G=$(U=K,q)}}function styleFunction(B,$,q){var U,V,G;return function(){var K=styleValue(this,B),J=q(this),W=J+"";return J==null&&(W=J=(this.style.removeProperty(B),styleValue(this,B))),K===W?null:K===U&&W===V?G:(V=W,G=$(U=K,J))}}function styleMaybeRemove(B,$){var q,U,V,G="style."+$,K="end."+G,J;return function(){var W=set(this,B),Z=W.on,Q=W.value[G]==null?J||(J=styleRemove($)):void 0;(Z!==q||V!==Q)&&(U=(q=Z).copy()).on(K,V=Q),W.on=U}}function transition_style(B,$,q){var U=(B+="")=="transform"?interpolateTransformCss:interpolate;return $==null?this.styleTween(B,styleNull(B,U)).on("end.style."+B,styleRemove(B)):typeof $=="function"?this.styleTween(B,styleFunction(B,U,tweenValue(this,"style."+B,$))).each(styleMaybeRemove(this._id,B)):this.styleTween(B,styleConstant(B,U,$),q).on("end.style."+B,null)}function styleInterpolate(B,$,q){return function(U){this.style.setProperty(B,$.call(this,U),q)}}function styleTween(B,$,q){var U,V;function G(){var K=$.apply(this,arguments);return K!==V&&(U=(V=K)&&styleInterpolate(B,K,q)),U}return G._value=$,G}function transition_styleTween(B,$,q){var U="style."+(B+="");if(arguments.length<2)return(U=this.tween(U))&&U._value;if($==null)return this.tween(U,null);if(typeof $!="function")throw new Error;return this.tween(U,styleTween(B,$,q==null?"":q))}function textConstant(B){return function(){this.textContent=B}}function textFunction(B){return function(){var $=B(this);this.textContent=$==null?"":$}}function transition_text(B){return this.tween("text",typeof B=="function"?textFunction(tweenValue(this,"text",B)):textConstant(B==null?"":B+""))}function textInterpolate(B){return function($){this.textContent=B.call(this,$)}}function textTween(B){var $,q;function U(){var V=B.apply(this,arguments);return V!==q&&($=(q=V)&&textInterpolate(V)),$}return U._value=B,U}function transition_textTween(B){var $="text";if(arguments.length<1)return($=this.tween($))&&$._value;if(B==null)return this.tween($,null);if(typeof B!="function")throw new Error;return this.tween($,textTween(B))}function transition_transition(){for(var B=this._name,$=this._id,q=newId(),U=this._groups,V=U.length,G=0;G<V;++G)for(var K=U[G],J=K.length,W,Z=0;Z<J;++Z)if(W=K[Z]){var Q=get(W,$);schedule(W,B,q,Z,K,{time:Q.time+Q.delay+Q.duration,delay:0,duration:Q.duration,ease:Q.ease})}return new Transition(U,this._parents,B,q)}function transition_end(){var B,$,q=this,U=q._id,V=q.size();return new Promise(function(G,K){var J={value:K},W={value:function(){--V===0&&G()}};q.each(function(){var Z=set(this,U),Q=Z.on;Q!==B&&($=(B=Q).copy(),$._.cancel.push(J),$._.interrupt.push(J),$._.end.push(W)),Z.on=$}),V===0&&G()})}var id=0;function Transition(B,$,q,U){this._groups=B,this._parents=$,this._name=q,this._id=U}function newId(){return++id}var selection_prototype=selection.prototype;Transition.prototype={constructor:Transition,select:transition_select,selectAll:transition_selectAll,selectChild:selection_prototype.selectChild,selectChildren:selection_prototype.selectChildren,filter:transition_filter,merge:transition_merge,selection:transition_selection,transition:transition_transition,call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:transition_on,attr:transition_attr,attrTween:transition_attrTween,style:transition_style,styleTween:transition_styleTween,text:transition_text,textTween:transition_textTween,remove:transition_remove,tween:transition_tween,delay:transition_delay,duration:transition_duration,ease:transition_ease,easeVarying:transition_easeVarying,end:transition_end,[Symbol.iterator]:selection_prototype[Symbol.iterator]};function cubicInOut(B){return((B*=2)<=1?B*B*B:(B-=2)*B*B+2)/2}var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function inherit(B,$){for(var q;!(q=B.__transition)||!(q=q[$]);)if(!(B=B.parentNode))throw new Error(`transition ${$} not found`);return q}function selection_transition(B){var $,q;B instanceof Transition?($=B._id,B=B._name):($=newId(),(q=defaultTiming).time=now(),B=B==null?null:B+"");for(var U=this._groups,V=U.length,G=0;G<V;++G)for(var K=U[G],J=K.length,W,Z=0;Z<J;++Z)(W=K[Z])&&schedule(W,B,$,Z,K,q||inherit(W,$));return new Transition(U,this._parents,B,$)}selection.prototype.interrupt=selection_interrupt,selection.prototype.transition=selection_transition;function Transform(B,$,q){this.k=B,this.x=$,this.y=q}Transform.prototype={constructor:Transform,scale:function(B){return B===1?this:new Transform(this.k*B,this.x,this.y)},translate:function(B,$){return B===0&$===0?this:new Transform(this.k,this.x+this.k*B,this.y+this.k*$)},apply:function(B){return[B[0]*this.k+this.x,B[1]*this.k+this.y]},applyX:function(B){return B*this.k+this.x},applyY:function(B){return B*this.k+this.y},invert:function(B){return[(B[0]-this.x)/this.k,(B[1]-this.y)/this.k]},invertX:function(B){return(B-this.x)/this.k},invertY:function(B){return(B-this.y)/this.k},rescaleX:function(B){return B.copy().domain(B.range().map(this.invertX,this).map(B.invert,B))},rescaleY:function(B){return B.copy().domain(B.range().map(this.invertY,this).map(B.invert,B))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},Transform.prototype;var m$a=Object.defineProperty,g$7=Object.getOwnPropertySymbols,p$7=Object.prototype.hasOwnProperty,x$1=Object.prototype.propertyIsEnumerable,u$8=(B,$,q)=>$ in B?m$a(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,l$a=(B,$)=>{for(var q in $||($={}))p$7.call($,q)&&u$8(B,q,$[q]);if(g$7)for(var q of g$7($))x$1.call($,q)&&u$8(B,q,$[q]);return B},w$3=(B,$,q)=>u$8(B,typeof $!="symbol"?$+"":$,q),d$3=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});const c$5=class Le{constructor(){w$3(this,"_canvasMap",new QuickLRU({maxSize:20,maxAge:1e3*60*5}))}static create(){return Le._instance||(Le._instance=new Le),Le._instance}getDataURL($,q){return d$3(this,null,function*(){if(!($.width===0||$.height===0))try{const U=yield createImageBitmap($);if(U.width===0||U.height===0){U.close();return}const V=this._getOffscreenCanvas(U),G=V.getContext("bitmaprenderer");if(!G){U.close();return}G.transferFromImageBitmap(U);const K=yield V.convertToBlob(l$a({type:"image/png",quality:.6},q));return yield this._blobToDataURL(K)}catch(U){}})}_getOffscreenCanvas($){const q=`${$.width}x${$.height}`;let U=this._canvasMap.get(q);return U||(U=new OffscreenCanvas($.width,$.height),this._canvasMap.set(q,U)),U}_blobToDataURL($){return d$3(this,null,function*(){return new Promise((q,U)=>{const V=new FileReader;V.onload=()=>q(V.result),V.onerror=U,V.readAsDataURL($)})})}};w$3(c$5,"_instance");function f$3(B){return new DOMMatrix(B)}function b$2(B){return B!=null&&B.CANVAS_OBSERVER_PROXIED_PATH2D===!0}var h$6=Object.defineProperty,u$7=(B,$,q)=>$ in B?h$6(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,c$4=(B,$,q)=>u$7(B,$+"",q),g$6=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let p$6=class{constructor(){c$4(this,"_imageCache",new QuickLRU({maxSize:1e3,maxAge:2e4}))}deserialize($){return g$6(this,null,function*(){if($==null)return;const q=this._imageCache.get($);if(q!=null)return q;if(n$4())try{const U=yield(yield fetch($)).blob(),V=yield createImageBitmap(U);return this._imageCache.set($,V),V}catch(U){return}else return new Promise((U,V)=>{try{const G=new Image;G.onload=()=>{this._imageCache.set($,G),U(G)},G.onerror=V,G.src=$}catch(G){V()}})})}};const C$1=new p$6;var m$9=Object.defineProperty,p$5=(B,$,q)=>$ in B?m$9(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,l$9=(B,$,q)=>p$5(B,$+"",q),u$6=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});class j{constructor($){l$9(this,"_canvas"),this._canvas=$}decode($){return u$6(this,null,function*(){const{api:q,args:U}=$,V=n$5(q),G=V==="setAttr"?yield this._decodeAttr(U):this._decodeArgs(U);if(V==="stroke"&&G.length&&!b$2(G[0]))throw new Error("argument type invalid, Path2D is not ProxyPath2D");return{api:V,args:G||[]}})}_decodeAttr($){return u$6(this,null,function*(){const q=[];let U=0;for(;U<$.length-1;){const V=$[U],G=$[U+1];(G==null?void 0:G.type)==="ProxyLinearGradient"?q.push({key:r$6(V),value:_$2(G.value,this._canvas)}):(G==null?void 0:G.type)==="ProxyPattern"?q.push({key:r$6(V),value:yield v(G.value,this._canvas)}):q.push({key:r$6(V),value:G}),U+=2}return q})}_decodeArgs($){return s$2($)?$.map(q=>D$1(q)?new t$1.Path2D(q.value):q):$}}function D$1(B){return(B==null?void 0:B.type)==="Path2D"}function _$2(B,$){const q=$.getContext("2d");if(!q)return null;const U=B[0],V=q.createLinearGradient(U[0],U[1],U[2],U[3]);for(let G=1;G<B.length;G++){const K=B[G];V.addColorStop(K[0],K[1])}return V}function v(B,$){return u$6(this,null,function*(){var q,U;const V=$.getContext("2d");if(!V)return null;const G=(q=B[0])!=null?q:[],K=yield C$1.deserialize((U=G[0])==null?void 0:U.src);if(!K)return;const J=V.createPattern(K,G[1]);if(J)for(let W=1;W<B.length;W++){const Z=B[W];Z&&J.setTransform(f$3(Z))}return J})}var _$1=Object.defineProperty,m$8=(B,$,q)=>$ in B?_$1(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,l$8=(B,$,q)=>m$8(B,typeof $!="symbol"?$+"":$,q),d$2=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let z$1=class{constructor($){l$8(this,"_canvas"),l$8(this,"_isOffscreenCanvas",!1),l$8(this,"_decoder"),l$8(this,"_prevApi"),l$8(this,"_instructions",[]),l$8(this,"_executePromise",null),this._canvas=$,this._isOffscreenCanvas=$ instanceof OffscreenCanvas,this._decoder=new j($)}execute($){$.length>0&&(this._instructions.length===0?(this._instructions.push(...$),this._execute()):this._instructions.push(...$))}_execute(){return d$2(this,null,function*(){for(;this._instructions.length;){const $=this._instructions.shift();if(g$5($)){const q=$;if(this._instructions.length>0&&u$5(this._instructions[0])){const U=this._instructions.shift();yield this.executeOne({api:q,args:U}),this._executePromise=null}else yield this.executeOne({api:q,args:[]}),this._executePromise=null;this._prevApi=q}else u$5($)&&this._prevApi!=null?(yield this.executeOne({api:this._prevApi,args:$}),this._executePromise=null):console.log("sth error")}})}executeOne($){return d$2(this,null,function*(){return this._executePromise=new Promise((q,U)=>d$2(this,null,function*(){var V;const G=this._canvas.getContext("2d");if(G==null){U(-1);return}try{const{api:K,args:J}=yield this._decoder.decode($);if(!(K!=null&&K.length))console.log("invalid api"),q(-1);else if(K==="setAttr"){for(let W=0;W<J.length;W++){const{key:Z,value:Q}=J[W];G[Z]=Q}q(1)}else if(K==="snapshot")C$1.deserialize(J).then(W=>{G.drawImage(W,0,0),q(1)});else if(K==="lineTo"){let W=0;for(;W<J.length-1;){const Z=J[W],Q=J[W+1];G[K].apply(G,[Z,Q]),W+=2}q(1)}else K==="drawImage"&&Array.isArray(J)&&(V=J[0])!=null&&V.src?C$1.deserialize(J[0].src).then(W=>{J[0].__drawFullPage&&G.clearRect(0,0,this._canvas.width,this._canvas.height),G.drawImage(W,...J.slice(1)),q(1)}):(i$2(K)&&G[K].apply(G,[...J]),q(1))}catch(K){console.error("[bytereplay] Execute canvas command error",K,{instruction:$}),localStorage&&localStorage.bytereplay_debug&&console.error("[bytereplay] Execute canvas command error",K,{instruction:$}),q(-1)}})),this._executePromise})}snapshot(){return d$2(this,null,function*(){if(this._isOffscreenCanvas){const $=yield this._canvas.convertToBlob({type:"image/png",quality:.6});return yield new Promise(q=>{const U=new FileReader;U.addEventListener("load",()=>q(U.result)),U.readAsDataURL($)})}else return this._canvas.toDataURL("image/png",.6)})}decode($){return d$2(this,null,function*(){const q=[];if(!($!=null&&$.length)||!this._decoder)return q;const U=[...$];for(;U.length;){const V=U.shift();if(g$5(V)){const G=V;if(U.length>0&&u$5(U[0])){const K=U.shift();q.push(yield this._decoder.decode({api:G,args:K}))}else q.push(yield this._decoder.decode({api:G,args:[]}));this._prevApi=G}else u$5(V)&&this._prevApi!=null?q.push(yield this._decoder.decode({api:this._prevApi,args:V})):console.log("sth error")}return q})}};function g$5(B){return typeof B=="string"||typeof B=="undefined"?!1:n$5(B)!=null}function u$5(B){return!!(typeof B=="object"||typeof B=="string"&&B.startsWith("data:"))}function T(B,$,q){B&&$&&($.autoplay!==void 0&&(B.autoplay=$.autoplay),$.controls!==void 0&&(B.controls=$.controls),$.loop!==void 0&&(B.loop=$.loop),$.playbackRate!==void 0&&(B.playbackRate=$.playbackRate),$.muted!==void 0&&(B.muted=$.muted),$.volume!==void 0&&(B.volume=$.volume),$.currentTime!==void 0&&(B.paused||Math.abs(B.currentTime-$.currentTime)>1)&&(B.currentTime=$.currentTime),$.paused!==void 0&&($.paused?B.paused||B.pause():B.paused&&B.play().catch(U=>{q&&q(U)})))}function r$4(B,$){if(B&&$&&B.extra){const q=B.extra;$.autoplay!==void 0&&(q.autoplay=$.autoplay),$.controls!==void 0&&(q.controls=$.controls),$.loop!==void 0&&(q.loop=$.loop),$.playbackRate!==void 0&&(q.playbackRate=$.playbackRate),$.muted!==void 0&&(q.muted=$.muted),$.volume!==void 0&&(q.volume=$.volume),$.currentTime!==void 0&&(q.currentTime=$.currentTime),$.paused!==void 0&&(q.paused=$.paused),$.meta!==void 0&&(q.meta=$.meta)}}const l$7={0:"insertRule",1:"deleteRule",2:"replace",3:"replaceSync",4:"addRule",5:"removeRule"};function r$3(B){return l$7[B]}let n$3=class extends z$3{constructor($,q){super($,q),this.name="SnapshotError"}};class t extends n$3{constructor($,q){super($,q),this.name="RenderingError"}}var l$6=(B=>(B.VanillaDOM="VanillaDOM",B.VirtualDOM="VirtualDOM",B))(l$6||{}),c$3=Object.defineProperty,u$4=(B,$,q)=>$ in B?c$3(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,y$3=(B,$,q)=>u$4(B,typeof $!="symbol"?$+"":$,q);const a$2=class De{constructor(){y$3(this,"tag","CANVAS")}static registerPlayer($,q,U,V){const G={player:new z$1(U),order:V},K=De.players.get(`${$}/${q}`);K?K.order<G.order&&De.players.set(`${$}/${q}`,G):De.players.set(`${$}/${q}`,G)}static resolvePlayer($,q,U){const V=De.players.get(`${$}/${q}`);if(V&&V.order<=U)return V.player}static removePlayer($,q){De.players.delete(`${$}/${q}`)}static resetPlayer($){const q=De.players.keys();Array.from(q).forEach(U=>{U.startsWith($)&&De.players.delete(U)})}onRender($,q){var U,V,G;const K=(U=q.extra)==null?void 0:U.image;if(!K)return;const J=this.getPerformOrder($);if($.isVanilla()){const W=$.getNode(q.id),Z=W.getContext("2d");$.enqueueConcurrentTask(new Promise(Q=>{const ee=new Image;ee.onload=()=>{Z==null||Z.drawImage(ee,0,0,ee.width,ee.height),Q({element:W,failed:!1,timeout:!1})},ee.onerror=()=>{Q({element:W,failed:!0,timeout:!1})},ee.src=K})),De.registerPlayer($.snapshotId,q.id,W,J)}else{const W=new OffscreenCanvas(parseFloat(((V=q.attrs)==null?void 0:V.width)||"300")||300,parseFloat(((G=q.attrs)==null?void 0:G.height)||"150")||150);De.registerPlayer($.snapshotId,q.id,W,J)}}onRemove($,q){De.removePlayer($.snapshotId,q)}performEvent($,q){if(q.eventType===R$4.HTMLCanvas){const{target:U,data:V}=q.data,G=this.getPerformOrder($),K=De.resolvePlayer($.snapshotId,U,G);K&&K.execute(V)}}onReset($){De.resetPlayer($.snapshotId)}onCapture($,q){if($.isVirtual()){const U=$.getNode(q);if(U&&U.tag===this.tag){const V=this.getPerformOrder($),G=De.resolvePlayer($.snapshotId,q,V);G&&$.enqueueConcurrentTask(new Promise((K,J)=>{G.snapshot().then(W=>{U.extra={image:W},K({element:void 0,failed:!1,timeout:!1})}).catch(()=>{J({element:void 0,failed:!0,timeout:!1})})}))}}}getPerformOrder($){return $.mode===l$6.VanillaDOM?2:$.isIncremental?0:1}};y$3(a$2,"players",new Map);let g$4=a$2;var f$2=Object.defineProperty,l$5=Object.defineProperties,E$1=Object.getOwnPropertyDescriptors,n$2=Object.getOwnPropertySymbols,h$5=Object.prototype.hasOwnProperty,d$1=Object.prototype.propertyIsEnumerable,a$1=(B,$,q)=>$ in B?f$2(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,g$3=(B,$)=>{for(var q in $||($={}))h$5.call($,q)&&a$1(B,q,$[q]);if(n$2)for(var q of n$2($))d$1.call($,q)&&a$1(B,q,$[q]);return B},p$4=(B,$)=>l$5(B,E$1($));let c$2=class{constructor($){this.options=$}get tag(){return"IMAGE"}onRender($,q,U){$.isVanilla()&&this._triggerEvent(U,q.extra)}performEvent($,q){if(q.eventType===R$4.HTMLImage){const{target:U,data:V}=q.data;if($.isVanilla())this._triggerEvent($.getNode(U),V);else{const G=$.getNode(U);G&&(G.extra=p$4(g$3({},G==null?void 0:G.extra),{status:V.status}))}}}onRemove(){}_triggerEvent($,q){var U,V;(U=this.options)!=null&&U.onError&&(q==null?void 0:q.status)==="failed"&&this.options.onError($),(V=this.options)!=null&&V.onLoad&&q.status==="loaded"&&this.options.onLoad($)}};var s$1=Object.defineProperty,h$4=(B,$,q)=>$ in B?s$1(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,i$1=(B,$,q)=>h$4(B,$+"",q);let p$3=class{constructor($){i$1(this,"_options"),this._options=$}get tag(){return"LINK"}onRender($,q,U){if($.isVanilla()){const V=U;(V.as==="script"||V.rel==="dns-prefetch"||V.rel==="preconnect")&&(V.setAttribute("data-bytereplay-href",V.href),V.href="#"),this._triggerEvent(U)}}onRemove(){}performEvent(){}_triggerEvent($){var q;(q=this._options)!=null&&q.onLoad&&$.hasAttribute("href")&&$.href!=="#"&&this._options.onLoad($)}};function u$3(B,$=0){return new Promise(q=>{setTimeout(()=>{const U=B();q(U)},$)})}var r$2=Object.defineProperty,h$3=(B,$,q)=>$ in B?r$2(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,e=(B,$,q)=>h$3(B,$+"",q);let u$2=class{constructor(){e(this,"_tasks",[])}enqueue($){this._tasks.push($)}clear(){this._tasks.splice(0,this._tasks.length)}toArray(){return[...this._tasks]}};var o$2=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let m$7=class extends u$2{execute(){return o$2(this,null,function*(){const $=this.toArray();this.clear(),yield Promise.all($)})}};var k$1=Object.defineProperty,l$4=(B,$,q)=>$ in B?k$1(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,o$1=(B,$,q)=>l$4(B,$+"",q),r$1=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let m$6=class extends u$2{constructor(){super(...arguments),o$1(this,"_chain",Promise.resolve())}execute(){return r$1(this,null,function*(){const $=this.toArray();return this.clear(),this._chain=this._chain.then(()=>r$1(this,null,function*(){for(const q of $)yield q()})),this._chain})}};var a=Object.defineProperty,r=(B,$,q)=>$ in B?a(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,m$5=(B,$,q)=>r(B,$+"",q);class o extends EventEmitter{constructor(){super(...arguments),m$5(this,"_map",new Map)}reset(){this._map.clear(),this.emit("nodeReset")}has($){return this._map.has($)}getNode($){return this._map.get($)}addNode($,q){this._map.set($,q),q&&this.emit("nodeAdded",q,$)}keys(){return this._map.keys()}size(){return this._map.size}removeNode($){const q=this._map.get($);this._map.delete($),q&&this.emit("nodeRemoved",q,$)}}var l$3=Object.defineProperty,m$4=(B,$,q)=>$ in B?l$3(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,i=(B,$,q)=>m$4(B,typeof $!="symbol"?$+"":$,q),h$2=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let w$2=class{constructor($){i(this,"_map",new o),i(this,"_nodeRenderers",new Map),i(this,"_concurrentQueue",new m$7),i(this,"_sequentialQueue",new m$6),i(this,"_snapshotId"),i(this,"_isIncremental",!1),this.mode=$}get nodes(){return this._map}get snapshotId(){return this._snapshotId?`${this.mode}/${this._snapshotId}`:this.mode}setSnapshotId($){this._snapshotId=$}get isIncremental(){return this._isIncremental}setIncremental($){this._isIncremental=$}setNodes($){this._map=$}getNode($){return this._map.getNode($)}registerNodeRenderer($){this._nodeRenderers.set($.tag,$)}onNodeRender($,q){const U=this._nodeRenderers.get($.tag);try{U&&U.onRender(this,$,q)}catch(V){console.error(V)}}onNodeRemove($){const q=this.nodes.getNode($);if(!q)return;let U;this.isVanilla()?U=this._nodeRenderers.get(q.tagName):U=this._nodeRenderers.get(q.tag);try{U&&U.onRemove(this,$)}catch(V){console.error(V)}}onPatch($,q,U){if($==="attrs")Reflect.set(q,$,Object.assign({},q[$],U[$]));else if($==="extra"){const V=this._nodeRenderers.get(q.tag);V&&V.onPatchExtra&&V.onPatchExtra(q,U)}}performEvent($){this._nodeRenderers.forEach(q=>{q.performEvent(this,$)})}enqueueConcurrentTask($){this._concurrentQueue.enqueue($)}enqueueSequentialTask($){this._sequentialQueue.enqueue($)}executeQueuedTasks(){return h$2(this,null,function*(){yield this._concurrentQueue.execute(),yield this._sequentialQueue.execute()})}capture(){var $;for(const q of this._map.keys())for(const U of this._nodeRenderers.values())($=U.onCapture)==null||$.call(U,this,q)}reset(){this._snapshotId&&this._nodeRenderers.forEach($=>{var q;(q=$.onReset)==null||q.call($,this)}),this._map.reset(),this._concurrentQueue.clear(),this._sequentialQueue.clear()}isVanilla(){return this.mode===l$6.VanillaDOM}isVirtual(){return this.mode===l$6.VirtualDOM}};var R$3=Object.defineProperty,E=Object.defineProperties,k=Object.getOwnPropertyDescriptors,p$2=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,I$1=(B,$,q)=>$ in B?R$3(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,f$1=(B,$)=>{for(var q in $||($={}))F.call($,q)&&I$1(B,q,$[q]);if(p$2)for(var q of p$2($))L.call($,q)&&I$1(B,q,$[q]);return B},l$2=(B,$)=>E(B,k($)),u$1=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});class S{get tag(){return"IFRAME"}performEvent($,q){if(q.eventType===R$4.HTMLIFrame)if($.isVanilla()){const U=$.getNode(q.data.target);U&&$.enqueueSequentialTask(()=>u$1(this,null,function*(){U.dispatchEvent(n$b(q.data.action))}))}else{const{target:U,action:V}=q.data,G=$.getNode(U);if(!G)throw new t(`Node with ID \'${U}\' not found.`);const K=G.extra||{state:o$6.Loaded};switch(V.type){case o$7.Load:K.state=o$6.Loaded,K.recordings=void 0;break;case o$7.Unload:K.state=o$6.Loading,K.recordings=void 0;break;case o$7.StartRecording:K.state=o$6.Recording,K.recordings=l$2(f$1({},K.recordings),{[V.data.parentId]:V.data.recording});break;case o$7.StopRecording:K.state=o$6.Loaded,K.recordings&&delete K.recordings[V.data.parentId];break}G.extra=K}}onRender(){}onRemove(){}}var m$3=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});let R$2=class{get tag(){return"STYLE"}onRender($,q){var U;if($.isVanilla()){const V=$.getNode(q.id);if(P$1(V)&&M$1(V)){const G=(U=q.extra)==null?void 0:U.commands;G!=null&&$.enqueueSequentialTask(()=>m$3(this,null,function*(){const{sheet:K}=V;K!=null&&G.forEach(J=>y$2(K,J))}))}}}onPatchExtra($,q){var U,V,G;const K=$.extra;(U=K==null?void 0:K.commands)!=null&&U.length&&(K.commands=[...(G=(V=q.extra)==null?void 0:V.commands)!=null?G:[],...K.commands])}onRemove(){}performEvent($,q){if(q.eventType===R$4.HTMLMutations){if($.isVanilla()){q.data.forEach(U=>{if(U.type===d$5.StyleSheetRule){const V=$.getNode(U.target);P$1(V)&&M$1(V)&&$.enqueueSequentialTask(()=>m$3(this,null,function*(){V.sheet&&y$2(V.sheet,U.data)}))}});return}$.isVirtual()&&q.data.forEach(U=>{var V;if(U.type===d$5.StyleSheetRule){const G=$.getNode(U.target);G!=null&&((G.extra==null||G.extra.commands==null)&&(G.extra={commands:[]}),(V=G.extra.commands)==null||V.push(U.data))}})}}};function y$2(B,$){const q=r$3($[0]);if(q!=null){const U=Reflect.get(B,q);try{Reflect.apply(U,B,$[1])}catch(V){console.warn(`Failed to apply style sheet method: ${q}`,V)}}}var m$2=Object.defineProperty,w$1=Object.defineProperties,N$2=Object.getOwnPropertyDescriptors,g$2=Object.getOwnPropertySymbols,b$1=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,y$1=(B,$,q)=>$ in B?m$2(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,c$1=(B,$)=>{for(var q in $||($={}))b$1.call($,q)&&y$1(B,q,$[q]);if(g$2)for(var q of g$2($))C.call($,q)&&y$1(B,q,$[q]);return B},p$1=(B,$)=>w$1(B,N$2($)),R$1=(B,$,q)=>y$1(B,$+"",q);class H{constructor(){R$1(this,"_renderedSheets",new Map)}get tag(){return"#document-fragment"}onRender($,q,U){const V=q.extra,G=V.styleSheets.sheets;if($.isVanilla()){const K=U;$.enqueueConcurrentTask(new Promise(J=>{setTimeout(()=>{const W=[];for(let Z=0;Z<G.length;Z++){const Q=G[Z],ee=V.styleSheets.rules[Q];let te=this._renderedSheets.get(Q);te==null&&(te=this._createHostedStyleSheet(K,ee),this._renderedSheets.set(Q,te)),W.push(te)}K.adoptedStyleSheets=[...K.adoptedStyleSheets,...W],J({failed:!1,timeout:!1,element:K})},0)}))}}onPatchExtra($,q){const{sheets:U,rules:V}=q.extra.styleSheets,G={styleSheets:{sheets:[...U],rules:Object.keys(V).reduce((J,W)=>p$1(c$1({},J),{[W]:[...V[Number(W)]]}),{})}},K=$.extra.styleSheets;Object.keys(K.rules).forEach(J=>{const W=G.styleSheets.rules[Number(J)];W?W.push(...K.rules[Number(J)]):(G.styleSheets.rules[Number(J)]=[...K.rules[Number(J)]],G.styleSheets.sheets.push(Number(J)))}),$.extra=G}performEvent($,q){q.eventType===R$4.HTMLMutations&&q.data.forEach(U=>{U.type===d$5.StyleSheetRule?this._performStyleSheetRuleChange($,U):U.type===d$5.StyleSheetAdopted&&this._performStyleSheetAdoptedChange($,U)})}_createHostedStyleSheet($,q){var U;const V=(U=$.host.ownerDocument)==null?void 0:U.defaultView,G=V==null?new CSSStyleSheet:new V.CSSStyleSheet;return q==null||q.forEach(K=>{y$2(G,K)}),G}_performStyleSheetRuleChange($,q){if($.isVanilla()){const U=$.getNode(q.target);if(U==null||!(U instanceof ShadowRoot)||!q.sheetId)return;const V=this._renderedSheets.get(q.sheetId);V!=null&&y$2(V,q.data)}else if($.isVirtual()){const U=$.getNode(q.target);if(!(U!=null&&U.tag===this.tag)||!q.sheetId)return;let V=U.extra;if(V||(V={styleSheets:{sheets:[],rules:{}}},U.extra=V),V&&V.styleSheets.rules){const G=V.styleSheets.rules[q.sheetId];G?G.push(q.data):(V.styleSheets.rules[q.sheetId]=[q.data],V.styleSheets.sheets.push(q.sheetId))}}}_performStyleSheetAdoptedChange($,q){if($.isVanilla()){const U=$.getNode(q.target);if(!U)return;$.enqueueConcurrentTask(u$3(()=>{const V=U,{sheets:G,rules:K}=q.data,J=G.map(W=>{var Z;let Q=this._renderedSheets.get(W);return Q!=null?(Z=K[W])==null||Z.forEach(ee=>{y$2(Q,ee)}):(Q=this._createHostedStyleSheet(V,K[W]),this._renderedSheets.set(W,Q)),Q});return V.adoptedStyleSheets=J,{failed:!1,timeout:!1,element:V}}))}else if($.isVirtual()){const U=$.getNode(q.target);if(!U||U.tag!==this.tag)return;const{sheets:V,rules:G}=q.data,K=U.extra,J=K.styleSheets.rules;K.styleSheets.rules=V.reduce((W,Z)=>p$1(c$1({},W),{[Z]:J[Z]||G[Z]}),{}),K.styleSheets.sheets=V}}onRemove(){}onReset(){this._renderedSheets.clear()}}var m$1=Object.defineProperty,s=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,h$1=Object.prototype.propertyIsEnumerable,l$1=(B,$,q)=>$ in B?m$1(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,n$1=(B,$)=>{for(var q in $||($={}))f.call($,q)&&l$1(B,q,$[q]);if(s)for(var q of s($))h$1.call($,q)&&l$1(B,q,$[q]);return B},d=(B,$,q)=>l$1(B,$+"",q);let g$1=class extends EventEmitter{constructor(){super(...arguments),d(this,"_handleNotAllowed",()=>{this.emit("requestUserInteraction")})}get tag(){return"VIDEO"}onRender($,q,U){$.isVanilla()&&$.enqueueConcurrentTask(new Promise(V=>{T(U,q.extra,this._handleNotAllowed),V({})}))}performEvent($,q){if(q.eventType===R$4.HTMLVideo){const{target:U,properties:V}=q.data;$.isVanilla()?T($.getNode(U),V,this._handleNotAllowed):$.isVirtual()&&r$4($.getNode(U),V)}}onPatchExtra($,q){const U=$.extra;U&&($.extra=n$1(n$1({},q.extra),U))}onRemove(){}};var g=Object.defineProperty,R=(B,$,q)=>$ in B?g(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,n=(B,$,q)=>R(B,typeof $!="symbol"?$+"":$,q),m=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});class z extends EventEmitter{constructor($,q){var U,V;super(),n(this,"context"),n(this,"_disableFocusChange"),n(this,"_ignoreAutoplayPolicyError"),n(this,"_suspended",!0),n(this,"_needRebuildId2NodeMap",!1),this._disableFocusChange=(U=q==null?void 0:q.disableFocusChange)!=null?U:!1,this._ignoreAutoplayPolicyError=(V=q==null?void 0:q.ignoreAutoplayPolicyError)!=null?V:!1,this.context=new w$2($),this.registerNodeRenderer(R$2),this.registerNodeRenderer(S),this.registerNodeRenderer(g$4),this.registerNodeRenderer(c$2,q==null?void 0:q.image),this.registerNodeRenderer(g$1),this.registerNodeRenderer(p$3,q==null?void 0:q.link),this.registerNodeRenderer(H),this.context.nodes.on("nodeAdded",(G,K)=>{this.emit("nodeAdded",G,K)}),this.context.nodes.on("nodeRemoved",(G,K)=>{this.emit("nodeRemoved",G,K)}),this.context.nodes.on("nodeReset",()=>{this.emit("nodeReset")})}get suspended(){return this._suspended}getNode($){return this.context.nodes.getNode($)}reset(){this.context.reset()}suspend(){this._suspended=!0}resume(){this._suspended=!1}registerNodeRenderer($,...q){const U=Reflect.construct($,[...q]);this.context.registerNodeRenderer(U),this._ignoreAutoplayPolicyError||U instanceof g$1&&U.on("requestUserInteraction",()=>{this.emit("requestUserInteraction")})}render($){return m(this,null,function*(){if($.version!==1)throw new s$7(`Unsupported snapshot version ${$.version}.`);this.context.setSnapshotId($.id),this.reset();const q=this.suspended;this.suspend(),this.renderWindow($.window),this.renderDocument($.document),q||this.resume()})}performEvent($){return m(this,null,function*(){try{switch($.eventType){case R$4.HTMLSnapshot:yield this.render($.data);break;case R$4.HTMLMutations:this.performMutations($.data);break;case R$4.HTMLNavigation:this.performNavigation($.data);break;case R$4.HTMLScroll:this.performScroll($.data);break;case R$4.HTMLFocus:this.performFocus($.data);break;case R$4.HTMLBlur:this.performBlur($.data);break;case R$4.HTMLValueChange:this.performValueChange($.data);break;case R$4.HTMLSelectionChange:this.performSelectionChange($.data);break;case R$4.HTMLResize:this.performResize($.data);break}this.context.performEvent($),yield this.performPostRendering()}catch(q){console.error(q)}if(this._needRebuildId2NodeMap){const q=new o;this.rebuildNodes(q),this.context.setNodes(q),this._needRebuildId2NodeMap=!1}})}performMutations($){for(const q of $)try{this.performMutation(q)}catch(U){console.error(U)}}performMutation($){switch($.type){case d$5.AddNode:this.performAddNodeMutation($);break;case d$5.ChangeAttributes:this.performChangeAttributeMutation($);break;case d$5.RemoveNode:try{this.performRemoveNodeMutation($)}catch(q){}break;case d$5.CharacterData:this.performCharacterDataMutation($);break;case d$5.Document:this.performDocumentMutation($);break;case d$5.AndroidUpdateNode:this.performAndroidUpdateNodeMutation($);break}}performPostRendering(){return m(this,null,function*(){})}performChangeAttributeMutation($){const q=this.getNode($.target);if(!q)throw new t(`Node with ID \'${$.target}\' not found.`);this.applyAttrs($.data,q)}performScroll($){const q=this.getNode($.target);q&&this.applyScrolling($.scroll,q)}performFocus($){if(!this._disableFocusChange){const q=this.getNode($.target);if(q)this.applyFocus(q);else throw new t(`Node with ID \'${$.target}\' not found.`)}}performBlur($){if(!this._disableFocusChange){const q=this.getNode($.target);if(q)this.applyBlur(q);else throw new t(`Node with ID \'${$.target}\' not found.`)}}performValueChange($){const q=this.getNode($.target);q&&(typeof $.value=="string"?this.applyValue($.value,q):this.applyCheckedState($.value,q))}performSelectionChange($){this._disableFocusChange||this.applySelection($)}performResize($){this.applySize($.size)}}var I=Object.defineProperty,p=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,w=(B,$,q)=>$ in B?I(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,h=(B,$)=>{for(var q in $||($={}))y.call($,q)&&w(B,q,$[q]);if(p)for(var q of p($))D.call($,q)&&w(B,q,$[q]);return B},b=(B,$)=>{var q={};for(var U in B)y.call(B,U)&&$.indexOf(U)<0&&(q[U]=B[U]);if(B!=null&&p)for(var U of p(B))$.indexOf(U)<0&&D.call(B,U)&&(q[U]=B[U]);return q},N$1=(B,$,q)=>w(B,typeof $!="symbol"?$+"":$,q),x=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});class A extends z{constructor($){super(l$6.VirtualDOM,$),N$1(this,"_contentWindow"),N$1(this,"_contentDocument"),this._createNewContent()}get contentWindow(){return this._contentWindow}get contentDocument(){return this._contentDocument}get size(){return this.contentWindow.size}get documentTitle(){return this.contentDocument.title}get documentURL(){return this.contentWindow.location}get documentBaseURI(){return this.contentDocument.baseURI}getNode($){return this.context.nodes.getNode($)}reset(){super.reset(),this._createNewContent()}captureSnapshot(){return x(this,null,function*(){const $={version:1,window:this.contentWindow,document:this._contentDocument,id:this.context.snapshotId};return this.context.capture(),yield this.context.executeQueuedTasks(),l$c($)})}mergeIncrementalSnapshot($,q){let U=l$c($);return q.forEach(V=>{const G=new Map;this.visitVElement(U.document.root,G),U=this.patchIncrementalSnapshot(U,l$c(V),G)}),U}visitVElement($,q){var U;q.set($.id,$),(U=$.children)==null||U.forEach(V=>{this.visitVElement(V,q)})}patchVElement($,q){var U;const V=q.get($.id);if(V){const G=V,{children:K,shadowRoot:J,id:W,type:Z,tag:Q,extra:ee}=G,te=b(G,["children","shadowRoot","id","type","tag","extra"]),ne=new Set(Object.keys($));["id","type","tag",...Object.keys(te),"extra"].forEach(oe=>{const ce=oe;ne.has(ce)?oe==="attrs"?$.attrs=h(h({},te.attrs),$.attrs):this.context.onPatch(ce,$,V):Reflect.set($,ce,V[ce])}),D$3($)&&((U=$.children)==null||U.forEach(oe=>{this.patchVElement(oe,q)})),J&&($.shadowRoot=this.patchVElement(J,q))}return $}patchIncrementalSnapshot($,q,U){const V=this.patchVElement(q.document.root,U);$.window=h(h({},$.window),q.window);const{visibilityState:G}=q.document;return $.document.root=V,G&&($.document.visibilityState=G),$}_createNewContent(){this._contentWindow={location:"about:blank",size:[0,0]},this._contentDocument={type:n$l.DocumentNode,id:1,baseURI:"about:blank",title:"",root:{id:2,parentId:1,tag:"HTML",type:n$l.ElementNode},visibilityState:"hidden"}}renderWindow($){this._contentWindow=l$c($)}renderDocument($){this._contentDocument=l$c($),this.context.nodes.addNode(this._contentDocument.id,this._contentDocument),this.renderNode(this._contentDocument.root,!1)}renderNode($,q=!0){const U=q?l$c($):$;return this.context.nodes.addNode($.id,U),this.context.onNodeRender($,U),n$k(U)&&this._renderElementNode(U),D$3(U)&&this._renderChildren(U),U}_renderElementNode($){$.shadowRoot&&this.renderNode($.shadowRoot,!1)}_renderChildren($){if($.children)for(const q of $.children)this.renderNode(q,!1)}performNavigation($){this._contentWindow.location=$.to,this.emit("navigate",$)}performAddNodeMutation($){const q=this.getNode($.target);if(!q)throw new t(`Target with ID \'${$.target}\' not found.`);const U=this.renderNode($.data.node);q.children||(q.children=[]);let V;$.data.before&&(V=this.getNode($.data.before));let G;V&&(G=q.children.findIndex(K=>K.id===(V==null?void 0:V.id)))!==-1?q.children.splice(G,0,U):q.children.push(U)}performRemoveNodeMutation($){const q=this.getNode($.target);if(!q)throw new t(`Node with ID \'${$.target}\' not found.`);let U,V=[];typeof $.data=="object"?(U=$.data.id,V=$.data.children):U=$.data;const G=this.getNode(U);if(!G)throw new t(`Node with ID \'${U}\' not found.`);if(q.children){const K=q.children.findIndex(J=>J.id===G.id);K!==-1&&q.children.splice(K,1)}V.forEach(K=>{this.context.onNodeRemove(K),this.context.nodes.removeNode(K)}),this.context.onNodeRemove(U),this.context.nodes.removeNode(U)}performCharacterDataMutation($){const q=this.getNode($.target);if(!q)throw new t(`Node with ID \'${$.target}\' not found.`);$.data!==null?q.text=$.data:delete q.text}performDocumentMutation($){$.data.visibilityState&&(this.contentDocument.visibilityState=$.data.visibilityState)}applyAttrs($,q){for(const[U,V]of Object.entries($))V!==null?(q.attrs||(q.attrs={}),q.attrs[U]=V):q.attrs&&delete q.attrs[U]}applyScrolling($,q){q.scroll=[...$]}applyValue($,q){q.value=$}applyCheckedState($,q){q.checked=$}applySize($,q=!0){this.contentWindow.size=[...$],q&&this.emit("resize")}applyBlur(){}applyFocus(){}applySelection(){}rebuildNodes($){$.addNode(this._contentDocument.root.id,this._contentDocument),this._rebuildNode($,this._contentDocument.root)}_rebuildNode($,q){var U;$.addNode(q.id,q),D$3(q)&&((U=q.children)==null||U.forEach(V=>this._rebuildNode($,V))),n$k(q)&&q.shadowRoot&&this._rebuildNode($,q.shadowRoot)}performAndroidUpdateNodeMutation($){}}var _=Object.defineProperty,l=(B,$,q)=>$ in B?_(B,$,{enumerable:!0,configurable:!0,writable:!0,value:q}):B[$]=q,c=(B,$,q)=>l(B,typeof $!="symbol"?$+"":$,q),u=(B,$,q)=>new Promise((U,V)=>{var G=W=>{try{J(q.next(W))}catch(Z){V(Z)}},K=W=>{try{J(q.throw(W))}catch(Z){V(Z)}},J=W=>W.done?U(W.value):Promise.resolve(W.value).then(G,K);J((q=q.apply(B,$)).next())});class N extends A{constructor($){super($),c(this,"_changedWindow"),c(this,"_changedDocument"),c(this,"_changedCount",0),this.context.setIncremental(!0),this._initIncremental()}get size(){return this._changedWindow.size||super.size}get documentTitle(){return this._changedDocument.title||super.documentTitle}get documentURL(){return this._changedWindow.location||super.documentURL}get documentBaseURI(){return this._changedDocument.baseURI||super.documentBaseURI}reset(){super.reset(),this._initIncremental()}_initIncremental(){this._changedWindow={},this._changedDocument={},this._changedCount=0}getIncrementalPercent(){return this._changedCount/this.context.nodes.size()}renderWindow($){super.renderWindow($)}renderDocument($){super.renderDocument($),this._changedDocument.root=this.renderNode($.root,!1)}captureIncrementalSnapshot(){return u(this,null,function*(){const $={version:1,window:this._changedWindow,document:this._changedDocument,id:this.context.snapshotId};this.context.capture(),yield this.context.executeQueuedTasks();const q=l$c($);return this._initIncremental(),this.context.reset(),this._changedDocument.root=this.renderNode($.document.root,!1),q})}renderNode($,q=!0){const{id:U,type:V}=$,G=q?l$c($):{id:U,type:V};return D$3($)&&(G.children=this.__renderChildren($,q)),n$k($)&&$.shadowRoot&&(G.shadowRoot=this.renderNode($.shadowRoot,q)),this.context.nodes.addNode($.id,G),G}__renderChildren($,q=!0){if($.children)return $.children.map(U=>this.renderNode(U,q))}performAddNodeMutation($){super.performAddNodeMutation($),this._changedCount++}performNavigation($){this._changedWindow.location=$.to}applyAttrs($,q){for(const[U,V]of Object.entries($))q.attrs||(q.attrs={}),q.attrs[U]=V}applySize($,q){this._changedWindow.size=$,q&&this.emit("resize")}rebuildNodes($){this._changedDocument.id!=null&&$.addNode(this._changedDocument.root.id,this._changedDocument),this._rebuildNode($,this._changedDocument.root)}}const DEFAULT_BLACKBOX_BUFFER_TIME=12e4;class BlackboxProcessor extends AbstractProcessor{constructor(q,U,V,G){var K,J,W;super(V);se(this,"_apiClient");se(this,"_subscription");se(this,"_queue",[]);se(this,"_contextMap",new Map);se(this,"_virtualRenderer",new A);se(this,"_cacheLimit");se(this,"_storage");se(this,"_retry",new y$4);se(this,"_bufferTime");se(this,"_startTime",0);se(this,"_endTime",0);se(this,"_endRealTime",0);se(this,"_hasRotated",!1);this._subscription=q.subscribe(Z=>this.handleInput(Z)),this._apiClient=U,this._bufferTime=(K=G==null?void 0:G.bufferTime)!=null?K:DEFAULT_BLACKBOX_BUFFER_TIME,this._cacheLimit=(J=G==null?void 0:G.cache)==null?void 0:J.limit,this._storage=(W=G==null?void 0:G.cache)==null?void 0:W.storageProvider.getStorage()}join(q){this._contextMap.set(q.id,q)}remove(q){this._contextMap.delete(q.id)}getSize(){return this._contextMap.size}handleFrame(q){this._enqueue(q)}cache(){return me(this,null,function*(){const q=[];if(this._storage&&this.getSize()>0){const U=yield this._createFrames(),V=this._calculateClientTime(U);for(const[G,K]of this._contextMap.entries()){const J=this._createRecordingOptions(G,K,V),W={id:J.id,frames:U,startTime:this._startTime,endTime:this._endTime,mode:a$5.Blackbox,recordingOptions:J};yield this._storage.deleteRecordings(W),yield this._storage.putRecordings([W],this._cacheLimit),q.push(W.id)}}return q})}dump(q,U){return me(this,null,function*(){const V=this._contextMap.get(q);if(!V)throw new Error("Blackbox recording not found");const G=yield this._createFrames(),K=this._calculateClientTime(G),J=this._createRecordingOptions(q,V,K,U),{recording:W,transport:Z}=yield createRecording(this._apiClient,J),Q=Z.strategies.find(ne=>ne.mode===a$5.Blackbox&&"channelType"in ne),ee=yield pack(encode(G,this._startTime),G.length,G[0].time,this._endTime,W.id,this._startTime,!0);yield this._retry.attempt(()=>createBlock(this._apiClient,{blob:new Blob([ee.data],{type:"application/octet-stream"}),recordingId:W.id,token:Q.config.token,offset:ee.frameRange[0],count:ee.frameRange[1],firstFrameTime:ee.firstFrameTime,lastFrameTime:ee.lastFrameTime,isEOF:ee.isEOF}));const te=Z.strategies.find(ne=>ne.name==="blackbox-record-dump");if(te){const ne=te.config;V.dumpConfig=ne}else V.dumpConfig={id:r$7(),token:J.token};return{id:W.id,mode:a$5.Blackbox,createTime:new Date(W.createTime).getTime(),meta:W.meta,environment:W.environment}})}dumpInMemory(q,U){return me(this,null,function*(){const V=this._contextMap.get(q);if(!V)throw new Error("Blackbox recording not found");const G=yield this._createFrames();return G.forEach(K=>K.time-=this._startTime),s$5.from(q,G,Ne(Oe({},U),{createTime:this._calculateClientDate(G).getTime(),trackers:V.trackers,environment:V.recording.environment,meta:Oe(Oe({},V.recording.meta),U==null?void 0:U.meta)}))})}dispose(){this._subscription.unsubscribe(),this._queue.splice(0,this._queue.length),this._contextMap.clear(),this._virtualRenderer.reset(),this._virtualRenderer=new A}_enqueue(q){this._queue.length===0&&q.trackType===n$c.HTML&&q.event.eventType===R$4.HTMLSnapshot&&(this._startTime=q.time),this._queue.push(q),this._rotate(q.time)}_rotate(q){this._endTime=q,this._endRealTime=n$p();const U=q-this._bufferTime;let V;for(;(V=this._queue[0])&&V.time<U;)this._queue.shift(),this._virtualRenderer.performEvent(V.event),this._startTime=V.time,this._hasRotated=!0;U>this._startTime&&(this._startTime=U)}_createRecordingOptions(q,U,V,G){return Ne(Oe(Oe({},G),U.dumpConfig),{clientTime:V,mode:a$5.Blackbox,parent:q,refType:"blackbox",trackers:U.trackers,environment:U.recording.environment,meta:Oe(Oe({},U.recording.meta),G==null?void 0:G.meta)})}_createFrames(){return me(this,null,function*(){const q=n$p()-this._endRealTime,U=this._endTime+q;this._rotate(U);const V=[...this._queue];if(V.length===0||this._hasRotated){const G=yield this._virtualRenderer.captureSnapshot(),K={trackType:n$c.HTML,time:this._startTime,event:{eventType:R$4.HTMLSnapshot,data:G}};V.unshift(K),this._hasRotated=!1}return V})}_calculateClientTime(q){return this._calculateClientDate(q).toISOString()}_calculateClientDate(q){return q.length===0?new Date:new Date(Date.now()-(q[q.length-1].time-q[0].time))}}class Controller extends d$6{constructor(){super(...arguments);se(this,"_buffer",new Array);se(this,"_suspend",!1)}get isSuspend(){return this._suspend}suspend(){this._suspend=!0}resume(){let q=this._buffer.shift();for(;q;)this.output(q),q=this._buffer.shift();this._suspend=!1}handleInput(q){this.isSuspend?this._buffer.push(q):this.output(q)}}class HTMLDataMask{constructor($,q){se(this,"_renderer");se(this,"_textDataMask");se(this,"_nameDataMask");se(this,"_commonDataMask");se(this,"_strict",!1);se(this,"_maskElements");var J;this._renderer=$,this._nameDataMask=new o$5(new n$a,new l$e),this._textDataMask=new n$6;const{disableBuiltInDataMasks:U=!1,maskingLevel:V=A$1.BALANCE,maskElements:G}=q;this._maskElements=G,this._strict=V===A$1.STRICT;const K=(J=q.dataMasks)!=null?J:[];U||(this._commonDataMask=new o$5(new n$9,new e$2,new n$8,new t$5,new d$4,new t$4,new b$3,new e$3)),K.length>0&&(this._commonDataMask=this._commonDataMask?new o$5(...K,this._commonDataMask):new o$5(...K))}mask($){var G,K;const{data:q,eventType:U}=$.event,V=M();if(U===R$4.HTMLSnapshot){if(u$f(q.document.title)){const J=this._strict?this._textDataMask:this._commonDataMask;J&&(q.document.title=J.mask(q.document.title))}this.maskElement(q.document.root)}else if(U===R$4.HTMLMutations)q.forEach(J=>{var W,Z;if(J.type===d$5.AddNode)this.maskElement(J.data.node,this._renderer.getNode(J.target));else if(J.type===d$5.ChangeAttributes)J.data=this.maskAttribute(J.data,this._renderer.getNode(J.target));else if(J.type===d$5.CharacterData&&u$f(J.data)){let Q;const ee=this._renderer.getNode(J.target);ee&&v$2(ee)&&ee.parentId!=null&&(Q=this._renderer.getNode(ee.parentId));const te=this._getDataMask((W=ee==null?void 0:ee.attrs)==null?void 0:W[V],(Z=Q==null?void 0:Q.attrs)==null?void 0:Z[V])[0];te?J.data=te.mask(J.data):this._commonDataMask&&(Q==null||shouldMask(Q))&&(J.data=this._commonDataMask.mask(J.data))}});else if(U===R$4.HTMLValueChange&&u$f(q.value)){const J=this._renderer.getNode(q.target),W=(K=this._getDataMask((G=J==null?void 0:J.attrs)==null?void 0:G[V])[0])!=null?K:this._commonDataMask;W&&(q.value=W.mask(q.value))}return $}maskElement($,q){var K,J,W;if(q!=null&&!shouldMask(q)||!shouldMask($))return;const U=M(),[V,G]=this._getDataMask((K=$.attrs)==null?void 0:K[U],(J=q==null?void 0:q.attrs)==null?void 0:J[U]);this._maskElement($,V!=null?V:this._commonDataMask,G),(W=$.children)==null||W.forEach(Z=>this.maskElement(Z,$))}maskAttribute($,q){var K,J;if(q!=null&&!shouldMask(q))return $;const U=M(),[V,G]=this._getDataMask((J=(K=q==null?void 0:q.attrs)==null?void 0:K[U])!=null?J:$[U]);return this._maskAttribute(V!=null?V:this._commonDataMask,G,$,q)}_maskElement($,q,U){const{text:V,value:G}=$;q!=null&&(u$f(V)&&($.text=q.mask(V)),u$f(G)&&($.value=q.mask(G))),$.attrs=this._maskAttribute(q,U,$.attrs,$)}_maskAttribute($,q,U,V){var K,J,W,Z,Q;if(!U)return U;if($!=null)for(const[ee,te]of Object.entries(U))shouldMaskAttribute(ee)&&u$f(te)&&(U[ee]=$.mask(te));const G=l$g(q);if(V!=null&&(k$5(V)?(G||(K=this._maskElements)!=null&&K.anchor)&&(U.href="#"):j$1(V)?(G||(J=this._maskElements)!=null&&J.image)&&(U.src="",U.srcset=""):p$9(V)?(G||(W=this._maskElements)!=null&&W.audio)&&(U.src="",this._maskChildSourceElements(V)):X(V)&&(G||(Z=this._maskElements)!=null&&Z.video)&&(U.src="",this._maskChildSourceElements(V))),U.style!=null&&(G||(Q=this._maskElements)!=null&&Q.image)){const ee=/url\\([\'"]?([^\'")]+)[\'"]?\\)/g;U.style=U.style.replace(ee,function(te,ne){return/\\.(png|jpe?g|gif|webp|bmp|tiff|svg)(\\?.*)?$/i.test(ne)?\'url("#")\':te})}return U}_maskChildSourceElements($){var q;(q=$.children)==null||q.filter(U=>Y(U)&&U.attrs!=null).forEach(U=>{U.attrs.src=""})}_getDataMask($,q){return k$4(q)||k$4($)?[this._commonDataMask,a$7.balance]:D$2(q)||D$2($)?[this._nameDataMask,a$7.name]:A$3(q)||A$3($)?[this._textDataMask,a$7.balance]:this._strict||l$g(q)||l$g($)?[this._textDataMask,a$7.strict]:[]}}class HTMLProcessor extends AbstractProcessor{constructor(q,U){super(q,n$c.HTML);se(this,"_isOptionsInitialized",!1);se(this,"_lastSnapshotTime",-1);se(this,"_virtualRenderer");se(this,"_capturerAwait",null);se(this,"_callbacks",new Array);se(this,"_dataMask");this._virtualRenderer=new A,this._context.virtualRenderer=this._virtualRenderer,this.initOptions(U)}initOptions(q){this._isOptionsInitialized||(q!=null&&(this._isOptionsInitialized=!0),q!=null&&q.disableDataMasking?this._dataMask=void 0:this._dataMask=new HTMLDataMask(this._virtualRenderer,{disableDataMasking:q==null?void 0:q.disableDataMasking,disableBuiltInDataMasks:q==null?void 0:q.disableBuiltInDataMasks,dataMasks:deserializeDataMasks(q==null?void 0:q.dataMasks),maskingLevel:q==null?void 0:q.maskingLevel,maskElements:q==null?void 0:q.maskElements}))}captureSnapshotFrame(q,U=!0){if(this._lastSnapshotTime===-1){q(null);return}return this._callbacks.push(q),this._capturerAwait?this._capturerAwait:(this._context.controller.suspend(),this._capturerAwait=me(this,null,function*(){try{const V=yield this._virtualRenderer.captureSnapshot();this._lastSnapshotTime=o$e.now();let G={trackType:n$c.HTML,time:this._lastSnapshotTime,event:{eventType:R$4.HTMLSnapshot,data:V}};U&&this._dataMask&&(G=this._dataMask.mask(G)),this._callbacks.forEach(K=>{K(G)}),this._callbacks=new Array}catch(V){console.error("Capture virtual snapshot error",V)}this._context.controller.resume(),this._capturerAwait=null}),this._capturerAwait)}outputSnapshotFrame(){this.captureSnapshotFrame(q=>{q&&this.output(q)})}handleFrame(q){const U=q.event;this._virtualRenderer.performEvent(U),U.eventType===R$4.HTMLSnapshot&&(this._lastSnapshotTime=q.time),this.output(this._dataMask?this._dataMask.mask(q):q)}}const MINUTE=60*1e3,ONE_TICK=1e-6;class IncrementalProcessor extends AbstractProcessor{constructor(q,U){super(q,n$c.HTML);se(this,"_recordingContext");se(this,"incrementalSnapshotRenderer",new N);se(this,"_index",0);se(this,"_lastSnapshotTime");se(this,"_capturerAwait",null);this._recordingContext=U}handleFrame(q){const U=q.event;if(this.incrementalSnapshotRenderer.performEvent(U),U.eventType===R$4.HTMLSnapshot&&(this._lastSnapshotTime=q.time),this.output(q),this._lastSnapshotTime&&this._recordingContext.now-this._lastSnapshotTime>2*MINUTE&&this.incrementalSnapshotRenderer.getIncrementalPercent()>.3){const G=q.time;this._createIncrementalSnapshot(G)}}_createIncrementalSnapshot(q){return this._capturerAwait?this._capturerAwait:(this._context.controller.suspend(),this._capturerAwait=me(this,null,function*(){try{this._lastSnapshotTime=q;const U=yield this.incrementalSnapshotRenderer.captureIncrementalSnapshot(),V=++this._index,G={trackType:n$c.HTML,time:q+ONE_TICK,event:{eventType:R$4.HTMLIncrementalSnapshot,data:{snapshot:U,index:V}}};this.output(G)}catch(U){console.error("Capture virtual snapshot error",U)}this._context.controller.resume(),this._capturerAwait=null}),this._capturerAwait)}}class AbstractInsightDetector extends EventEmitter{constructor(q){super();se(this,"_config");this.setOptions(q)}setOptions(q){this._config=Oe(Oe({},this.getDefaultOptions()),q)}getDefaultOptions(){return{}}}class DeadClickDetector extends AbstractInsightDetector{constructor(q,U){super(U);se(this,"_HANDLED_FRAMES",new Set([n$c.HTML,n$c.Mouse,n$c.Network]));se(this,"_IGNORED_EVENTS",new Set([R$4.HTMLSnapshot,R$4.HTMLIncrementalSnapshot,R$4.HTMLIFrame,R$4.MouseMove,R$4.MouseDown,R$4.MouseUp,R$4.MouseEnter,R$4.MouseLeave,R$4.TouchStart,R$4.TouchMove,R$4.TouchEnd,R$4.TouchCancel,R$4.NETWORK_ABORT,R$4.NETWORK_DONE,R$4.NETWORK_ERROR,R$4.NETWORK_TIMEOUT]));se(this,"_vRenderer");se(this,"_subsequentFrames",[]);se(this,"_timer");this._vRenderer=q}getDefaultOptions(){return{changesThreshold:1,timeoutThreshold:500}}handle(q){const{trackType:U,event:V}=q,G=V.eventType;if(!(s$4(U)||!this._HANDLED_FRAMES.has(U)||this._IGNORED_EVENTS.has(G))&&!(this._timer==null&&G!==R$4.MouseClick)){if(G===R$4.MouseClick){this._stop();const K=V.data[3];if(K!=null){const J=this._vRenderer.getNode(K);(J==null?void 0:J.type)===n$l.ElementNode&&this._shouldHandle(J)&&this._start(q)}return}this._subsequentFrames.push(q)}}_start(q){this._subsequentFrames.push(q),this._timer=setTimeout(()=>{if(this._subsequentFrames.length-1<this._config.changesThreshold){const V=this._subsequentFrames[0],[G,K,J,W,Z]=V.event.data,Q={duration:o$e.now()-V.time,x:G,y:K,buttons:J};W!=null&&(Q.targetId=W),Z!=null&&(Q.context=Z),this.emit("detected",Q)}this._stop()},this._config.timeoutThreshold)}_stop(){this._timer!=null&&(this._subsequentFrames=[],clearTimeout(this._timer),this._timer=void 0)}_shouldHandle(q){const{tag:U,attrs:V}=q;return U==="A"||U==="BUTTON"||U==="INPUT"&&V!=null&&(V.type==="button"||V.type==="checkbox"||V.type==="submit"||V.type==="radio"&&!q.checked)}}class ExcessiveScrollingDetector extends AbstractInsightDetector{constructor(){super(...arguments);se(this,"_distance",0);se(this,"_startTime");se(this,"_lastScroll")}getDefaultOptions(){return{scrollThreshold:1e3,timeoutThreshold:3e3}}handle(q){var K,J,W;if(q.event.eventType!==R$4.HTMLScroll)return;const U=q.event.data,{scroll:V,target:G}=U;if(this._startTime==null&&(this._startTime=o$e.now()),((K=this._lastScroll)==null?void 0:K.target)!==G)this._distance=0,this._startTime=o$e.now(),this._lastScroll=U;else{const Z=o$e.now()-this._startTime;Z>=this._config.timeoutThreshold?this._reset():(this._distance+=Math.abs(V[1]-((W=(J=this._lastScroll)==null?void 0:J.scroll[1])!=null?W:0)),this._distance>=this._config.scrollThreshold?(this.emit("detected",{distance:this._distance,duration:Z,targetId:G}),this._reset()):this._lastScroll=U)}}_reset(){this._distance=0,this._startTime=void 0,this._lastScroll=void 0}}function getMousePosition(B){const[$,q]=isMouseEvent(B)?B.data:B.data[0];return[$,q]}function getMouseTargetId(B){return(isMouseEvent(B)?B.data:B.data[0])[3]}function getMouseTargetContext(B){return(isMouseEvent(B)?B.data:B.data[0])[4]}function isMouseEvent(B){const{eventType:$}=B;return $===R$4.MouseMove||$===R$4.MouseDown||$===R$4.MouseUp||$===R$4.MouseClick||$===R$4.MouseEnter||$===R$4.MouseLeave}class LongHoverDetector extends AbstractInsightDetector{constructor(){super(...arguments);se(this,"_HANDLED_FRAMES",new Set([n$c.HTML,n$c.Mouse,n$c.Keyboard]));se(this,"_IGNORED_EVENTS",new Set([R$4.HTMLSnapshot,R$4.HTMLMutations,R$4.HTMLIncrementalSnapshot,R$4.HTMLIFrame]));se(this,"_lastMouseFrame");se(this,"_lastInteraction");se(this,"_timer")}getDefaultOptions(){return{timeThreshold:1e4}}handle(q){const{trackType:U,event:V}=q,G=V.eventType;if(!(s$4(U)||!this._HANDLED_FRAMES.has(U)||this._IGNORED_EVENTS.has(G))){if(U===n$c.Mouse&&(this._lastMouseFrame=q),this._lastInteraction==null){this._start(q);return}this._restart(q)}}_start(q){this._lastInteraction=q,this._timer=setTimeout(()=>{if(this._lastMouseFrame!=null&&this._lastInteraction!=null){const[U,V]=getMousePosition(this._lastMouseFrame.event),G=getMouseTargetId(this._lastMouseFrame.event),K=getMouseTargetContext(this._lastMouseFrame.event),J={duration:o$e.now()-this._lastInteraction.time,x:U,y:V};G!=null&&(J.targetId=G),K!=null&&(J.context=K),this.emit("detected",J)}this._stop(),this._lastMouseFrame=void 0},this._config.timeThreshold)}_restart(q){this._stop(),this._start(q)}_stop(){this._timer!=null&&(this._lastInteraction=void 0,clearTimeout(this._timer),this._timer=void 0)}}class RageClickDetector extends AbstractInsightDetector{constructor(){super(...arguments);se(this,"_clicks",[]);se(this,"_timer")}getDefaultOptions(){return{clicksThreshold:4,distanceThreshold:30,timeoutThreshold:800}}handle(q){if(!(s$4(q.trackType)||q.event.eventType!==R$4.MouseClick)){if(this._clicks.length===0){this._start(q);return}if(this._isWithInDistance(this._clicks[0],q)){this._clicks.push(q);return}this._restart(q)}}_start(q){this._clicks.push(q),this._timer=setTimeout(()=>{const{length:U}=this._clicks;if(U>=this._config.clicksThreshold){const V=this._clicks[0],G=this._clicks[U-1],[K,J,W,Z,Q]=V.event.data,ee={duration:G.time-V.time,clicks:U,x:K,y:J,buttons:W};Z!=null&&(ee.targetId=Z),Q!=null&&(ee.context=Q),this.emit("detected",ee)}this._stop()},this._config.timeoutThreshold)}_restart(q){this._stop(),this._start(q)}_stop(){this._timer!=null&&(this._clicks=[],clearTimeout(this._timer),this._timer=void 0)}_isWithInDistance(q,U){const[V,G]=q.event.data,[K,J]=U.event.data;return Math.abs(K-V)+Math.abs(J-G)<=this._config.distanceThreshold}}class InsightProcessor extends AbstractProcessor{constructor(q,U){super(q);se(this,"_isOptionsInitialized",!1);se(this,"_deadClickDetector");se(this,"_longHoverDetector");se(this,"_rageClickDetector");se(this,"_excessiveScrollingDetector");se(this,"_handleInsight",q=>U=>{this.output(a$4(n$c.Insight,{eventType:q,data:U},o$e.now()))});this._initDetectors(U)}initOptions(q){var U,V,G,K,J,W,Z,Q;this._isOptionsInitialized||(q!=null&&(this._isOptionsInitialized=!0),this._isDetectorEnabled(q==null?void 0:q.deadClick)?(U=this._deadClickDetector)==null||U.setOptions(q==null?void 0:q.deadClick):((V=this._deadClickDetector)==null||V.removeAllListeners(),this._deadClickDetector=void 0),this._isDetectorEnabled(q==null?void 0:q.excessiveScrolling)?(G=this._excessiveScrollingDetector)==null||G.setOptions(q==null?void 0:q.excessiveScrolling):((K=this._excessiveScrollingDetector)==null||K.removeAllListeners(),this._excessiveScrollingDetector=void 0),this._isDetectorEnabled(q==null?void 0:q.longHover)?(J=this._longHoverDetector)==null||J.setOptions(q==null?void 0:q.longHover):((W=this._longHoverDetector)==null||W.removeAllListeners(),this._longHoverDetector=void 0),this._isDetectorEnabled(q==null?void 0:q.rageClick)?(Z=this._rageClickDetector)==null||Z.setOptions(q==null?void 0:q.rageClick):((Q=this._rageClickDetector)==null||Q.removeAllListeners(),this._rageClickDetector=void 0))}handleFrame(q){var U,V,G,K;this.output(q),(U=this._deadClickDetector)==null||U.handle(q),(V=this._excessiveScrollingDetector)==null||V.handle(q),(G=this._longHoverDetector)==null||G.handle(q),(K=this._rageClickDetector)==null||K.handle(q)}_initDetectors(q){q!=null&&(this._isOptionsInitialized=!0),this._isDetectorEnabled(q==null?void 0:q.deadClick)&&this._context.virtualRenderer&&(this._deadClickDetector=new DeadClickDetector(this._context.virtualRenderer,q==null?void 0:q.deadClick),this._deadClickDetector.on("detected",this._handleInsight(R$4.INSIGHT_DEAD_CLICK))),this._isDetectorEnabled(q==null?void 0:q.excessiveScrolling)&&(this._excessiveScrollingDetector=new ExcessiveScrollingDetector(q==null?void 0:q.excessiveScrolling),this._excessiveScrollingDetector.on("detected",this._handleInsight(R$4.INSIGHT_EXCESSIVE_SCROLLING))),this._isDetectorEnabled(q==null?void 0:q.longHover)&&(this._longHoverDetector=new LongHoverDetector(q==null?void 0:q.longHover),this._longHoverDetector.on("detected",this._handleInsight(R$4.INSIGHT_LONG_HOVER))),this._isDetectorEnabled(q==null?void 0:q.rageClick)&&(this._rageClickDetector=new RageClickDetector(q==null?void 0:q.rageClick),this._rageClickDetector.on("detected",this._handleInsight(R$4.INSIGHT_RAGE_CLICK)))}_isDetectorEnabled(q){return q!==!1}}class NetworkDataMask{constructor($){se(this,"_commonDataMask");var G;const{disableBuiltInDataMasks:q=!1,maskingLevel:U=A$1.BALANCE}=$,V=(G=$.dataMasks)!=null?G:[];q||(U===A$1.STRICT?this._commonDataMask=new n$6:this._commonDataMask=new o$5(new n$9,new e$2,new n$8,new t$5,new d$4,new t$4,new b$3,new e$3)),V.length>0&&(this._commonDataMask=this._commonDataMask?new o$5(...V,this._commonDataMask):new o$5(...V))}mask($){const{data:q,eventType:U}=$.event;if(U===R$4.NETWORK_DONE&&this._commonDataMask){const{body:V}=q;if(V!=null)if(u$f(V))q.body=this._commonDataMask.mask(V);else try{let G=!1;const K=JSON.stringify(V,(J,W)=>u$f(W)?(G=!0,this._commonDataMask.mask(W)):W);G&&(q.body=K)}catch(G){}}return $}}class NetworkProcessor extends AbstractProcessor{constructor(q,U){super(q,n$c.Network);se(this,"_isOptionsInitialized",!1);se(this,"_dataMask");this.initOptions(U)}initOptions(q){this._isOptionsInitialized||(q!=null&&(this._isOptionsInitialized=!0),q!=null&&q.disableDataMasking?this._dataMask=void 0:this._dataMask=new NetworkDataMask({disableDataMasking:q==null?void 0:q.disableDataMasking,disableBuiltInDataMasks:q==null?void 0:q.disableBuiltInDataMasks,dataMasks:deserializeDataMasks(q==null?void 0:q.dataMasks),maskingLevel:q==null?void 0:q.maskingLevel}))}handleFrame(q){this.output(this._dataMask?this._dataMask.mask(q):q)}}class ProcessorContext{constructor($){se(this,"_trackTypes");se(this,"_controller");se(this,"_virtualRenderer");this._controller=$}get trackTypes(){return this._trackTypes}set trackTypes($){this._trackTypes=$}get controller(){return this._controller}get virtualRenderer(){return this._virtualRenderer}set virtualRenderer($){this._virtualRenderer=$}}class RecordingContext{constructor($,q,U){se(this,"manager");se(this,"_id");se(this,"_recording");se(this,"_startTime");se(this,"_offsetTime");se(this,"_trackers");se(this,"_transmitter");se(this,"_events",new EventEmitter);var G,K;this.options=U,this.manager=$,this._recording=q,this._id=q.id,this._startTime=(G=U.startTime)!=null?G:n$p(),this._trackers=U.trackers,this._offsetTime=this.getOffsetTime(this._startTime);const V=(K=U.transport)==null?void 0:K.strategies.find(J=>J.mode===U.mode&&"channelType"in J);this._transmitter={strategy:V}}get id(){return this._id}get recording(){return this._recording}get baseURL(){return this.manager.env.baseURL}get env(){return this.manager.env}get startTime(){return this._startTime}get offsetTime(){return this._offsetTime}get now(){return n$p()+this._offsetTime}get transmitter(){return this._transmitter}get trackers(){return this._trackers}dumpRecording($){return this.manager.dumpRecording(this._id,$)}dumpInMemoryRecording($){return this.manager.dumpInMemoryRecording(this._id,$)}cacheRecordings(){return this.manager.cacheRecordings()}stopRecording(){return this.manager.stopRecordingContext(this._id)}toString(){return JSON.stringify(this._recording)}emit($,...q){return this._events.emit($,...q)}on($,q){this._events.on($,q,{})}once($,q){this._events.once($,q,{})}off($,q){this._events.off($,q,{})}addListener($,q){this._events.addListener($,q,{})}removeListener($,q){this._events.removeListener($,q,{})}getOffsetTime($){return $-n$p()}}class BlackboxRecordingContext extends RecordingContext{constructor(q,U,V){var K;super(q,U,V);se(this,"_dumpConfig");const G=(K=V.transport)==null?void 0:K.strategies.find(J=>J.name==="blackbox-record-dump");G?this._dumpConfig=G==null?void 0:G.config:this._dumpConfig={id:r$7(),token:V.token}}get dumpConfig(){return this._dumpConfig}set dumpConfig(q){this._dumpConfig=q}dumpRecording(q){return me(this,null,function*(){const U=yield Ze(BlackboxRecordingContext.prototype,this,"dumpRecording").call(this,q);return this.emit("dumped",U.id,this.dumpConfig),U.id})}getDumpConfig(){return me(this,null,function*(){return Promise.resolve(this.dumpConfig)})}}class InMemoryRecordingContext extends RecordingContext{dumpRecording(){return super.dumpRecording()}}function normalizeTrackType(B){return u$f(B)?n$c[B]:B}function normalizeTrackTypes(B){const $=B==null?void 0:B.map(q=>normalizeTrackType(q)).filter(q=>!!q);return $&&$.length>0?$:[n$c.HTML,n$c.Mouse]}class RecordingError extends z$3{constructor($,q){super($,q),this.name="bytereplay.recorder.RecordingError"}}class FrameBuffer extends d$6{constructor(q){super();se(this,"_bufferedFrames",[]);se(this,"_timer",0);se(this,"_handleTick",()=>{this._bufferedFrames.length?this.flush():this.dispose()});this.options=q}handleInput(q){this._bufferedFrames.push(q),this._timer||(this._timer=setInterval(this._handleTick,this.options.bufferTime))}flush(){return me(this,null,function*(){return this._bufferedFrames.length?(this.output([...this._bufferedFrames]),this._bufferedFrames.splice(0,this._bufferedFrames.length),new Promise(q=>{setTimeout(q,0)})):Promise.resolve()})}dispose(){clearInterval(this._timer),this._timer=0}}class BlobTransmitter extends d$6{constructor(q){super();se(this,"_chunks",[]);this.context=q}handleInput(q){this._chunks.push(q.data)}open(){return me(this,null,function*(){})}close(){return me(this,null,function*(){})}dump(){return me(this,null,function*(){return new Blob(this._chunks,{type:"text/plain"})})}}class BlockTransmitter extends d$6{constructor(q){var U;super();se(this,"_retry");se(this,"_strategy");se(this,"_closing");this.context=q,this._strategy=(U=q.transmitter)==null?void 0:U.strategy,this._retry=new y$4}open(){return me(this,null,function*(){})}close(){return me(this,null,function*(){return new Promise((q,U)=>{this._closing=V=>{this._closing=void 0,V?U(V):q()}})})}handleInput(q){this.context.emit("feedback",{type:SignalType.CompensateSnapshot,recordingId:this.context.id}),this._retry.attempt(()=>me(this,null,function*(){var U,V;try{return createBlock(this.context.manager.apiClient,{blob:new Blob([q.data],{type:((V=(U=this._strategy.packer)==null?void 0:U.compression)==null?void 0:V.mode)==="gzip"?"application/octet-stream":"text/plain"}),recordingId:this.context.recording.id,token:this._strategy.config.token,offset:q.frameRange[0],count:q.frameRange[1],firstFrameTime:q.firstFrameTime,lastFrameTime:q.lastFrameTime,isEOF:q.isEOF})}catch(G){throw G}})).then(U=>{var V;this.context.emit("feedback",{type:SignalType.BlockCreated,block:U}),(V=this._closing)==null||V.call(this)}).catch(U=>{var V;(V=this._closing)==null||V.call(this,U)})}}class StreamingCompensator extends EventEmitter{constructor(q=100){super();se(this,"_mailbox");se(this,"_connection");se(this,"_handleOpen",()=>{this._sendAll()});se(this,"_handleSend",q=>{!g$8(q)&&q.type===n$e.Chunk&&this._mailbox.enqueue(q)});se(this,"_handleMessage",q=>{if(q!=null&&!g$8(q)&&q.type===n$e.ACK){const U=q.sequence,V=this._mailbox.findIndex(G=>G.sequence===U);if(V!==-1&&this._mailbox.remove(V),V>0&&this._connection!=null){const G=this._mailbox.slice(0,V);for(const K of G)this._connection.send(K,!1)}}});se(this,"_handleRotated",()=>{this._mailbox.clear(),this.emit("compensate")});this._mailbox=new g$9(q)}attach(q){this.detach(),this._connection=q,q.on("open",this._handleOpen),q.on("send",this._handleSend),q.on("message",this._handleMessage),this._mailbox.on("rotated",this._handleRotated)}detach(){var q,U,V;(q=this._connection)==null||q.off("open",this._handleOpen),(U=this._connection)==null||U.off("send",this._handleSend),(V=this._connection)==null||V.off("message",this._handleMessage),this._connection=void 0,this._mailbox.off("rotated",this._handleRotated),this._mailbox.clear()}flush(){this._sendAll()}_sendAll(){this._connection!==null&&this._mailbox.forEach(q=>{this._connection.send(q,!1)})}}class StreamingHttpTransmitter extends d$6{constructor(q){var U,V;super();se(this,"_connection");se(this,"_strategy");se(this,"_snapshotInterval");se(this,"_lastSnapshotTime",0);se(this,"_compensateSnapshot",()=>{n$p()-this._lastSnapshotTime>this._snapshotInterval&&this._handleCompensate()});se(this,"_handleError",()=>{this.context.stopRecording()});se(this,"_handleCompensate",()=>{this.context.emit("feedback",{type:SignalType.CompensateSnapshot,recordingId:this.context.id}),this._lastSnapshotTime=n$p()});this.context=q,this._strategy=(U=q==null?void 0:q.transmitter)==null?void 0:U.strategy,this._snapshotInterval=(V=this._strategy.config.snapshotInterval)!=null?V:3e5,this._connection=new A$2(q.manager.apiClient,{retry:this._strategy.config.retry,bufferSize:this._strategy.config.bufferSize})}get strategy(){return this._strategy}open(){return me(this,null,function*(){this._lastSnapshotTime=0,this._connection.on("error",this._handleError),this._connection.on("compensate",this._handleCompensate),this._connection.open()})}close(){return me(this,null,function*(){this._lastSnapshotTime=0,this._connection.close()})}handleInput(q){return me(this,null,function*(){var V,G;const U=createBlockRequestMessage({blob:new Blob([q.data],{type:((G=(V=this._strategy.packer)==null?void 0:V.compression)==null?void 0:G.mode)==="gzip"?"application/octet-stream":"text/plain"}),recordingId:this.context.recording.id,token:this._strategy.config.token,offset:q.frameRange[0],count:q.frameRange[1],firstFrameTime:q.firstFrameTime,lastFrameTime:q.lastFrameTime,isEOF:q.isEOF,hasSnapshot:q.hasSnapshot},!0);this._connection.send(U),q.hasSnapshot?this._lastSnapshotTime=n$p():this._compensateSnapshot()})}}var SeekOrigin=(B=>(B[B.Begin=0]="Begin",B[B.End=1]="End",B[B.Current=2]="Current",B))(SeekOrigin||{});class BinaryWriter{constructor($=1024,q=$){se(this,"_byteLength",0);se(this,"_position",0);se(this,"_bytes");se(this,"_buffer");se(this,"_view");se(this,"_encoder",null);se(this,"_allocCount",0);se(this,"_allocWarned",!1);this.initialBufferSize=$,this.incrementalSize=q,this.realloc($)}get byteLength(){return this._byteLength}get capacity(){return this._bytes.length}get currentPosition(){return this._position}encode($){return this._encoder||(this._encoder=new TextEncoder),this._encoder.encode($)}seek($,q=SeekOrigin.Begin){let U;if(q===SeekOrigin.Current?U=this.currentPosition:q===SeekOrigin.End?U=this.byteLength:U=0,U=U+$,U<0)throw new c$d("The seeking position must equal to or be greater than 0.");this._position=U}writeUint8($){this.checkAlloc(1),this._view.setUint8(this.currentPosition,$),this.increaseSize(1)}writeUint8Array($){const q=$.byteLength;this.checkAlloc(q),this._bytes.set($,this.currentPosition),this.increaseSize(q)}writeUint16($){this.checkAlloc(2),this._view.setUint16(this.currentPosition,$),this.increaseSize(2)}writeUint32($){this.checkAlloc(4),this._view.setUint32(this.currentPosition,$,!1),this.increaseSize(4)}writeString($,q){let U=this.encode($);if(q&&U.length>q&&(U=U.slice(0,q)),this.writeUint8Array(U),q){const V=q-U.length;V&&(this._bytes.fill(0,this.currentPosition,this.currentPosition+V),this.increaseSize(V))}}toUint8Array(){return this._bytes.slice(0,this.byteLength)}toBuffer(){return this._buffer.slice(0,this.byteLength)}toString(){return this.toUint8Array().toString()}increaseSize($){this._position=this.currentPosition+$,this._byteLength=Math.max(this._byteLength,this.currentPosition)}checkAlloc($){const q=this.currentPosition+$;if(this._buffer.byteLength>=q)return;let U=this.byteLength;for(;U<q;)U+=this.incrementalSize;this.realloc(U)}realloc($){const q=new ArrayBuffer($),U=new Uint8Array(q);this._bytes&&U.set(this._bytes,0),this._buffer=q,this._bytes=U,this._view=new DataView(this._buffer),this._allocCount++,!this._allocWarned&&this._allocCount>5&&(console.warn("This BinaryWriter frequently reallocates itself. Try to avoid this by adjusting buffer settings.",this),this._allocWarned=!0)}}class BoxWriter{constructor($,q=1024,U=q){se(this,"_binaryWriter");this.name=$,this.initialBufferSize=q,this.incrementalSize=U,this._binaryWriter=new BinaryWriter(q,U),this._binaryWriter.writeUint32(0),this._binaryWriter.writeString($,4)}get byteLength(){return this._binaryWriter.byteLength}get capacity(){return this._binaryWriter.capacity}appendUint8($,q){this.writeKVHeader($,8/8),this._binaryWriter.writeUint8(q)}appendBoolean($,q){this.appendUint8($,q?1:0)}appendUint16($,q){this.writeKVHeader($,16/8),this._binaryWriter.writeUint16(q)}appendUint32($,q){this.writeKVHeader($,32/8),this._binaryWriter.writeUint32(q)}appendUint32Tuple($,q){this.writeKVHeader($,32/8+32/8),this._binaryWriter.writeUint32(q[0]),this._binaryWriter.writeUint32(q[1])}appendUint8Array($,q){this.writeKVHeader($,q.byteLength),this._binaryWriter.writeUint8Array(q)}appendString($,q){const U=this._binaryWriter.encode(q);this.appendUint8Array($,U)}appendBox($){const q=$.toUint8Array();this._binaryWriter.writeUint8Array(q)}toUint8Array(){const $=this._binaryWriter.currentPosition;return this._binaryWriter.seek(0),this._binaryWriter.writeUint32(this._binaryWriter.byteLength),this._binaryWriter.seek($),this._binaryWriter.toUint8Array()}toString(){return this.toUint8Array().toString()}writeKVHeader($,q){this._binaryWriter.writeUint32(this._calcKVByteLength(q)),this._binaryWriter.writeString($,4)}_calcKVByteLength($){return 8+$}}const CHUNK_NAME="chnk";function serializeChunk(B){const $=new BoxWriter("head",160,64);$.appendUint32("id",B.header.id),$.appendString("ver",B.header.version),$.appendUint16("idx",B.header.index),$.appendString("pid",B.header.packetId),$.appendUint32Tuple("rng",B.header.packetFrameRange),$.appendBoolean("fin",B.header.fin);const q=$.byteLength+B.body.length+8+8,U=new BoxWriter(CHUNK_NAME,q,64);return U.appendBox($),U.appendUint8Array("body",B.body),U.toUint8Array()}function stringifyChunk(B){return JSON.stringify(B,($,q)=>q instanceof Uint8Array?new TextDecoder().decode(q):q)}const MIN_SPLITTING_PACKET_SIZE=1024*1024;class ChunkSplitter{constructor($){se(this,"_chunkId",0);this.context=$}split($,q=1){$.data.length<MIN_SPLITTING_PACKET_SIZE&&(q=1);const U=[],V=Math.ceil($.data.length/q);for(let G=0;G*V<$.data.length;G++){const K=Math.min(G*V+V,$.data.length),J={header:{fin:K===$.data.length,id:this._nextChunkId(),index:G,packetId:$.id,packetFrameRange:$.frameRange,version:"1.0.0"},body:$.data.subarray(G*V,K)};U.push(J)}return U}_nextChunkId(){return this._chunkId++}}class StreamingTransmitter extends d$6{constructor(q){var J,W;super();se(this,"_connection");se(this,"_compensator");se(this,"_splitter");se(this,"_strategy");se(this,"_closing");se(this,"_splitChunks");se(this,"_splitCount");se(this,"_handleCompensate",()=>{this.context.emit("feedback",{type:SignalType.CompensateSnapshot,recordingId:this.context.id})});se(this,"_handleWebsocketMessage",q=>{if(q!=null&&!g$8(q)&&q.type===n$e.Command)switch(q.data.command){case e$5.SyncBlock:{this.context.emit("feedback",{type:SignalType.BlockCreated,block:q.data.block});break}case e$5.ReceiverStopped:{this.close();break}}});se(this,"_handleWebsocketConnectionClosed",()=>{this.context.stopRecording()});this.context=q,this._splitter=new ChunkSplitter(q),this._strategy=(J=q==null?void 0:q.transmitter)==null?void 0:J.strategy;const Z=Oe(Oe({},this.strategy.config),(W=q.options.modeOption)!=null?W:{}),{bufferSize:U,splitChunks:V,splitCount:G}=Z,K=Je(Z,["bufferSize","splitChunks","splitCount"]);this._splitChunks=V!=null?V:!0,this._splitCount=Math.min(Math.max(G!=null?G:5,1),5),this._connection=new F$1(q.env.getFullUrl(this.strategy.url,!0),K),this._connection.on("message",this._handleWebsocketMessage),this._connection.on("closed",this._handleWebsocketConnectionClosed),this._compensator=new StreamingCompensator(U)}get strategy(){return this._strategy}open(){return me(this,null,function*(){this._compensator.attach(this._connection),this._compensator.on("compensate",this._handleCompensate),yield this._connection.open()})}close(){return me(this,null,function*(){this._closing||(this._closing=new Promise((q,U)=>{this._connection.send({type:n$e.Command,data:{command:e$5.RecorderStopped}},!1),this._compensator.flush(),this._compensator.detach(),this._compensator.off("compensate",this._handleCompensate),this._connection.close().then(()=>{this._closing=void 0,q()}).catch(V=>{this._closing=void 0,U(V)})}))})}handleInput(q){return me(this,null,function*(){var U,V;if(this._splitChunks){const G=this._splitter.split(q,this._splitCount);for(const K of G)this._connection.send({type:n$e.Chunk,sequence:K.header.id,data:serializeChunk(K)})}else{const G=this._splitter.split(q,1)[0],J=yield((V=(U=this._strategy.packer)==null?void 0:U.compression.mode)!=null?V:"raw")==="gzip"?gzip(new TextEncoder().encode(stringifyChunk(G))):stringifyChunk(G);this._connection.send({type:n$e.Chunk,sequence:G.header.id,data:J})}})}}class RecordingFlow extends d$6{constructor(q){var W,Z,Q,ee,te;super();se(this,"_transmitter");se(this,"_frameBuffer");se(this,"_subscription");se(this,"_firstSnapshotFlushed",!1);se(this,"_shouldFlushFirstSnapshot",!1);this.context=q;const U=new DefaultPacker(q);let V=1e3;const G=(W=q.transmitter)==null?void 0:W.strategy;if((G==null?void 0:G.mode)===a$5.Streaming||(G==null?void 0:G.mode)===a$5.LiveStreaming)this._transmitter=new StreamingTransmitter(q),V=(Z=G.config.bufferTime)!=null?Z:1e3,this._shouldFlushFirstSnapshot=!0;else if((G==null?void 0:G.mode)===a$5.StreamingHttp)this._transmitter=new StreamingHttpTransmitter(q),V=(Q=G.config.bufferTime)!=null?Q:5e3,this._shouldFlushFirstSnapshot=!0;else if((G==null?void 0:G.mode)===a$5.Blocking){const ne=this.context.options.modeOption;this._transmitter=new BlockTransmitter(q),V=(te=(ee=ne==null?void 0:ne.bufferTime)!=null?ee:G.config.bufferTime)!=null?te:12e4}else this._transmitter=new BlobTransmitter(q);this._frameBuffer=new FrameBuffer({bufferTime:V});const K=new ProcessorContext(new Controller),J=new IncrementalProcessor(K,q);this.pipe(K.controller.asPipeable()).pipe(J.asPipeable()).pipe(this._frameBuffer.asPipeable()).pipe(U.asPipeable()).pipe(this._transmitter.asPipeable())}subscribe(q){this._subscription=q.subscribe(U=>{this.handleInput(U)})}handleInput(q){this.output(q),this._shouldFlushFirstSnapshot&&!this._firstSnapshotFlushed&&(this._firstSnapshotFlushed=!0,this._frameBuffer.flush())}open(){return me(this,null,function*(){this._firstSnapshotFlushed=!1,yield this._transmitter.open()})}close(){return me(this,null,function*(){var q;this.output(c$8(o$e.now())),(q=this._subscription)==null||q.unsubscribe(),yield this._frameBuffer.flush(),this._frameBuffer.dispose(),yield this._transmitter.close(),this._firstSnapshotFlushed=!1})}dump(){return me(this,null,function*(){if(this._transmitter.dump)return this._transmitter.dump();throw new RecordingError(`Transmitter for \'${this.context.recording.id}\' does not support dumping.`)})}}class RecordingManagerImpl{constructor($){se(this,"input");se(this,"_retry");se(this,"env");se(this,"apiClient");se(this,"htmlProcessor");se(this,"insightProcessor");se(this,"networkProcessor");se(this,"_processorContext");se(this,"_cacheOptions");se(this,"_blackboxOptions");se(this,"_blockingOptions");se(this,"_streamingOptions");se(this,"_blackboxProcessor");se(this,"_events",new EventEmitter);se(this,"_contextMap",new Map);se(this,"_flowMap",new Map);se(this,"handleFeedback",$=>{switch($.type){case SignalType.CompensateSnapshot:this.htmlProcessor.captureSnapshotFrame(q=>{if(!q)return;const U=this._flowMap.get($.recordingId);U&&U.output(q)});break}});se(this,"_handleFrame",$=>{this._emit("frame",$)});this._retry=new y$4;const{environment:q,html:U,network:V,insight:G,interceptors:K,interceptRequest:J}=$;this.env=new E$2(q),this.apiClient=new APIClient(this.env),K&&(this.apiClient.interceptors=K),J&&(this.apiClient.requestInterceptor=J),this._processorContext=new ProcessorContext(new Controller),this._processorContext.trackTypes=normalizeTrackTypes($.trackers),this.htmlProcessor=new HTMLProcessor(this._processorContext,U),this.networkProcessor=new NetworkProcessor(this._processorContext,V),this.insightProcessor=new InsightProcessor(this._processorContext,G),this._initCacheOptions($),this._initBlackboxOptions($),this._blockingOptions=$.blocking,this._streamingOptions=$.streaming}observe($){let q=$.pipe(this._processorContext.controller.asPipeable()).pipe(this.htmlProcessor.asPipeable()).pipe(this.networkProcessor.asPipeable());this.insightProcessor&&(q=q.pipe(this.insightProcessor.asPipeable())),this.input=q.pipe(tap(this._handleFrame)).pipe(share())}initOptions($,q){return me(this,null,function*(){var U,V,G,K,J;o$e.sync(q.mainTime),this.env.baseURL=(U=$.environment)==null?void 0:U.baseURL,this.env.type=(V=$.environment)==null?void 0:V.type,this.env.apiPrefix=(G=$.environment)==null?void 0:G.apiPrefix,this.env.headers=(K=$.environment)==null?void 0:K.headers,$.interceptors&&(this.apiClient.interceptors=$.interceptors),$.interceptRequest&&(this.apiClient.requestInterceptor=$.interceptRequest),this._initBlackboxOptions($),this._blockingOptions=$.blocking,this._streamingOptions=$.streaming,this.htmlProcessor.initOptions($.html),this.networkProcessor.initOptions($.network),(J=this.insightProcessor)==null||J.initOptions($.insight)})}createRecordingContext($){return me(this,null,function*(){if(!this.input)throw new Error("Tracking source is not ready.");const{recording:q,transport:U}=yield createRecording(this.apiClient,$),V=Ne(Oe({},q),{createTime:new Date(q.createTime).getTime()}),G=Ne(Oe({},$),{transport:U});let K;if($.mode===a$5.Blackbox?K=new BlackboxRecordingContext(this,V,G):$.mode===a$5.InMemory?K=new InMemoryRecordingContext(this,V,G):($.mode===a$5.Blocking?G.modeOption=this._blockingOptions:($.mode===a$5.Streaming||$.mode===a$5.StreamingHttp)&&(G.modeOption=this._streamingOptions),K=new RecordingContext(this,V,G)),K.on("feedback",this.handleFeedback),$.mode===a$5.Blackbox){if(!this._blackboxProcessor){const J=new BlackboxProcessor(this.input,this.apiClient,this._processorContext,this._blackboxOptions);this._blackboxProcessor=J,this._contextMap.size>0&&(yield this.htmlProcessor.captureSnapshotFrame(W=>{W!=null&&(W.time=K.startTime,J.handleInput(W))}))}this._blackboxProcessor.join(K)}else{const J=new RecordingFlow(K);yield J.open(),J.subscribe(this.input),this._contextMap.size>0&&(yield this.htmlProcessor.captureSnapshotFrame(W=>{W!=null&&(W.time=K.startTime,J.handleInput(W))})),this._flowMap.set(V.id,J)}return this._contextMap.set(K.id,K),this._emit("startRecording",K.recording),K})}stopRecordingContext($){return me(this,null,function*(){const q=this._flowMap.get($);q&&(yield q.close()),this._cleanRecordingContext($)})}_cleanRecordingContext($){const q=this._contextMap.get($);q&&(this._contextMap.delete($),this._blackboxProcessor&&(this._blackboxProcessor.remove(q),this._blackboxProcessor.getSize()===0&&(this._blackboxProcessor.dispose(),this._blackboxProcessor=void 0)));const U=this._flowMap.get($);U&&(this._flowMap.delete($),U.context.off("feedback",this.handleFeedback),U.context.emit("stopped")),q&&this._emit("stopRecording",q.recording)}dumpRecording($,q){return me(this,null,function*(){if(this._flowMap.has($))return this._flowMap.get($).dump();if(this._blackboxProcessor){const U={meta:q},V=yield this._blackboxProcessor.dump($,U);return this._emit("dumpRecording",Ne(Oe({},V),{parent:$,refType:"blackbox"})),V}throw new RecordingError(`Unknown recording ${$}.`)})}dumpInMemoryRecording($,q){return me(this,null,function*(){if(this._blackboxProcessor)return this._blackboxProcessor.dumpInMemory($,{meta:q})})}cacheRecordings(){return me(this,null,function*(){return this._blackboxProcessor?this._blackboxProcessor.cache():[]})}uploadRecordingCaches(){return me(this,null,function*(){var $;try{const q=($=this._cacheOptions)==null?void 0:$.storageProvider.getStorage();if(q){const U=yield q.getRecordings();this._uploadRecordingCaches(U,q)}}catch(q){}})}_uploadRecordingCaches($,q){return me(this,null,function*(){for(const U of $){try{const{frames:V,startTime:G,endTime:K,mode:J,recordingOptions:W}=U;if(J===a$5.Blackbox){const{recording:Z,transport:Q}=yield createRecording(this.apiClient,W),ee=Q.strategies.find(ne=>ne.mode===a$5.Blackbox&&"channelType"in ne),te=yield pack(encode(V,G),V.length,V[0].time,K,Z.id,G,!0);yield this._retry.attempt(()=>createBlock(this.apiClient,{blob:new Blob([te.data],{type:"application/octet-stream"}),recordingId:Z.id,token:ee.config.token,offset:te.frameRange[0],count:te.frameRange[1],firstFrameTime:te.firstFrameTime,lastFrameTime:te.lastFrameTime,isEOF:te.isEOF}))}}catch(V){}yield q.deleteRecordings(U)}})}_initCacheOptions($){const q=Oe({limit:10},typeof($==null?void 0:$.cache)=="boolean"?{}:$.cache);q.storageProvider||(q.storageProvider=new n$o),this._cacheOptions=q}_initBlackboxOptions($){this._blackboxOptions=Ne(Oe({},$.blackbox),{cache:this._cacheOptions})}_emit($,...q){this._events.emit($,...q)}on($,q){this._events.on($,q,{})}once($,q){this._events.once($,q,{})}off($,q,U,V){this._events.off($,q,{},V)}addListener($,q){this._events.addListener($,q,{})}removeListener($,q,U,V){this._events.removeListener($,q,{},V)}}class InMemoryRecordingTransferHandler{canHandle($){return $ instanceof s$5}serialize($){const{port1:q,port2:U}=new MessageChannel;if($ instanceof s$5){const V={id:$.id,frames:$.frames,createTime:$.createTime,duration:$.duration,mode:$.mode,environment:$.environment,meta:$.meta,trackers:$.trackers};q.postMessage({type:"InMemoryRecordingManifest",value:{id:r$7(),staticProperties:V,exposeMethods:["getReader"]}})}return expose($,q),[U,[U]]}deserialize($){let q;const U=new Set,V=new Set,G=new Set,K=wrap$1($),J=new Proxy(K,{get(Z,Q,ee){const te=Q;if(!q)throw new Error("InMemoryRecording manifest not found from worker");if(U.has(te))return q.staticProperties[te];const ne=Reflect.get(Z,Q,ee);if(V.has(te))return(...oe)=>{const ce=oe.map(pe=>{if(typeof pe=="function"){const he=proxy(pe);return G.add(he),he}return pe});return Reflect.apply(ne,Z,[...ce])};if(Q==="then"||Q===releaseProxy)return ne}});return new Promise(Z=>{const Q=ee=>{typeof ee.data=="object"&&ee.data.type==="InMemoryRecordingManifest"&&(q=ee.data.value,Object.keys(q.staticProperties).forEach(te=>{U.add(te)}),q.exposeMethods.forEach(te=>{V.add(te)}),Z(),$.removeEventListener("message",Q))};$.addEventListener("message",Q,!0),$.start()}).then(()=>J)}}var TransferPosition=(B=>(B.Worker="worker",B.Main="main",B))(TransferPosition||{});class RecordingContextTransferHandler{constructor($){this.position=$}canHandle($){return $ instanceof RecordingContext}serialize($){const{port1:q,port2:U}=new MessageChannel;if($ instanceof RecordingContext){const V={id:$.id,startTime:$.startTime,recording:$.recording,transmitter:$.transmitter,baseURL:$.baseURL,trackers:$.trackers};$ instanceof BlackboxRecordingContext&&(V.dumpConfig=$.dumpConfig),q.postMessage({type:"RecordingContextManifest",value:{id:r$7(),staticProperties:V,exposeMethods:["on","once","off","stopRecording","cacheRecordings","dumpRecording","dumpInMemoryRecording","getDumpConfig","addListener","removeListener"]}})}return expose($,q),[U,[U]]}deserialize($){let q;const U=new Set,V=new Set,G=wrap$1($),K=new Proxy(G,{get(W,Z,Q){const ee=Z;if(!q)throw new Error("RecordingContext manifest not found from worker");if(U.has(ee))return q.staticProperties[ee];if(ee==="toString")return()=>JSON.stringify(q==null?void 0:q.staticProperties.recording);const te=Reflect.get(W,Z,Q);if(V.has(ee))return(...ne)=>{const oe=ne.map(le=>typeof le=="function"?proxy(le):le);return Reflect.apply(te,W,[...oe])};if(Z==="then"||Z===releaseProxy)return te}});return new Promise(W=>{const Z=Q=>{typeof Q.data=="object"&&Q.data.type==="RecordingContextManifest"&&(q=Q.data.value,Object.keys(q.staticProperties).forEach(ee=>{U.add(ee)}),q.exposeMethods.forEach(ee=>{V.add(ee)}),W(K),$.removeEventListener("message",Z))};$.addEventListener("message",Z,!0),$.start()})}}let isInitialized=!1;function createRecordingManagerWorker(B){if(!_isInWorker())throw new Error("createRecordingManagerWorker must be called in a WebWorker");_init();const $=workerBridge(),q=new RecordingManagerImpl(B);q.observe($),expose(q)}function _isInWorker(){return typeof globalThis.WorkerGlobalScope!="undefined"&&self instanceof globalThis.WorkerGlobalScope}function _init(){if(!isInitialized){try{self.window=self}catch(B){}transferHandlers.set("RecordingContext",new RecordingContextTransferHandler(TransferPosition.Worker)),transferHandlers.set("InMemoryRecording",new InMemoryRecordingTransferHandler),isInitialized=!0}}createRecordingManagerWorker({})})();\n',Qy=typeof self!="undefined"&&self.Blob&&new Blob([Xy],{type:"text/javascript;charset=utf-8"});function Yy(r){let e;try{if(e=Qy&&(self.URL||self.webkitURL).createObjectURL(Qy),!e)throw"";let t=new Worker(e,{name:r==null?void 0:r.name});return t.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),t}catch(t){return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(Xy),{name:r==null?void 0:r.name})}finally{e&&(self.URL||self.webkitURL).revokeObjectURL(e)}}var T7=Z(Q()),dR=Object.defineProperty,pR=Object.defineProperties,fR=Object.getOwnPropertyDescriptors,eb=Object.getOwnPropertySymbols,mR=Object.prototype.hasOwnProperty,gR=Object.prototype.propertyIsEnumerable,Hh=(r,e,t)=>e in r?dR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tb=(r,e)=>{for(var t in e||(e={}))mR.call(e,t)&&Hh(r,t,e[t]);if(eb)for(var t of eb(e))gR.call(e,t)&&Hh(r,t,e[t]);return r},vR=(r,e)=>pR(r,fR(e)),Ee=(r,e,t)=>Hh(r,typeof e!="symbol"?e+"":e,t),Un=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Wr=class extends R.default{constructor(e,t){super(),Ee(this,"context"),Ee(this,"trackers",[]),Ee(this,"options"),Ee(this,"_trackTypes"),Ee(this,"_activeRecordingIds",new Set),Ee(this,"_recordingManager",null),Ee(this,"_trackerSource",null),Ee(this,"_initialHandler"),Ee(this,"_initialTasks",[]),Ee(this,"_cachedTokens",new Map),Ee(this,"_apiClient"),Ee(this,"_watchRecordingStop",o=>Un(this,null,function*(){var s;(s=me.global)==null||s.stopRecording(o),this._activeRecordingIds.delete(o.id),this._cachedTokens.delete(o.id),this.isRecording()||this._stopTracking(),this.emit("stopRecording",o)})),Ee(this,"_watchRecordingDump",o=>Un(this,null,function*(){var s;(s=me.global)==null||s.dumpRecording(o),this.emit("dumpRecording",o)})),Ee(this,"_watchRecordingFrame",o=>{this.emit("frame",o)}),Ee(this,"_handleBeforeUnload",()=>Un(this,null,function*(){for(let[o,s]of this._cachedTokens.entries())My(this._apiClient,{recordingId:o,token:s});this.options.cache&&(yield this.isRecording())&&this.recordingManager.cacheRecordings()})),this.mode=e;let n=bo(t==null?void 0:t.trackers);this.options=vR(tb({},t),{trackers:n}),this._trackTypes=n;let i=new Ae(t==null?void 0:t.environment);this.context=new _o(i),this._apiClient=new rt(i)}static get version(){return dr}get recordingManager(){return this._recordingManager==null&&(this._recordingManager=this.createRecordingManager()),this._recordingManager}get trackerSource(){return this._trackerSource}addInitialTask(e){this._initialTasks.push(e)}getManager(){return this._recordingManager}getTracker(e){let t;T(e)?t=w[e]:t=e;let n=this.trackers.find(i=>i.trackType===t);if(!n)throw new Error(`TrackType ${t} not found`);return n}registerTracker(e){let t=Reflect.construct(e,[this.context]);Gs(t.trackType),ku(t.trackType,this._trackTypes),this.trackers.push(t),this._trackTypes.push(t.trackType)}startRecording(e){return Un(this,null,function*(){var t,n,i,o;yield this._initialize();let s=yield this.recordingManager.createRecordingContext(tb({clientTime:new Date().toISOString(),startTime:P(),environment:this.getEnvironment(),mode:E.StreamingHttp,trackers:this._trackTypes},e));return((t=this.options.html)!=null&&t.iframe||e.refType==="iframe")&&(me.global&&me.global.setRecorder(this),(n=me.global)==null||n.startRecording(e,s.recording)),this._startTracking(),this.emit("startRecording",s.recording),this._activeRecordingIds.add(s.recording.id),(e.mode===E.Blocking||e.mode===E.StreamingHttp)&&this._cachedTokens.set(s.recording.id,((o=(i=s.transmitter)==null?void 0:i.strategy)==null?void 0:o.config).token),s})}getEnvironment(){return fu()}dumpRecording(e,t){return Un(this,null,function*(){return yield this.recordingManager.dumpRecording(e,t)})}stopRecording(e){return Un(this,null,function*(){yield this.recordingManager.stopRecordingContext(e)})}isRecording(){return this._activeRecordingIds.size>0}track(e,t){let n=this.getTracker(e);return n!=null?(n.track(t),!0):!1}_initialize(){return this._initialHandler||(this._initialHandler=Promise.all([new Promise(e=>{this._initTrackers(),this.onInit(),this._trackerSource=Tu(...this.trackers.map(t=>t.output)),e()}),this._waitUntilPageLoaded(),...this._initialTasks])),this._initialHandler}_waitUntilPageLoaded(){return!document||document.readyState==="complete"?Promise.resolve():new Promise(e=>{document.addEventListener("readystatechange",()=>{if(document.readyState==="complete")return e()})})}_initTrackers(){if(X(this._trackTypes,w.HTML)){let e=new fo(this.context,this.options.html);this.context.snapshotCapturer=e.snapshotCapturer,this.trackers.push(e)}if(X(this._trackTypes,w.Mouse)){let e=new go(this.context,this.options.mouse);this.trackers.push(e)}if(X(this._trackTypes,w.Keyboard)){let e=new mo(this.context,this.options.keyboard);this.trackers.push(e)}if(X(this._trackTypes,w.Console)){let e=new Rh(this.context,this.options.console);this.trackers.push(e)}if(X(this._trackTypes,w.Error)){let e=new po(this.context);this.trackers.push(e)}if(X(this._trackTypes,w.Network)){let e=new Uh(this.context,this.options.network);this.trackers.push(e)}if(X(this._trackTypes,w.Performance)){let e=new vo(this.context,this.options.performance);this.trackers.push(e)}}onInit(){}_startTracking(){this._subscribeRawEvents();for(let e of this.trackers)e.isActive||e.activate();this._resumeRecordings()}_stopTracking(){this._unsubscribeRawEvents();for(let e of this.trackers)e.deactivate()}_subscribeRawEvents(){window.addEventListener("beforeunload",this._handleBeforeUnload,!0)}_unsubscribeRawEvents(){window.removeEventListener("beforeunload",this._handleBeforeUnload,!0)}_resumeRecordings(){this.options.autoUploadingCache&&setTimeout(()=>{this.recordingManager.uploadRecordingCaches()},1e3)}};var Pn=(r=>(r.Standard="standard",r.Multithreaded="multithreaded",r))(Pn||{});var _R=Object.defineProperty,yR=Object.defineProperties,bR=Object.getOwnPropertyDescriptors,rb=Object.getOwnPropertySymbols,$R=Object.prototype.hasOwnProperty,wR=Object.prototype.propertyIsEnumerable,zh=(r,e,t)=>e in r?_R(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xR=(r,e)=>{for(var t in e||(e={}))$R.call(e,t)&&zh(r,t,e[t]);if(rb)for(var t of rb(e))wR.call(e,t)&&zh(r,t,e[t]);return r},qR=(r,e)=>yR(r,bR(e)),nb=(r,e,t)=>zh(r,typeof e!="symbol"?e+"":e,t),Fr=class extends Wr{constructor(e){super(Pn.Multithreaded,e),nb(this,"_workerProvider"),nb(this,"_worker"),this._verifyOptions(this.options),this._workerProvider=e==null?void 0:e.worker}get worker(){return this._worker==null&&(this._workerProvider==null?this._worker=new Yy:T(this._workerProvider)?this._worker=new Worker(this._workerProvider,{type:"module"}):re(this._workerProvider)?this._worker=new this._workerProvider:this._worker=this._workerProvider),this._worker}createRecordingManager(){this.addInitialTask(new Promise(n=>{if(this.trackerSource){let i=new Qa(this.worker);this.trackerSource.pipe(i.asPipeable())}else throw new Ve("Trackers must be initialized before creating recording manager.");n()}));let e=jh(this.worker),t=new Ae(this.options.environment);return this.addInitialTask(e.initOptions(Cn(qR(xR({},this.options),{environment:t.toOptions()})),{mainTime:P()})),e.on("stopRecording",kt(this._watchRecordingStop)),e.on("dumpRecording",kt(this._watchRecordingDump)),e.on("frame",kt(this._watchRecordingFrame)),e}_verifyOptions(e){var t,n;e.interceptRequest&&(e.interceptRequest=String(this.options.interceptRequest));try{(t=this.options.html)!=null&&t.dataMasks&&(this.options.html.dataMasks=ws(this.options.html.dataMasks)),(n=this.options.network)!=null&&n.dataMasks&&(this.options.network.dataMasks=ws(this.options.network.dataMasks))}catch(i){throw new Ve(i.message)}}};var TR=Object.defineProperty,BR=(r,e,t)=>e in r?TR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ib=(r,e,t)=>BR(r,typeof e!="symbol"?e+"":e,t),An=class{constructor(e){ib(this,"envelop"),ib(this,"_source"),this.envelop=e.envelop,this._source=e.source}message(){return this.envelop.message}sourceId(){return this.envelop.fromId}sourceWindow(){return dt(this._source)?this._source:null}};var SR=Object.defineProperty,ER=(r,e,t)=>e in r?SR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,To=(r,e,t)=>ER(r,typeof e!="symbol"?e+"":e,t),Bo=class extends R.default{constructor(e){super(),To(this,"uuid"),To(this,"_connections",new WeakMap),To(this,"_allowedOrigins",new Set),To(this,"_handleMessage",t=>{let{origin:n,source:i,data:o}=t;if(this.isAllowedOrigin(n))try{if(Bh(o)){let s=new An({origin:n,source:i,envelop:o});switch(s.message().type){case De.Handshake:i&&(this._sendMessage({type:De.Connected,payload:{}},i),this._connections.get(i)||this.handshake(i));break;case De.Connected:if(i){if(this._connections.get(i))return;this._connections.set(i,n)}break;default:break}this.onReceive(s)}}catch(s){}}),To(this,"_handleSelfUnload",t=>{t.currentTarget&&this._connections.has(t.currentTarget)&&(this._connections.delete(t.currentTarget),this.onReceive(new An({origin,source:t.currentTarget,envelop:this._newEnvelop({type:De.Stopped,payload:{}})})))}),this.options=e,this.uuid=ve(),globalThis.addEventListener("message",this._handleMessage),globalThis.addEventListener("beforeunload",this._handleSelfUnload),globalThis.addEventListener("DOMContentLoaded",()=>{globalThis.removeEventListener("message",this._handleMessage),globalThis.removeEventListener("beforeunload",this._handleSelfUnload),globalThis.addEventListener("message",this._handleMessage),globalThis.addEventListener("beforeunload",this._handleSelfUnload)})}get connections(){return this._connections}isAllowedOrigin(e){return this._allowedOrigins.size===0?!0:this._allowedOrigins.has(e)}addAllowedOrigins(...e){for(let t of e)this._allowedOrigins.add(t)}handshake(e){this._connections.get(e)||this._sendMessage({type:De.Handshake,payload:{}},e)}send(e,t){this._sendMessage(e,t)}_sendMessage(e,t){var n,i;if(dt(t)){let o=this._connections.get(t);t.postMessage(this._newEnvelop(e),(i=o!=null?o:(n=this.options)==null?void 0:n.targetOrigin)!=null?i:"*")}else t.postMessage(this._newEnvelop(e))}_newEnvelop(e){return{id:ve(),fromId:this.uuid,topic:Dr,message:e}}};var t9=Z(Q()),kR=Object.defineProperty,RR=Object.defineProperties,OR=Object.getOwnPropertyDescriptors,ob=Object.getOwnPropertySymbols,CR=Object.prototype.hasOwnProperty,IR=Object.prototype.propertyIsEnumerable,Jh=(r,e,t)=>e in r?kR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,So=(r,e)=>{for(var t in e||(e={}))CR.call(e,t)&&Jh(r,t,e[t]);if(ob)for(var t of ob(e))IR.call(e,t)&&Jh(r,t,e[t]);return r},sb=(r,e)=>RR(r,OR(e)),ab=(r,e,t)=>Jh(r,typeof e!="symbol"?e+"":e,t);var Eo=class extends Bo{constructor(e){super({namespace:"data.dp.bytereplay.iframe",targetOrigin:"*"}),ab(this,"localRecordings",new Map),ab(this,"mapping",new Map),this._options=e,globalThis.self&&globalThis.self.parent!==globalThis.self&&this.handshake(globalThis.self.parent)}onReceive(e){var t,n,i;let o=e.message(),s=e.sourceWindow();switch(o.type){case De.Stopped:this.send({type:De.Disconnected,payload:{}},window.parent);break;case De.Connected:if(s&&this.connections.has(s)&&s!==globalThis.self.parent){try{(t=me.global)!=null&&t.recorder&&this.send({type:"InitRecorder",payload:{options:Cn(So({},(n=me.global.recorder)==null?void 0:n.options))}},s)}catch(c){console.error("send InitRecorder",c)}this.localRecordings.forEach((c,u)=>{this.send({type:"StartRecording",payload:sb(So({},c),{parent:u,refType:"iframe"})},s)})}break;case De.Disconnected:s&&this.emit("unload",s);break;case"InitRecorder":(i=me.global)==null||i.initRecorder(o.payload.options);break;case"StartRecording":o.payload.parent&&this._options.onParentStart(o.payload);break;case"DumpRecording":let a=this.mapping.get(o.payload.id);a&&this._options.onParentDump(a,o.payload.meta);break;case"StopRecording":let l=this.mapping.get(o.payload.id);l&&this._options.onParentStop(l);break;case"RecordingStarted":this.emit("recordingStarted",o.payload,s);break;case"RecordingStopped":this.emit("recordingStopped",o.payload,s);break}}get children(){let e=document.querySelectorAll("iframe"),t=[];for(let n=0;n<e.length;n++){let{contentWindow:i}=e[n];if(i!=null){let o=this.connections.get(i);o!=null&&t.push({id:o,target:i})}}return t}initRecorder(e){var t;let n=(t=e.html)==null?void 0:t.iframe;typeof n=="object"&&n.allowOrigins&&this.addAllowedOrigins(...n.allowOrigins),this.children.forEach(({id:i,target:o})=>{i!=null&&this.send({type:"InitRecorder",payload:{options:Cn(So({},e))}},o)})}startRecording(e,t){this.localRecordings.set(t.id,e),this.children.forEach(({id:n,target:i})=>{n!=null&&this.send({type:"StartRecording",payload:sb(So({},e),{parent:t.id,refType:"iframe"})},i)})}dumpRecording(e){this.children.forEach(({id:t,target:n})=>{t!=null&&e.parent&&this.send({type:"DumpRecording",payload:{id:e.parent,meta:e.meta}},n)})}sendStartedToParent(e,t){if(e.parent){let n=So({},t.recording);t.recording.mode===E.Blackbox&&(n.id=t.dumpConfig.id),this.send({type:"RecordingStarted",payload:{recording:n,parentId:e.parent}},window.parent),this.mapping.set(e.parent,t.id)}}stopRecording(e){this.children.forEach(({id:t,target:n})=>{t!=null&&n!==self.parent&&this.send({type:"StopRecording",payload:{id:e}},n)})}sendStoppedToParent(e){let t=this.localRecordings.get(e);t!=null&&t.parent&&this.send({type:"RecordingStopped",payload:{recordingId:e,parentId:t.parent}},window.parent)}connect(e,t){var n;try{if(!this.isAllowedOrigin(t.origin))return;this.handshake(e),!t.isCrossOrigin&&e&&e.document&&((n=me.global)==null||n.inject(e))}catch(i){}}};var MR=Object.defineProperty,UR=(r,e,t)=>e in r?MR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lb=(r,e,t)=>UR(r,typeof e!="symbol"?e+"":e,t);function PR(r,e){if(globalThis.__bytereplay_bridge__){let i=globalThis.__bytereplay_bridge__;i==null||i.initRecorder(e);return}let t;self.define&&self.define.amd&&(t=self.define.amd,self.define.amd=void 0);let n=document.createElement("script");n.src=r,n.crossOrigin="anonymous",n.onload=()=>{let i=globalThis.__bytereplay_bridge__;i==null||i.initRecorder(e),t&&(self.define.amd=t)},n.onerror=()=>{t&&(self.define.amd=t)},self.document.body.append(n)}function Zh(r,e,t){typeof r.eval=="function"&&r.eval(`(${PR.toString()})('${e}', ${JSON.stringify(t||{})})`)}var sl=class{constructor(){lb(this,"recorder"),lb(this,"iframe"),this.iframe=new Eo({onParentStart:e=>{var t;(t=this.recorder)==null||t.startRecording(e).then(n=>{this.iframe.sendStartedToParent(e,n)})},onParentDump:(e,t)=>{var n,i;(i=(n=this.recorder)==null?void 0:n.getManager())==null||i.dumpRecording(e,t)},onParentStop:e=>{var t;(t=this.recorder)==null||t.stopRecording(e).then(()=>{this.iframe.sendStoppedToParent(e)})}})}inject(e){var t,n,i;let o=(n=(t=this.recorder)==null?void 0:t.options.html)==null?void 0:n.iframe;if(typeof o!="object"||!o.autoInject||!o.injectScript)return;let s=o.injectScript;e.document&&e.document.body&&e.document.body.children.length>0&&Zh(e,s,(i=this.recorder)==null?void 0:i.options),e.addEventListener("load",()=>{var a;Zh(e,s,(a=this.recorder)==null?void 0:a.options)},{once:!0}),e.addEventListener("DOMContentLoaded",()=>{var a;Zh(e,s,(a=this.recorder)==null?void 0:a.options)})}setRecorder(e){this.recorder=e,this.iframe.initRecorder(e.options)}initRecorder(e){e==null||delete e.worker,this.setRecorder(new Fr(e))}startRecording(e,t){this.iframe.startRecording(e,t)}dumpRecording(e){this.iframe.dumpRecording(e)}stopRecording(e){this.iframe.stopRecording(e.id)}},AR=new sl;globalThis[Ka]=AR;var Ue=(r=>(r.CompensateSnapshot="CompensateSnapshot",r.BlockCreated="BlockCreated",r.FrameIndex="FrameIndex",r))(Ue||{});var ko=class extends Qe{dumpRecording(){return super.dumpRecording()}};function Dn(r,e){let t=r.map(i=>JSON.stringify([i.time-e,i.trackType,i.event.eventType,i.event.data]));t.push("");let n=t.join(`
`);return new TextEncoder().encode(n)}var DR=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())});function Vn(r){return DR(this,null,function*(){if(wt.compressionStream())try{let e=lu(r),t=new globalThis.CompressionStream("gzip"),n=e.pipeThrough(t);return yield uu(n)}catch(e){}return Jy(r)})}var VR=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())});function al(r,e,t,n,i,o,s){return VR(this,null,function*(){let a=yield Vn(r);return{id:`${i}/0`,frameRange:[0,e],data:a,firstFrameTime:t-o,lastFrameTime:n-o,isEOF:s}})}var NR=Object.defineProperty,LR=(r,e,t)=>e in r?NR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cb=(r,e,t)=>LR(r,typeof e!="symbol"?e+"":e,t),Xe=class extends J{constructor(e,t){if(super(),cb(this,"_trackTypesToHandle"),cb(this,"_context"),this._context=e,t!=null){let n={};Array.isArray(t)?t.forEach(i=>{n[i]=!0}):n[t]=!0,this._trackTypesToHandle=n}}handleInput(e){this._shouldHandle(e)?this.handleFrame(e):this.output(e)}_shouldHandle(e){return this._trackTypesToHandle==null||this._trackTypesToHandle[e.trackType]===!0}};var GR=Object.defineProperty,WR=Object.defineProperties,FR=Object.getOwnPropertyDescriptors,ub=Object.getOwnPropertySymbols,KR=Object.prototype.hasOwnProperty,jR=Object.prototype.propertyIsEnumerable,Qh=(r,e,t)=>e in r?GR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kr=(r,e)=>{for(var t in e||(e={}))KR.call(e,t)&&Qh(r,t,e[t]);if(ub)for(var t of ub(e))jR.call(e,t)&&Qh(r,t,e[t]);return r},hb=(r,e)=>WR(r,FR(e)),Le=(r,e,t)=>Qh(r,typeof e!="symbol"?e+"":e,t),ll=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),HR=12e4,cl=class extends Xe{constructor(e,t,n,i){var o,s,a;super(n),Le(this,"_apiClient"),Le(this,"_subscription"),Le(this,"_queue",[]),Le(this,"_contextMap",new Map),Le(this,"_virtualRenderer",new vt),Le(this,"_cacheLimit"),Le(this,"_storage"),Le(this,"_retry",new nt),Le(this,"_bufferTime"),Le(this,"_startTime",0),Le(this,"_endTime",0),Le(this,"_endRealTime",0),Le(this,"_hasRotated",!1),this._subscription=e.subscribe(l=>this.handleInput(l)),this._apiClient=t,this._bufferTime=(o=i==null?void 0:i.bufferTime)!=null?o:HR,this._cacheLimit=(s=i==null?void 0:i.cache)==null?void 0:s.limit,this._storage=(a=i==null?void 0:i.cache)==null?void 0:a.storageProvider.getStorage()}join(e){this._contextMap.set(e.id,e)}remove(e){this._contextMap.delete(e.id)}getSize(){return this._contextMap.size}handleFrame(e){this._enqueue(e)}cache(){return ll(this,null,function*(){let e=[];if(this._storage&&this.getSize()>0){let t=yield this._createFrames(),n=this._calculateClientTime(t);for(let[i,o]of this._contextMap.entries()){let s=this._createRecordingOptions(i,o,n),a={id:s.id,frames:t,startTime:this._startTime,endTime:this._endTime,mode:E.Blackbox,recordingOptions:s};yield this._storage.deleteRecordings(a),yield this._storage.putRecordings([a],this._cacheLimit),e.push(a.id)}}return e})}dump(e,t){return ll(this,null,function*(){let n=this._contextMap.get(e);if(!n)throw new Error("Blackbox recording not found");let i=yield this._createFrames(),o=this._calculateClientTime(i),s=this._createRecordingOptions(e,n,o,t),{recording:a,transport:l}=yield yo(this._apiClient,s),c=l.strategies.find(d=>d.mode===E.Blackbox&&"channelType"in d),u=yield al(Dn(i,this._startTime),i.length,i[0].time,this._endTime,a.id,this._startTime,!0);yield this._retry.attempt(()=>On(this._apiClient,{blob:new Blob([u.data],{type:"application/octet-stream"}),recordingId:a.id,token:c.config.token,offset:u.frameRange[0],count:u.frameRange[1],firstFrameTime:u.firstFrameTime,lastFrameTime:u.lastFrameTime,isEOF:u.isEOF}));let h=l.strategies.find(d=>d.name==="blackbox-record-dump");if(h){let d=h.config;n.dumpConfig=d}else n.dumpConfig={id:ve(),token:s.token};return{id:a.id,mode:E.Blackbox,createTime:new Date(a.createTime).getTime(),meta:a.meta,environment:a.environment}})}dumpInMemory(e,t){return ll(this,null,function*(){let n=this._contextMap.get(e);if(!n)throw new Error("Blackbox recording not found");let i=yield this._createFrames();return i.forEach(o=>o.time-=this._startTime),Vt.from(e,i,hb(Kr({},t),{createTime:this._calculateClientDate(i).getTime(),trackers:n.trackers,environment:n.recording.environment,meta:Kr(Kr({},n.recording.meta),t==null?void 0:t.meta)}))})}dispose(){this._subscription.unsubscribe(),this._queue.splice(0,this._queue.length),this._contextMap.clear(),this._virtualRenderer.reset(),this._virtualRenderer=new vt}_enqueue(e){this._queue.length===0&&e.trackType===w.HTML&&e.event.eventType===m.HTMLSnapshot&&(this._startTime=e.time),this._queue.push(e),this._rotate(e.time)}_rotate(e){this._endTime=e,this._endRealTime=P();let t=e-this._bufferTime,n;for(;(n=this._queue[0])&&n.time<t;)this._queue.shift(),this._virtualRenderer.performEvent(n.event),this._startTime=n.time,this._hasRotated=!0;t>this._startTime&&(this._startTime=t)}_createRecordingOptions(e,t,n,i){return hb(Kr(Kr({},i),t.dumpConfig),{clientTime:n,mode:E.Blackbox,parent:e,refType:"blackbox",trackers:t.trackers,environment:t.recording.environment,meta:Kr(Kr({},t.recording.meta),i==null?void 0:i.meta)})}_createFrames(){return ll(this,null,function*(){let e=P()-this._endRealTime,t=this._endTime+e;this._rotate(t);let n=[...this._queue];if(n.length===0||this._hasRotated){let i=yield this._virtualRenderer.captureSnapshot(),o={trackType:w.HTML,time:this._startTime,event:{eventType:m.HTMLSnapshot,data:i}};n.unshift(o),this._hasRotated=!1}return n})}_calculateClientTime(e){return this._calculateClientDate(e).toISOString()}_calculateClientDate(e){return e.length===0?new Date:new Date(Date.now()-(e[e.length-1].time-e[0].time))}};var zR=Object.defineProperty,JR=(r,e,t)=>e in r?zR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,db=(r,e,t)=>JR(r,typeof e!="symbol"?e+"":e,t),Nn=class extends J{constructor(){super(...arguments),db(this,"_buffer",new Array),db(this,"_suspend",!1)}get isSuspend(){return this._suspend}suspend(){this._suspend=!0}resume(){let e=this._buffer.shift();for(;e;)this.output(e),e=this._buffer.shift();this._suspend=!1}handleInput(e){this.isSuspend?this._buffer.push(e):this.output(e)}};var ZR=Object.defineProperty,QR=(r,e,t)=>e in r?ZR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ln=(r,e,t)=>QR(r,typeof e!="symbol"?e+"":e,t),ul=class{constructor(e,t){Ln(this,"_renderer"),Ln(this,"_textDataMask"),Ln(this,"_nameDataMask"),Ln(this,"_commonDataMask"),Ln(this,"_strict",!1),Ln(this,"_maskElements");var n;this._renderer=e,this._nameDataMask=new Je(new Bi,new Si),this._textDataMask=new qr;let{disableBuiltInDataMasks:i=!1,maskingLevel:o=Pe.BALANCE,maskElements:s}=t;this._maskElements=s,this._strict=o===Pe.STRICT;let a=(n=t.dataMasks)!=null?n:[];i||(this._commonDataMask=new Je(new _r,new yr,new br,new $r,new wr,new Tr,new xr,new vr)),a.length>0&&(this._commonDataMask=this._commonDataMask?new Je(...a,this._commonDataMask):new Je(...a))}mask(e){var t,n;let{data:i,eventType:o}=e.event,s=We();if(o===m.HTMLSnapshot){if(T(i.document.title)){let a=this._strict?this._textDataMask:this._commonDataMask;a&&(i.document.title=a.mask(i.document.title))}this.maskElement(i.document.root)}else if(o===m.HTMLMutations)i.forEach(a=>{var l,c;if(a.type===M.AddNode)this.maskElement(a.data.node,this._renderer.getNode(a.target));else if(a.type===M.ChangeAttributes)a.data=this.maskAttribute(a.data,this._renderer.getNode(a.target));else if(a.type===M.CharacterData&&T(a.data)){let u,h=this._renderer.getNode(a.target);h&&nu(h)&&h.parentId!=null&&(u=this._renderer.getNode(h.parentId));let d=this._getDataMask((l=h==null?void 0:h.attrs)==null?void 0:l[s],(c=u==null?void 0:u.attrs)==null?void 0:c[s])[0];d?a.data=d.mask(a.data):this._commonDataMask&&(u==null||Yr(u))&&(a.data=this._commonDataMask.mask(a.data))}});else if(o===m.HTMLValueChange&&T(i.value)){let a=this._renderer.getNode(i.target),l=(n=this._getDataMask((t=a==null?void 0:a.attrs)==null?void 0:t[s])[0])!=null?n:this._commonDataMask;l&&(i.value=l.mask(i.value))}return e}maskElement(e,t){var n,i,o;if(t!=null&&!Yr(t)||!Yr(e))return;let s=We(),[a,l]=this._getDataMask((n=e.attrs)==null?void 0:n[s],(i=t==null?void 0:t.attrs)==null?void 0:i[s]);this._maskElement(e,a!=null?a:this._commonDataMask,l),(o=e.children)==null||o.forEach(c=>this.maskElement(c,e))}maskAttribute(e,t){var n,i;if(t!=null&&!Yr(t))return e;let o=We(),[s,a]=this._getDataMask((i=(n=t==null?void 0:t.attrs)==null?void 0:n[o])!=null?i:e[o]);return this._maskAttribute(s!=null?s:this._commonDataMask,a,e,t)}_maskElement(e,t,n){let{text:i,value:o}=e;t!=null&&(T(i)&&(e.text=t.mask(i)),T(o)&&(e.value=t.mask(o))),e.attrs=this._maskAttribute(t,n,e.attrs,e)}_maskAttribute(e,t,n,i){var o,s,a,l,c;if(!n)return n;if(e!=null)for(let[h,d]of Object.entries(n))au(h)&&T(d)&&(n[h]=e.mask(d));let u=Xr(t);if(i!=null&&(Xc(i)?(u||(o=this._maskElements)!=null&&o.anchor)&&(n.href="#"):Yc(i)?(u||(s=this._maskElements)!=null&&s.image)&&(n.src="",n.srcset=""):eu(i)?(u||(a=this._maskElements)!=null&&a.audio)&&(n.src="",this._maskChildSourceElements(i)):tu(i)&&(u||(l=this._maskElements)!=null&&l.video)&&(n.src="",this._maskChildSourceElements(i))),n.style!=null&&(u||(c=this._maskElements)!=null&&c.image)){let h=/url\(['"]?([^'")]+)['"]?\)/g;n.style=n.style.replace(h,function(d,f){return/\.(png|jpe?g|gif|webp|bmp|tiff|svg)(\?.*)?$/i.test(f)?'url("#")':d})}return n}_maskChildSourceElements(e){var t;(t=e.children)==null||t.filter(n=>ru(n)&&n.attrs!=null).forEach(n=>{n.attrs.src=""})}_getDataMask(e,t){return pi(t)||pi(e)?[this._commonDataMask,Fe.balance]:di(t)||di(e)?[this._nameDataMask,Fe.name]:hi(t)||hi(e)?[this._textDataMask,Fe.balance]:this._strict||Xr(t)||Xr(e)?[this._textDataMask,Fe.strict]:[]}};var XR=Object.defineProperty,YR=(r,e,t)=>e in r?XR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Gn=(r,e,t)=>YR(r,typeof e!="symbol"?e+"":e,t),eO=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),hl=class extends Xe{constructor(e,t){super(e,w.HTML),Gn(this,"_isOptionsInitialized",!1),Gn(this,"_lastSnapshotTime",-1),Gn(this,"_virtualRenderer"),Gn(this,"_capturerAwait",null),Gn(this,"_callbacks",new Array),Gn(this,"_dataMask"),this._virtualRenderer=new vt,this._context.virtualRenderer=this._virtualRenderer,this.initOptions(t)}initOptions(e){this._isOptionsInitialized||(e!=null&&(this._isOptionsInitialized=!0),e!=null&&e.disableDataMasking?this._dataMask=void 0:this._dataMask=new ul(this._virtualRenderer,{disableDataMasking:e==null?void 0:e.disableDataMasking,disableBuiltInDataMasks:e==null?void 0:e.disableBuiltInDataMasks,dataMasks:mi(e==null?void 0:e.dataMasks),maskingLevel:e==null?void 0:e.maskingLevel,maskElements:e==null?void 0:e.maskElements}))}captureSnapshotFrame(e,t=!0){if(this._lastSnapshotTime===-1){e(null);return}return this._callbacks.push(e),this._capturerAwait?this._capturerAwait:(this._context.controller.suspend(),this._capturerAwait=eO(this,null,function*(){try{let n=yield this._virtualRenderer.captureSnapshot();this._lastSnapshotTime=se.now();let i={trackType:w.HTML,time:this._lastSnapshotTime,event:{eventType:m.HTMLSnapshot,data:n}};t&&this._dataMask&&(i=this._dataMask.mask(i)),this._callbacks.forEach(o=>{o(i)}),this._callbacks=new Array}catch(n){console.error("Capture virtual snapshot error",n)}this._context.controller.resume(),this._capturerAwait=null}),this._capturerAwait)}outputSnapshotFrame(){this.captureSnapshotFrame(e=>{e&&this.output(e)})}handleFrame(e){let t=e.event;this._virtualRenderer.performEvent(t),t.eventType===m.HTMLSnapshot&&(this._lastSnapshotTime=e.time),this.output(this._dataMask?this._dataMask.mask(e):e)}};var tO=Object.defineProperty,pb=Object.getOwnPropertySymbols,rO=Object.prototype.hasOwnProperty,nO=Object.prototype.propertyIsEnumerable,Xh=(r,e,t)=>e in r?tO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fb=(r,e)=>{for(var t in e||(e={}))rO.call(e,t)&&Xh(r,t,e[t]);if(pb)for(var t of pb(e))nO.call(e,t)&&Xh(r,t,e[t]);return r},iO=(r,e,t)=>Xh(r,typeof e!="symbol"?e+"":e,t),yt=class extends R.default{constructor(e){super(),iO(this,"_config"),this.setOptions(e)}setOptions(e){this._config=fb(fb({},this.getDefaultOptions()),e)}getDefaultOptions(){return{}}};var oO=Object.defineProperty,sO=(r,e,t)=>e in r?oO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ro=(r,e,t)=>sO(r,typeof e!="symbol"?e+"":e,t),dl=class extends yt{constructor(e,t){super(t),Ro(this,"_HANDLED_FRAMES",new Set([w.HTML,w.Mouse,w.Network])),Ro(this,"_IGNORED_EVENTS",new Set([m.HTMLSnapshot,m.HTMLIncrementalSnapshot,m.HTMLIFrame,m.MouseMove,m.MouseDown,m.MouseUp,m.MouseEnter,m.MouseLeave,m.TouchStart,m.TouchMove,m.TouchEnd,m.TouchCancel,m.NETWORK_ABORT,m.NETWORK_DONE,m.NETWORK_ERROR,m.NETWORK_TIMEOUT])),Ro(this,"_vRenderer"),Ro(this,"_subsequentFrames",[]),Ro(this,"_timer"),this._vRenderer=e}getDefaultOptions(){return{changesThreshold:1,timeoutThreshold:500}}handle(e){let{trackType:t,event:n}=e,i=n.eventType;if(!(Ft(t)||!this._HANDLED_FRAMES.has(t)||this._IGNORED_EVENTS.has(i))&&!(this._timer==null&&i!==m.MouseClick)){if(i===m.MouseClick){this._stop();let o=n.data[3];if(o!=null){let s=this._vRenderer.getNode(o);(s==null?void 0:s.type)===Y.ElementNode&&this._shouldHandle(s)&&this._start(e)}return}this._subsequentFrames.push(e)}}_start(e){this._subsequentFrames.push(e),this._timer=setTimeout(()=>{if(this._subsequentFrames.length-1<this._config.changesThreshold){let t=this._subsequentFrames[0],[n,i,o,s,a]=t.event.data,l={duration:se.now()-t.time,x:n,y:i,buttons:o};s!=null&&(l.targetId=s),a!=null&&(l.context=a),this.emit("detected",l)}this._stop()},this._config.timeoutThreshold)}_stop(){this._timer!=null&&(this._subsequentFrames=[],clearTimeout(this._timer),this._timer=void 0)}_shouldHandle(e){let{tag:t,attrs:n}=e;return t==="A"||t==="BUTTON"||t==="INPUT"&&n!=null&&(n.type==="button"||n.type==="checkbox"||n.type==="submit"||n.type==="radio"&&!e.checked)}};var aO=Object.defineProperty,lO=(r,e,t)=>e in r?aO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yh=(r,e,t)=>lO(r,typeof e!="symbol"?e+"":e,t),pl=class extends yt{constructor(){super(...arguments),Yh(this,"_distance",0),Yh(this,"_startTime"),Yh(this,"_lastScroll")}getDefaultOptions(){return{scrollThreshold:1e3,timeoutThreshold:3e3}}handle(e){var t,n,i;if(e.event.eventType!==m.HTMLScroll)return;let o=e.event.data,{scroll:s,target:a}=o;if(this._startTime==null&&(this._startTime=se.now()),((t=this._lastScroll)==null?void 0:t.target)!==a)this._distance=0,this._startTime=se.now(),this._lastScroll=o;else{let l=se.now()-this._startTime;l>=this._config.timeoutThreshold?this._reset():(this._distance+=Math.abs(s[1]-((i=(n=this._lastScroll)==null?void 0:n.scroll[1])!=null?i:0)),this._distance>=this._config.scrollThreshold?(this.emit("detected",{distance:this._distance,duration:l,targetId:a}),this._reset()):this._lastScroll=o)}}_reset(){this._distance=0,this._startTime=void 0,this._lastScroll=void 0}};var cO=Object.defineProperty,uO=(r,e,t)=>e in r?cO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Oo=(r,e,t)=>uO(r,typeof e!="symbol"?e+"":e,t),fl=class extends yt{constructor(){super(...arguments),Oo(this,"_HANDLED_FRAMES",new Set([w.HTML,w.Mouse,w.Keyboard])),Oo(this,"_IGNORED_EVENTS",new Set([m.HTMLSnapshot,m.HTMLMutations,m.HTMLIncrementalSnapshot,m.HTMLIFrame])),Oo(this,"_lastMouseFrame"),Oo(this,"_lastInteraction"),Oo(this,"_timer")}getDefaultOptions(){return{timeThreshold:1e4}}handle(e){let{trackType:t,event:n}=e,i=n.eventType;if(!(Ft(t)||!this._HANDLED_FRAMES.has(t)||this._IGNORED_EVENTS.has(i))){if(t===w.Mouse&&(this._lastMouseFrame=e),this._lastInteraction==null){this._start(e);return}this._restart(e)}}_start(e){this._lastInteraction=e,this._timer=setTimeout(()=>{if(this._lastMouseFrame!=null&&this._lastInteraction!=null){let[t,n]=$y(this._lastMouseFrame.event),i=wy(this._lastMouseFrame.event),o=xy(this._lastMouseFrame.event),s={duration:se.now()-this._lastInteraction.time,x:t,y:n};i!=null&&(s.targetId=i),o!=null&&(s.context=o),this.emit("detected",s)}this._stop(),this._lastMouseFrame=void 0},this._config.timeThreshold)}_restart(e){this._stop(),this._start(e)}_stop(){this._timer!=null&&(this._lastInteraction=void 0,clearTimeout(this._timer),this._timer=void 0)}};var hO=Object.defineProperty,dO=(r,e,t)=>e in r?hO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mb=(r,e,t)=>dO(r,typeof e!="symbol"?e+"":e,t),ml=class extends yt{constructor(){super(...arguments),mb(this,"_clicks",[]),mb(this,"_timer")}getDefaultOptions(){return{clicksThreshold:4,distanceThreshold:30,timeoutThreshold:800}}handle(e){if(!(Ft(e.trackType)||e.event.eventType!==m.MouseClick)){if(this._clicks.length===0){this._start(e);return}if(this._isWithInDistance(this._clicks[0],e)){this._clicks.push(e);return}this._restart(e)}}_start(e){this._clicks.push(e),this._timer=setTimeout(()=>{let{length:t}=this._clicks;if(t>=this._config.clicksThreshold){let n=this._clicks[0],i=this._clicks[t-1],[o,s,a,l,c]=n.event.data,u={duration:i.time-n.time,clicks:t,x:o,y:s,buttons:a};l!=null&&(u.targetId=l),c!=null&&(u.context=c),this.emit("detected",u)}this._stop()},this._config.timeoutThreshold)}_restart(e){this._stop(),this._start(e)}_stop(){this._timer!=null&&(this._clicks=[],clearTimeout(this._timer),this._timer=void 0)}_isWithInDistance(e,t){let[n,i]=e.event.data,[o,s]=t.event.data;return Math.abs(o-n)+Math.abs(s-i)<=this._config.distanceThreshold}};var pO=Object.defineProperty,fO=(r,e,t)=>e in r?pO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wn=(r,e,t)=>fO(r,typeof e!="symbol"?e+"":e,t),gl=class extends Xe{constructor(e,t){super(e),Wn(this,"_isOptionsInitialized",!1),Wn(this,"_deadClickDetector"),Wn(this,"_longHoverDetector"),Wn(this,"_rageClickDetector"),Wn(this,"_excessiveScrollingDetector"),Wn(this,"_handleInsight",n=>i=>{this.output(cn(w.Insight,{eventType:n,data:i},se.now()))}),this._initDetectors(t)}initOptions(e){var t,n,i,o,s,a,l,c;this._isOptionsInitialized||(e!=null&&(this._isOptionsInitialized=!0),this._isDetectorEnabled(e==null?void 0:e.deadClick)?(t=this._deadClickDetector)==null||t.setOptions(e==null?void 0:e.deadClick):((n=this._deadClickDetector)==null||n.removeAllListeners(),this._deadClickDetector=void 0),this._isDetectorEnabled(e==null?void 0:e.excessiveScrolling)?(i=this._excessiveScrollingDetector)==null||i.setOptions(e==null?void 0:e.excessiveScrolling):((o=this._excessiveScrollingDetector)==null||o.removeAllListeners(),this._excessiveScrollingDetector=void 0),this._isDetectorEnabled(e==null?void 0:e.longHover)?(s=this._longHoverDetector)==null||s.setOptions(e==null?void 0:e.longHover):((a=this._longHoverDetector)==null||a.removeAllListeners(),this._longHoverDetector=void 0),this._isDetectorEnabled(e==null?void 0:e.rageClick)?(l=this._rageClickDetector)==null||l.setOptions(e==null?void 0:e.rageClick):((c=this._rageClickDetector)==null||c.removeAllListeners(),this._rageClickDetector=void 0))}handleFrame(e){var t,n,i,o;this.output(e),(t=this._deadClickDetector)==null||t.handle(e),(n=this._excessiveScrollingDetector)==null||n.handle(e),(i=this._longHoverDetector)==null||i.handle(e),(o=this._rageClickDetector)==null||o.handle(e)}_initDetectors(e){e!=null&&(this._isOptionsInitialized=!0),this._isDetectorEnabled(e==null?void 0:e.deadClick)&&this._context.virtualRenderer&&(this._deadClickDetector=new dl(this._context.virtualRenderer,e==null?void 0:e.deadClick),this._deadClickDetector.on("detected",this._handleInsight(m.INSIGHT_DEAD_CLICK))),this._isDetectorEnabled(e==null?void 0:e.excessiveScrolling)&&(this._excessiveScrollingDetector=new pl(e==null?void 0:e.excessiveScrolling),this._excessiveScrollingDetector.on("detected",this._handleInsight(m.INSIGHT_EXCESSIVE_SCROLLING))),this._isDetectorEnabled(e==null?void 0:e.longHover)&&(this._longHoverDetector=new fl(e==null?void 0:e.longHover),this._longHoverDetector.on("detected",this._handleInsight(m.INSIGHT_LONG_HOVER))),this._isDetectorEnabled(e==null?void 0:e.rageClick)&&(this._rageClickDetector=new ml(e==null?void 0:e.rageClick),this._rageClickDetector.on("detected",this._handleInsight(m.INSIGHT_RAGE_CLICK)))}_isDetectorEnabled(e){return e!==!1}};var mO=Object.defineProperty,gO=(r,e,t)=>e in r?mO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vO=(r,e,t)=>gO(r,typeof e!="symbol"?e+"":e,t),vl=class{constructor(e){vO(this,"_commonDataMask");var t;let{disableBuiltInDataMasks:n=!1,maskingLevel:i=Pe.BALANCE}=e,o=(t=e.dataMasks)!=null?t:[];n||(i===Pe.STRICT?this._commonDataMask=new qr:this._commonDataMask=new Je(new _r,new yr,new br,new $r,new wr,new Tr,new xr,new vr)),o.length>0&&(this._commonDataMask=this._commonDataMask?new Je(...o,this._commonDataMask):new Je(...o))}mask(e){let{data:t,eventType:n}=e.event;if(n===m.NETWORK_DONE&&this._commonDataMask){let{body:i}=t;if(i!=null)if(T(i))t.body=this._commonDataMask.mask(i);else try{let o=!1,s=JSON.stringify(i,(a,l)=>T(l)?(o=!0,this._commonDataMask.mask(l)):l);o&&(t.body=s)}catch(o){}}return e}};var _O=Object.defineProperty,yO=(r,e,t)=>e in r?_O(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gb=(r,e,t)=>yO(r,typeof e!="symbol"?e+"":e,t),_l=class extends Xe{constructor(e,t){super(e,w.Network),gb(this,"_isOptionsInitialized",!1),gb(this,"_dataMask"),this.initOptions(t)}initOptions(e){this._isOptionsInitialized||(e!=null&&(this._isOptionsInitialized=!0),e!=null&&e.disableDataMasking?this._dataMask=void 0:this._dataMask=new vl({disableDataMasking:e==null?void 0:e.disableDataMasking,disableBuiltInDataMasks:e==null?void 0:e.disableBuiltInDataMasks,dataMasks:mi(e==null?void 0:e.dataMasks),maskingLevel:e==null?void 0:e.maskingLevel}))}handleFrame(e){this.output(this._dataMask?this._dataMask.mask(e):e)}};var bO=Object.defineProperty,$O=(r,e,t)=>e in r?bO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ed=(r,e,t)=>$O(r,typeof e!="symbol"?e+"":e,t),Fn=class{constructor(e){ed(this,"_trackTypes"),ed(this,"_controller"),ed(this,"_virtualRenderer"),this._controller=e}get trackTypes(){return this._trackTypes}set trackTypes(e){this._trackTypes=e}get controller(){return this._controller}get virtualRenderer(){return this._virtualRenderer}set virtualRenderer(e){this._virtualRenderer=e}};var wO=Object.defineProperty,xO=(r,e,t)=>e in r?wO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,td=(r,e,t)=>xO(r,typeof e!="symbol"?e+"":e,t),qO=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),yl=class extends J{constructor(e){super(),td(this,"_bufferedFrames",[]),td(this,"_timer",0),td(this,"_handleTick",()=>{this._bufferedFrames.length?this.flush():this.dispose()}),this.options=e}handleInput(e){this._bufferedFrames.push(e),this._timer||(this._timer=setInterval(this._handleTick,this.options.bufferTime))}flush(){return qO(this,null,function*(){return this._bufferedFrames.length?(this.output([...this._bufferedFrames]),this._bufferedFrames.splice(0,this._bufferedFrames.length),new Promise(e=>{setTimeout(e,0)})):Promise.resolve()})}dispose(){clearInterval(this._timer),this._timer=0}};var bl=class{constructor(e){this.context=e}encode(e){return Dn(e,this.context.startTime)}};var TO=Object.defineProperty,BO=(r,e,t)=>e in r?TO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,rd=(r,e,t)=>BO(r,typeof e!="symbol"?e+"":e,t),vb=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),SO={compression:{mode:"gzip"}},$l=class extends J{constructor(e){super(),rd(this,"_packetId",0),rd(this,"_frameOffset",0),rd(this,"_encoder"),this.context=e,this._encoder=new bl(e)}handleInput(e){return vb(this,null,function*(){if(e.length>0){let t=this.encode(e),n=e.some(a=>a.trackType===w.HTML&&a.event.eventType===m.HTMLSnapshot),i=!1,o=e[e.length-1];o&&o.trackType===w.EOF&&(i=!0);let s=yield this.pack(t,e.length,e[0].time,e[e.length-1].time,i,n);this.output(s)}})}encode(e){return e.forEach((t,n)=>{if(t.trackType===w.HTML&&t.event.eventType===m.HTMLIncrementalSnapshot){let i={id:`frame/${this._frameOffset+n}`,time:t.time,type:"frame",recordingId:this.context.id,data:{trackType:t.trackType,eventType:t.event.eventType,offset:this._frameOffset+n}};this.context.emit("feedback",{type:Ue.FrameIndex,index:i})}}),this._encoder.encode(e)}pack(e,t,n,i,o,s){return vb(this,null,function*(){var a,l;let c=e;(((l=(a=this.context.transmitter)==null?void 0:a.strategy)==null?void 0:l.packer)||SO).compression.mode==="gzip"&&(c=yield Vn(e));let u={id:`${this.context.recording.id}/${this._nextPacketId()}`,frameRange:[this._frameOffset,t],data:c,firstFrameTime:n-this.context.startTime,lastFrameTime:i-this.context.startTime,isEOF:o,hasSnapshot:s};return this._frameOffset+=t,u})}_nextPacketId(){return this._packetId++}};var EO=Object.defineProperty,kO=(r,e,t)=>e in r?EO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Co=(r,e,t)=>kO(r,typeof e!="symbol"?e+"":e,t),RO=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),OO=60*1e3,CO=1e-6,wl=class extends Xe{constructor(e,t){super(e,w.HTML),Co(this,"_recordingContext"),Co(this,"incrementalSnapshotRenderer",new co),Co(this,"_index",0),Co(this,"_lastSnapshotTime"),Co(this,"_capturerAwait",null),this._recordingContext=t}handleFrame(e){let t=e.event;if(this.incrementalSnapshotRenderer.performEvent(t),t.eventType===m.HTMLSnapshot&&(this._lastSnapshotTime=e.time),this.output(e),this._lastSnapshotTime&&this._recordingContext.now-this._lastSnapshotTime>2*OO&&this.incrementalSnapshotRenderer.getIncrementalPercent()>.3){let n=e.time;this._createIncrementalSnapshot(n)}}_createIncrementalSnapshot(e){return this._capturerAwait?this._capturerAwait:(this._context.controller.suspend(),this._capturerAwait=RO(this,null,function*(){try{this._lastSnapshotTime=e;let t=yield this.incrementalSnapshotRenderer.captureIncrementalSnapshot(),n=++this._index,i={trackType:w.HTML,time:e+CO,event:{eventType:m.HTMLIncrementalSnapshot,data:{snapshot:t,index:n}}};this.output(i)}catch(t){console.error("Capture virtual snapshot error",t)}this._context.controller.resume(),this._capturerAwait=null}),this._capturerAwait)}};var IO=Object.defineProperty,MO=(r,e,t)=>e in r?IO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,UO=(r,e,t)=>MO(r,typeof e!="symbol"?e+"":e,t),nd=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Io=class extends J{constructor(e){super(),UO(this,"_chunks",[]),this.context=e}handleInput(e){this._chunks.push(e.data)}open(){return nd(this,null,function*(){})}close(){return nd(this,null,function*(){})}dump(){return nd(this,null,function*(){return new Blob(this._chunks,{type:"text/plain"})})}};var PO=Object.defineProperty,AO=(r,e,t)=>e in r?PO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,id=(r,e,t)=>AO(r,typeof e!="symbol"?e+"":e,t),od=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Mo=class extends J{constructor(e){var t;super(),id(this,"_retry"),id(this,"_strategy"),id(this,"_closing"),this.context=e,this._strategy=(t=e.transmitter)==null?void 0:t.strategy,this._retry=new nt}open(){return od(this,null,function*(){})}close(){return od(this,null,function*(){return new Promise((e,t)=>{this._closing=n=>{this._closing=void 0,n?t(n):e()}})})}handleInput(e){this.context.emit("feedback",{type:Ue.CompensateSnapshot,recordingId:this.context.id}),this._retry.attempt(()=>od(this,null,function*(){var t,n;try{return On(this.context.manager.apiClient,{blob:new Blob([e.data],{type:((n=(t=this._strategy.packer)==null?void 0:t.compression)==null?void 0:n.mode)==="gzip"?"application/octet-stream":"text/plain"}),recordingId:this.context.recording.id,token:this._strategy.config.token,offset:e.frameRange[0],count:e.frameRange[1],firstFrameTime:e.firstFrameTime,lastFrameTime:e.lastFrameTime,isEOF:e.isEOF})}catch(i){throw i}})).then(t=>{var n;this.context.emit("feedback",{type:Ue.BlockCreated,block:t}),(n=this._closing)==null||n.call(this)}).catch(t=>{var n;(n=this._closing)==null||n.call(this,t)})}};var DO=Object.defineProperty,VO=(r,e,t)=>e in r?DO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jr=(r,e,t)=>VO(r,typeof e!="symbol"?e+"":e,t),sd=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Uo=class extends J{constructor(e){var t,n;super(),jr(this,"_connection"),jr(this,"_strategy"),jr(this,"_snapshotInterval"),jr(this,"_lastSnapshotTime",0),jr(this,"_compensateSnapshot",()=>{P()-this._lastSnapshotTime>this._snapshotInterval&&this._handleCompensate()}),jr(this,"_handleError",()=>{this.context.stopRecording()}),jr(this,"_handleCompensate",()=>{this.context.emit("feedback",{type:Ue.CompensateSnapshot,recordingId:this.context.id}),this._lastSnapshotTime=P()}),this.context=e,this._strategy=(t=e==null?void 0:e.transmitter)==null?void 0:t.strategy,this._snapshotInterval=(n=this._strategy.config.snapshotInterval)!=null?n:3e5,this._connection=new bi(e.manager.apiClient,{retry:this._strategy.config.retry,bufferSize:this._strategy.config.bufferSize})}get strategy(){return this._strategy}open(){return sd(this,null,function*(){this._lastSnapshotTime=0,this._connection.on("error",this._handleError),this._connection.on("compensate",this._handleCompensate),this._connection.open()})}close(){return sd(this,null,function*(){this._lastSnapshotTime=0,this._connection.close()})}handleInput(e){return sd(this,null,function*(){var t,n;let i=Ah({blob:new Blob([e.data],{type:((n=(t=this._strategy.packer)==null?void 0:t.compression)==null?void 0:n.mode)==="gzip"?"application/octet-stream":"text/plain"}),recordingId:this.context.recording.id,token:this._strategy.config.token,offset:e.frameRange[0],count:e.frameRange[1],firstFrameTime:e.firstFrameTime,lastFrameTime:e.lastFrameTime,isEOF:e.isEOF,hasSnapshot:e.hasSnapshot},!0);this._connection.send(i),e.hasSnapshot?this._lastSnapshotTime=P():this._compensateSnapshot()})}};var Po=(r=>(r[r.Begin=0]="Begin",r[r.End=1]="End",r[r.Current=2]="Current",r))(Po||{});var NO=Object.defineProperty,LO=(r,e,t)=>e in r?NO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tr=(r,e,t)=>LO(r,typeof e!="symbol"?e+"":e,t),xl=class{constructor(e=1024,t=e){tr(this,"_byteLength",0),tr(this,"_position",0),tr(this,"_bytes"),tr(this,"_buffer"),tr(this,"_view"),tr(this,"_encoder",null),tr(this,"_allocCount",0),tr(this,"_allocWarned",!1),this.initialBufferSize=e,this.incrementalSize=t,this.realloc(e)}get byteLength(){return this._byteLength}get capacity(){return this._bytes.length}get currentPosition(){return this._position}encode(e){return this._encoder||(this._encoder=new TextEncoder),this._encoder.encode(e)}seek(e,t=Po.Begin){let n;if(t===Po.Current?n=this.currentPosition:t===Po.End?n=this.byteLength:n=0,n=n+e,n<0)throw new vi("The seeking position must equal to or be greater than 0.");this._position=n}writeUint8(e){this.checkAlloc(1),this._view.setUint8(this.currentPosition,e),this.increaseSize(1)}writeUint8Array(e){let t=e.byteLength;this.checkAlloc(t),this._bytes.set(e,this.currentPosition),this.increaseSize(t)}writeUint16(e){this.checkAlloc(2),this._view.setUint16(this.currentPosition,e),this.increaseSize(2)}writeUint32(e){this.checkAlloc(4),this._view.setUint32(this.currentPosition,e,!1),this.increaseSize(4)}writeString(e,t){let n=this.encode(e);if(t&&n.length>t&&(n=n.slice(0,t)),this.writeUint8Array(n),t){let i=t-n.length;i&&(this._bytes.fill(0,this.currentPosition,this.currentPosition+i),this.increaseSize(i))}}toUint8Array(){return this._bytes.slice(0,this.byteLength)}toBuffer(){return this._buffer.slice(0,this.byteLength)}toString(){return this.toUint8Array().toString()}increaseSize(e){this._position=this.currentPosition+e,this._byteLength=Math.max(this._byteLength,this.currentPosition)}checkAlloc(e){let t=this.currentPosition+e;if(this._buffer.byteLength>=t)return;let n=this.byteLength;for(;n<t;)n+=this.incrementalSize;this.realloc(n)}realloc(e){let t=new ArrayBuffer(e),n=new Uint8Array(t);this._bytes&&n.set(this._bytes,0),this._buffer=t,this._bytes=n,this._view=new DataView(this._buffer),this._allocCount++,!this._allocWarned&&this._allocCount>5&&(console.warn("This BinaryWriter frequently reallocates itself. Try to avoid this by adjusting buffer settings.",this),this._allocWarned=!0)}};var GO=Object.defineProperty,WO=(r,e,t)=>e in r?GO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,FO=(r,e,t)=>WO(r,typeof e!="symbol"?e+"":e,t),Ao=class{constructor(e,t=1024,n=t){FO(this,"_binaryWriter"),this.name=e,this.initialBufferSize=t,this.incrementalSize=n,this._binaryWriter=new xl(t,n),this._binaryWriter.writeUint32(0),this._binaryWriter.writeString(e,4)}get byteLength(){return this._binaryWriter.byteLength}get capacity(){return this._binaryWriter.capacity}appendUint8(e,t){this.writeKVHeader(e,8/8),this._binaryWriter.writeUint8(t)}appendBoolean(e,t){this.appendUint8(e,t?1:0)}appendUint16(e,t){this.writeKVHeader(e,16/8),this._binaryWriter.writeUint16(t)}appendUint32(e,t){this.writeKVHeader(e,32/8),this._binaryWriter.writeUint32(t)}appendUint32Tuple(e,t){this.writeKVHeader(e,32/8+32/8),this._binaryWriter.writeUint32(t[0]),this._binaryWriter.writeUint32(t[1])}appendUint8Array(e,t){this.writeKVHeader(e,t.byteLength),this._binaryWriter.writeUint8Array(t)}appendString(e,t){let n=this._binaryWriter.encode(t);this.appendUint8Array(e,n)}appendBox(e){let t=e.toUint8Array();this._binaryWriter.writeUint8Array(t)}toUint8Array(){let e=this._binaryWriter.currentPosition;return this._binaryWriter.seek(0),this._binaryWriter.writeUint32(this._binaryWriter.byteLength),this._binaryWriter.seek(e),this._binaryWriter.toUint8Array()}toString(){return this.toUint8Array().toString()}writeKVHeader(e,t){this._binaryWriter.writeUint32(this._calcKVByteLength(t)),this._binaryWriter.writeString(e,4)}_calcKVByteLength(e){return 8+e}};var _b="chnk";function yb(r){let e=new Ao("head",160,64);e.appendUint32("id",r.header.id),e.appendString("ver",r.header.version),e.appendUint16("idx",r.header.index),e.appendString("pid",r.header.packetId),e.appendUint32Tuple("rng",r.header.packetFrameRange),e.appendBoolean("fin",r.header.fin);let t=e.byteLength+r.body.length+8+8,n=new Ao(_b,t,64);return n.appendBox(e),n.appendUint8Array("body",r.body),n.toUint8Array()}function ad(r){return JSON.stringify(r,(e,t)=>t instanceof Uint8Array?new TextDecoder().decode(t):t)}var KO=Object.defineProperty,jO=(r,e,t)=>e in r?KO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,HO=(r,e,t)=>jO(r,typeof e!="symbol"?e+"":e,t),ql=class{constructor(e){HO(this,"_chunkId",0),this.context=e}split(e,t=1){e.data.length<1048576&&(t=1);let n=[],i=Math.ceil(e.data.length/t);for(let o=0;o*i<e.data.length;o++){let s=Math.min(o*i+i,e.data.length),a={header:{fin:s===e.data.length,id:this._nextChunkId(),index:o,packetId:e.id,packetFrameRange:e.frameRange,version:"1.0.0"},body:e.data.subarray(o*i,s)};n.push(a)}return n}_nextChunkId(){return this._chunkId++}};var zO=Object.defineProperty,JO=(r,e,t)=>e in r?zO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kn=(r,e,t)=>JO(r,typeof e!="symbol"?e+"":e,t),Do=class extends R.default{constructor(e=100){super(),Kn(this,"_mailbox"),Kn(this,"_connection"),Kn(this,"_handleOpen",()=>{this._sendAll()}),Kn(this,"_handleSend",t=>{!xt(t)&&t.type===Ke.Chunk&&this._mailbox.enqueue(t)}),Kn(this,"_handleMessage",t=>{if(t!=null&&!xt(t)&&t.type===Ke.ACK){let n=t.sequence,i=this._mailbox.findIndex(o=>o.sequence===n);if(i!==-1&&this._mailbox.remove(i),i>0&&this._connection!=null){let o=this._mailbox.slice(0,i);for(let s of o)this._connection.send(s,!1)}}}),Kn(this,"_handleRotated",()=>{this._mailbox.clear(),this.emit("compensate")}),this._mailbox=new lr(e)}attach(e){this.detach(),this._connection=e,e.on("open",this._handleOpen),e.on("send",this._handleSend),e.on("message",this._handleMessage),this._mailbox.on("rotated",this._handleRotated)}detach(){var e,t,n;(e=this._connection)==null||e.off("open",this._handleOpen),(t=this._connection)==null||t.off("send",this._handleSend),(n=this._connection)==null||n.off("message",this._handleMessage),this._connection=void 0,this._mailbox.off("rotated",this._handleRotated),this._mailbox.clear()}flush(){this._sendAll()}_sendAll(){this._connection!==null&&this._mailbox.forEach(e=>{this._connection.send(e,!1)})}};var ZO=Object.defineProperty,Tl=Object.getOwnPropertySymbols,$b=Object.prototype.hasOwnProperty,wb=Object.prototype.propertyIsEnumerable,cd=(r,e,t)=>e in r?ZO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,bb=(r,e)=>{for(var t in e||(e={}))$b.call(e,t)&&cd(r,t,e[t]);if(Tl)for(var t of Tl(e))wb.call(e,t)&&cd(r,t,e[t]);return r},QO=(r,e)=>{var t={};for(var n in r)$b.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Tl)for(var n of Tl(r))e.indexOf(n)<0&&wb.call(r,n)&&(t[n]=r[n]);return t},bt=(r,e,t)=>cd(r,typeof e!="symbol"?e+"":e,t),ld=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Vo=class extends J{constructor(e){var t,n;super(),bt(this,"_connection"),bt(this,"_compensator"),bt(this,"_splitter"),bt(this,"_strategy"),bt(this,"_closing"),bt(this,"_splitChunks"),bt(this,"_splitCount"),bt(this,"_handleCompensate",()=>{this.context.emit("feedback",{type:Ue.CompensateSnapshot,recordingId:this.context.id})}),bt(this,"_handleWebsocketMessage",c=>{if(c!=null&&!xt(c)&&c.type===Ke.Command)switch(c.data.command){case un.SyncBlock:{this.context.emit("feedback",{type:Ue.BlockCreated,block:c.data.block});break}case un.ReceiverStopped:{this.close();break}}}),bt(this,"_handleWebsocketConnectionClosed",()=>{this.context.stopRecording()}),this.context=e,this._splitter=new ql(e),this._strategy=(t=e==null?void 0:e.transmitter)==null?void 0:t.strategy;let i=bb(bb({},this.strategy.config),(n=e.options.modeOption)!=null?n:{}),{bufferSize:o,splitChunks:s,splitCount:a}=i,l=QO(i,["bufferSize","splitChunks","splitCount"]);this._splitChunks=s!=null?s:!0,this._splitCount=Math.min(Math.max(a!=null?a:5,1),5),this._connection=new wi(e.env.getFullUrl(this.strategy.url,!0),l),this._connection.on("message",this._handleWebsocketMessage),this._connection.on("closed",this._handleWebsocketConnectionClosed),this._compensator=new Do(o)}get strategy(){return this._strategy}open(){return ld(this,null,function*(){this._compensator.attach(this._connection),this._compensator.on("compensate",this._handleCompensate),yield this._connection.open()})}close(){return ld(this,null,function*(){this._closing||(this._closing=new Promise((e,t)=>{this._connection.send({type:Ke.Command,data:{command:un.RecorderStopped}},!1),this._compensator.flush(),this._compensator.detach(),this._compensator.off("compensate",this._handleCompensate),this._connection.close().then(()=>{this._closing=void 0,e()}).catch(n=>{this._closing=void 0,t(n)})}))})}handleInput(e){return ld(this,null,function*(){var t,n;if(this._splitChunks){let i=this._splitter.split(e,this._splitCount);for(let o of i)this._connection.send({type:Ke.Chunk,sequence:o.header.id,data:yb(o)})}else{let i=this._splitter.split(e,1)[0],o=yield((n=(t=this._strategy.packer)==null?void 0:t.compression.mode)!=null?n:"raw")==="gzip"?Vn(new TextEncoder().encode(ad(i))):ad(i);this._connection.send({type:Ke.Chunk,sequence:i.header.id,data:o})}})}};var XO=Object.defineProperty,YO=(r,e,t)=>e in r?XO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,No=(r,e,t)=>YO(r,typeof e!="symbol"?e+"":e,t),ud=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),Bl=class extends J{constructor(e){var t,n,i,o,s;super(),No(this,"_transmitter"),No(this,"_frameBuffer"),No(this,"_subscription"),No(this,"_firstSnapshotFlushed",!1),No(this,"_shouldFlushFirstSnapshot",!1),this.context=e;let a=new $l(e),l=1e3,c=(t=e.transmitter)==null?void 0:t.strategy;if((c==null?void 0:c.mode)===E.Streaming||(c==null?void 0:c.mode)===E.LiveStreaming)this._transmitter=new Vo(e),l=(n=c.config.bufferTime)!=null?n:1e3,this._shouldFlushFirstSnapshot=!0;else if((c==null?void 0:c.mode)===E.StreamingHttp)this._transmitter=new Uo(e),l=(i=c.config.bufferTime)!=null?i:5e3,this._shouldFlushFirstSnapshot=!0;else if((c==null?void 0:c.mode)===E.Blocking){let d=this.context.options.modeOption;this._transmitter=new Mo(e),l=(s=(o=d==null?void 0:d.bufferTime)!=null?o:c.config.bufferTime)!=null?s:12e4}else this._transmitter=new Io(e);this._frameBuffer=new yl({bufferTime:l});let u=new Fn(new Nn),h=new wl(u,e);this.pipe(u.controller.asPipeable()).pipe(h.asPipeable()).pipe(this._frameBuffer.asPipeable()).pipe(a.asPipeable()).pipe(this._transmitter.asPipeable())}subscribe(e){this._subscription=e.subscribe(t=>{this.handleInput(t)})}handleInput(e){this.output(e),this._shouldFlushFirstSnapshot&&!this._firstSnapshotFlushed&&(this._firstSnapshotFlushed=!0,this._frameBuffer.flush())}open(){return ud(this,null,function*(){this._firstSnapshotFlushed=!1,yield this._transmitter.open()})}close(){return ud(this,null,function*(){var e;this.output(Ru(se.now())),(e=this._subscription)==null||e.unsubscribe(),yield this._frameBuffer.flush(),this._frameBuffer.dispose(),yield this._transmitter.close(),this._firstSnapshotFlushed=!1})}dump(){return ud(this,null,function*(){if(this._transmitter.dump)return this._transmitter.dump();throw new Ve(`Transmitter for '${this.context.recording.id}' does not support dumping.`)})}};var eC=Object.defineProperty,tC=Object.defineProperties,rC=Object.getOwnPropertyDescriptors,xb=Object.getOwnPropertySymbols,nC=Object.prototype.hasOwnProperty,iC=Object.prototype.propertyIsEnumerable,hd=(r,e,t)=>e in r?eC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Lo=(r,e)=>{for(var t in e||(e={}))nC.call(e,t)&&hd(r,t,e[t]);if(xb)for(var t of xb(e))iC.call(e,t)&&hd(r,t,e[t]);return r},Sl=(r,e)=>tC(r,rC(e)),de=(r,e,t)=>hd(r,typeof e!="symbol"?e+"":e,t),rr=(r,e,t)=>new Promise((n,i)=>{var o=l=>{try{a(t.next(l))}catch(c){i(c)}},s=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(o,s);a((t=t.apply(r,e)).next())}),jn=class{constructor(e){de(this,"input"),de(this,"_retry"),de(this,"env"),de(this,"apiClient"),de(this,"htmlProcessor"),de(this,"insightProcessor"),de(this,"networkProcessor"),de(this,"_processorContext"),de(this,"_cacheOptions"),de(this,"_blackboxOptions"),de(this,"_blockingOptions"),de(this,"_streamingOptions"),de(this,"_blackboxProcessor"),de(this,"_events",new R.default),de(this,"_contextMap",new Map),de(this,"_flowMap",new Map),de(this,"handleFeedback",l=>{switch(l.type){case Ue.CompensateSnapshot:this.htmlProcessor.captureSnapshotFrame(c=>{if(!c)return;let u=this._flowMap.get(l.recordingId);u&&u.output(c)});break}}),de(this,"_handleFrame",l=>{this._emit("frame",l)}),this._retry=new nt;let{environment:t,html:n,network:i,insight:o,interceptors:s,interceptRequest:a}=e;this.env=new Ae(t),this.apiClient=new rt(this.env),s&&(this.apiClient.interceptors=s),a&&(this.apiClient.requestInterceptor=a),this._processorContext=new Fn(new Nn),this._processorContext.trackTypes=bo(e.trackers),this.htmlProcessor=new hl(this._processorContext,n),this.networkProcessor=new _l(this._processorContext,i),this.insightProcessor=new gl(this._processorContext,o),this._initCacheOptions(e),this._initBlackboxOptions(e),this._blockingOptions=e.blocking,this._streamingOptions=e.streaming}observe(e){let t=e.pipe(this._processorContext.controller.asPipeable()).pipe(this.htmlProcessor.asPipeable()).pipe(this.networkProcessor.asPipeable());this.insightProcessor&&(t=t.pipe(this.insightProcessor.asPipeable())),this.input=t.pipe(Eu(this._handleFrame)).pipe(Su())}initOptions(e,t){return rr(this,null,function*(){var n,i,o,s,a;se.sync(t.mainTime),this.env.baseURL=(n=e.environment)==null?void 0:n.baseURL,this.env.type=(i=e.environment)==null?void 0:i.type,this.env.apiPrefix=(o=e.environment)==null?void 0:o.apiPrefix,this.env.headers=(s=e.environment)==null?void 0:s.headers,e.interceptors&&(this.apiClient.interceptors=e.interceptors),e.interceptRequest&&(this.apiClient.requestInterceptor=e.interceptRequest),this._initBlackboxOptions(e),this._blockingOptions=e.blocking,this._streamingOptions=e.streaming,this.htmlProcessor.initOptions(e.html),this.networkProcessor.initOptions(e.network),(a=this.insightProcessor)==null||a.initOptions(e.insight)})}createRecordingContext(e){return rr(this,null,function*(){if(!this.input)throw new Error("Tracking source is not ready.");let{recording:t,transport:n}=yield yo(this.apiClient,e),i=Sl(Lo({},t),{createTime:new Date(t.createTime).getTime()}),o=Sl(Lo({},e),{transport:n}),s;if(e.mode===E.Blackbox?s=new Gr(this,i,o):e.mode===E.InMemory?s=new ko(this,i,o):(e.mode===E.Blocking?o.modeOption=this._blockingOptions:(e.mode===E.Streaming||e.mode===E.StreamingHttp)&&(o.modeOption=this._streamingOptions),s=new Qe(this,i,o)),s.on("feedback",this.handleFeedback),e.mode===E.Blackbox){if(!this._blackboxProcessor){let a=new cl(this.input,this.apiClient,this._processorContext,this._blackboxOptions);this._blackboxProcessor=a,this._contextMap.size>0&&(yield this.htmlProcessor.captureSnapshotFrame(l=>{l!=null&&(l.time=s.startTime,a.handleInput(l))}))}this._blackboxProcessor.join(s)}else{let a=new Bl(s);yield a.open(),a.subscribe(this.input),this._contextMap.size>0&&(yield this.htmlProcessor.captureSnapshotFrame(l=>{l!=null&&(l.time=s.startTime,a.handleInput(l))})),this._flowMap.set(i.id,a)}return this._contextMap.set(s.id,s),this._emit("startRecording",s.recording),s})}stopRecordingContext(e){return rr(this,null,function*(){let t=this._flowMap.get(e);t&&(yield t.close()),this._cleanRecordingContext(e)})}_cleanRecordingContext(e){let t=this._contextMap.get(e);t&&(this._contextMap.delete(e),this._blackboxProcessor&&(this._blackboxProcessor.remove(t),this._blackboxProcessor.getSize()===0&&(this._blackboxProcessor.dispose(),this._blackboxProcessor=void 0)));let n=this._flowMap.get(e);n&&(this._flowMap.delete(e),n.context.off("feedback",this.handleFeedback),n.context.emit("stopped")),t&&this._emit("stopRecording",t.recording)}dumpRecording(e,t){return rr(this,null,function*(){if(this._flowMap.has(e))return this._flowMap.get(e).dump();if(this._blackboxProcessor){let n={meta:t},i=yield this._blackboxProcessor.dump(e,n);return this._emit("dumpRecording",Sl(Lo({},i),{parent:e,refType:"blackbox"})),i}throw new Ve(`Unknown recording ${e}.`)})}dumpInMemoryRecording(e,t){return rr(this,null,function*(){if(this._blackboxProcessor)return this._blackboxProcessor.dumpInMemory(e,{meta:t})})}cacheRecordings(){return rr(this,null,function*(){return this._blackboxProcessor?this._blackboxProcessor.cache():[]})}uploadRecordingCaches(){return rr(this,null,function*(){var e;try{let t=(e=this._cacheOptions)==null?void 0:e.storageProvider.getStorage();if(t){let n=yield t.getRecordings();this._uploadRecordingCaches(n,t)}}catch(t){}})}_uploadRecordingCaches(e,t){return rr(this,null,function*(){for(let n of e){try{let{frames:i,startTime:o,endTime:s,mode:a,recordingOptions:l}=n;if(a===E.Blackbox){let{recording:c,transport:u}=yield yo(this.apiClient,l),h=u.strategies.find(f=>f.mode===E.Blackbox&&"channelType"in f),d=yield al(Dn(i,o),i.length,i[0].time,s,c.id,o,!0);yield this._retry.attempt(()=>On(this.apiClient,{blob:new Blob([d.data],{type:"application/octet-stream"}),recordingId:c.id,token:h.config.token,offset:d.frameRange[0],count:d.frameRange[1],firstFrameTime:d.firstFrameTime,lastFrameTime:d.lastFrameTime,isEOF:d.isEOF}))}}catch(i){}yield t.deleteRecordings(n)}})}_initCacheOptions(e){let t=Lo({limit:10},typeof(e==null?void 0:e.cache)=="boolean"?{}:e.cache);t.storageProvider||(t.storageProvider=new oi),this._cacheOptions=t}_initBlackboxOptions(e){this._blackboxOptions=Sl(Lo({},e.blackbox),{cache:this._cacheOptions})}_emit(e,...t){this._events.emit(e,...t)}on(e,t){this._events.on(e,t,{})}once(e,t){this._events.once(e,t,{})}off(e,t,n,i){this._events.off(e,t,{},i)}addListener(e,t){this._events.addListener(e,t,{})}removeListener(e,t,n,i){this._events.removeListener(e,t,{},i)}};var Go=class extends Wr{constructor(e){super(Pn.Standard,e)}createRecordingManager(){let e=new jn(this.options);return e.on("stopRecording",this._watchRecordingStop),e.on("dumpRecording",this._watchRecordingDump),e.on("frame",this._watchRecordingFrame),this.addInitialTask(new Promise(t=>{this.trackerSource&&e.observe(this.trackerSource),t()})),e}};var NX=Z(Q());var oC="136px",sC="48px",aC="64px",lC="32px",cC="_container_36akj_7",uC="_overlay_36akj_27",hC="_masking_36akj_37",dC="_controller_36akj_41",pC="_countdown_36akj_47",fC="_messageBox_36akj_52",mC="_handleBar_36akj_62",gC="_dot_36akj_78",vC="_initial_36akj_93",_C="_countingDown_36akj_97",yC="_center_36akj_103",bC="_stopButton_36akj_106",$C="_recording_36akj_113",wC="_mini_36akj_130",xC="_message_36akj_52",qC="_dragContainer_36akj_170",dd={controllerWidth:oC,controllerHeight:sC,miniControllerWidth:aC,miniControllerHeight:lC,container:cC,overlay:uC,masking:hC,controller:dC,countdown:pC,messageBox:fC,handleBar:mC,dot:gC,initial:vC,countingDown:_C,center:yC,stopButton:bC,recording:$C,mini:wC,"mini-recorder-controller-animation":"_mini-recorder-controller-animation_36akj_1",message:xC,dragContainer:qC};var CY=parseInt(dd.controllerWidth),IY=parseInt(dd.controllerHeight);(function(){"use strict";try{if(typeof document!="undefined"&&document.head){var r=document.createElement("style");r.appendChild(document.createTextNode("._container_1lxa9_1{display:flex;flex-direction:column;align-items:center;width:100%;transition:all .4s ease-in-out}._container_1lxa9_1 svg{display:block}._second_1lxa9_11{display:flex;align-items:center;position:absolute;height:120px;font-size:40px;transition:opacity .2s ease-in-out}._tips_1lxa9_19{margin-top:18px;transition:opacity .2s ease-in-out;text-align:center;padding:0 8px}._tips_1lxa9_19 span{color:#fd6f8e}._cancelButton_1lxa9_28{width:72px;height:32px;margin-top:24px;color:#fff;background:#ffffff1a;border:none;border-radius:8px;cursor:pointer}._stopped_1lxa9_38,._stopped_1lxa9_38 ._tips_1lxa9_19,._stopped_1lxa9_38 ._second_1lxa9_11{opacity:0}._container_2hh0t_1{display:flex;flex-direction:column;padding:16px}._title_2hh0t_6{color:#fff;margin-bottom:12px}._message_2hh0t_10{color:#98a2b3}._buttons_2hh0t_13{display:flex;flex-grow:1;justify-content:flex-end;align-items:flex-end}._buttons_2hh0t_13 button{min-width:80px;height:28px;margin-left:8px;border:none;color:#fff;background:#ffffff1a;border-radius:4px;cursor:pointer}._buttons_2hh0t_13 button._primary_2hh0t_29{background:linear-gradient(90deg,#fe1889,#ff5f7d),#f63d68}._container_15hlf_1{width:36px;height:36px;border-radius:36px;cursor:pointer;opacity:1}._container_15hlf_1:hover{opacity:1}._circle_15hlf_11{display:flex;width:36px;height:36px;align-items:center;justify-content:center;border-radius:36px;border:2px solid white}._rect_15hlf_20{width:14px;height:14px;background:#e54136;border-radius:2px}._active_15hlf_26._container_15hlf_1 ._rect_15hlf_20{animation:1.2s infinite alternate _stop-button-animation_15hlf_1}@keyframes _stop-button-animation_15hlf_1{0%{opacity:1}70%{opacity:.7}to{opacity:1}}._container_14o0x_1{display:flex;align-items:center}._stopButton_14o0x_5{transition:all .4s ease-in-out}._timeDisplay_14o0x_8{margin-left:9px;font-size:14px;transition:all .3s ease-in-out}._buttons_14o0x_13{display:flex;margin-left:4px}.mini ._container_14o0x_1{width:64px;height:32px}.mini ._container_14o0x_1._recording_14o0x_21{animation:1.2s infinite alternate _mini-recorder-controller-animation_14o0x_1}.mini ._container_14o0x_1 ._stopButton_14o0x_5{transform:scale(0);width:0;opacity:0}.mini ._container_14o0x_1 ._buttons_14o0x_13{opacity:0}._container_36akj_7{display:flex;align-items:center;justify-content:center;position:fixed;z-index:9999999;width:136px;height:48px;color:#fff;background:linear-gradient(63.44deg,#1d2939 16.72%,#475467 83.39%);border-radius:32px;user-select:none;font-size:14px;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;cursor:default;transition:all .3s ease-in-out}._container_36akj_7 *{box-sizing:border-box}._overlay_36akj_27{position:fixed;z-index:9999998;inset:0;user-select:none;transition:all .3s ease-in-out}._overlay_36akj_27._masking_36akj_37{user-select:all;backdrop-filter:brightness(66%) blur(4px)}._controller_36akj_41{position:absolute;margin-left:8px;opacity:0;transition:all .3s ease-in-out}._countdown_36akj_47{position:absolute;opacity:0;transition:all .5s ease-in-out}._messageBox_36akj_52{position:absolute;inset:0;opacity:0;pointer-events:none;transition:all .24s ease-in-out}._handleBar_36akj_62{display:flex;flex-wrap:wrap;position:absolute;right:16px;width:24px;height:24px;padding:2px 4px;pointer-events:none;cursor:move;opacity:0;transition:opacity .3s ease-in-out}._handleBar_36akj_62 ._dot_36akj_78{display:flex;align-items:center;justify-content:center;flex-grow:0;flex-shrink:0;width:50%;height:33%}._handleBar_36akj_62 ._dot_36akj_78>div{width:3px;height:3px;border-radius:100%;background:#d9d9d9}._initial_36akj_93._container_36akj_7{opacity:0;transform:translateY(-100px)}._countingDown_36akj_97._container_36akj_7{width:216px;height:268px;border-radius:24px;transition:all .5s ease-in-out}._countingDown_36akj_97._container_36akj_7._center_36akj_103{transform:translate(-40px)}._countingDown_36akj_97._container_36akj_7 ._controller_36akj_41 ::global(._stopButton_36akj_106){transform:translate(200px) scale(7)}._countingDown_36akj_97._container_36akj_7 ._countdown_36akj_47{opacity:1;transform:none}._recording_36akj_113._container_36akj_7{justify-content:flex-start;transition:all .3s ease-in-out}._recording_36akj_113._container_36akj_7 ._controller_36akj_41{opacity:1}._recording_36akj_113._container_36akj_7 ._countdown_36akj_47{transform:scale(.3) translate(-200px,-20px)}._recording_36akj_113._container_36akj_7 ._handleBar_36akj_62{opacity:.5;pointer-events:all}._recording_36akj_113._container_36akj_7 ._handleBar_36akj_62:hover{opacity:1}._mini_36akj_130._container_36akj_7{overflow:hidden;width:64px;height:32px;border-radius:24px;background:linear-gradient(63.44deg,#1d2939 16.72%,#475467 83.39%);transition:all .4s ease-in-out}._mini_36akj_130._container_36akj_7.recording{animation:1.2s infinite alternate _mini-recorder-controller-animation_36akj_1}._mini_36akj_130._container_36akj_7._center_36akj_103{transform:translate(36px)}._mini_36akj_130._container_36akj_7 ._controller_36akj_41{opacity:1}._message_36akj_52._container_36akj_7{width:300px;height:140px;border-radius:24px}._message_36akj_52._container_36akj_7._center_36akj_103{transform:translate(-82px)}._message_36akj_52._container_36akj_7 ._messageBox_36akj_52{opacity:1;pointer-events:all}@keyframes _mini-recorder-controller-animation_36akj_1{0%{background:#f04438}70%{background:#d92d20}to{background:#f04438}}._dragContainer_36akj_170{position:absolute;inset:0;z-index:9999997}")),document.head.appendChild(r)}}catch(e){console.error("Failed to inject CSS.",e)}})();var pd=["https://sgali-mcs.","https://maliva-mcs.","https://mcs-sg.","https://mcs-va.","https://mcs-va-useast2a.","https://mcs.","https://mcs-ttp2.","https://mcs-ie.","https://mcs-ie2.","https://mcs16-normal-no1a.","https://mon.","https://mssdk.","https://tnc3-"];var Hn="sr_",fd=(r,e)=>!!(r.entryType==="resource"&&r.name&&(pd.some(t=>r.name.startsWith(t))||e&&r.name.startsWith(e))),qb=(r,e)=>fd(r,e)?!0:r.entryType==="longtask"?r.duration<1e3:r.entryType==="resource"?r.duration<3e3:!1,Tb=(r,e)=>!!(r.url&&(pd.some(t=>r.url.startsWith(t))||e&&r.url.startsWith(e)));function md(r,e){let U=r!=null?r:{},{html:t,environment:n,network:i,performance:o,console:s,trackers:a,tea:l,teaEventType:c,sdk:u,verbose:h}=U,d=nr(U,["html","environment","network","performance","console","trackers","tea","teaEventType","sdk","verbose"]),L=i!=null?i:{},{shouldIgnoreRequest:f}=L,y=nr(L,["shouldIgnoreRequest"]),D=o!=null?o:{},{shouldIgnoreTiming:_}=D,q=nr(D,["shouldIgnoreTiming"]),ee=s!=null?s:{},{stringifyOptions:k}=ee,O=nr(ee,["stringifyOptions"]);return H({html:H({navigation:!0},t),trackers:a!=null?a:["HTML","Mouse","Network","Console","Error","Performance","Insight"],environment:H(H({},e),n),network:H({shouldIgnoreRequest:G=>(f==null?void 0:f(G))?!0:Tb(G,n==null?void 0:n.baseURL)},y),performance:H({shouldIgnoreTiming:G=>_?(_==null?void 0:_(G))||fd(G,n==null?void 0:n.baseURL):qb(G,n==null?void 0:n.baseURL)},q),console:H({stringifyOptions:H({maxDepth:2},k)},O)},d)}var Wo=function(r){return r&&r.Math===Math&&r},gd=Wo(typeof globalThis=="object"&&globalThis)||Wo(typeof window=="object"&&window)||Wo(typeof self=="object"&&self)||Wo(typeof global=="object"&&global)||Wo(!1)||function(){return this}()||Function("return this")(),TC=class{constructor(r,e){this.teaEventType=r,this.sdkCollectEvent=e,this.config=t=>{var n;(n=this==null?void 0:this.collectEvent)==null||n.call(this,"config",t)},this.event=(t,n)=>{var i,o;this.teaEventType==="xhr"?(i=this==null?void 0:this.collectEvent)==null||i.call(this,t,n):(o=this==null?void 0:this.collectEvent)==null||o.call(this,"beconEvent",t,n)},this.start=()=>{var t;(t=this==null?void 0:this.collectEvent)==null||t.call(this,"start")}}get collectEvent(){var r,e;return(e=this.sdkCollectEvent)!=null?e:this.teaExport?(r=gd)==null?void 0:r[this.teaExport]:void 0}get appId(){var r;return(r=this==null?void 0:this.collectEvent)==null?void 0:r.call(this,"getConfig","app_id")}get teaExport(){return gd.LogAnalyticsObject||gd.TeaAnalyticsObject}},BC=class{constructor(r,e){this.tea=r,this.teaEventType=e,this.config=t=>{this.tea.config(t)},this.event=(t,n)=>{this.teaEventType==="xhr"?this.tea.event(t,n):this.tea.beconEvent(t,n)},this.start=()=>{var t,n;(n=(t=this.tea).start)==null||n.call(t)}}get appId(){return this.tea.getConfig("app_id")}};function Bb(r,e){return r&&"config"in r?new BC(r,e):new TC(e,r)}function Sb(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,r=>(r^crypto.getRandomValues(new Uint8Array(1))[0]&15>>r/4).toString(16))}function Eb(){let r=Sb().replace(/-/g,""),e=new Date().toISOString().substring(0,19).replace(/[-:T]/g,"");return r+e}var SC="color: black;background: #5bfff3;padding: 2px 4px;border-radius: 8px;",El=class{constructor(e,t){W(this,"_enabled");W(this,"_tag");this._enabled=e,this._tag=t}log(e,t,...n){this._enabled&&console.log(`%c${this._tag}${e?`:${e}`:""}`,SC,t,...n)}};function kb(r,e){if(!r||r.length===0)return[];let t=new Set,n=[],i=typeof e=="function"?e:o=>o[e];for(let o of r){let s=i(o);t.has(s)||(t.add(s),n.push(o))}return n}var Rb=r=>{var t;if(!r||(r==null?void 0:r.enable)===0)return!1;if(r.switch===0)return!0;let e=((t=r.rate)!=null?t:100)/100;if(r.rules){let{mode:n,operation:i,urls:o}=r.rules,s=typeof window!="undefined"?window.location.href:"";if(n===2){if(o&&o.length>0){for(let a of o)if(i==="="&&s===a||i==="contains"&&s.includes(a)||i==="regexp"&&new RegExp(a).test(s))return!0}return Math.random()>e}if(n===1){if(o&&o.length>0){for(let a of o)if(i==="="&&s===a||i==="contains"&&s.includes(a)||i==="regexp"&&new RegExp(a).test(s))return Math.random()>e}return!0}}return Math.random()>e};var Ob=(r,e)=>{if(e!=null&&e.enable&&(e==null?void 0:e.desensitize_mode)===1){let t={};return t.maskingLevel=Pe.STRICT,t}return r};var Rl=class Rl{constructor(e){W(this,"_options");this._options=this._normalize(e)}attempt(e,t){return V(this,null,function*(){return typeof e!="function"?Promise.reject(new Error("executor is not function")):this._attempt(e,this._normalize(t,this._options))})}_attempt(e,t,n=1){return V(this,null,function*(){return e().catch(i=>{if(t.shouldRetry&&!t.shouldRetry(i))throw i;if(n<t.retries)return this._delay(this._randomTimeout(n,t)).then(()=>this._attempt(e,t,n+1));throw i})})}_normalize(e,t=Rl.DEFAULT_OPTIONS){let n=H({},t);if(e){let{retries:i,initialTimeout:o,maxTimeout:s,randomize:a}=e;i!=null&&i>=0&&(n.retries=i),o!=null&&o>=0&&(n.initialTimeout=o),s!=null&&s>=n.initialTimeout&&(n.maxTimeout=s),a!=null&&a>=1&&a<=2&&(a<1?n.randomize=1:a>2?n.randomize=2:n.randomize=a),e!=null&&e.shouldRetry&&(n.shouldRetry=e.shouldRetry)}return n}_delay(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}_randomTimeout(e,t){let{randomize:n,initialTimeout:i,maxTimeout:o,factor:s}=t;return Math.min(n*i*jo(s,e),o)}};W(Rl,"DEFAULT_OPTIONS",{retries:3,initialTimeout:1e3,maxTimeout:1/0,randomize:1.5,factor:1.5,shouldRetry:()=>!0});var kl=Rl;var Cb=r=>{if(!r)return"/";let e=r.trim();return e.startsWith("/")||(e="/"+e),e.endsWith("/")&&e.length>1&&(e=e.slice(0,-1)),e};var kC=r=>typeof r=="function",Fo=class{constructor(e,t,n){this._recorder=e;this._options=t;this._env=n;W(this,"_candidates",new Set);W(this,"_log");W(this,"_apiClient");W(this,"_environment");W(this,"_contextMap",new Map);W(this,"_sdkAdapterMap",new WeakMap);W(this,"_startRecordingRetry",new kl({retries:3,initialTimeout:1e3,shouldRetry:e=>(this._log.log("retry","handle error",e),e&&typeof e=="object"&&"code"in e&&(e.code==="BR_RECORDING_DUPLICATED"||e.code==="BR_RECORDING_CREATE_BODY_INVALID"||e.code==="BR_RECORDING_ID_EMPTY_FAIL"||e.code==="BR_AUTH_BAD_APP_KEY"||e.code==="BR_AUTH_BAD_APP_SECRET"||e.code==="BR_AUTH_RECORDING_NOT_MATCH"||e.code==="BR_AUTH_SIGN_METHOD"||e.code==="BR_AUTH_TOKEN_EMPTY"||e.code==="BR_AUTH_TOKEN_EXPIRED"||e.code==="BR_AUTH_TOKEN_INVALID"||e.code==="BR_AUTH_INVALID"||e.code==="BR_APP_KEY_EXPIRED")?(this._log.log("retry","should not retry",e),!1):!0)}));W(this,"_beforeStartRecording",e=>V(this,null,function*(){var q,O,U;let t=this._createAdapter(H(H({},this._options),e));try{(q=t.start)==null||q.call(t)}catch(L){console.warn("[session replay] Failed to start log sdk, you may need to call SDK.start() manually",L)}let n=Eb(),k=e,{extraStartParams:i,tokenProvider:o,tags:s,dataLevel:a,mode:l=E.Streaming,tea:c,sdk:u,teaEventType:h}=k,d=nr(k,["extraStartParams","tokenProvider","tags","dataLevel","mode","tea","sdk","teaEventType"]),[f,y]=yield this._createToken(n,t,o,d.token),_=this._recorder.options.html;return[Zn(H({id:n,token:f,mode:l},d),{meta:H({tags:s,[`${Hn}config`]:{html:{iframe:(O=_==null?void 0:_.iframe)!=null?O:!1,canvas:(U=_==null?void 0:_.canvas)!=null?U:!1}},[`${Hn}version`]:"0.4.42",[`${Hn}data_level`]:a!=null?a:2,[`${Hn}extra_start_params`]:i},d.meta)}),t,y]}));W(this,"_afterStartRecording",(e,t,n)=>{this._contextMap.set(e,{appId:n,adapter:t}),e.recording.mode!==E.Blackbox&&(this._configRecordingId(e.recording.id,t),this._emitStartEvent(e.recording,t),e.on("stopped",()=>{var o;this._log.log("context-event","recording stopped",e.recording.id);let i=(o=this._contextMap.get(e))==null?void 0:o.adapter;i==null||i.config({sr_recording_id:void 0}),this._contextMap.delete(e)}))});W(this,"_configRecordingId",(e,t)=>{t.config({sr_recording_id:e})});W(this,"_emitStartEvent",(e,t,n)=>{var u,h,d,f;let i;if(n===E.Blackbox?i=t!=null?t:(u=this._getConfigByRecordingId(e.parent||""))==null?void 0:u.adapter:i=t!=null?t:(h=this._getConfigByRecordingId(e.id))==null?void 0:h.adapter,!i)return;let o=(d=e.meta)==null?void 0:d.tags,s=(f=e.meta)==null?void 0:f[`${Hn}extra_start_params`],a=o?JSON.stringify(o):void 0,l=new Date().toISOString(),c=H({sr_recording_id:e.id,sr_mode:e.mode,sr_client_time:l,sr_server_time:l,sr_tags:a,sr_ref_type:e.refType,sr_ref_id:e.parent,sr_trackers:e.trackers?JSON.stringify(e.trackers):void 0,sr_environment:e.environment?JSON.stringify(e.environment):void 0,sr_referrer:document.referrer,sr_url:location.href},s);n===E.Blackbox&&(c.$sr_recording_id=e.id),this._log.log("emit-start-event","sr_start_recording",c),i.event("sr_start_recording",c)});W(this,"_emitInsightEvent",e=>{if(!e)return;let t=e.event,n=this._getAllAdapters();for(let[i,{adapter:o}]of n)switch(t==null?void 0:t.eventType){case 701:{let s=e.event.data,a={sr_recording_id:i.recording.id,sr_insight_rage_click_duration:s.duration,sr_insight_rage_click_clicks:s.clicks,sr_insight_rage_click_x:s.x,sr_insight_rage_click_y:s.y,sr_insight_rage_click_buttons:s.buttons,sr_insight_rage_click_targetId:s.targetId,sr_insight_rage_click_time:performance.now(),sr_referrer:document.referrer,sr_url:location.href};this._log.log("emit-insight-event","sr_insight_rage_click",a),o.event("sr_insight_rage_click",a);break}case 702:{let s=e.event.data,a={sr_recording_id:i.recording.id,sr_insight_dead_click_duration:s.duration,sr_insight_dead_click_x:s.x,sr_insight_dead_click_y:s.y,sr_insight_dead_click_buttons:s.buttons,sr_insight_dead_click_targetId:s.targetId,sr_insight_dead_click_time:performance.now(),sr_referrer:document.referrer,sr_url:location.href};this._log.log("emit-insight-event","sr_insight_dead_click",a),o.event("sr_insight_dead_click",a);break}case 703:{let s=e.event.data,a={sr_recording_id:i.recording.id,sr_insight_long_hover_duration:s.duration,sr_insight_long_hover_x:s.x,sr_insight_long_hover_y:s.y,sr_insight_long_hover_targetId:s.targetId,sr_insight_long_hover_time:performance.now(),sr_referrer:document.referrer,sr_url:location.href};this._log.log("emit-insight-event","sr_insight_long_hover",a),o.event("sr_insight_long_hover",a);break}case 704:{let s=e.event.data,a={sr_recording_id:i.recording.id,sr_insight_excessive_scrolling_distance:s.distance,sr_insight_excessive_scrolling_duration:s.duration,sr_insight_excessive_scrolling_targetId:s.targetId,sr_insight_excessive_scrolling_time:performance.now(),sr_referrer:document.referrer,sr_url:location.href};this._log.log("emit-insight-event","sr_insight_excessive_scrolling",a),o.event("sr_insight_excessive_scrolling",a);break}case 801:{let s=e.event.data;Array.isArray(s)&&s.forEach(a=>{let l={sr_recording_id:i.recording.id,sr_performance_long_task_timing_name:a.name,sr_performance_long_task_timing_duration:a.duration,sr_performance_long_task_timing_start_time:a.startTime,sr_referrer:document.referrer,sr_url:location.href};this._log.log("emit-insight-event","sr_performance_long_task_timing",l),o.event("sr_performance_long_task_timing",l)});break}case 802:{let s=e.event.data;Array.isArray(s)&&s.forEach(a=>{var d,f,y;let l,c,u;for(let _ of(d=a.serverTiming)!=null?d:[])switch(_.name){case"inner":l=_.duration;break;case"tt_agw":c=_.duration;break;case"origin":u=_.duration;break}let h={sr_recording_id:i.recording.id,sr_referrer:document.referrer,sr_url:location.href,sr_performance_resource_timing_name:a.name,sr_performance_resource_timing_duration:a.duration,sr_performance_resource_timing_initiator_type:a.initiatorType,sr_performance_resource_delivery_type:a.deliveryType,sr_performance_resource_next_hop_protocol:a.nextHopProtocol,sr_performance_resource_render_blocking_status:a.renderBlockingStatus,sr_performance_resource_response_status:a.responseStatus,sr_performance_resource_stats_total:a.stats.total,sr_performance_resource_stats_redirect:a.stats.redirect,sr_performance_resource_stats_service_worker:a.stats.serviceWorker,sr_performance_resource_stats_dns:a.stats.dns,sr_performance_resource_stats_tcp:a.stats.tcp,sr_performance_resource_stats_content_download:a.stats.contentDownload,sr_performance_resource_stats_ttfb:a.stats.ttfb,sr_performance_resource_stats_server:(f=a.stats.server)!=null?f:a.stats.total,sr_performance_resource_stats_client:(y=a.stats.client)!=null?y:0,sr_performance_resource_request_start:a.requestStart,sr_performance_resource_response_start:a.responseStart,sr_performance_resource_response_end:a.responseEnd,sr_performance_resource_server_timing_inner_duration:l,sr_performance_resource_server_timing_tt_agw_duration:c,sr_performance_resource_server_timing_origin_duration:u};this._log.log("emit-insight-event","sr_performance_resource_timing",h),o.event("sr_performance_resource_timing",h)});break}}});W(this,"_createToken",(e,t,n,i)=>V(this,null,function*(){let o;try{o=t.appId}catch(s){throw console.error("[session replay] Failed to get appId. You may have passed an uninitialized SDK or no SDK was provided",s),s}if(kC(n))try{return[yield n(e),o]}catch(s){throw new Error("Error executing token provider",{cause:s})}if(i)return[i,o];if(o!==void 0)return[`tea-${o}`,o];throw new Error("Missing tea app id or token.")}));W(this,"_createAdapter",e=>{var o,s;let t=(o=e==null?void 0:e.tea)!=null?o:e==null?void 0:e.sdk,n=(s=e==null?void 0:e.teaEventType)!=null?s:"beacon";if(t&&this._sdkAdapterMap.has(t)){let a=this._sdkAdapterMap.get(t);return a&&a.eventType!==n&&console.error(`[session replay] Same tea instance, but different event send type, from ${a.eventType} to ${n}, this may cause unexpected behavior`),this._sdkAdapterMap.get(t).adapter}let i=Bb(t,n);return t&&this._sdkAdapterMap.set(t,{adapter:i,eventType:n}),i});W(this,"_getConfigByRecordingId",e=>{let t=Array.from(this._contextMap.keys()).find(n=>n.recording.id===e);if(t)return this._contextMap.get(t)});W(this,"_getAllAdapters",()=>{let e=Array.from(this._contextMap.entries()).filter(([t])=>t.recording.mode!==E.Blackbox);return kb(e,([,{adapter:t}])=>t)});var i,o;this._log=new El((i=t==null?void 0:t.verbose)!=null?i:!1,"replay:recorder"),this._environment=H(H({},n||{}),((o=this._options)==null?void 0:o.environment)||{}),this._bindEvents(),this._apiClient=new rt(new Ae(t==null?void 0:t.environment))}startRecording(e,t){return V(this,null,function*(){let[n,i,o]=yield this._beforeStartRecording(t),s=yield this.checkCloudControlConfig(n.token);if(Rb(s))return{};this._recorder.options.html=Ob(this._recorder.options.html,s),this._log.log("start-recording","config generated",n);let a=yield this._startRecordingRetry.attempt(()=>e(n));return this._log.log("start-recording","success",a),this._afterStartRecording(a,i,o),a})}checkCloudControlConfig(e){return V(this,null,function*(){var t,n,i;try{let o=`${Cb((n=(t=this._environment)==null?void 0:t.apiPrefix)!=null?n:"/api")}/sdk/config?platform=web`;return yield(i=this._apiClient)==null?void 0:i.get(o,void 0,{Authorization:e})}catch(o){return console.warn("[session replay] Failed to get cloud control config",o),{enable:0}}})}get version(){return"ReplaySDK 0.4.42"}_bindEvents(){this._recorder.on("dumpRecording",e=>{this._emitStartEvent(e,void 0,E.Blackbox)}),this._recorder.on("frame",this._emitInsightEvent)}};var Ib=(i=>(i[i.L1=1]="L1",i[i.L2=2]="L2",i[i.L3=3]="L3",i[i.L4=4]="L4",i))(Ib||{});$s("data-finder-replay-mask");var Ol={baseURL:["https://gator","volces","com"].join("."),apiPrefix:"replay/openapi/"},vd=class r extends Go{constructor(t){super(md(t,Ol));W(this,"_teaRecorderCore");W(this,"startRecording",t=>V(this,null,function*(){return this._teaRecorderCore.startRecording(n=>Pl(r.prototype,this,"startRecording").call(this,n),t)}));this._teaRecorderCore=new Fo(this,t,Ol)}get version(){return this._teaRecorderCore.version}},_d=class r extends Fr{constructor(t){super(md(t,Ol));W(this,"_teaRecorderCore");W(this,"startRecording",t=>V(this,null,function*(){return this._teaRecorderCore.startRecording(n=>Pl(r.prototype,this,"startRecording").call(this,n),t)}));this._teaRecorderCore=new Fo(this,t,Ol)}get version(){return this._teaRecorderCore.version}};return Gb(RC);})();
/*! Bundled license information:

formdata-polyfill/formdata.min.js:
  (*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> *)

@bytereplay/snapshot/dist/es/capturing/capture-mutations.js:
  (*! remove node if exists check when some dom reused by the micro-frontend framework like Garfish *)

comlink/dist/esm/comlink.mjs:
  (**
   * @license
   * Copyright 2019 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
